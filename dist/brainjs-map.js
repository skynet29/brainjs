/*
 Leaflet 1.0.3+ed36a04, a JS library for interactive maps. http://leafletjs.com
 (c) 2010-2016 Vladimir Agafonkin, (c) 2010-2011 CloudMade
*/
!function(t,e,i){function n(){var e=t.L;o.noConflict=function(){return t.L=e,this},t.L=o}var o={version:"1.0.3+ed36a04"};"object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd&&define(o),"undefined"!=typeof t&&n(),o.Util={extend:function(t){var e,i,n,o;for(i=1,n=arguments.length;i<n;i++){o=arguments[i];for(e in o)t[e]=o[e]}return t},create:Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}(),bind:function(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}},stamp:function(t){return t._leaflet_id=t._leaflet_id||++o.Util.lastId,t._leaflet_id},lastId:0,throttle:function(t,e,i){var n,o,s,r;return r=function(){n=!1,o&&(s.apply(i,o),o=!1)},s=function(){n?o=arguments:(t.apply(i,arguments),setTimeout(r,e),n=!0)}},wrapNum:function(t,e,i){var n=e[1],o=e[0],s=n-o;return t===n&&i?t:((t-o)%s+s)%s+o},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,e){t.hasOwnProperty("options")||(t.options=t.options?o.Util.create(t.options):{});for(var i in e)t.options[i]=e[i];return t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&e.indexOf("?")!==-1?"&":"?")+n.join("&")},template:function(t,e){return t.replace(o.Util.templateRe,function(t,n){var o=e[n];if(o===i)throw new Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(e)),o})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},indexOf:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){return t["webkit"+e]||t["moz"+e]||t["ms"+e]}function i(e){var i=+new Date,o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(e,o)}var n=0,s=t.requestAnimationFrame||e("RequestAnimationFrame")||i,r=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};o.Util.requestAnimFrame=function(e,n,r){return r&&s===i?void e.call(n):s.call(t,o.bind(e,n))},o.Util.cancelAnimFrame=function(e){e&&r.call(t,e)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,n=o.Util.create(i);n.constructor=e,e.prototype=n;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(e[s]=this[s]);return t.statics&&(o.extend(e,t.statics),delete t.statics),t.includes&&(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),n.options&&(t.options=o.Util.extend(o.Util.create(n.options),t.options)),o.extend(n,t),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;t<e;t++)n._initHooks[t].call(this)}},e},o.Class.include=function(t){return o.extend(this.prototype,t),this},o.Class.mergeOptions=function(t){return o.extend(this.prototype.options,t),this},o.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this},o.Evented=o.Class.extend({on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else{t=o.Util.splitWords(t);for(var s=0,r=t.length;s<r;s++)this._on(t[s],e,i)}return this},off:function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else{t=o.Util.splitWords(t);for(var s=0,r=t.length;s<r;s++)this._off(t[s],e,i)}else delete this._events;return this},_on:function(t,e,n){this._events=this._events||{};var o=this._events[t];o||(o=[],this._events[t]=o),n===this&&(n=i);for(var s={fn:e,ctx:n},r=o,a=0,h=r.length;a<h;a++)if(r[a].fn===e&&r[a].ctx===n)return;r.push(s)},_off:function(t,e,n){var s,r,a;if(this._events&&(s=this._events[t])){if(!e){for(r=0,a=s.length;r<a;r++)s[r].fn=o.Util.falseFn;return void delete this._events[t]}if(n===this&&(n=i),s)for(r=0,a=s.length;r<a;r++){var h=s[r];if(h.ctx===n&&h.fn===e)return h.fn=o.Util.falseFn,this._firingCount&&(this._events[t]=s=s.slice()),void s.splice(r,1)}}},fire:function(t,e,i){if(!this.listens(t,i))return this;var n=o.Util.extend({},e,{type:t,target:this});if(this._events){var s=this._events[t];if(s){this._firingCount=this._firingCount+1||1;for(var r=0,a=s.length;r<a;r++){var h=s[r];h.fn.call(h.ctx||this,n)}this._firingCount--}}return i&&this._propagateEvent(n),this},listens:function(t,e){var i=this._events&&this._events[t];if(i&&i.length)return!0;if(e)for(var n in this._eventParents)if(this._eventParents[n].listens(t,e))return!0;return!1},once:function(t,e,i){if("object"==typeof t){for(var n in t)this.once(n,t[n],e);return this}var s=o.bind(function(){this.off(t,e,i).off(t,s,i)},this);return this.on(t,e,i).on(t,s,i)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[o.stamp(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[o.stamp(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,o.extend({layer:t.target},t),!0)}});var s=o.Evented.prototype;s.addEventListener=s.on,s.removeEventListener=s.clearAllEventListeners=s.off,s.addOneTimeEventListener=s.once,s.fireEvent=s.fire,s.hasEventListeners=s.listens,o.Mixin={Events:s},function(){var i=navigator.userAgent.toLowerCase(),n=e.documentElement,s="ActiveXObject"in t,r=i.indexOf("webkit")!==-1,a=i.indexOf("phantom")!==-1,h=i.search("android [23]")!==-1,l=i.indexOf("chrome")!==-1,u=i.indexOf("gecko")!==-1&&!r&&!t.opera&&!s,c=0===navigator.platform.indexOf("Win"),d="undefined"!=typeof orientation||i.indexOf("mobile")!==-1,_=!t.PointerEvent&&t.MSPointerEvent,m=t.PointerEvent||_,p=s&&"transition"in n.style,f="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!h,g="MozPerspective"in n.style,v="OTransition"in n.style,y=!t.L_NO_TOUCH&&(m||"ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch);o.Browser={ie:s,ielt9:s&&!e.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in e),webkit:r,gecko:u,android:i.indexOf("android")!==-1,android23:h,chrome:l,safari:!l&&i.indexOf("safari")!==-1,win:c,ie3d:p,webkit3d:f,gecko3d:g,opera12:v,any3d:!t.L_DISABLE_3D&&(p||f||g)&&!v&&!a,mobile:d,mobileWebkit:d&&r,mobileWebkit3d:d&&f,mobileOpera:d&&t.opera,mobileGecko:d&&u,touch:!!y,msPointer:!!_,pointer:!!m,retina:(t.devicePixelRatio||t.screen.deviceXDPI/t.screen.logicalXDPI)>1}}(),o.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new o.Point(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new o.Point(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(t){t=o.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=o.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,e,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===i||null===t?t:"object"==typeof t&&"x"in t&&"y"in t?new o.Point(t.x,t.y):new o.Point(t,e,n)},o.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,r=s.x>=e.x&&n.x<=i.x,a=s.y>=e.y&&n.y<=i.y;return r&&a},overlaps:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,r=s.x>e.x&&n.x<i.x,a=s.y>e.y&&n.y<i.y;return r&&a},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,e){return!t||t instanceof o.Bounds?t:new o.Bounds(t,e)},o.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},o.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new o.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i]||t.currentStyle&&t.currentStyle[i];if((!n||"auto"===n)&&e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},create:function(t,i,n){var o=e.createElement(t);return o.className=i||"",n&&n.appendChild(o),o},remove:function(t){var e=t.parentNode;e&&e.removeChild(t)},empty:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},toFront:function(t){t.parentNode.appendChild(t)},toBack:function(t){var e=t.parentNode;e.insertBefore(t,e.firstChild)},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=o.DomUtil.getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=o.Util.splitWords(e),s=0,r=n.length;s<r;s++)t.classList.add(n[s]);else if(!o.DomUtil.hasClass(t,e)){var a=o.DomUtil.getClass(t);o.DomUtil.setClass(t,(a?a+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):o.DomUtil.setClass(t,o.Util.trim((" "+o.DomUtil.getClass(t)+" ").replace(" "+e+" "," ")))},setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&o.DomUtil._setOpacityIE(t,e)},_setOpacityIE:function(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},setTransform:function(t,e,i){var n=e||new o.Point(0,0);t.style[o.DomUtil.TRANSFORM]=(o.Browser.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")},setPosition:function(t,e){t._leaflet_pos=e,o.Browser.any3d?o.DomUtil.setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos||new o.Point(0,0)}},function(){o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var i=o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);if(o.DomUtil.TRANSITION_END="webkitTransition"===i||"OTransition"===i?i+"End":"transitionend","onselectstart"in e)o.DomUtil.disableTextSelection=function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},o.DomUtil.enableTextSelection=function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)};else{var n=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.DomUtil.disableTextSelection=function(){if(n){var t=e.documentElement.style;this._userSelect=t[n],t[n]="none"}},o.DomUtil.enableTextSelection=function(){n&&(e.documentElement.style[n]=this._userSelect,delete this._userSelect)}}o.DomUtil.disableImageDrag=function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},o.DomUtil.enableImageDrag=function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)},o.DomUtil.preventOutline=function(e){for(;e.tabIndex===-1;)e=e.parentNode;e&&e.style&&(o.DomUtil.restoreOutline(),this._outlineElement=e,this._outlineStyle=e.style.outline,e.style.outline="none",o.DomEvent.on(t,"keydown",o.DomUtil.restoreOutline,this))},o.DomUtil.restoreOutline=function(){this._outlineElement&&(this._outlineElement.style.outline=this._outlineStyle,delete this._outlineElement,delete this._outlineStyle,o.DomEvent.off(t,"keydown",o.DomUtil.restoreOutline,this))}}(),o.LatLng=function(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,n!==i&&(this.alt=+n)},o.LatLng.prototype={equals:function(t,e){if(!t)return!1;t=o.latLng(t);var n=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return n<=(e===i?1e-9:e)},toString:function(t){return"LatLng("+o.Util.formatNum(this.lat,t)+", "+o.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){return o.CRS.Earth.distance(this,o.latLng(t))},wrap:function(){return o.CRS.Earth.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return o.latLngBounds([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new o.LatLng(this.lat,this.lng,this.alt)}},o.latLng=function(t,e,n){return t instanceof o.LatLng?t:o.Util.isArray(t)&&"object"!=typeof t[0]?3===t.length?new o.LatLng(t[0],t[1],t[2]):2===t.length?new o.LatLng(t[0],t[1]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new o.LatLng(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===i?null:new o.LatLng(t,e,n)},o.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])},o.LatLngBounds.prototype={extend:function(t){var e,i,n=this._southWest,s=this._northEast;if(t instanceof o.LatLng)e=t,i=t;else{if(!(t instanceof o.LatLngBounds))return t?this.extend(o.latLng(t)||o.latLngBounds(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||s?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),s.lat=Math.max(i.lat,s.lat),s.lng=Math.max(i.lng,s.lng)):(this._southWest=new o.LatLng(e.lat,e.lng),this._northEast=new o.LatLng(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new o.LatLngBounds(new o.LatLng(e.lat-n,e.lng-s),new o.LatLng(i.lat+n,i.lng+s))},getCenter:function(){return new o.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new o.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof o.LatLng||"lat"in t?o.latLng(t):o.latLngBounds(t);var e,i,n=this._southWest,s=this._northEast;return t instanceof o.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=s.lat&&e.lng>=n.lng&&i.lng<=s.lng},intersects:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>=e.lat&&n.lat<=i.lat,a=s.lng>=e.lng&&n.lng<=i.lng;return r&&a},overlaps:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),r=s.lat>e.lat&&n.lat<i.lat,a=s.lng>e.lng&&n.lng<i.lng;return r&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return!!t&&(t=o.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast()))},isValid:function(){return!(!this._southWest||!this._northEast)}},o.latLngBounds=function(t,e){return t instanceof o.LatLngBounds?t:new o.LatLngBounds(t,e)},o.Projection={},o.Projection.LonLat={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new o.LatLng(t.y,t.x)},bounds:o.bounds([-180,-90],[180,90])},o.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=Math.sin(n*e);return new o.Point(this.R*t.lng*e,this.R*Math.log((1+s)/(1-s))/2)},unproject:function(t){var e=180/Math.PI;return new o.LatLng((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return o.bounds([-t,-t],[t,t])}()},o.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t),n=this.transformation.transform(e.min,i),s=this.transformation.transform(e.max,i);return o.bounds(n,s)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?o.Util.wrapNum(t.lng,this.wrapLng,!0):t.lng,i=this.wrapLat?o.Util.wrapNum(t.lat,this.wrapLat,!0):t.lat,n=t.alt;return o.latLng(i,e,n)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),n=e.lat-i.lat,s=e.lng-i.lng;if(0===n&&0===s)return t;var r=t.getSouthWest(),a=t.getNorthEast(),h=o.latLng({lat:r.lat-n,lng:r.lng-s}),l=o.latLng({lat:a.lat-n,lng:a.lng-s});return new o.LatLngBounds(h,l)}},o.CRS.Simple=o.extend({},o.CRS,{projection:o.Projection.LonLat,transformation:new o.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0}),o.CRS.Earth=o.extend({},o.CRS,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,o=e.lat*i,s=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((e.lng-t.lng)*i);return this.R*Math.acos(Math.min(s,1))}}),o.CRS.EPSG3857=o.extend({},o.CRS.Earth,{code:"EPSG:3857",projection:o.Projection.SphericalMercator,transformation:function(){var t=.5/(Math.PI*o.Projection.SphericalMercator.R);return new o.Transformation(t,.5,-t,.5)}()}),o.CRS.EPSG900913=o.extend({},o.CRS.EPSG3857,{code:"EPSG:900913"}),o.CRS.EPSG4326=o.extend({},o.CRS.Earth,{code:"EPSG:4326",projection:o.Projection.LonLat,transformation:new o.Transformation(1/180,1,-1/180,.5)}),o.Map=o.Evented.extend({options:{crs:o.CRS.EPSG3857,center:i,zoom:i,minZoom:i,maxZoom:i,layers:[],maxBounds:i,renderer:i,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=o.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.zoom!==i&&(this._zoom=this._limitZoom(e.zoom)),e.center&&e.zoom!==i&&this.setView(o.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._zoomAnimated=o.DomUtil.TRANSITION&&o.Browser.any3d&&!o.Browser.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),o.DomEvent.on(this._proxy,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(o.latLng(t),e,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate,duration:n.duration},n.pan));var s=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(o.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(o.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),r=t instanceof o.Point?t:this.latLngToContainerPoint(t),a=r.subtract(s).multiplyBy(1-1/n),h=this.containerPointToLatLng(s.add(a));return this.setView(h,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():o.latLngBounds(t);var i=o.point(e.paddingTopLeft||e.padding||[0,0]),n=o.point(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n));s="number"==typeof e.maxZoom?Math.min(e.maxZoom,s):s;var r=n.subtract(i).divideBy(2),a=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),l=this.unproject(a.add(h).divideBy(2).add(r),s);return{center:l,zoom:s}},fitBounds:function(t,e){if(t=o.latLngBounds(t),!t.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=o.point(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){o.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){function s(t){var e=t?-1:1,i=t?v:g,n=v*v-g*g+e*L*L*y*y,o=2*i*L*y,s=n/o,r=Math.sqrt(s*s+1)-s,a=r<1e-9?-18:Math.log(r);return a}function r(t){return(Math.exp(t)-Math.exp(-t))/2}function a(t){return(Math.exp(t)+Math.exp(-t))/2}function h(t){return r(t)/a(t)}function l(t){return g*(a(x)/a(x+P*t))}function u(t){return g*(a(x)*h(x+P*t)-r(x))/L}function c(t){return 1-Math.pow(1-t,1.5)}function d(){var i=(Date.now()-w)/T,n=c(i)*b;i<=1?(this._flyToFrame=o.Util.requestAnimFrame(d,this),this._move(this.unproject(_.add(m.subtract(_).multiplyBy(u(n)/y)),f),this.getScaleZoom(g/l(n),f),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}if(n=n||{},n.animate===!1||!o.Browser.any3d)return this.setView(t,e,n);this._stop();var _=this.project(this.getCenter()),m=this.project(t),p=this.getSize(),f=this._zoom;t=o.latLng(t),e=e===i?f:e;var g=Math.max(p.x,p.y),v=g*this.getZoomScale(f,e),y=m.distanceTo(_)||1,P=1.42,L=P*P,x=s(0),w=Date.now(),b=(s(1)-x)/P,T=n.duration?1e3*n.duration:1e3*b*.8;return this._moveStart(!0),d.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=o.latLngBounds(t),t.isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){return this.options.minZoom=t,this._loaded&&this.getZoom()<this.options.minZoom?this.setZoom(t):this},setMaxZoom:function(t){return this.options.maxZoom=t,this._loaded&&this.getZoom()>this.options.maxZoom?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,o.latLngBounds(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),s=i.divideBy(2).round(),r=n.subtract(s);return r.x||r.y?(t.animate&&t.pan?this.panBy(r):(t.pan&&this._rawPanBy(r),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=o.extend({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o.bind(this._handleGeolocationResponse,this),i=o.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new o.LatLng(e,i),s=n.toBounds(t.coords.accuracy),r=this._locateOptions;if(r.setView){var a=this.getBoundsZoom(s);this.setView(n,r.maxZoom?Math.min(a,r.maxZoom):a)}var h={latlng:n,bounds:s,timestamp:t.timestamp};for(var l in t.coords)"number"==typeof t.coords[l]&&(h[l]=t.coords[l]);this.fire("locationfound",h)},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=i,this._containerId=i}o.DomUtil.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload");for(var t in this._layers)this._layers[t].remove();return this},createPane:function(t,e){var i="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),n=o.DomUtil.create("div",i,e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new o.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=o.latLngBounds(t),i=o.point(i||[0,0]);var n=this.getZoom()||0,s=this.getMinZoom(),r=this.getMaxZoom(),a=t.getNorthWest(),h=t.getSouthEast(),l=this.getSize().subtract(i),u=o.bounds(this.project(h,n),this.project(a,n)).getSize(),c=o.Browser.any3d?this.options.zoomSnap:1,d=Math.min(l.x/u.x,l.y/u.y);return n=this.getScaleZoom(d,n),c&&(n=Math.round(n/(c/100))*(c/100),n=e?Math.ceil(n/c)*c:Math.floor(n/c)*c),Math.max(s,Math.min(r,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new o.Point(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new o.Bounds(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===i?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=e===i?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=e===i?this._zoom:e;var o=n.zoom(t*n.scale(e));return isNaN(o)?1/0:o},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(o.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(o.point(t),e)},layerPointToLatLng:function(t){var e=o.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(o.latLng(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(o.latLng(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(o.latLngBounds(t))},distance:function(t,e){return this.options.crs.distance(o.latLng(t),o.latLng(e))},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(o.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(o.latLng(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=o.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");o.DomEvent.addListener(e,"scroll",this._onScroll,this),this._containerId=o.Util.stamp(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&o.Browser.any3d,
o.DomUtil.addClass(t,"leaflet-container"+(o.Browser.touch?" leaflet-touch":"")+(o.Browser.retina?" leaflet-retina":"")+(o.Browser.ielt9?" leaflet-oldie":"")+(o.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=o.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),o.DomUtil.setPosition(this._mapPane,new o.Point(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,"leaflet-zoom-hide"),o.DomUtil.addClass(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){o.DomUtil.setPosition(this._mapPane,new o.Point(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t){return t&&this.fire("zoomstart"),this.fire("movestart")},_move:function(t,e,n){e===i&&(e=this._zoom);var o=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(o||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return o.Util.cancelAnimFrame(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(o.DomEvent){this._targets={},this._targets[o.stamp(this._container)]=this;var i=e?"off":"on";o.DomEvent[i](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&o.DomEvent[i](t,"resize",this._onResize,this),o.Browser.any3d&&this.options.transform3DLimit&&this[i]("moveend",this._onMoveEnd)}},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,n=[],s="mouseout"===e||"mouseover"===e,r=t.target||t.srcElement,a=!1;r;){if(i=this._targets[o.stamp(r)],i&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(e,!0)){if(s&&!o.DomEvent._isExternalTarget(r,t))break;if(n.push(i),s)break}if(r===this._container)break;r=r.parentNode}return n.length||a||s||!o.DomEvent._isExternalTarget(r,t)||(n=[this]),n},_handleDOMEvent:function(t){if(this._loaded&&!o.DomEvent._skipped(t)){var e="keypress"===t.type&&13===t.keyCode?"click":t.type;"mousedown"===e&&o.DomUtil.preventOutline(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_fireDOMEvent:function(t,e,i){if("click"===t.type){var n=o.Util.extend({},t);n.type="preclick",this._fireDOMEvent(n,n.type,i)}if(!t._stopped&&(i=(i||[]).concat(this._findEventTargets(t,e)),i.length)){var s=i[0];"contextmenu"===e&&s.listens(e,!0)&&o.DomEvent.preventDefault(t);var r={originalEvent:t};if("keypress"!==t.type){var a=s instanceof o.Marker;r.containerPoint=a?this.latLngToContainerPoint(s.getLatLng()):this.mouseEventToContainerPoint(t),r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.latlng=a?s.getLatLng():this.layerPointToLatLng(r.layerPoint)}for(var h=0;h<i.length;h++)if(i[h].fire(e,r,!0),r.originalEvent._stopped||i[h].options.nonBubblingEvents&&o.Util.indexOf(i[h].options.nonBubblingEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)||new o.Point(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var n=t&&e!==i?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return n.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return o.bounds([this.project(t.getSouthWest(),e)._subtract(n),this.project(t.getNorthWest(),e)._subtract(n),this.project(t.getSouthEast(),e)._subtract(n),this.project(t.getNorthEast(),e)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),r=new o.Bounds(n.subtract(s),n.add(s)),a=this._getBoundsOffset(r,i,e);return a.round().equals([0,0])?t:this.unproject(n.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new o.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=o.bounds(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),s=n.min.subtract(t.min),r=n.max.subtract(t.max),a=this._rebound(s.x,-r.x),h=this._rebound(s.y,-r.y);return new o.Point(a,h)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=o.Browser.any3d?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return!((e&&e.animate)!==!0&&!this.getSize().contains(i))&&(this.panBy(i,e),!0)},_createAnimProxy:function(){var t=this._proxy=o.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var i=o.DomUtil.TRANSFORM,n=t.style[i];o.DomUtil.setTransform(t,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===t.style[i]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var e=this.getCenter(),i=this.getZoom();o.DomUtil.setTransform(t,this.project(e,i),this.getZoomScale(i,1))},this)},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/n);return!(i.animate!==!0&&!this.getSize().contains(s))&&(o.Util.requestAnimFrame(function(){this._moveStart(!0)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,i,n){i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,o.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),setTimeout(o.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){this._animatingZoom&&(o.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),o.Util.requestAnimFrame(function(){this._moveEnd(!0)},this))}}),o.map=function(t,e){return new o.Map(t,e)},o.Layer=o.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[],attribution:null},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[o.stamp(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[o.stamp(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e),this.getAttribution&&e.attributionControl&&e.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}}),o.Map.include({addLayer:function(t){var e=o.stamp(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=o.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&o.stamp(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[o.stamp(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=o.stamp(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-(1/0),n=this._getZoomSpan();for(var o in this._zoomBoundLayers){var s=this._zoomBoundLayers[o].options;t=s.minZoom===i?t:Math.min(t,s.minZoom),e=s.maxZoom===i?e:Math.max(e,s.maxZoom)}this._layersMaxZoom=e===-(1/0)?i:e,this._layersMinZoom=t===1/0?i:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===i&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===i&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var r="_leaflet_events";o.DomEvent={on:function(t,e,i,n){if("object"==typeof e)for(var s in e)this._on(t,s,e[s],i);else{e=o.Util.splitWords(e);for(var r=0,a=e.length;r<a;r++)this._on(t,e[r],i,n)}return this},off:function(t,e,i,n){if("object"==typeof e)for(var s in e)this._off(t,s,e[s],i);else{e=o.Util.splitWords(e);for(var r=0,a=e.length;r<a;r++)this._off(t,e[r],i,n)}return this},_on:function(e,i,n,s){var a=i+o.stamp(n)+(s?"_"+o.stamp(s):"");if(e[r]&&e[r][a])return this;var h=function(i){return n.call(s||e,i||t.event)},l=h;return o.Browser.pointer&&0===i.indexOf("touch")?this.addPointerListener(e,i,h,a):!o.Browser.touch||"dblclick"!==i||!this.addDoubleTapListener||o.Browser.pointer&&o.Browser.chrome?"addEventListener"in e?"mousewheel"===i?e.addEventListener("onwheel"in e?"wheel":"mousewheel",h,!1):"mouseenter"===i||"mouseleave"===i?(h=function(i){i=i||t.event,o.DomEvent._isExternalTarget(e,i)&&l(i)},e.addEventListener("mouseenter"===i?"mouseover":"mouseout",h,!1)):("click"===i&&o.Browser.android&&(h=function(t){return o.DomEvent._filterClick(t,l)}),e.addEventListener(i,h,!1)):"attachEvent"in e&&e.attachEvent("on"+i,h):this.addDoubleTapListener(e,h,a),e[r]=e[r]||{},e[r][a]=h,this},_off:function(t,e,i,n){var s=e+o.stamp(i)+(n?"_"+o.stamp(n):""),a=t[r]&&t[r][s];return a?(o.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,s):o.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,s):"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",a,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a),t[r][s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){return o.DomEvent.on(t,"mousewheel",o.DomEvent.stopPropagation)},disableClickPropagation:function(t){var e=o.DomEvent.stopPropagation;return o.DomEvent.on(t,o.Draggable.START.join(" "),e),o.DomEvent.on(t,{click:o.DomEvent._fakeStop,dblclick:e})},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new o.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new o.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},_wheelPxFactor:o.Browser.win&&o.Browser.chrome?2:o.Browser.gecko?t.devicePixelRatio:1,getWheelDelta:function(t){return o.Browser.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/o.DomEvent._wheelPxFactor:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_isExternalTarget:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent&&t.originalEvent.timeStamp,n=o.DomEvent._lastClick&&i-o.DomEvent._lastClick;return n&&n>100&&n<500||t.target._simulatedClick&&!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=i,void e(t))}},o.DomEvent.addListener=o.DomEvent.on,o.DomEvent.removeListener=o.DomEvent.off,o.PosAnimation=o.Evented.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),o.DomUtil.setPosition(this._el,i),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:o.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,s=this.R_MINOR/i,r=Math.sqrt(1-s*s),a=r*Math.sin(n),h=Math.tan(Math.PI/4-n/2)/Math.pow((1-a)/(1+a),r/2);return n=-i*Math.log(Math.max(h,1e-10)),new o.Point(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,s=this.R_MINOR/n,r=Math.sqrt(1-s*s),a=Math.exp(-t.y/n),h=Math.PI/2-2*Math.atan(a),l=0,u=.1;l<15&&Math.abs(u)>1e-7;l++)e=r*Math.sin(h),e=Math.pow((1-e)/(1+e),r/2),u=Math.PI/2-2*Math.atan(a*e)-h,h+=u;return new o.LatLng(h*i,t.x*i/n)}},o.CRS.EPSG3395=o.extend({},o.CRS.Earth,{code:"EPSG:3395",projection:o.Projection.Mercator,transformation:function(){var t=.5/(Math.PI*o.Projection.Mercator.R);return new o.Transformation(t,.5,-t,.5)}()}),o.GridLayer=o.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:o.Browser.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:i,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){o.setOptions(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),o.DomUtil.remove(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=null},bringToFront:function(){return this._map&&(o.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(o.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=o.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return e.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof o.Point?t:new o.Point(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-(1/0),1/0),o=0,s=i.length;o<s;o++)e=i[o].style.zIndex,i[o]!==this._container&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!o.Browser.ielt9){o.DomUtil.setOpacity(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var s=this._tiles[n];if(s.current&&s.loaded){var r=Math.min(1,(t-s.loaded)/200);o.DomUtil.setOpacity(s.el,r),r<1?e=!0:(s.active&&(i=!0),s.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(o.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=o.Util.requestAnimFrame(this._updateOpacity,this))}},_initContainer:function(){this._container||(this._container=o.DomUtil.create("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t===i)return i;for(var n in this._levels)this._levels[n].el.children.length||n===t?this._levels[n].el.style.zIndex=e-Math.abs(t-n):(o.DomUtil.remove(this._levels[n].el),this._removeTilesAtZoom(n),delete this._levels[n]);var s=this._levels[t],r=this._map;return s||(s=this._levels[t]={},s.el=o.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),s.el.style.zIndex=e,s.origin=r.project(r.unproject(r.getPixelOrigin()),t).round(),s.zoom=t,this._setZoomTransform(s,r.getCenter(),r.getZoom()),o.Util.falseFn(s.el.offsetWidth)),this._level=s,s},_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)return void this._removeAllTiles();for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)o.DomUtil.remove(this._levels[t].el),delete this._levels[t];this._removeAllTiles(),this._tileZoom=null},_retainParent:function(t,e,i,n){var s=Math.floor(t/2),r=Math.floor(e/2),a=i-1,h=new o.Point(+s,+r);h.z=+a;var l=this._tileCoordsToKey(h),u=this._tiles[l];return u&&u.active?(u.retain=!0,!0):(u&&u.loaded&&(u.retain=!0),a>n&&this._retainParent(s,r,a,n))},_retainChildren:function(t,e,i,n){for(var s=2*t;s<2*t+2;s++)for(var r=2*e;r<2*e+2;r++){var a=new o.Point(s,r);a.z=i+1;var h=this._tileCoordsToKey(a),l=this._tiles[h];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<n&&this._retainChildren(s,r,i+1,n))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_setView:function(t,e,n,o){var s=Math.round(e);(this.options.maxZoom!==i&&s>this.options.maxZoom||this.options.minZoom!==i&&s<this.options.minZoom)&&(s=i);var r=this.options.updateWhenZooming&&s!==this._tileZoom;o&&!r||(this._tileZoom=s,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),s!==i&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),s=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();o.Browser.any3d?o.DomUtil.setTransform(t.el,s,n):o.DomUtil.setPosition(t.el,s)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,o=this._map.getPixelWorldBounds(this._tileZoom);o&&(this._globalTileRange=this._pxBoundsToTileRange(o)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),s=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*n);return new o.Bounds(s.subtract(r),s.add(r))},_update:function(t){var n=this._map;if(n){var s=n.getZoom();if(t===i&&(t=n.getCenter()),this._tileZoom!==i){var r=this._getTiledPixelBounds(t),a=this._pxBoundsToTileRange(r),h=a.getCenter(),l=[],u=this.options.keepBuffer,c=new o.Bounds(a.getBottomLeft().subtract([u,-u]),a.getTopRight().add([u,-u]));for(var d in this._tiles){var _=this._tiles[d].coords;_.z===this._tileZoom&&c.contains(o.point(_.x,_.y))||(this._tiles[d].current=!1)}if(Math.abs(s-this._tileZoom)>1)return void this._setView(t,s);for(var m=a.min.y;m<=a.max.y;m++)for(var p=a.min.x;p<=a.max.x;p++){var f=new o.Point(p,m);if(f.z=this._tileZoom,this._isValidTile(f)){var g=this._tiles[this._tileCoordsToKey(f)];g?g.current=!0:l.push(f)}}if(l.sort(function(t,e){return t.distanceTo(h)-e.distanceTo(h)}),0!==l.length){this._loading||(this._loading=!0,this.fire("loading"));var v=e.createDocumentFragment();for(p=0;p<l.length;p++)this._addTile(l[p],v);this._level.el.appendChild(v)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return o.latLngBounds(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToBounds:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),s=n.add(i),r=e.unproject(n,t.z),a=e.unproject(s,t.z),h=new o.LatLngBounds(r,a);return this.options.noWrap||e.wrapLatLngBounds(h),h},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new o.Point(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(o.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){o.DomUtil.addClass(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=o.Util.falseFn,t.onmousemove=o.Util.falseFn,o.Browser.ielt9&&this.options.opacity<1&&o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.android&&!o.Browser.android23&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),o.bind(this._tileReady,this,t));this._initTile(s),this.createTile.length<2&&o.Util.requestAnimFrame(o.bind(this._tileReady,this,t,null,s)),o.DomUtil.setPosition(s,i),this._tiles[n]={el:s,coords:t,current:!0},e.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})},_tileReady:function(t,e,i){if(this._map){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);i=this._tiles[n],i&&(i.loaded=+new Date,this._map._fadeAnimated?(o.DomUtil.setOpacity(i.el,0),o.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=o.Util.requestAnimFrame(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(o.DomUtil.addClass(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),o.Browser.ielt9||!this._map._fadeAnimated?o.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(o.bind(this._pruneTiles,this),250)))}},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new o.Point(this._wrapX?o.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?o.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new o.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),o.gridLayer=function(t){return new o.GridLayer(t)},o.TileLayer=o.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,minNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,e=o.setOptions(this,e),e.detectRetina&&o.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),o.Browser.android||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},createTile:function(t,i){var n=e.createElement("img");return o.DomEvent.on(n,"load",o.bind(this._tileOnLoad,this,i,n)),o.DomEvent.on(n,"error",o.bind(this._tileOnError,this,i,n)),this.options.crossOrigin&&(n.crossOrigin=""),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:o.Browser.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}return o.Util.template(this._url,o.extend(e,this.options))},_tileOnLoad:function(t,e){o.Browser.ielt9?setTimeout(o.bind(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&e.src!==n&&(e.src=n),t(i,e)},getTileSize:function(){var t=this._map,e=o.GridLayer.prototype.getTileSize.call(this),i=this._tileZoom+this.options.zoomOffset,n=this.options.minNativeZoom,s=this.options.maxNativeZoom;return null!==n&&i<n?e.divideBy(t.getZoomScale(n,i)).round():null!==s&&i>s?e.divideBy(t.getZoomScale(s,i)).round():e},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,i=this.options.zoomReverse,n=this.options.zoomOffset,o=this.options.minNativeZoom,s=this.options.maxNativeZoom;return i&&(t=e-t),t+=n,null!==o&&t<o?o:null!==s&&t>s?s:t},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=o.Util.falseFn,e.onerror=o.Util.falseFn,e.complete||(e.src=o.Util.emptyImageUrl,o.DomUtil.remove(e)))}}),o.tileLayer=function(t,e){return new o.TileLayer(t,e)},o.TileLayer.WMS=o.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i=o.extend({},this.defaultWmsParams);for(var n in e)n in this.options||(i[n]=e[n]);e=o.setOptions(this,e),i.width=i.height=e.tileSize*(e.detectRetina&&o.Browser.retina?2:1),this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,o.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToBounds(t),i=this._crs.project(e.getNorthWest()),n=this._crs.project(e.getSouthEast()),s=(this._wmsVersion>=1.3&&this._crs===o.CRS.EPSG4326?[n.y,i.x,i.y,n.x]:[i.x,n.y,n.x,i.y]).join(","),r=o.TileLayer.prototype.getTileUrl.call(this,t);return r+o.Util.getParamString(this.wmsParams,r,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},setParams:function(t,e){return o.extend(this.wmsParams,t),e||this.redraw(),this}}),o.tileLayer.wms=function(t,e){return new o.TileLayer.WMS(t,e)},o.ImageOverlay=o.Layer.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1},initialize:function(t,e,i){this._url=t,this._bounds=o.latLngBounds(e),o.setOptions(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(o.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){o.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&o.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&o.DomUtil.toBack(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=t,this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._image=o.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));t.onselectstart=o.Util.falseFn,t.onmousemove=o.Util.falseFn,t.onload=o.bind(this.fire,this,"load"),this.options.crossOrigin&&(t.crossOrigin=""),t.src=this._url,t.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;
o.DomUtil.setTransform(this._image,i,e)},_reset:function(){var t=this._image,e=new o.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();o.DomUtil.setPosition(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,e,i){return new o.ImageOverlay(t,e,i)},o.Icon=o.Class.extend({initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];"number"==typeof n&&(n=[n,n]);var s=o.point(n),r=o.point("shadow"===e&&i.shadowAnchor||i.iconAnchor||s&&s.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return o.Browser.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return o.Icon.Default.imagePath||(o.Icon.Default.imagePath=this._detectIconPath()),(this.options.imagePath||o.Icon.Default.imagePath)+o.Icon.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=o.DomUtil.create("div","leaflet-default-icon-path",e.body),i=o.DomUtil.getStyle(t,"background-image")||o.DomUtil.getStyle(t,"backgroundImage");return e.body.removeChild(t),0===i.indexOf("url")?i.replace(/^url\([\"\']?/,"").replace(/marker-icon\.png[\"\']?\)$/,""):""}}),o.Marker=o.Layer.extend({options:{icon:new o.Icon.Default,interactive:!0,draggable:!1,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=o.latLng(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),t.alt&&(i.alt=t.alt)),o.DomUtil.addClass(i,e),t.keyboard&&(i.tabIndex="0"),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var s=t.icon.createShadow(this._shadow),r=!1;s!==this._shadow&&(this._removeShadow(),r=!0),s&&(o.DomUtil.addClass(s,e),s.alt=""),this._shadow=s,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),s&&r&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),o.DomUtil.remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&o.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&&o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(o.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),o.Handler.MarkerDrag)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new o.Handler.MarkerDrag(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;o.DomUtil.setOpacity(this._icon,t),this._shadow&&o.DomUtil.setOpacity(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor||[0,0]}}),o.marker=function(t,e){return new o.Marker(t,e)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;if(i.innerHTML=n.html!==!1?n.html:"",n.bgPos){var s=o.point(n.bgPos);i.style.backgroundPosition=-s.x+"px "+-s.y+"px"}return this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.DivOverlay=o.Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){o.setOptions(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&o.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&o.DomUtil.setOpacity(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(o.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(o.bind(o.DomUtil.remove,o.DomUtil,this._container),200)):o.DomUtil.remove(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&o.DomUtil.toFront(this._container),this},bringToBack:function(){return this._map&&o.DomUtil.toBack(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=o.point(this.options.offset),i=this._getAnchor();this._zoomAnimated?o.DomUtil.setPosition(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,s=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=s+"px"}},_getAnchor:function(){return[0,0]}}),o.Popup=o.DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){o.DivOverlay.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof o.Path||this._source.on("preclick",o.DomEvent.stopPropagation))},onRemove:function(t){o.DivOverlay.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof o.Path||this._source.off("preclick",o.DomEvent.stopPropagation))},getEvents:function(){var t=o.DivOverlay.prototype.getEvents.call(this);return("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=o.DomUtil.create("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated");if(this.options.closeButton){var i=this._closeButton=o.DomUtil.create("a",t+"-close-button",e);i.href="#close",i.innerHTML="&#215;",o.DomEvent.on(i,"click",this._onCloseButtonClick,this)}var n=this._wrapper=o.DomUtil.create("div",t+"-content-wrapper",e);this._contentNode=o.DomUtil.create("div",t+"-content",n),o.DomEvent.disableClickPropagation(n).disableScrollPropagation(this._contentNode).on(n,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",t+"-tip-container",e),this._tip=o.DomUtil.create("div",t+"-tip",this._tipContainer)},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,r="leaflet-popup-scrolled";s&&n>s?(e.height=s+"px",o.DomUtil.addClass(t,r)):o.DomUtil.removeClass(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();o.DomUtil.setPosition(this._container,e.add(i))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var t=this._map,e=parseInt(o.DomUtil.getStyle(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,s=new o.Point(this._containerLeft,-i-this._containerBottom);s._add(o.DomUtil.getPosition(this._container));var r=t.layerPointToContainerPoint(s),a=o.point(this.options.autoPanPadding),h=o.point(this.options.autoPanPaddingTopLeft||a),l=o.point(this.options.autoPanPaddingBottomRight||a),u=t.getSize(),c=0,d=0;r.x+n+l.x>u.x&&(c=r.x+n-u.x+l.x),r.x-c-h.x<0&&(c=r.x-h.x),r.y+i+l.y>u.y&&(d=r.y+i-u.y+l.y),r.y-d-h.y<0&&(d=r.y-h.y),(c||d)&&t.fire("autopanstart").panBy([c,d])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)},_getAnchor:function(){return o.point(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),o.popup=function(t,e){return new o.Popup(t,e)},o.Map.mergeOptions({closePopupOnClick:!0}),o.Map.include({openPopup:function(t,e,i){return t instanceof o.Popup||(t=new o.Popup(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),o.Layer.include({bindPopup:function(t,e){return t instanceof o.Popup?(o.setOptions(t,e),this._popup=t,t._source=this):(this._popup&&!e||(this._popup=new o.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){if(t instanceof o.Layer||(e=t,t=this),t instanceof o.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._popup&&this._map&&(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;if(this._popup&&this._map)return o.DomEvent.stop(t),e instanceof o.Path?void this.openPopup(t.layer||t.target,t.latlng):void(this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),o.Tooltip=o.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){o.DivOverlay.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){o.DivOverlay.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=o.DivOverlay.prototype.getEvents.call(this);return o.Browser.touch&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=o.DomUtil.create("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,i=this._container,n=e.latLngToContainerPoint(e.getCenter()),s=e.layerPointToContainerPoint(t),r=this.options.direction,a=i.offsetWidth,h=i.offsetHeight,l=o.point(this.options.offset),u=this._getAnchor();"top"===r?t=t.add(o.point(-a/2+l.x,-h+l.y+u.y,!0)):"bottom"===r?t=t.subtract(o.point(a/2-l.x,-l.y,!0)):"center"===r?t=t.subtract(o.point(a/2+l.x,h/2-u.y+l.y,!0)):"right"===r||"auto"===r&&s.x<n.x?(r="right",t=t.add(o.point(l.x+u.x,u.y-h/2+l.y,!0))):(r="left",t=t.subtract(o.point(a+u.x-l.x,h/2-u.y-l.y,!0))),o.DomUtil.removeClass(i,"leaflet-tooltip-right"),o.DomUtil.removeClass(i,"leaflet-tooltip-left"),o.DomUtil.removeClass(i,"leaflet-tooltip-top"),o.DomUtil.removeClass(i,"leaflet-tooltip-bottom"),o.DomUtil.addClass(i,"leaflet-tooltip-"+r),o.DomUtil.setPosition(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&o.DomUtil.setOpacity(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return o.point(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),o.tooltip=function(t,e){return new o.Tooltip(t,e)},o.Map.include({openTooltip:function(t,e,i){return t instanceof o.Tooltip||(t=new o.Tooltip(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),o.Layer.include({bindTooltip:function(t,e){return t instanceof o.Tooltip?(o.setOptions(t,e),this._tooltip=t,t._source=this):(this._tooltip&&!e||(this._tooltip=o.tooltip(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),o.Browser.touch&&(i.click=this._openTooltip)),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){if(t instanceof o.Layer||(e=t,t=this),t instanceof o.FeatureGroup)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(o.DomUtil.addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(o.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:i)},_moveTooltip:function(t){var e,i,n=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),n=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(n)}}),o.LayerGroup=o.Layer.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;e<i;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){for(var t in this._layers)this.removeLayer(this._layers[t]);return this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){for(var e in this._layers)t.addLayer(this._layers[e])},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e])},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),o.LayerGroup.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),o.LayerGroup.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.LatLngBounds;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Renderer=o.Layer.extend({options:{padding:.1},initialize:function(t){o.setOptions(this,t),o.stamp(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&o.DomUtil.addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){o.DomUtil.remove(this._container),this.off("update",this._updatePaths,this)},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=o.DomUtil.getPosition(this._container),s=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),a=this._map.project(t,e),h=a.subtract(r),l=s.multiplyBy(-i).add(n).add(s).subtract(h);o.Browser.any3d?o.DomUtil.setTransform(this._container,l,i):o.DomUtil.setPosition(this._container,l)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new o.Bounds(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),o.Map.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this.options.preferCanvas&&o.canvas()||o.svg()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||t===i)return!1;var e=this._paneRenderers[t];return e===i&&(e=o.SVG&&o.svg({pane:t})||o.Canvas&&o.canvas({pane:t}),this._paneRenderers[t]=e),e}}),o.Path=o.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return o.setOptions(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(o.Browser.touch?10:0)}}),o.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,e,0,n-1);var r,a=[];for(r=0;r<n;r++)s[r]&&a.push(t[r]);return a},_simplifyDPStep:function(t,e,i,n,o){var s,r,a,h=0;for(r=n+1;r<=o-1;r++)a=this._sqClosestPointOnSegment(t[r],t[n],t[o],!0),a>h&&(s=r,h=a);h>i&&(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;n<s;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return o<s-1&&i.push(t[s-1]),i},clipSegment:function(t,e,i,n,o){var s,r,a,h=n?this._lastCode:this._getBitCode(t,i),l=this._getBitCode(e,i);for(this._lastCode=l;;){if(!(h|l))return[t,e];if(h&l)return!1;s=h||l,r=this._getEdgeIntersection(t,e,s,i,o),a=this._getBitCode(r,i),s===h?(t=r,h=a):(e=r,l=a)}},_getEdgeIntersection:function(t,e,i,n,s){var r,a,h=e.x-t.x,l=e.y-t.y,u=n.min,c=n.max;return 8&i?(r=t.x+h*(c.y-t.y)/l,a=c.y):4&i?(r=t.x+h*(u.y-t.y)/l,a=u.y):2&i?(r=c.x,a=t.y+l*(c.x-t.x)/h):1&i&&(r=u.x,a=t.y+l*(u.x-t.x)/h),new o.Point(r,a,s)},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var s,r=e.x,a=e.y,h=i.x-r,l=i.y-a,u=h*h+l*l;return u>0&&(s=((t.x-r)*h+(t.y-a)*l)/u,s>1?(r=i.x,a=i.y):s>0&&(r+=h*s,a+=l*s)),h=t.x-r,l=t.y-a,n?h*h+l*l:new o.Point(r,a)}},o.Polyline=o.Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){o.setOptions(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,s=null,r=o.LineUtil._sqClosestPointOnSegment,a=0,h=this._parts.length;a<h;a++)for(var l=this._parts[a],u=1,c=l.length;u<c;u++){e=l[u-1],i=l[u];var d=r(t,e,i,!0);d<n&&(n=d,s=r(t,e,i))}return s&&(s.distance=Math.sqrt(n)),s},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,s,r,a=this._rings[0],h=a.length;if(!h)return null;for(t=0,e=0;t<h-1;t++)e+=a[t].distanceTo(a[t+1])/2;if(0===e)return this._map.layerPointToLatLng(a[0]);for(t=0,n=0;t<h-1;t++)if(o=a[t],s=a[t+1],i=o.distanceTo(s),n+=i,n>e)return r=(n-e)/i,this._map.layerPointToLatLng([s.x-r*(s.x-o.x),s.y-r*(s.y-o.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=o.latLng(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new o.LatLngBounds,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return o.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=o.Polyline._flat(t),n=0,s=t.length;n<s;n++)i?(e[n]=o.latLng(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new o.Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var e=this._clickTolerance(),i=new o.Point(e,e);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(i),t.max._add(i),this._pxBounds=t)},_projectLatlngs:function(t,e,i){var n,s,r=t[0]instanceof o.LatLng,a=t.length;if(r){for(s=[],n=0;n<a;n++)s[n]=this._map.latLngToLayerPoint(t[n]),i.extend(s[n]);e.push(s)}else for(n=0;n<a;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var e,i,n,s,r,a,h,l=this._parts;for(e=0,n=0,s=this._rings.length;e<s;e++)for(h=this._rings[e],i=0,r=h.length;i<r-1;i++)a=o.LineUtil.clipSegment(h[i],h[i+1],t,i,!0),a&&(l[n]=l[n]||[],l[n].push(a[0]),a[1]===h[i+1]&&i!==r-2||(l[n].push(a[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=o.LineUtil.simplify(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}}),o.polyline=function(t,e){return new o.Polyline(t,e)},o.Polyline._flat=function(t){return!o.Util.isArray(t[0])||"object"!=typeof t[0][0]&&"undefined"!=typeof t[0][0]},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,e,i){var n,s,r,a,h,l,u,c,d,_=[1,4,2,8],m=o.LineUtil;for(s=0,u=t.length;s<u;s++)t[s]._code=m._getBitCode(t[s],e);for(a=0;a<4;a++){for(c=_[a],n=[],s=0,u=t.length,r=u-1;s<u;r=s++)h=t[s],l=t[r],h._code&c?l._code&c||(d=m._getEdgeIntersection(l,h,c,e,i),d._code=m._getBitCode(d,e),n.push(d)):(l._code&c&&(d=m._getEdgeIntersection(l,h,c,e,i),d._code=m._getBitCode(d,e),n.push(d)),n.push(h));t=n}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,s,r,a,h,l=this._rings[0],u=l.length;if(!u)return null;for(s=r=a=0,t=0,e=u-1;t<u;e=t++)i=l[t],n=l[e],o=i.y*n.x-n.y*i.x,r+=(i.x+n.x)*o,a+=(i.y+n.y)*o,s+=3*o;return h=0===s?l[0]:[r/s,a/s],this._map.layerPointToLatLng(h)},_convertLatLngs:function(t){var e=o.Polyline.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof o.LatLng&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){o.Polyline.prototype._setLatLngs.call(this,t),o.Polyline._flat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return o.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new o.Point(e,e);if(t=new o.Bounds(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);for(var n,s=0,r=this._rings.length;s<r;s++)n=o.PolyUtil.clipPolygon(this._rings[s],t,!0),n.length&&this._parts.push(n)}},_updatePath:function(){this._renderer._updatePoly(this,!0)}}),o.polygon=function(t,e){return new o.Polygon(t,e)},o.Rectangle=o.Polygon.extend({initialize:function(t,e){o.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=o.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,e){return new o.Rectangle(t,e)},o.CircleMarker=o.Path.extend({options:{fill:!0,radius:10},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=o.latLng(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return o.Path.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new o.Bounds(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}}),o.circleMarker=function(t,e){return new o.CircleMarker(t,e)},o.Circle=o.CircleMarker.extend({initialize:function(t,e,i){if("number"==typeof e&&(e=o.extend({},i,{radius:e})),o.setOptions(this,e),this._latlng=o.latLng(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,
this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new o.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:o.Path.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===o.CRS.Earth.distance){var s=Math.PI/180,r=this._mRadius/o.CRS.Earth.R/s,a=i.project([e+r,t]),h=i.project([e-r,t]),l=a.add(h).divideBy(2),u=i.unproject(l).lat,c=Math.acos((Math.cos(r*s)-Math.sin(e*s)*Math.sin(u*s))/(Math.cos(e*s)*Math.cos(u*s)))/s;(isNaN(c)||0===c)&&(c=r/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(c)?0:Math.max(Math.round(l.x-i.project([u,t-c]).x),1),this._radiusY=Math.max(Math.round(l.y-a.y),1)}else{var d=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(d).x}this._updateBounds()}}),o.circle=function(t,e,i){return new o.Circle(t,e,i)},o.SVG=o.Renderer.extend({getEvents:function(){var t=o.Renderer.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=o.SVG.create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=o.SVG.create("g"),this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){o.Renderer.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),o.DomUtil.setPosition(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=o.SVG.create("path");t.options.className&&o.DomUtil.addClass(e,t.options.className),t.options.interactive&&o.DomUtil.addClass(e,"leaflet-interactive"),this._updateStyle(t),this._layers[o.stamp(t)]=t},_addPath:function(t){this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){o.DomUtil.remove(t._path),t.removeInteractiveTarget(t._path),delete this._layers[o.stamp(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,o.SVG.pointsToPath(t._parts,e))},_updateCircle:function(t){var e=t._point,i=t._radius,n=t._radiusY||i,o="a"+i+","+n+" 0 1,0 ",s=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+o+2*i+",0 "+o+2*-i+",0 ";this._setPath(t,s)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){o.DomUtil.toFront(t._path)},_bringToBack:function(t){o.DomUtil.toBack(t._path)}}),o.extend(o.SVG,{create:function(t){return e.createElementNS("http://www.w3.org/2000/svg",t)},pointsToPath:function(t,e){var i,n,s,r,a,h,l="";for(i=0,s=t.length;i<s;i++){for(a=t[i],n=0,r=a.length;n<r;n++)h=a[n],l+=(n?"L":"M")+h.x+" "+h.y;l+=e?o.Browser.svg?"z":"x":""}return l||"M0 0"}}),o.Browser.svg=!(!e.createElementNS||!o.SVG.create("svg").createSVGRect),o.svg=function(t){return o.Browser.svg||o.Browser.vml?new o.SVG(t):null},o.Browser.vml=!o.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(t){return!1}}(),o.SVG.include(o.Browser.vml?{_initContainer:function(){this._container=o.DomUtil.create("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(o.Renderer.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=o.SVG.create("shape");o.DomUtil.addClass(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=o.SVG.create("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[o.stamp(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;o.DomUtil.remove(e),t.removeInteractiveTarget(e),delete this._layers[o.stamp(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,s=t._container;s.stroked=!!n.stroke,s.filled=!!n.fill,n.stroke?(e||(e=t._stroke=o.SVG.create("stroke")),s.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=o.Util.isArray(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(s.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=o.SVG.create("fill")),s.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(s.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){o.DomUtil.toFront(t._container)},_bringToBack:function(t){o.DomUtil.toBack(t._container)}}:{}),o.Browser.vml&&(o.SVG.create=function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()),o.Canvas=o.Renderer.extend({getEvents:function(){var t=o.Renderer.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){o.Renderer.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=e.createElement("canvas");o.DomEvent.on(t,"mousemove",o.Util.throttle(this._onMouseMove,32,this),this).on(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},o.Renderer.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=o.Browser.retina?2:1;o.DomUtil.setPosition(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",o.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){o.Renderer.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[o.stamp(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,n=e.prev;i?i.prev=n:this._drawLast=n,n?n.next=i:this._drawFirst=i,delete t._order,delete this._layers[o.stamp(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(t.options.dashArray){var e,i=t.options.dashArray.split(","),n=[];for(e=0;e<i.length;e++)n.push(Number(i[e]));t.options._dashArray=n}},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||o.Util.requestAnimFrame(this._redraw,this))},_extendRedrawBounds:function(t){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new o.Bounds,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,o,s,r=t._parts,a=r.length,h=this._ctx;if(a){for(this._drawnLayers[t._leaflet_id]=t,h.beginPath(),h.setLineDash&&h.setLineDash(t.options&&t.options._dashArray||[]),i=0;i<a;i++){for(n=0,o=r[i].length;n<o;n++)s=r[i][n],h[n?"lineTo":"moveTo"](s.x,s.y);e&&h.closePath()}this._fillStroke(h,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,n=t._radius,o=(t._radiusY||n)/n;this._drawnLayers[t._leaflet_id]=t,1!==o&&(i.save(),i.scale(1,o)),i.beginPath(),i.arc(e.x,e.y/o,n,0,2*Math.PI,!1),1!==o&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,n=this._map.mouseEventToLayerPoint(t),s=this._drawFirst;s;s=s.next)e=s.layer,e.options.interactive&&e._containsPoint(n)&&!this._map._draggableMoved(e)&&(i=e);i&&(o.DomEvent._fakeStop(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(o.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var i,n,s=this._drawFirst;s;s=s.next)i=s.layer,i.options.interactive&&i._containsPoint(e)&&(n=i);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(o.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order,i=e.next,n=e.prev;i&&(i.prev=n,n?n.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))},_bringToBack:function(t){var e=t._order,i=e.next,n=e.prev;n&&(n.next=i,i?i.prev=n:n&&(this._drawLast=n),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}),o.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),o.canvas=function(t){return o.Browser.canvas?new o.Canvas(t):null},o.Polyline.prototype._containsPoint=function(t,e){var i,n,s,r,a,h,l=this._clickTolerance();if(!this._pxBounds.contains(t))return!1;for(i=0,r=this._parts.length;i<r;i++)for(h=this._parts[i],n=0,a=h.length,s=a-1;n<a;s=n++)if((e||0!==n)&&o.LineUtil.pointToSegmentDistance(t,h[s],h[n])<=l)return!0;return!1},o.Polygon.prototype._containsPoint=function(t){var e,i,n,s,r,a,h,l,u=!1;if(!this._pxBounds.contains(t))return!1;for(s=0,h=this._parts.length;s<h;s++)for(e=this._parts[s],r=0,l=e.length,a=l-1;r<l;a=r++)i=e[r],n=e[a],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(u=!u);return u||o.Polyline.prototype._containsPoint.call(this,t,!0)},o.CircleMarker.prototype._containsPoint=function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()},o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,e){o.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,s=o.Util.isArray(t)?t:t.features;if(s){for(e=0,i=s.length;e<i;e++)n=s[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var r=this.options;if(r.filter&&!r.filter(t))return this;var a=o.GeoJSON.geometryToLayer(t,r);return a?(a.feature=o.GeoJSON.asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),r.onEachFeature&&r.onEachFeature(t,a),this.addLayer(a)):this},resetStyle:function(t){return t.options=o.Util.extend({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,e){var i,n,s,r,a="Feature"===t.type?t.geometry:t,h=a?a.coordinates:null,l=[],u=e&&e.pointToLayer,c=e&&e.coordsToLatLng||this.coordsToLatLng;if(!h&&!a)return null;switch(a.type){case"Point":return i=c(h),u?u(t,i):new o.Marker(i);case"MultiPoint":for(s=0,r=h.length;s<r;s++)i=c(h[s]),l.push(u?u(t,i):new o.Marker(i));return new o.FeatureGroup(l);case"LineString":case"MultiLineString":return n=this.coordsToLatLngs(h,"LineString"===a.type?0:1,c),new o.Polyline(n,e);case"Polygon":case"MultiPolygon":return n=this.coordsToLatLngs(h,"Polygon"===a.type?1:2,c),new o.Polygon(n,e);case"GeometryCollection":for(s=0,r=a.geometries.length;s<r;s++){var d=this.geometryToLayer({geometry:a.geometries[s],type:"Feature",properties:t.properties},e);d&&l.push(d)}return new o.FeatureGroup(l);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new o.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){for(var n,o=[],s=0,r=t.length;s<r;s++)n=e?this.coordsToLatLngs(t[s],e-1,i):(i||this.coordsToLatLng)(t[s]),o.push(n);return o},latLngToCoords:function(t){return t.alt!==i?[t.lng,t.lat,t.alt]:[t.lng,t.lat]},latLngsToCoords:function(t,e,i){for(var n=[],s=0,r=t.length;s<r;s++)n.push(e?o.GeoJSON.latLngsToCoords(t[s],e-1,i):o.GeoJSON.latLngToCoords(t[s]));return!e&&i&&n.push(n[0]),n},getFeature:function(t,e){return t.feature?o.extend({},t.feature,{geometry:e}):o.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var a={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.latLngToCoords(this.getLatLng())})}};o.Marker.include(a),o.Circle.include(a),o.CircleMarker.include(a),o.Polyline.prototype.toGeoJSON=function(){var t=!o.Polyline._flat(this._latlngs),e=o.GeoJSON.latLngsToCoords(this._latlngs,t?1:0);return o.GeoJSON.getFeature(this,{type:(t?"Multi":"")+"LineString",coordinates:e})},o.Polygon.prototype.toGeoJSON=function(){var t=!o.Polyline._flat(this._latlngs),e=t&&!o.Polyline._flat(this._latlngs[0]),i=o.GeoJSON.latLngsToCoords(this._latlngs,e?2:t?1:0,!0);return t||(i=[i]),o.GeoJSON.getFeature(this,{type:(e?"Multi":"")+"Polygon",coordinates:i})},o.LayerGroup.include({toMultiPoint:function(){var t=[];return this.eachLayer(function(e){t.push(e.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint();var e="GeometryCollection"===t,i=[];return this.eachLayer(function(t){if(t.toGeoJSON){var n=t.toGeoJSON();i.push(e?n.geometry:o.GeoJSON.asFeature(n))}}),e?o.GeoJSON.getFeature(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}}),o.geoJSON=function(t,e){return new o.GeoJSON(t,e)},o.geoJson=o.geoJSON,o.Draggable=o.Evented.extend({options:{clickTolerance:3},statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e,i){this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(o.DomEvent.on(this._dragStartTarget,o.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(o.Draggable._dragging===this&&this.finishDrag(),o.DomEvent.off(this._dragStartTarget,o.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!o.DomUtil.hasClass(this._element,"leaflet-zoom-anim")&&!(o.Draggable._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(o.Draggable._dragging=this,this._preventOutline&&o.DomUtil.preventOutline(this._element),o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),this._moving)))){this.fire("down");var i=t.touches?t.touches[0]:t;this._startPoint=new o.Point(i.clientX,i.clientY),o.DomEvent.on(e,o.Draggable.MOVE[t.type],this._onMove,this).on(e,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(i){if(!i._simulated&&this._enabled){if(i.touches&&i.touches.length>1)return void(this._moved=!0);var n=i.touches&&1===i.touches.length?i.touches[0]:i,s=new o.Point(n.clientX,n.clientY),r=s.subtract(this._startPoint);(r.x||r.y)&&(Math.abs(r.x)+Math.abs(r.y)<this.options.clickTolerance||(o.DomEvent.preventDefault(i),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(r),o.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=i.target||i.srcElement,t.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),o.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(r),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._lastEvent=i,this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){o.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(o.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in o.Draggable.MOVE)o.DomEvent.off(e,o.Draggable.MOVE[t],this._onMove,this).off(e,o.Draggable.END[t],this._onUp,this);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&&this._moving&&(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,o.Draggable._dragging=!1}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}o.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){o.DomUtil.removeClass(this._map._container,"leaflet-grab"),o.DomUtil.removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var t=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=o.latLngBounds(this._map.options.maxBounds);this._offsetLimit=o.bounds(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),e-this._times[0]>50&&(this._positions.shift(),this._times.shift())}this._map.fire("move",t).fire("drag",t)},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,r=Math.abs(o+i)<Math.abs(s+i)?o:s;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=r},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||this._times.length<2;if(e.fire("dragend",t),n)e.fire("moveend");else{var s=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,a=i.easeLinearity,h=s.multiplyBy(a/r),l=h.distanceTo([0,0]),u=Math.min(i.inertiaMaxSpeed,l),c=h.multiplyBy(u/l),d=u/(i.inertiaDeceleration*a),_=c.multiplyBy(-d/2).round();_.x||_.y?(_=e._limitOffset(_,e.options.maxBounds),o.Util.requestAnimFrame(function(){e.panBy(_,{duration:d,easeLinearity:a,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,o=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(o):e.setZoomAround(t.containerPoint,o)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=o.DomEvent.getWheelDelta(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),n),o.DomEvent.stop(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),o=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,s=i?Math.ceil(o/i)*i:o,r=t._limitZoom(e+(this._delta>0?s:-s))-e;this._delta=0,this._startTime=null,r&&("center"===t.options.scrollWheelZoom?t.setZoom(e+r):t.setZoomAround(this._lastMousePos,e+r))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.extend(o.DomEvent,{_touchstart:o.Browser.msPointer?"MSPointerDown":o.Browser.pointer?"pointerdown":"touchstart",_touchend:o.Browser.msPointer?"MSPointerUp":o.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,e,i){function n(t){var e;if(o.Browser.pointer){if(!o.Browser.edge||"mouse"===t.pointerType)return;e=o.DomEvent._pointersCount}else e=t.touches.length;if(!(e>1)){var i=Date.now(),n=i-(r||i);a=t.touches?t.touches[0]:t,h=n>0&&n<=l,r=i}}function s(t){if(h&&!a.cancelBubble){if(o.Browser.pointer){if(!o.Browser.edge||"mouse"===t.pointerType)return;var i,n,s={};for(n in a)i=a[n],s[n]=i&&i.bind?i.bind(a):i;a=s}a.type="dblclick",e(a),r=null}}var r,a,h=!1,l=250,u="_leaflet_",c=this._touchstart,d=this._touchend;return t[u+c+i]=n,t[u+d+i]=s,t[u+"dblclick"+i]=e,t.addEventListener(c,n,!1),t.addEventListener(d,s,!1),t.addEventListener("dblclick",e,!1),this},removeDoubleTapListener:function(t,e){var i="_leaflet_",n=t[i+this._touchstart+e],s=t[i+this._touchend+e],r=t[i+"dblclick"+e];return t.removeEventListener(this._touchstart,n,!1),t.removeEventListener(this._touchend,s,!1),o.Browser.edge||t.removeEventListener("dblclick",r,!1),this}}),o.extend(o.DomEvent,{POINTER_DOWN:o.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:o.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:o.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:o.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(t,e,i,n){return"touchstart"===e?this._addPointerStart(t,i,n):"touchmove"===e?this._addPointerMove(t,i,n):"touchend"===e&&this._addPointerEnd(t,i,n),this},removePointerListener:function(t,e,i){var n=t["_leaflet_"+e+i];return"touchstart"===e?t.removeEventListener(this.POINTER_DOWN,n,!1):"touchmove"===e?t.removeEventListener(this.POINTER_MOVE,n,!1):"touchend"===e&&(t.removeEventListener(this.POINTER_UP,n,!1),t.removeEventListener(this.POINTER_CANCEL,n,!1)),this},_addPointerStart:function(t,i,n){var s=o.bind(function(t){if("mouse"!==t.pointerType&&t.MSPOINTER_TYPE_MOUSE&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(this.TAG_WHITE_LIST.indexOf(t.target.tagName)<0))return;o.DomEvent.preventDefault(t)}this._handlePointer(t,i)},this);if(t["_leaflet_touchstart"+n]=s,t.addEventListener(this.POINTER_DOWN,s,!1),!this._pointerDocListener){var r=o.bind(this._globalPointerUp,this);e.documentElement.addEventListener(this.POINTER_DOWN,o.bind(this._globalPointerDown,this),!0),e.documentElement.addEventListener(this.POINTER_MOVE,o.bind(this._globalPointerMove,this),!0),e.documentElement.addEventListener(this.POINTER_UP,r,!0),e.documentElement.addEventListener(this.POINTER_CANCEL,r,!0),this._pointerDocListener=!0}},_globalPointerDown:function(t){this._pointers[t.pointerId]=t,this._pointersCount++},_globalPointerMove:function(t){this._pointers[t.pointerId]&&(this._pointers[t.pointerId]=t)},_globalPointerUp:function(t){delete this._pointers[t.pointerId],this._pointersCount--},_handlePointer:function(t,e){t.touches=[];for(var i in this._pointers)t.touches.push(this._pointers[i]);t.changedTouches=[t],e(t)},_addPointerMove:function(t,e,i){var n=o.bind(function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&this._handlePointer(t,e)},this);t["_leaflet_touchmove"+i]=n,t.addEventListener(this.POINTER_MOVE,n,!1)},_addPointerEnd:function(t,e,i){var n=o.bind(function(t){this._handlePointer(t,e)},this);t["_leaflet_touchend"+i]=n,t.addEventListener(this.POINTER_UP,n,!1),t.addEventListener(this.POINTER_CANCEL,n,!1)}}),o.Map.mergeOptions({touchZoom:o.Browser.touch&&!o.Browser.android23,bounceAtZoomLimits:!0}),o.Map.TouchZoom=o.Handler.extend({addHooks:function(){o.DomUtil.addClass(this._map._container,"leaflet-touch-zoom"),o.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){o.DomUtil.removeClass(this._map._container,"leaflet-touch-zoom"),o.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToContainerPoint(t.touches[0]),s=i.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=i.getSize()._divideBy(2),this._startLatLng=i.containerPointToLatLng(this._centerPoint),"center"!==i.options.touchZoom&&(this._pinchStartLatLng=i.containerPointToLatLng(n.add(s)._divideBy(2))),this._startDist=n.distanceTo(s),this._startZoom=i.getZoom(),this._moved=!1,this._zooming=!0,i._stop(),o.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),o.DomEvent.preventDefault(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),s=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(s,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&s<1||this._zoom>e.getMaxZoom()&&s>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===s)return}else{var r=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1===s&&0===r.x&&0===r.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(r),this._zoom)}this._moved||(e._moveStart(!0),this._moved=!0),o.Util.cancelAnimFrame(this._animRequest);var a=o.bind(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=o.Util.requestAnimFrame(a,this,!0),o.DomEvent.preventDefault(t)}},_onTouchEnd:function(){return this._moved&&this._zooming?(this._zooming=!1,o.Util.cancelAnimFrame(this._animRequest),o.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd),void(this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom)))):void(this._zooming=!1)}}),o.Map.addInitHook("addHandler","touchZoom",o.Map.TouchZoom),o.Map.mergeOptions({tap:!0,tapTolerance:15}),o.Map.Tap=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(o.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new o.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(o.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),this._simulateEvent("mousedown",i),o.DomEvent.on(e,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),o.DomEvent.off(e,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.removeClass(n,"leaflet-active"),this._simulateEvent("mouseup",i),
this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new o.Point(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),o.Browser.touch&&!o.Browser.pointer&&o.Map.addInitHook("addHandler","tap",o.Map.Tap),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(t){return!(!t.shiftKey||1!==t.which&&1!==t.button)&&(this._resetState(),o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),void o.DomEvent.on(e,{contextmenu:o.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=o.DomUtil.create("div","leaflet-zoom-box",this._container),o.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new o.Bounds(this._point,this._startPoint),i=e.getSize();o.DomUtil.setPosition(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(o.DomUtil.remove(this._box),o.DomUtil.removeClass(this._container,"leaflet-crosshair")),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(e,{contextmenu:o.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){setTimeout(o.bind(this._resetState,this),0);var e=new o.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanDelta:80}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),o.DomEvent.on(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),o.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,o=i.scrollTop||n.scrollTop,s=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;e<i;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;e<i;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;e<i;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;e<i;e++)n[o.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;e<i;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;e<i;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){o.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys){if(n._panAnim&&n._panAnim._inProgress)return;e=this._panKeys[i],t.shiftKey&&(e=o.point(e).multiplyBy(3)),n.panBy(e),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds)}else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i)return;n.closePopup()}o.DomEvent.stop(t)}}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),o.DomUtil.addClass(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&o.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(t){var e=this._marker,i=e._shadow,n=o.DomUtil.getPosition(e._icon),s=e._map.layerPointToLatLng(n);i&&o.DomUtil.setPosition(i,n),e._latlng=s,t.latlng=s,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return o.DomUtil.addClass(e,"leaflet-control"),i.indexOf("bottom")!==-1?n.insertBefore(e,n.firstChild):n.appendChild(e),this},remove:function(){return this._map?(o.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,s){var r=i+t+" "+i+s;e[t+s]=o.DomUtil.create("div",r,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=o.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){o.DomUtil.remove(this._controlContainer)}}),o.Control.Zoom=o.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=o.DomUtil.create("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,s){var r=o.DomUtil.create("a",i,n);return r.innerHTML=t,r.href="#",r.title=e,r.setAttribute("role","button"),r.setAttribute("aria-label",e),o.DomEvent.on(r,"mousedown dblclick",o.DomEvent.stopPropagation).on(r,"click",o.DomEvent.stop).on(r,"click",s,this).on(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";o.DomUtil.removeClass(this._zoomInButton,e),o.DomUtil.removeClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&&o.DomUtil.addClass(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&&o.DomUtil.addClass(this._zoomInButton,e)}}),o.Map.mergeOptions({zoomControl:!0}),o.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new o.Control.Zoom,this.addControl(this.zoomControl))}),o.control.zoom=function(t){return new o.Control.Zoom(t)},o.Control.Attribution=o.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){o.setOptions(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=o.DomUtil.create("div","leaflet-control-attribution"),o.DomEvent&&o.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}}}),o.Map.mergeOptions({attributionControl:!0}),o.Map.addInitHook(function(){this.options.attributionControl&&(new o.Control.Attribution).addTo(this)}),o.control.attribution=function(t){return new o.Control.Attribution(t)},o.Control.Scale=o.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=o.DomUtil.create("div",e),n=this.options;return this._addScales(n,e+"-line",i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=o.DomUtil.create("div",e,i)),t.imperial&&(this._iScale=o.DomUtil.create("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,n,o=3.2808399*t;o>5280?(e=o/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(n=this._getRoundNum(o),this._updateScale(this._iScale,n+" ft",n/o))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),o.control.scale=function(t){return new o.Control.Scale(t)},o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i<n?-1:n<i?1:0}},initialize:function(t,e,i){o.setOptions(this,i),this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this),this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(o.stamp(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){o.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._form.clientHeight?(o.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=t+"px"):o.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return o.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=o.DomUtil.create("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),o.DomEvent.disableClickPropagation(e),o.Browser.touch||o.DomEvent.disableScrollPropagation(e);var n=this._form=o.DomUtil.create("form",t+"-list");i&&(this._map.on("click",this.collapse,this),o.Browser.android||o.DomEvent.on(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var s=this._layersLink=o.DomUtil.create("a",t+"-toggle",e);s.href="#",s.title="Layers",o.Browser.touch?o.DomEvent.on(s,"click",o.DomEvent.stop).on(s,"click",this.expand,this):o.DomEvent.on(s,"focus",this.expand,this),o.DomEvent.on(n,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),i||this.expand(),this._baseLayersList=o.DomUtil.create("div",t+"-base",n),this._separator=o.DomUtil.create("div",t+"-separator",n),this._overlaysList=o.DomUtil.create("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&o.stamp(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(o.bind(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;o.DomUtil.empty(this._baseLayersList),o.DomUtil.empty(this._overlaysList);var t,e,i,n,s=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,s+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&s>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(o.stamp(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(i?' checked="checked"':"")+"/>",o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,n=e.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=this._createRadioElement("leaflet-base-layers",s),i.layerId=o.stamp(t.layer),o.DomEvent.on(i,"click",this._onInputClick,this);var r=e.createElement("span");r.innerHTML=" "+t.name;var a=e.createElement("div");n.appendChild(a),a.appendChild(i),a.appendChild(r);var h=t.overlay?this._overlaysList:this._baseLayersList;return h.appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=[],s=[];this._handlingClick=!0;for(var r=n.length-1;r>=0;r--)t=n[r],e=this._getLayer(t.layerId).layer,i=this._map.hasLayer(e),t.checked&&!i?o.push(e):!t.checked&&i&&s.push(e);for(r=0;r<s.length;r++)this._map.removeLayer(s[r]);for(r=0;r<o.length;r++)this._map.addLayer(o[r]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,n=this._form.getElementsByTagName("input"),o=this._map.getZoom(),s=n.length-1;s>=0;s--)t=n[s],e=this._getLayer(t.layerId).layer,t.disabled=e.options.minZoom!==i&&o<e.options.minZoom||e.options.maxZoom!==i&&o>e.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),o.control.layers=function(t,e,i){return new o.Control.Layers(t,e,i)}}(window,document);
(function() {
    // save these original methods before they are overwritten
    var proto_initIcon = L.Marker.prototype._initIcon;
    var proto_setPos = L.Marker.prototype._setPos;
    var proto_onDrag = L.Handler.MarkerDrag.prototype._onDrag;

    var oldIE = (L.DomUtil.TRANSFORM === 'msTransform');

    L.Marker.addInitHook(function () {
        var iconOptions = this.options.icon && this.options.icon.options;
        var iconAnchor = iconOptions && this.options.icon.options.iconAnchor;
        if (iconAnchor) {
            iconAnchor = (iconAnchor[0] + 'px ' + iconAnchor[1] + 'px');
        }
        this.options.rotationOrigin = this.options.rotationOrigin || iconAnchor || 'center bottom' ;
        this.options.rotationAngle = this.options.rotationAngle || 0;
    });

    L.Marker.include({
        _initIcon: function() {
            proto_initIcon.call(this);
        },

        _setPos: function (pos) {
            proto_setPos.call(this, pos);
            this._applyRotation();
        },

        _applyRotation: function () {
            if(this.options.rotationAngle) {
                this._icon.style[L.DomUtil.TRANSFORM+'Origin'] = this.options.rotationOrigin;

                if(oldIE) {
                    // for IE 9, use the 2D rotation
                    this._icon.style[L.DomUtil.TRANSFORM] = 'rotate(' + this.options.rotationAngle + 'deg)';
                } else {
                    // for modern browsers, prefer the 3D accelerated version
                    this._icon.style[L.DomUtil.TRANSFORM] += ' rotateZ(' + this.options.rotationAngle + 'deg)';
                }
            }
        },

        setRotationAngle: function(angle) {
            this.options.rotationAngle = angle;
            this.update();
            return this;
        },

        setRotationOrigin: function(origin) {
            this.options.rotationOrigin = origin;
            this.update();
            return this;
        }
    });

    L.Handler.MarkerDrag.include({
        _onDrag: function (e) {
            proto_onDrag.call(this, e);
            this._marker._applyRotation();
        }
    })
})();

/*! Leaflet.Coordinates 03-07-2013 */
L.Control.Coordinates=L.Control.extend({options:{position:"bottomright",decimals:4,decimalSeperator:".",labelTemplateLat:"Lat: {y}",labelTemplateLng:"Lng: {x}",labelFormatterLat:void 0,labelFormatterLng:void 0,enableUserInput:!0,useDMS:!1,useLatLngOrder:!1},onAdd:function(a){this._map=a;var b="leaflet-control-coordinates",c=this._container=L.DomUtil.create("div",b),d=this.options;this._labelcontainer=L.DomUtil.create("div","uiElement label",c),this._label=L.DomUtil.create("span","labelFirst",this._labelcontainer),this._inputcontainer=L.DomUtil.create("div","uiElement input uiHidden",c);var e,f;return d.useLatLngOrder?(f=L.DomUtil.create("span","",this._inputcontainer),this._inputY=this._createInput("inputY",this._inputcontainer),e=L.DomUtil.create("span","",this._inputcontainer),this._inputX=this._createInput("inputX",this._inputcontainer)):(e=L.DomUtil.create("span","",this._inputcontainer),this._inputX=this._createInput("inputX",this._inputcontainer),f=L.DomUtil.create("span","",this._inputcontainer),this._inputY=this._createInput("inputY",this._inputcontainer)),e.innerHTML=d.labelTemplateLng.replace("{x}",""),f.innerHTML=d.labelTemplateLat.replace("{y}",""),L.DomEvent.on(this._inputX,"keyup",this._handleKeypress,this),L.DomEvent.on(this._inputY,"keyup",this._handleKeypress,this),a.on("mousemove",this._update,this),a.on("dragstart",this.collapse,this),a.whenReady(this._update,this),this._showsCoordinates=!0,d.enableUserInput&&L.DomEvent.addListener(this._container,"click",this._switchUI,this),c},_createInput:function(a,b){var c=L.DomUtil.create("input",a,b);return c.type="text",L.DomEvent.disableClickPropagation(c),c},_clearMarker:function(){this._map.removeLayer(this._marker)},_handleKeypress:function(a){switch(a.keyCode){case 27:this.collapse();break;case 13:this._handleSubmit(),this.collapse();break;default:this._handleSubmit()}},_handleSubmit:function(){var a=L.NumberFormatter.createValidNumber(this._inputX.value,this.options.decimalSeperator),b=L.NumberFormatter.createValidNumber(this._inputY.value,this.options.decimalSeperator);if(void 0!==a&&void 0!==b){var c=this._marker;c||(c=this._marker=L.marker(),c.on("click",this._clearMarker,this)),c.setLatLng(new L.LatLng(b,a)),c.addTo(this._map)}},expand:function(){this._showsCoordinates=!1,this._map.off("mousemove",this._update,this),L.DomEvent.addListener(this._container,"mousemove",L.DomEvent.stop),L.DomEvent.removeListener(this._container,"click",this._switchUI,this),L.DomUtil.addClass(this._labelcontainer,"uiHidden"),L.DomUtil.removeClass(this._inputcontainer,"uiHidden")},_createCoordinateLabel:function(a){var b,c,d=this.options;return b=d.labelFormatterLng?d.labelFormatterLng(a.lng):L.Util.template(d.labelTemplateLng,{x:this._getNumber(a.lng,d)}),c=d.labelFormatterLat?d.labelFormatterLat(a.lat):L.Util.template(d.labelTemplateLat,{y:this._getNumber(a.lat,d)}),d.useLatLngOrder?c+" "+b:b+" "+c},_getNumber:function(a,b){var c;return c=b.useDMS?L.NumberFormatter.toDMS(a):L.NumberFormatter.round(a,b.decimals,b.decimalSeperator)},collapse:function(){if(!this._showsCoordinates&&(this._map.on("mousemove",this._update,this),this._showsCoordinates=!0,this.options,L.DomEvent.addListener(this._container,"click",this._switchUI,this),L.DomEvent.removeListener(this._container,"mousemove",L.DomEvent.stop),L.DomUtil.addClass(this._inputcontainer,"uiHidden"),L.DomUtil.removeClass(this._labelcontainer,"uiHidden"),this._marker)){var a=L.marker(),b=this._marker.getLatLng();a.setLatLng(b);var c=L.DomUtil.create("div",""),d=L.DomUtil.create("div","",c);d.innerHTML=this._createCoordinateLabel(b);var e=L.DomUtil.create("a","",c);e.innerHTML="Remove",e.href="#";var f=L.DomEvent.stopPropagation;L.DomEvent.on(e,"click",f).on(e,"mousedown",f).on(e,"dblclick",f).on(e,"click",L.DomEvent.preventDefault).on(e,"click",function(){this._map.removeLayer(a)},this),a.bindPopup(c),a.addTo(this._map),this._map.removeLayer(this._marker),this._marker=null}},_switchUI:function(a){L.DomEvent.stop(a),L.DomEvent.stopPropagation(a),L.DomEvent.preventDefault(a),this._showsCoordinates?this.expand():this.collapse()},onRemove:function(a){a.off("mousemove",this._update,this)},_update:function(a){var b=a.latlng,c=this.options;b&&(b=b.wrap(),this._currentPos=b,this._inputY.value=L.NumberFormatter.round(b.lat,c.decimals,c.decimalSeperator),this._inputX.value=L.NumberFormatter.round(b.lng,c.decimals,c.decimalSeperator),this._label.innerHTML=this._createCoordinateLabel(b))}}),L.control.coordinates=function(a){return new L.Control.Coordinates(a)},L.Map.mergeOptions({coordinateControl:!1}),L.Map.addInitHook(function(){this.options.coordinateControl&&(this.coordinateControl=new L.Control.Coordinates,this.addControl(this.coordinateControl))}),L.NumberFormatter={round:function(a,b,c){var d=L.Util.formatNum(a,b)+"",e=d.split(".");if(e[1]){for(var f=b-e[1].length;f>0;f--)e[1]+="0";d=e.join(c||".")}return d},toDMS:function(a){var b=Math.floor(a),c=60*(a-b),d=Math.floor(c),e=60*(c-d),f=Math.round(e);return 60==f&&(d++,f="00"),60==d&&(b++,d="00"),10>f&&(f="0"+f),10>d&&(d="0"+d),""+b+"&deg; "+d+"' "+f+"''"},createValidNumber:function(a,b){if(a&&a.length>0){var c=a.split(b||".");try{var d=Number(c.join("."));return isNaN(d)?void 0:d}catch(e){return void 0}}return void 0}};
/*
	Leaflet.contextmenu, a context menu for Leaflet.
	(c) 2015, Adam Ratcliffe, GeoSmart Maps Limited

	@preserve
*/
(function(t){var e;if(typeof define==="function"&&define.amd){define(["leaflet"],t)}else if(typeof module==="object"&&typeof module.exports==="object"){e=require("leaflet");module.exports=t(e)}else{if(typeof window.L==="undefined"){throw new Error("Leaflet must be loaded first")}t(window.L)}})(function(t){t.Map.mergeOptions({contextmenuItems:[]});t.Map.ContextMenu=t.Handler.extend({_touchstart:t.Browser.msPointer?"MSPointerDown":t.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(e){t.Handler.prototype.initialize.call(this,e);this._items=[];this._visible=false;var n=this._container=t.DomUtil.create("div",t.Map.ContextMenu.BASE_CLS,e._container);n.style.zIndex=1e4;n.style.position="absolute";if(e.options.contextmenuWidth){n.style.width=e.options.contextmenuWidth+"px"}this._createItems();t.DomEvent.on(n,"click",t.DomEvent.stop).on(n,"mousedown",t.DomEvent.stop).on(n,"dblclick",t.DomEvent.stop).on(n,"contextmenu",t.DomEvent.stop)},addHooks:function(){var e=this._map.getContainer();t.DomEvent.on(e,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this);if(t.Browser.touch){t.DomEvent.on(document,this._touchstart,this._hide,this)}this._map.on({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var e=this._map.getContainer();t.DomEvent.off(e,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this);if(t.Browser.touch){t.DomEvent.off(document,this._touchstart,this._hide,this)}this._map.off({contextmenu:this._show,mousedown:this._hide,movestart:this._hide,zoomstart:this._hide},this)},showAt:function(e,n){if(e instanceof t.LatLng){e=this._map.latLngToContainerPoint(e)}this._showAtPoint(e,n)},hide:function(){this._hide()},addItem:function(t){return this.insertItem(t)},insertItem:function(t,e){e=e!==undefined?e:this._items.length;var n=this._createItem(this._container,t,e);this._items.push(n);this._sizeChanged=true;this._map.fire("contextmenu.additem",{contextmenu:this,el:n.el,index:e});return n.el},removeItem:function(e){var n=this._container;if(!isNaN(e)){e=n.children[e]}if(e){this._removeItem(t.Util.stamp(e));this._sizeChanged=true;this._map.fire("contextmenu.removeitem",{contextmenu:this,el:e});return e}return null},removeAllItems:function(){var e=this._container.children,n;while(e.length){n=e[0];this._removeItem(t.Util.stamp(n))}return e},hideAllItems:function(){var t,e,n;for(e=0,n=this._items.length;e<n;e++){t=this._items[e];t.el.style.display="none"}},showAllItems:function(){var t,e,n;for(e=0,n=this._items.length;e<n;e++){t=this._items[e];t.el.style.display=""}},setDisabled:function(e,n){var i=this._container,o=t.Map.ContextMenu.BASE_CLS+"-item";if(!isNaN(e)){e=i.children[e]}if(e&&t.DomUtil.hasClass(e,o)){if(n){t.DomUtil.addClass(e,o+"-disabled");this._map.fire("contextmenu.disableitem",{contextmenu:this,el:e})}else{t.DomUtil.removeClass(e,o+"-disabled");this._map.fire("contextmenu.enableitem",{contextmenu:this,el:e})}}},isVisible:function(){return this._visible},_createItems:function(){var t=this._map.options.contextmenuItems,e,n,i;for(n=0,i=t.length;n<i;n++){this._items.push(this._createItem(this._container,t[n]))}},_createItem:function(e,n,i){if(n.separator||n==="-"){return this._createSeparator(e,i)}var o=t.Map.ContextMenu.BASE_CLS+"-item",s=n.disabled?o+" "+o+"-disabled":o,h=this._insertElementAt("a",s,e,i),r=this._createEventHandler(h,n.callback,n.context,n.hideOnSelect),a=this._getIcon(n),m=this._getIconCls(n),u="";if(a){u='<img class="'+t.Map.ContextMenu.BASE_CLS+'-icon" src="'+a+'"/>'}else if(m){u='<span class="'+t.Map.ContextMenu.BASE_CLS+"-icon "+m+'"></span>'}h.innerHTML=u+n.text;h.href="#";t.DomEvent.on(h,"mouseover",this._onItemMouseOver,this).on(h,"mouseout",this._onItemMouseOut,this).on(h,"mousedown",t.DomEvent.stopPropagation).on(h,"click",r);if(t.Browser.touch){t.DomEvent.on(h,this._touchstart,t.DomEvent.stopPropagation)}if(!t.Browser.pointer){t.DomEvent.on(h,"click",this._onItemMouseOut,this)}return{id:t.Util.stamp(h),el:h,callback:r}},_removeItem:function(e){var n,i,o,s,h;for(o=0,s=this._items.length;o<s;o++){n=this._items[o];if(n.id===e){i=n.el;h=n.callback;if(h){t.DomEvent.off(i,"mouseover",this._onItemMouseOver,this).off(i,"mouseover",this._onItemMouseOut,this).off(i,"mousedown",t.DomEvent.stopPropagation).off(i,"click",h);if(t.Browser.touch){t.DomEvent.off(i,this._touchstart,t.DomEvent.stopPropagation)}if(!t.Browser.pointer){t.DomEvent.on(i,"click",this._onItemMouseOut,this)}}this._container.removeChild(i);this._items.splice(o,1);return n}}return null},_createSeparator:function(e,n){var i=this._insertElementAt("div",t.Map.ContextMenu.BASE_CLS+"-separator",e,n);return{id:t.Util.stamp(i),el:i}},_createEventHandler:function(e,n,i,o){var s=this,h=this._map,r=t.Map.ContextMenu.BASE_CLS+"-item-disabled",o=o!==undefined?o:true;return function(a){if(t.DomUtil.hasClass(e,r)){return}if(o){s._hide()}if(n){n.call(i||h,s._showLocation)}s._map.fire("contextmenu.select",{contextmenu:s,el:e})}},_insertElementAt:function(t,e,n,i){var o,s=document.createElement(t);s.className=e;if(i!==undefined){o=n.children[i]}if(o){n.insertBefore(s,o)}else{n.appendChild(s)}return s},_show:function(t){this._showAtPoint(t.containerPoint,t)},_showAtPoint:function(e,n){if(this._items.length){var i=this._map,o=i.containerPointToLayerPoint(e),s=i.layerPointToLatLng(o),h=t.extend(n||{},{contextmenu:this});this._showLocation={latlng:s,layerPoint:o,containerPoint:e};if(n&&n.relatedTarget){this._showLocation.relatedTarget=n.relatedTarget}this._setPosition(e);if(!this._visible){this._container.style.display="block";this._visible=true}this._map.fire("contextmenu.show",h)}},_hide:function(){if(this._visible){this._visible=false;this._container.style.display="none";this._map.fire("contextmenu.hide",{contextmenu:this})}},_getIcon:function(e){return t.Browser.retina&&e.retinaIcon||e.icon},_getIconCls:function(e){return t.Browser.retina&&e.retinaIconCls||e.iconCls},_setPosition:function(e){var n=this._map.getSize(),i=this._container,o=this._getElementSize(i),s;if(this._map.options.contextmenuAnchor){s=t.point(this._map.options.contextmenuAnchor);e=e.add(s)}i._leaflet_pos=e;if(e.x+o.x>n.x){i.style.left="auto";i.style.right=Math.min(Math.max(n.x-e.x,0),n.x-o.x-1)+"px"}else{i.style.left=Math.max(e.x,0)+"px";i.style.right="auto"}if(e.y+o.y>n.y){i.style.top="auto";i.style.bottom=Math.min(Math.max(n.y-e.y,0),n.y-o.y-1)+"px"}else{i.style.top=Math.max(e.y,0)+"px";i.style.bottom="auto"}},_getElementSize:function(t){var e=this._size,n=t.style.display;if(!e||this._sizeChanged){e={};t.style.left="-999999px";t.style.right="auto";t.style.display="block";e.x=t.offsetWidth;e.y=t.offsetHeight;t.style.left="auto";t.style.display=n;this._sizeChanged=false}return e},_onKeyDown:function(t){var e=t.keyCode;if(e===27){this._hide()}},_onItemMouseOver:function(e){t.DomUtil.addClass(e.target||e.srcElement,"over")},_onItemMouseOut:function(e){t.DomUtil.removeClass(e.target||e.srcElement,"over")}});t.Map.addInitHook("addHandler","contextmenu",t.Map.ContextMenu);t.Mixin.ContextMenu={bindContextMenu:function(e){t.setOptions(this,e);this._initContextMenu();return this},unbindContextMenu:function(){this.off("contextmenu",this._showContextMenu,this);return this},addContextMenuItem:function(t){this.options.contextmenuItems.push(t)},removeContextMenuItemWithIndex:function(t){var e=[];for(var n=0;n<this.options.contextmenuItems.length;n++){if(this.options.contextmenuItems[n].index==t){e.push(n)}}var i=e.pop();while(i!==undefined){this.options.contextmenuItems.splice(i,1);i=e.pop()}},replaceContextMenuItem:function(t){this.removeContextMenuItemWithIndex(t.index);this.addContextMenuItem(t)},_initContextMenu:function(){this._items=[];this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(e){var n,i,o,s,h;if(this._map.contextmenu){i=t.extend({relatedTarget:this},e);o=this._map.mouseEventToContainerPoint(e.originalEvent);if(!this.options.contextmenuInheritItems){this._map.contextmenu.hideAllItems()}for(s=0,h=this.options.contextmenuItems.length;s<h;s++){n=this.options.contextmenuItems[s];this._items.push(this._map.contextmenu.insertItem(n,n.index))}this._map.once("contextmenu.hide",this._hideContextMenu,this);this._map.contextmenu.showAt(o,i)}},_hideContextMenu:function(){var t,e;for(t=0,e=this._items.length;t<e;t++){this._map.contextmenu.removeItem(this._items[t])}this._items.length=0;if(!this.options.contextmenuInheritItems){this._map.contextmenu.showAllItems()}}};var e=[t.Marker,t.Path],n={contextmenu:false,contextmenuItems:[],contextmenuInheritItems:true},i,o,s;for(o=0,s=e.length;o<s;o++){i=e[o];if(!i.prototype.options){i.prototype.options=n}else{i.mergeOptions(n)}i.addInitHook(function(){if(this.options.contextmenu){this._initContextMenu()}});i.include(t.Mixin.ContextMenu)}return t.Map.ContextMenu});
/**
 * Semicircle extension for L.Circle.
 * Jan Pieter Waagmeester <jieter@jieter.nl>
 *
 * This version is tested with leaflet 1.0.2
 */
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD
        define(['leaflet'], factory);
    } else if (typeof module !== 'undefined' && typeof require !== 'undefined') {
        // Node/CommonJS
        module.exports = factory(require('leaflet'));
    } else {
        // Browser globals
        if (typeof window.L === 'undefined') {
            throw 'Leaflet must be loaded first';
        }
        factory(window.L);
    }
})(function (L) {
    var DEG_TO_RAD = Math.PI / 180;

    // make sure 0 degrees is up (North) and convert to radians.
    function fixAngle (angle) {
        return (angle - 90) * DEG_TO_RAD;
    }

    // rotate point [x + r, y+r] around [x, y] by `angle` radians.
    function rotated (p, angle, r) {
        return p.add(
            L.point(Math.cos(angle), Math.sin(angle)).multiplyBy(r)
        );
    }

    L.Point.prototype.rotated = function (angle, r) {
        return rotated(this, angle, r);
    };

    var semicircle = {
        options: {
            startAngle: 0,
            stopAngle: 359.9999
        },

        startAngle: function () {
            if (this.options.startAngle < this.options.stopAngle) {
                return fixAngle(this.options.startAngle);
            } else {
                return fixAngle(this.options.stopAngle);
            }
        },
        stopAngle: function () {
            if (this.options.startAngle < this.options.stopAngle) {
                return fixAngle(this.options.stopAngle);
            } else {
                return fixAngle(this.options.startAngle);
            }
        },

        setStartAngle: function (angle) {
            this.options.startAngle = angle;
            return this.redraw();
        },

        setStopAngle: function (angle) {
            this.options.stopAngle = angle;
            return this.redraw();
        },

        setDirection: function (direction, degrees) {
            if (degrees === undefined) {
                degrees = 10;
            }
            this.options.startAngle = direction - (degrees / 2);
            this.options.stopAngle = direction + (degrees / 2);

            return this.redraw();
        },
        getDirection: function () {
            return this.stopAngle() - (this.stopAngle() - this.startAngle()) / 2;
        },

        isSemicircle: function () {
            var startAngle = this.options.startAngle,
                stopAngle = this.options.stopAngle;

            return (
                !(startAngle === 0 && stopAngle > 359) &&
                !(startAngle == stopAngle)
            );
        },
        _containsPoint: function (p) {
            function normalize (angle) {
                while (angle <= -Math.PI) {
                    angle += 2.0 * Math.PI;
                }
                while (angle > Math.PI) {
                    angle -= 2.0 * Math.PI;
                }
                return angle;
            }
            var angle = Math.atan2(p.y - this._point.y, p.x - this._point.x);
            var nStart = normalize(this.startAngle());
            var nStop = normalize(this.stopAngle());
            if (nStop <= nStart) {
                nStop += 2.0 * Math.PI;
            }
            if (angle <= nStart) {
                angle += 2.0 * Math.PI;
            }
            return (
                nStart < angle && angle <= nStop &&
                p.distanceTo(this._point) <= this._radius + this._clickTolerance()
            );
        }
    };

    L.SemiCircle = L.Circle.extend(semicircle);
    L.SemiCircleMarker = L.CircleMarker.extend(semicircle);

    L.semiCircle = function (latlng, options) {
        return new L.SemiCircle(latlng, options);
    };
    L.semiCircleMarker = function (latlng, options) {
        return new L.SemiCircleMarker(latlng, options);
    };

    var _updateCircleSVG = L.SVG.prototype._updateCircle;
    var _updateCircleCanvas = L.Canvas.prototype._updateCircle;

    L.SVG.include({
        _updateCircle: function (layer) {
            // If we want a circle, we use the original function
            if (!(layer instanceof L.SemiCircle || layer instanceof L.SemiCircleMarker) ||
                !layer.isSemicircle()) {
                return _updateCircleSVG.call(this, layer);
            }
            if (layer._empty()) {
                return this._setPath(layer, 'M0 0');
            }

            var p = layer._map.latLngToLayerPoint(layer._latlng),
                r = layer._radius,
                r2 = Math.round(layer._radiusY || r),
                start = p.rotated(layer.startAngle(), r),
                end = p.rotated(layer.stopAngle(), r);

            var largeArc = (layer.options.stopAngle - layer.options.startAngle >= 180) ? '1' : '0';

            var d = 'M' + p.x + ',' + p.y +
                // line to first start point
                'L' + start.x + ',' + start.y +
                'A ' + r + ',' + r2 + ',0,' + largeArc + ',1,' + end.x + ',' + end.y +
                ' z';

            this._setPath(layer, d);
        }
    });

    L.Canvas.include({
        _updateCircle: function (layer) {
            // If we want a circle, we use the original function
            if (!(layer instanceof L.SemiCircle || layer instanceof L.SemiCircleMarker) ||
                !layer.isSemicircle()) {
                return _updateCircleCanvas.call(this, layer);
            }

            var p = layer._point,
                ctx = this._ctx,
                r = layer._radius,
                s = (layer._radiusY || r) / r,
                start = p.rotated(layer.startAngle(), r);

            this._drawnLayers[layer._leaflet_id] = layer;

            if (s !== 1) {
                ctx.save();
                ctx.scale(1, s);
            }

            ctx.beginPath();
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(start.x, start.y);
            ctx.arc(p.x, p.y, r, layer.startAngle(), layer.stopAngle());
            ctx.lineTo(p.x, p.y);

            if (s !== 1) {
                ctx.restore();
            }

            this._fillStroke(ctx, layer);
        }
    });
});

$$.module.registerModule('brainjs.map.icon.ais', function() {

	return function(data) {

		var color = data.color || 'green'

		var template =  `
			<svg width="40" height="40" style="border: 1px solid back;">
				<g transform="translate(20, 20)" stroke="${color}" fill="${color}">
					<circle r="3"></circle>
					<rect x="-7" y="-7" width="15" height="15" fill=${color} fill-opacity="0.3"></rect>
					<line y2="-30"></line>
				</g>
			</svg>
		`

		return L.divIcon({
			className: 'aisMarker',
			iconSize: [40, 40],
			iconAnchor: [20, 20],
			html: template
		})		
	}
});

$$.module.registerModule('brainjs.map.icon.font', function() {

	return function(data) {
		data = $.extend({
			className: 'fa fa-home',
			fontSize: 10,
			color: 'green'
		}, data)

		const fontSize = data.fontSize

		var template = `
			<i class="${data.className}" style="color: ${data.color}; font-size: ${fontSize}px"></i>
		`
		return L.divIcon({
			className: 'fontMarker',
			iconSize: [fontSize, fontSize],
			iconAnchor: [fontSize/2, fontSize/2],
			html: template
		})	
	}	
})
$$.module.registerModule('brainjs.map.shape.circle', function() {

	return {
		
		create: function(data) {
			return L.circle(data.latlng, data.radius, data.style)
		},
		update: function(layer, data) {
		
			if (data.latlng) {
				layer.setLatLng(data.latlng)
			}	
			
			if (data.radius) {
				layer.setRadius(data.radius)
			}
			if (data.style) {
				layer.setStyle(data.style)
			}
			
		},
		getData: function(layer, data) {
			data.radius = layer.getRadius()
			data.latlng = layer.getLatLng()	
		}		

	}
});


$$.module.registerModule('brainjs.map.shape.circleMarker', function() {

	return {

		create: function(data) {
			
			return L.circleMarker(data.latlng, data.options)
		},
		update: function(layer, data) {
		
			if (data.latlng) {
				layer.setLatLng(data.latlng)
			}	
			
			if (data.options) {
				layer.setStyle(data.options)
			}
			
		}				
	}
});

(function() {



function getIconMarker(data) {
	if (typeof data.type != 'string') {
		console.error('[brainjs.map] getIconMarker, missing type field')
		return
	}
	const func = $$.module.getModule('brainjs.map.icon.' + data.type)

	if (typeof func == 'function') {
		return func(data)
	}
}

$$.module.registerModule('brainjs.map.shape.marker', function() {

	return {
		
		create: function(data) {

			const options = data.options || {}
			if (data.icon) {
				options.icon = getIconMarker(data.icon)
			}
			if (data.rotationAngle) {
				options.rotationAngle = data.rotationAngle
			}

			const marker = L.marker(data.latlng, options)							
			
			if (data.popup) {
				const content = data.popup.content
				if (typeof content == 'string') {
					delete data.popup.content
					const options = $.extend({autoClose: false, closeButton: true, autoPan: false}, data.popup)
					let popup = L.popup(options)
					popup.setContent(content)
					marker.bindPopup(popup)
	
				}
			}




			if (typeof data.tooltip == 'string') {
				marker.bindTooltip(data.tooltip).openTooltip()
			}
																
			return marker
		},

		update: function(layer, data) {
		

			if (data.latlng) {
				layer.setLatLng(data.latlng)
			}
			if (data.icon) {
				layer.setIcon(getIconMarker(data.icon))
			}
			if (data.rotationAngle) {
				layer.setRotationAngle(data.rotationAngle)
			}	

			if (data.popupContent) {
				layer.setPopupContent(data.popupContent)
			}	

		},
		getData: function(layer, data) {
			data.latlng = layer.getLatLng()
		}
	}
})

})();
$$.module.registerModule('brainjs.map.shape.polygon', function() {

	return {
		
		create: function(data) {
			return L.polygon(data.latlngs, data.style)
		},
		update: function(layer, data) {
		
			if (data.latlngs) {
				layer.setLatLngs(data.latlngs)
			}
			if (data.style) {
				layer.setStyle(data.style)
			}
			
		},
		getData: function(layer, data) {
			data.latlngs = layer.getLatLngs()[0]
		}		

	}
});


$$.module.registerModule('brainjs.map.shape.polyline', function() {

	return {
		
		create: function(data) {
			return L.polyline(data.latlngs, data.style)
		},
		update: function(layer, data) {
		
			if (data.latlngs) {
				layer.setLatLngs(data.latlngs)
			}
			if (data.style) {
				layer.setStyle(data.style)
			}
			
		},
		getData: function(layer, data) {
			data.latlngs = layer.getLatLngs()
		}	
	}
});


$$.module.registerModule('brainjs.map.shape.rectangle', function() {

	return {
		
		create: function(data) {
		
			const bounds = L.latLngBounds(data.northWest, data.southEast)
			return L.rectangle(bounds, data.style)
		},

		update: function(layer, data) {
			
			if (data.northWest && data.southEast) {
				const bounds = L.latLngBounds(data.northWest, data.southEast)
				layer.setBounds(bounds)
			}
			if (data.style) {
				layer.setStyle(data.style)
			}
		},
		getData: function(layer, data) {
			const bounds = layer.getBounds()
			data.northWest =  bounds.getNorthWest()
			data.southEast =  bounds.getSouthEast()
		}
	}
});


$$.module.registerModule('brainjs.map.shape.sector', function() {

	return {

		create: function(data) {
			var options = $.extend({radius: data.radius}, data.options)
			var sector = L.semiCircle(data.latlng, options)
			sector.setDirection(data.direction, data.size)
			return sector
		},
		update: function(layer, data) {
			if (data.latlng) {
				layer.setLatLng(data.latlng)
			}
			if (data.radius) {
				layer.setRadius(data.radius)
			}
			if (data.direction && data.size) {
				layer.setDirection(data.direction, data.size)
			}
			if (data.options) {
				layer.setStyle(data.options)
			}
		}		
	}
});


$(function () {
	console.log('[brainjs.map] Leaflet version', L.version)
	//$$.util.loadStyle('map/brainjs-map.css')
})



$$.control.registerControl('brainjs.map', {
	props: {
		tileUrl: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
		center: { lat: 51.505, lng: -0.09 }, // london city
		zoom: 13,
		layers: {},
		scale: false,
		coordinates: false,
		plugins: {},
		contextMenu: {},
		shapes: {}
	},
	init: function (elt) {

		const div = $('<div>').css('height', '100%').appendTo(elt).get(0)

		const { center, zoom, tileUrl, contextMenu } = this.props

		const mapOptions = {
			center,
			zoom,
			closePopupOnClick: false,
			contextmenu: true,
			//contextmenuWidth: 200,
			attributionControl: false
		}

		mapOptions.contextmenuItems = Object.keys(contextMenu).map(function (cmd) {
			const text = contextMenu[cmd].name
			if (text === '--') {
				return { separator: true }
			}
			return {
				text,
				callback: function (ev) {
					elt.trigger('mapcontextmenu', { cmd, latlng: ev.latlng })
				}
			}

		})

		const map = L.map(div, mapOptions)
		const shapes = {}
		const layers = {}

		const confLayer = {}

		for (let layerName in this.props.layers) {
			const { label, visible } = this.props.layers[layerName]
			const layer = new L.FeatureGroup()
			layers[layerName] = layer
			if (typeof label == 'string') {
				confLayer[label] = layer
			}

			if (visible === true) {
				map.addLayer(layer)
			}
		}

		if (Object.keys(confLayer).length != 0) {
			L.control.layers({}, confLayer).addTo(map)
		}

		if (this.props.scale) {
			L.control.scale({ imperial: false, position: 'bottomright' }).addTo(map)
		}

		if (this.props.coordinates) {
			L.control.coordinates({
				position: 'bottomleft',
				useLatLngOrder: true,
				enableUserInput: false,
				decimals: 5
			}).addTo(map)
		}

		const data = { elt, map, layers, shapes }

		for (let pluginName in this.props.plugins) {
			const func = $$.module.getModule('brainjs.map.plugin.' + pluginName)
			const config = this.props.plugins[pluginName]
			if (typeof func == 'function') {
				console.log(`[brainjs.map] instance plugin '${pluginName}' with config`, config)
				func(data, config)
			}
		}

		L.tileLayer(tileUrl).addTo(map)

		setTimeout(function () {
			map.invalidateSize()
		}, 100)

		map.on('click', function (ev) {
			//console.log('[map] onclick', ev)
			elt.trigger('mapclick', { latlng: ev.latlng })
		})

		this.getShapes = function () {
			return Object.keys(shapes)
		}

		this.updateShape = function (id, options) {
			const shape = shapes[id]
			if (shape) {
				const shapeDesc = $$.module.getModule('brainjs.map.shape.' + shape.type)
				if (shapeDesc && typeof shapeDesc.update == 'function') {

					//console.log('[brainjs.map] updateShape with id', id)
					shapeDesc.update(shape, options)
					$.extend(shape.info, options)
				}
			}
			else {
				throw `[brainjs.map] updateShape id '${id}' doesn't exist`
			}
		}

		this.addShape = function (id, data) {
			if (shapes[id]) {
				throw `[brainjs.map] addShape id '${id}' already exist`
			}
			data = data || {}

			if (typeof data.type != 'string') {
				console.error('[brainjs.map] addShape, missing type field')
				return
			}

			const shapeDesc = $$.module.getModule('brainjs.map.shape.' + data.type)

			let layer = map
			if (typeof data.layer == 'string') {
				layer = layers[data.layer]
				if (layer == undefined) {
					throw `layer '${data.layer}' doesn't exist`
				}
			}

			if (shapeDesc && typeof shapeDesc.create == 'function') {

				console.log('[brainjs.map] addShape with id', id)
				if (data.contextMenu) {
					data.options = {
						contextmenu: true,
						contextmenuInheritItems: false,
						contextmenuItems: Object.entries(data.contextMenu).map((item) => {
							const [cmd, info] = item
							const text = info.name
							if (text === '--') {
								return { separator: true }
							}
							return {
								text,
								iconCls: info.iconCls,
								callback: function (ev) {
									elt.trigger('mapshapecontextmenu', { id, cmd, latlng: ev.latlng })
								}
							}
	
						})
	
					}
				}

				shape = shapeDesc.create(data)
				shape.type = data.type
				shape.ownlayer = layer
				shape.info = data
				shape.id = id
				shapes[id] = shape
				if (data.contextMenu == undefined) {
					shape.on('contextmenu', function (ev) {
						const data = { id, latlng: ev.latlng }
						if (typeof ev.target.getLatLng == 'function') {
							data.pos = map.latLngToContainerPoint(ev.target.getLatLng())
						}
						elt.trigger('mapshapecontextmenu', data)
					})

				}
				else {
					delete data.contextMenu
				}
				shape.addTo(layer)
				if (data.popup) {
					shape.openPopup()
				}
			}
		}

		this.removeShape = function (id) {

			const shape = shapes[id]
			if (shape) {
				console.log('[brainjs.map] removeShape with id', id)
				shape.removeFrom(shape.ownlayer)
				delete shapes[id]
			}
			else {
				console.warn(`[brainjs.map] removeShape id '${id}' doesn't exist`)
			}
		}


		this.getShapeInfo = function (id) {

			const shape = shapes[id]
			if (shape) {
				return shape.info
			}
			else {
				console.warn(`[brainjs.map] removeShape id '${id}' doesn't exist`)
			}
		}

		this.enableHandlers = function (enabled) {
			map._handlers.forEach(function (handler) {
				if (enabled)
					handler.enable()
				else
					handler.disable()
			})
		}

		this.getZoom = function () {
			return map.getZoom()
		}

		this.getCenter = function () {
			return map.getCenter()
		}

		this.panTo = function (latlng) {
			return map.panTo(latlng, { animate: true })
		}

		this.flyTo = function (latlng, zoom) {
			return map.flyTo(latlng, zoom, { animate: true })
		}

		for (let shapeId in this.props.shapes) {
			this.addShape(shapeId, this.props.shapes[shapeId])
		}

	},

	$iface: `
		getShapes():[shapeId];
		updateShape(shapeId, options);
		addShape(shapeId, options);
		removeShape(shapeId);
		getShapeInfo(shapeId): ShapeInfo;
		enableHandlers(enabled);
		getZoom():ZoomLevel;
		getCenter(): LatLng;
		panTo(latlng);
		flyTo(latlng, zoom)
		`,

	$events: `mapcontextmenu;mapclick;mapshapecontextmenu`

});

$$.control.registerControl('brainjs.image', {

	props: {
		src: ''
	},

	template: "<div class=\"toolbar\">\n	<div bn-show=\"!ready\">\n		<i class=\"fa fa-spinner fa-pulse\"></i>\n		&nbsp;Loading...\n	</div>\n	\n</div>\n\n<div bn-bind=\"map\" class=\"map\"></div>",

	init: function(elt) {

		const {src} = this.props

		let rotationAngle = 0

		const ctrl = $$.viewController(elt, {
			data: {
				ready: false
			},
			events: {
			}
		})

		const mapOptions = {
			crs: L.CRS.Simple,
			attributionControl: false,
			zoomControl: false,
			minZoom: -4,
			zoomSnap: 0.05,
			contextmenu: true,
			contextmenuItems: [
				{
					text: 'Fit Image Size',
					iconCls: 'fas fa-expand w3-text-blue',
					callback: function() {
						fitImage()
					}
				},
				{separator: true},
				{
					text: 'Rotate Right',
					iconCls: 'fas fa-redo-alt w3-text-blue',
					callback: function() {
						rotate(90)
					}
				},
				{
					text: 'Rotate Left', 
					iconCls: 'fas fa-undo-alt w3-text-blue',
					callback: function() {
						rotate(-90)
					}
				}
			]			
		}

		const map = L.map(ctrl.scope.map.get(0), mapOptions)

		let bounds
		let imageOverlay = null
		let image = null

		function load(url) {
			ctrl.setData({ready: false})

			image = new Image()
			image.onload = function() {
				ctrl.setData({ready: true})

				const width = image.width
				const height = image.height
				//console.log('width: ', width, ' height:', height)
				bounds = [[0, 0], [height, width]]

			if (imageOverlay == null) {
					imageOverlay = L.rotateImageLayer(url, bounds).addTo(map)					
				}
				else {
					imageOverlay.setBounds(bounds)
					rotationAngle = 0
					imageOverlay.setRotation(rotationAngle)
					imageOverlay.setUrl(url)
				}
				map.fitBounds(bounds)

			}
			image.src = url			
		}

		if (src != '') {
			load(src)
		}

		function fitImage() {
			if (bounds != undefined) {
				map.fitBounds(bounds)
			}
		}

		function rotate(angleDeg) {
			rotationAngle += angleDeg
			rotationAngle = (rotationAngle + 360) % 360

			const width = image.width
			const height = image.height

			if (rotationAngle == 0) {
				bounds = [[0, 0], [height, width]]
			}
			if (rotationAngle == 270) {
				bounds = [[height, 0], [width+height, width]]
			}
			if (rotationAngle == 90) {
				bounds = [[height, -height], [height-width, 0]]
			}
			if (rotationAngle == 180) {
				bounds = [[height, 0], [2*height, -width]]
			}
			//console.log('rotationAngle', rotationAngle)
			//console.log('bounds', bounds)
			imageOverlay.setRotation(rotationAngle)
			fitImage()
		}

		this.fitImage = fitImage
		this.rotate = rotate

		this.enableHandlers = function(isEnabled) {
			map._handlers.forEach((handler) => {
				if (isEnabled) {
					handler.enable()
				}
				else {
					handler.disable()
				}
			})
		}

		this.enableContextMenu = function(isEnabled) {

			if (isEnabled) {
				map.contextmenu.enable()
			}
			else {
				map.contextmenu.disable()
			}
		}

		this.invalidateSize = function() {
			map.invalidateSize()
			fitImage()
		}

		this.setData = function(data) {
			//console.log('[image] setData', data)
			if (data.src) {
				load(data.src)
			}
		}

	},
	$iface: `
		setData({src});
		invalidateSize();
		enableHandlers(isEnabled);
		enableContextMenu(isEnabled);
		fitImage();
		rotate(angleDeg)

	`

})
L.rotateImageLayer = function(url, bounds, options) {
    return new L.RotateImageLayer(url, bounds, options);
};
// A quick extension to allow image layer rotation.
L.RotateImageLayer = L.ImageOverlay.extend({
    options: {rotation: 0},

    _animateZoom: function(e){
        L.ImageOverlay.prototype._animateZoom.call(this, e);
        var img = this._image;
        img.style[L.DomUtil.TRANSFORM] += ' rotate(' + this.options.rotation + 'deg)';
    },

    _reset: function(){
        L.ImageOverlay.prototype._reset.call(this);
        var img = this._image;
        img.style[L.DomUtil.TRANSFORM] += ' rotate(' + this.options.rotation + 'deg)';
    },

    setRotation:function(rotation) {
        this.options.rotation = rotation
        if (this._map) {
            this._reset()
        }
        return this
    },

    setBounds:function(bounds) {
        //console.log('setBounds', bounds)
        const corner1 = L.latLng(bounds[0][0], bounds[0][1])
        const corner2 = L.latLng(bounds[1][0], bounds[1][1])
        bounds = L.latLngBounds(corner1, corner2);        
        L.ImageOverlay.prototype.setBounds.call(this, bounds);
        return this
    }    
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxlYWZsZXQuanMiLCJsZWFmbGV0LnJvdGF0ZWRNYXJrZXIuanMiLCJMZWFmbGV0LkNvb3JkaW5hdGVzLm1pbi5qcyIsImxlYWZsZXQuY29udGV4dG1lbnUubWluLmpzIiwiU2VtaWNpcmNsZS5qcyIsImFpcy5qcyIsImZvbnQuanMiLCJjaXJjbGUuanMiLCJjaXJjbGVNYXJrZXIuanMiLCJtYXJrZXIuanMiLCJwb2x5Z29uLmpzIiwicG9seWxpbmUuanMiLCJyZWN0YW5nbGUuanMiLCJzZWN0b3IuanMiLCJtYXAuanMiLCJpbWFnZS5qcyIsInJvdGF0ZUltYWdlTGF5ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOURBO0FBQ0E7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbk1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL1FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJicmFpbmpzLW1hcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gTGVhZmxldCAxLjAuMytlZDM2YTA0LCBhIEpTIGxpYnJhcnkgZm9yIGludGVyYWN0aXZlIG1hcHMuIGh0dHA6Ly9sZWFmbGV0anMuY29tXG4gKGMpIDIwMTAtMjAxNiBWbGFkaW1pciBBZ2Fmb25raW4sIChjKSAyMDEwLTIwMTEgQ2xvdWRNYWRlXG4qL1xuIWZ1bmN0aW9uKHQsZSxpKXtmdW5jdGlvbiBuKCl7dmFyIGU9dC5MO28ubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiB0Lkw9ZSx0aGlzfSx0Lkw9b312YXIgbz17dmVyc2lvbjpcIjEuMC4zK2VkMzZhMDRcIn07XCJvYmplY3RcIj09dHlwZW9mIG1vZHVsZSYmXCJvYmplY3RcIj09dHlwZW9mIG1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPW86XCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kJiZkZWZpbmUobyksXCJ1bmRlZmluZWRcIiE9dHlwZW9mIHQmJm4oKSxvLlV0aWw9e2V4dGVuZDpmdW5jdGlvbih0KXt2YXIgZSxpLG4sbztmb3IoaT0xLG49YXJndW1lbnRzLmxlbmd0aDtpPG47aSsrKXtvPWFyZ3VtZW50c1tpXTtmb3IoZSBpbiBvKXRbZV09b1tlXX1yZXR1cm4gdH0sY3JlYXRlOk9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIHQucHJvdG90eXBlPWUsbmV3IHR9fSgpLGJpbmQ6ZnVuY3Rpb24odCxlKXt2YXIgaT1BcnJheS5wcm90b3R5cGUuc2xpY2U7aWYodC5iaW5kKXJldHVybiB0LmJpbmQuYXBwbHkodCxpLmNhbGwoYXJndW1lbnRzLDEpKTt2YXIgbj1pLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBmdW5jdGlvbigpe3JldHVybiB0LmFwcGx5KGUsbi5sZW5ndGg/bi5jb25jYXQoaS5jYWxsKGFyZ3VtZW50cykpOmFyZ3VtZW50cyl9fSxzdGFtcDpmdW5jdGlvbih0KXtyZXR1cm4gdC5fbGVhZmxldF9pZD10Ll9sZWFmbGV0X2lkfHwrK28uVXRpbC5sYXN0SWQsdC5fbGVhZmxldF9pZH0sbGFzdElkOjAsdGhyb3R0bGU6ZnVuY3Rpb24odCxlLGkpe3ZhciBuLG8scyxyO3JldHVybiByPWZ1bmN0aW9uKCl7bj0hMSxvJiYocy5hcHBseShpLG8pLG89ITEpfSxzPWZ1bmN0aW9uKCl7bj9vPWFyZ3VtZW50czoodC5hcHBseShpLGFyZ3VtZW50cyksc2V0VGltZW91dChyLGUpLG49ITApfX0sd3JhcE51bTpmdW5jdGlvbih0LGUsaSl7dmFyIG49ZVsxXSxvPWVbMF0scz1uLW87cmV0dXJuIHQ9PT1uJiZpP3Q6KCh0LW8pJXMrcyklcytvfSxmYWxzZUZuOmZ1bmN0aW9uKCl7cmV0dXJuITF9LGZvcm1hdE51bTpmdW5jdGlvbih0LGUpe3ZhciBpPU1hdGgucG93KDEwLGV8fDUpO3JldHVybiBNYXRoLnJvdW5kKHQqaSkvaX0sdHJpbTpmdW5jdGlvbih0KXtyZXR1cm4gdC50cmltP3QudHJpbSgpOnQucmVwbGFjZSgvXlxccyt8XFxzKyQvZyxcIlwiKX0sc3BsaXRXb3JkczpmdW5jdGlvbih0KXtyZXR1cm4gby5VdGlsLnRyaW0odCkuc3BsaXQoL1xccysvKX0sc2V0T3B0aW9uczpmdW5jdGlvbih0LGUpe3QuaGFzT3duUHJvcGVydHkoXCJvcHRpb25zXCIpfHwodC5vcHRpb25zPXQub3B0aW9ucz9vLlV0aWwuY3JlYXRlKHQub3B0aW9ucyk6e30pO2Zvcih2YXIgaSBpbiBlKXQub3B0aW9uc1tpXT1lW2ldO3JldHVybiB0Lm9wdGlvbnN9LGdldFBhcmFtU3RyaW5nOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbj1bXTtmb3IodmFyIG8gaW4gdCluLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGk/by50b1VwcGVyQ2FzZSgpOm8pK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudCh0W29dKSk7cmV0dXJuKGUmJmUuaW5kZXhPZihcIj9cIikhPT0tMT9cIiZcIjpcIj9cIikrbi5qb2luKFwiJlwiKX0sdGVtcGxhdGU6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdC5yZXBsYWNlKG8uVXRpbC50ZW1wbGF0ZVJlLGZ1bmN0aW9uKHQsbil7dmFyIG89ZVtuXTtpZihvPT09aSl0aHJvdyBuZXcgRXJyb3IoXCJObyB2YWx1ZSBwcm92aWRlZCBmb3IgdmFyaWFibGUgXCIrdCk7cmV0dXJuXCJmdW5jdGlvblwiPT10eXBlb2YgbyYmKG89byhlKSksb30pfSx0ZW1wbGF0ZVJlOi9cXHsgKihbXFx3X1xcLV0rKSAqXFx9L2csaXNBcnJheTpBcnJheS5pc0FycmF5fHxmdW5jdGlvbih0KXtyZXR1cm5cIltvYmplY3QgQXJyYXldXCI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCl9LGluZGV4T2Y6ZnVuY3Rpb24odCxlKXtmb3IodmFyIGk9MDtpPHQubGVuZ3RoO2krKylpZih0W2ldPT09ZSlyZXR1cm4gaTtyZXR1cm4tMX0sZW1wdHlJbWFnZVVybDpcImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBQUQvQUN3QUFBQUFBUUFCQUFBQ0FEcz1cIn0sZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUpe3JldHVybiB0W1wid2Via2l0XCIrZV18fHRbXCJtb3pcIitlXXx8dFtcIm1zXCIrZV19ZnVuY3Rpb24gaShlKXt2YXIgaT0rbmV3IERhdGUsbz1NYXRoLm1heCgwLDE2LShpLW4pKTtyZXR1cm4gbj1pK28sdC5zZXRUaW1lb3V0KGUsbyl9dmFyIG49MCxzPXQucmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxlKFwiUmVxdWVzdEFuaW1hdGlvbkZyYW1lXCIpfHxpLHI9dC5jYW5jZWxBbmltYXRpb25GcmFtZXx8ZShcIkNhbmNlbEFuaW1hdGlvbkZyYW1lXCIpfHxlKFwiQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lXCIpfHxmdW5jdGlvbihlKXt0LmNsZWFyVGltZW91dChlKX07by5VdGlsLnJlcXVlc3RBbmltRnJhbWU9ZnVuY3Rpb24oZSxuLHIpe3JldHVybiByJiZzPT09aT92b2lkIGUuY2FsbChuKTpzLmNhbGwodCxvLmJpbmQoZSxuKSl9LG8uVXRpbC5jYW5jZWxBbmltRnJhbWU9ZnVuY3Rpb24oZSl7ZSYmci5jYWxsKHQsZSl9fSgpLG8uZXh0ZW5kPW8uVXRpbC5leHRlbmQsby5iaW5kPW8uVXRpbC5iaW5kLG8uc3RhbXA9by5VdGlsLnN0YW1wLG8uc2V0T3B0aW9ucz1vLlV0aWwuc2V0T3B0aW9ucyxvLkNsYXNzPWZ1bmN0aW9uKCl7fSxvLkNsYXNzLmV4dGVuZD1mdW5jdGlvbih0KXt2YXIgZT1mdW5jdGlvbigpe3RoaXMuaW5pdGlhbGl6ZSYmdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLmNhbGxJbml0SG9va3MoKX0saT1lLl9fc3VwZXJfXz10aGlzLnByb3RvdHlwZSxuPW8uVXRpbC5jcmVhdGUoaSk7bi5jb25zdHJ1Y3Rvcj1lLGUucHJvdG90eXBlPW47Zm9yKHZhciBzIGluIHRoaXMpdGhpcy5oYXNPd25Qcm9wZXJ0eShzKSYmXCJwcm90b3R5cGVcIiE9PXMmJihlW3NdPXRoaXNbc10pO3JldHVybiB0LnN0YXRpY3MmJihvLmV4dGVuZChlLHQuc3RhdGljcyksZGVsZXRlIHQuc3RhdGljcyksdC5pbmNsdWRlcyYmKG8uVXRpbC5leHRlbmQuYXBwbHkobnVsbCxbbl0uY29uY2F0KHQuaW5jbHVkZXMpKSxkZWxldGUgdC5pbmNsdWRlcyksbi5vcHRpb25zJiYodC5vcHRpb25zPW8uVXRpbC5leHRlbmQoby5VdGlsLmNyZWF0ZShuLm9wdGlvbnMpLHQub3B0aW9ucykpLG8uZXh0ZW5kKG4sdCksbi5faW5pdEhvb2tzPVtdLG4uY2FsbEluaXRIb29rcz1mdW5jdGlvbigpe2lmKCF0aGlzLl9pbml0SG9va3NDYWxsZWQpe2kuY2FsbEluaXRIb29rcyYmaS5jYWxsSW5pdEhvb2tzLmNhbGwodGhpcyksdGhpcy5faW5pdEhvb2tzQ2FsbGVkPSEwO2Zvcih2YXIgdD0wLGU9bi5faW5pdEhvb2tzLmxlbmd0aDt0PGU7dCsrKW4uX2luaXRIb29rc1t0XS5jYWxsKHRoaXMpfX0sZX0sby5DbGFzcy5pbmNsdWRlPWZ1bmN0aW9uKHQpe3JldHVybiBvLmV4dGVuZCh0aGlzLnByb3RvdHlwZSx0KSx0aGlzfSxvLkNsYXNzLm1lcmdlT3B0aW9ucz1mdW5jdGlvbih0KXtyZXR1cm4gby5leHRlbmQodGhpcy5wcm90b3R5cGUub3B0aW9ucyx0KSx0aGlzfSxvLkNsYXNzLmFkZEluaXRIb29rPWZ1bmN0aW9uKHQpe3ZhciBlPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxpPVwiZnVuY3Rpb25cIj09dHlwZW9mIHQ/dDpmdW5jdGlvbigpe3RoaXNbdF0uYXBwbHkodGhpcyxlKX07cmV0dXJuIHRoaXMucHJvdG90eXBlLl9pbml0SG9va3M9dGhpcy5wcm90b3R5cGUuX2luaXRIb29rc3x8W10sdGhpcy5wcm90b3R5cGUuX2luaXRIb29rcy5wdXNoKGkpLHRoaXN9LG8uRXZlbnRlZD1vLkNsYXNzLmV4dGVuZCh7b246ZnVuY3Rpb24odCxlLGkpe2lmKFwib2JqZWN0XCI9PXR5cGVvZiB0KWZvcih2YXIgbiBpbiB0KXRoaXMuX29uKG4sdFtuXSxlKTtlbHNle3Q9by5VdGlsLnNwbGl0V29yZHModCk7Zm9yKHZhciBzPTAscj10Lmxlbmd0aDtzPHI7cysrKXRoaXMuX29uKHRbc10sZSxpKX1yZXR1cm4gdGhpc30sb2ZmOmZ1bmN0aW9uKHQsZSxpKXtpZih0KWlmKFwib2JqZWN0XCI9PXR5cGVvZiB0KWZvcih2YXIgbiBpbiB0KXRoaXMuX29mZihuLHRbbl0sZSk7ZWxzZXt0PW8uVXRpbC5zcGxpdFdvcmRzKHQpO2Zvcih2YXIgcz0wLHI9dC5sZW5ndGg7czxyO3MrKyl0aGlzLl9vZmYodFtzXSxlLGkpfWVsc2UgZGVsZXRlIHRoaXMuX2V2ZW50cztyZXR1cm4gdGhpc30sX29uOmZ1bmN0aW9uKHQsZSxuKXt0aGlzLl9ldmVudHM9dGhpcy5fZXZlbnRzfHx7fTt2YXIgbz10aGlzLl9ldmVudHNbdF07b3x8KG89W10sdGhpcy5fZXZlbnRzW3RdPW8pLG49PT10aGlzJiYobj1pKTtmb3IodmFyIHM9e2ZuOmUsY3R4Om59LHI9byxhPTAsaD1yLmxlbmd0aDthPGg7YSsrKWlmKHJbYV0uZm49PT1lJiZyW2FdLmN0eD09PW4pcmV0dXJuO3IucHVzaChzKX0sX29mZjpmdW5jdGlvbih0LGUsbil7dmFyIHMscixhO2lmKHRoaXMuX2V2ZW50cyYmKHM9dGhpcy5fZXZlbnRzW3RdKSl7aWYoIWUpe2ZvcihyPTAsYT1zLmxlbmd0aDtyPGE7cisrKXNbcl0uZm49by5VdGlsLmZhbHNlRm47cmV0dXJuIHZvaWQgZGVsZXRlIHRoaXMuX2V2ZW50c1t0XX1pZihuPT09dGhpcyYmKG49aSkscylmb3Iocj0wLGE9cy5sZW5ndGg7cjxhO3IrKyl7dmFyIGg9c1tyXTtpZihoLmN0eD09PW4mJmguZm49PT1lKXJldHVybiBoLmZuPW8uVXRpbC5mYWxzZUZuLHRoaXMuX2ZpcmluZ0NvdW50JiYodGhpcy5fZXZlbnRzW3RdPXM9cy5zbGljZSgpKSx2b2lkIHMuc3BsaWNlKHIsMSl9fX0sZmlyZTpmdW5jdGlvbih0LGUsaSl7aWYoIXRoaXMubGlzdGVucyh0LGkpKXJldHVybiB0aGlzO3ZhciBuPW8uVXRpbC5leHRlbmQoe30sZSx7dHlwZTp0LHRhcmdldDp0aGlzfSk7aWYodGhpcy5fZXZlbnRzKXt2YXIgcz10aGlzLl9ldmVudHNbdF07aWYocyl7dGhpcy5fZmlyaW5nQ291bnQ9dGhpcy5fZmlyaW5nQ291bnQrMXx8MTtmb3IodmFyIHI9MCxhPXMubGVuZ3RoO3I8YTtyKyspe3ZhciBoPXNbcl07aC5mbi5jYWxsKGguY3R4fHx0aGlzLG4pfXRoaXMuX2ZpcmluZ0NvdW50LS19fXJldHVybiBpJiZ0aGlzLl9wcm9wYWdhdGVFdmVudChuKSx0aGlzfSxsaXN0ZW5zOmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5fZXZlbnRzJiZ0aGlzLl9ldmVudHNbdF07aWYoaSYmaS5sZW5ndGgpcmV0dXJuITA7aWYoZSlmb3IodmFyIG4gaW4gdGhpcy5fZXZlbnRQYXJlbnRzKWlmKHRoaXMuX2V2ZW50UGFyZW50c1tuXS5saXN0ZW5zKHQsZSkpcmV0dXJuITA7cmV0dXJuITF9LG9uY2U6ZnVuY3Rpb24odCxlLGkpe2lmKFwib2JqZWN0XCI9PXR5cGVvZiB0KXtmb3IodmFyIG4gaW4gdCl0aGlzLm9uY2Uobix0W25dLGUpO3JldHVybiB0aGlzfXZhciBzPW8uYmluZChmdW5jdGlvbigpe3RoaXMub2ZmKHQsZSxpKS5vZmYodCxzLGkpfSx0aGlzKTtyZXR1cm4gdGhpcy5vbih0LGUsaSkub24odCxzLGkpfSxhZGRFdmVudFBhcmVudDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fZXZlbnRQYXJlbnRzPXRoaXMuX2V2ZW50UGFyZW50c3x8e30sdGhpcy5fZXZlbnRQYXJlbnRzW28uc3RhbXAodCldPXQsdGhpc30scmVtb3ZlRXZlbnRQYXJlbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2V2ZW50UGFyZW50cyYmZGVsZXRlIHRoaXMuX2V2ZW50UGFyZW50c1tvLnN0YW1wKHQpXSx0aGlzfSxfcHJvcGFnYXRlRXZlbnQ6ZnVuY3Rpb24odCl7Zm9yKHZhciBlIGluIHRoaXMuX2V2ZW50UGFyZW50cyl0aGlzLl9ldmVudFBhcmVudHNbZV0uZmlyZSh0LnR5cGUsby5leHRlbmQoe2xheWVyOnQudGFyZ2V0fSx0KSwhMCl9fSk7dmFyIHM9by5FdmVudGVkLnByb3RvdHlwZTtzLmFkZEV2ZW50TGlzdGVuZXI9cy5vbixzLnJlbW92ZUV2ZW50TGlzdGVuZXI9cy5jbGVhckFsbEV2ZW50TGlzdGVuZXJzPXMub2ZmLHMuYWRkT25lVGltZUV2ZW50TGlzdGVuZXI9cy5vbmNlLHMuZmlyZUV2ZW50PXMuZmlyZSxzLmhhc0V2ZW50TGlzdGVuZXJzPXMubGlzdGVucyxvLk1peGluPXtFdmVudHM6c30sZnVuY3Rpb24oKXt2YXIgaT1uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCksbj1lLmRvY3VtZW50RWxlbWVudCxzPVwiQWN0aXZlWE9iamVjdFwiaW4gdCxyPWkuaW5kZXhPZihcIndlYmtpdFwiKSE9PS0xLGE9aS5pbmRleE9mKFwicGhhbnRvbVwiKSE9PS0xLGg9aS5zZWFyY2goXCJhbmRyb2lkIFsyM11cIikhPT0tMSxsPWkuaW5kZXhPZihcImNocm9tZVwiKSE9PS0xLHU9aS5pbmRleE9mKFwiZ2Vja29cIikhPT0tMSYmIXImJiF0Lm9wZXJhJiYhcyxjPTA9PT1uYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZihcIldpblwiKSxkPVwidW5kZWZpbmVkXCIhPXR5cGVvZiBvcmllbnRhdGlvbnx8aS5pbmRleE9mKFwibW9iaWxlXCIpIT09LTEsXz0hdC5Qb2ludGVyRXZlbnQmJnQuTVNQb2ludGVyRXZlbnQsbT10LlBvaW50ZXJFdmVudHx8XyxwPXMmJlwidHJhbnNpdGlvblwiaW4gbi5zdHlsZSxmPVwiV2ViS2l0Q1NTTWF0cml4XCJpbiB0JiZcIm0xMVwiaW4gbmV3IHQuV2ViS2l0Q1NTTWF0cml4JiYhaCxnPVwiTW96UGVyc3BlY3RpdmVcImluIG4uc3R5bGUsdj1cIk9UcmFuc2l0aW9uXCJpbiBuLnN0eWxlLHk9IXQuTF9OT19UT1VDSCYmKG18fFwib250b3VjaHN0YXJ0XCJpbiB0fHx0LkRvY3VtZW50VG91Y2gmJmUgaW5zdGFuY2VvZiB0LkRvY3VtZW50VG91Y2gpO28uQnJvd3Nlcj17aWU6cyxpZWx0OTpzJiYhZS5hZGRFdmVudExpc3RlbmVyLGVkZ2U6XCJtc0xhdW5jaFVyaVwiaW4gbmF2aWdhdG9yJiYhKFwiZG9jdW1lbnRNb2RlXCJpbiBlKSx3ZWJraXQ6cixnZWNrbzp1LGFuZHJvaWQ6aS5pbmRleE9mKFwiYW5kcm9pZFwiKSE9PS0xLGFuZHJvaWQyMzpoLGNocm9tZTpsLHNhZmFyaTohbCYmaS5pbmRleE9mKFwic2FmYXJpXCIpIT09LTEsd2luOmMsaWUzZDpwLHdlYmtpdDNkOmYsZ2Vja28zZDpnLG9wZXJhMTI6dixhbnkzZDohdC5MX0RJU0FCTEVfM0QmJihwfHxmfHxnKSYmIXYmJiFhLG1vYmlsZTpkLG1vYmlsZVdlYmtpdDpkJiZyLG1vYmlsZVdlYmtpdDNkOmQmJmYsbW9iaWxlT3BlcmE6ZCYmdC5vcGVyYSxtb2JpbGVHZWNrbzpkJiZ1LHRvdWNoOiEheSxtc1BvaW50ZXI6ISFfLHBvaW50ZXI6ISFtLHJldGluYToodC5kZXZpY2VQaXhlbFJhdGlvfHx0LnNjcmVlbi5kZXZpY2VYRFBJL3Quc2NyZWVuLmxvZ2ljYWxYRFBJKT4xfX0oKSxvLlBvaW50PWZ1bmN0aW9uKHQsZSxpKXt0aGlzLng9aT9NYXRoLnJvdW5kKHQpOnQsdGhpcy55PWk/TWF0aC5yb3VuZChlKTplfSxvLlBvaW50LnByb3RvdHlwZT17Y2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG8uUG9pbnQodGhpcy54LHRoaXMueSl9LGFkZDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5jbG9uZSgpLl9hZGQoby5wb2ludCh0KSl9LF9hZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueCs9dC54LHRoaXMueSs9dC55LHRoaXN9LHN1YnRyYWN0OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmNsb25lKCkuX3N1YnRyYWN0KG8ucG9pbnQodCkpfSxfc3VidHJhY3Q6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueC09dC54LHRoaXMueS09dC55LHRoaXN9LGRpdmlkZUJ5OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmNsb25lKCkuX2RpdmlkZUJ5KHQpfSxfZGl2aWRlQnk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMueC89dCx0aGlzLnkvPXQsdGhpc30sbXVsdGlwbHlCeTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5jbG9uZSgpLl9tdWx0aXBseUJ5KHQpfSxfbXVsdGlwbHlCeTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy54Kj10LHRoaXMueSo9dCx0aGlzfSxzY2FsZUJ5OmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5Qb2ludCh0aGlzLngqdC54LHRoaXMueSp0LnkpfSx1bnNjYWxlQnk6ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLlBvaW50KHRoaXMueC90LngsdGhpcy55L3QueSl9LHJvdW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2xvbmUoKS5fcm91bmQoKX0sX3JvdW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMueD1NYXRoLnJvdW5kKHRoaXMueCksdGhpcy55PU1hdGgucm91bmQodGhpcy55KSx0aGlzfSxmbG9vcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNsb25lKCkuX2Zsb29yKCl9LF9mbG9vcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLng9TWF0aC5mbG9vcih0aGlzLngpLHRoaXMueT1NYXRoLmZsb29yKHRoaXMueSksdGhpc30sY2VpbDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNsb25lKCkuX2NlaWwoKX0sX2NlaWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy54PU1hdGguY2VpbCh0aGlzLngpLHRoaXMueT1NYXRoLmNlaWwodGhpcy55KSx0aGlzfSxkaXN0YW5jZVRvOmZ1bmN0aW9uKHQpe3Q9by5wb2ludCh0KTt2YXIgZT10LngtdGhpcy54LGk9dC55LXRoaXMueTtyZXR1cm4gTWF0aC5zcXJ0KGUqZStpKmkpfSxlcXVhbHM6ZnVuY3Rpb24odCl7cmV0dXJuIHQ9by5wb2ludCh0KSx0Lng9PT10aGlzLngmJnQueT09PXRoaXMueX0sY29udGFpbnM6ZnVuY3Rpb24odCl7cmV0dXJuIHQ9by5wb2ludCh0KSxNYXRoLmFicyh0LngpPD1NYXRoLmFicyh0aGlzLngpJiZNYXRoLmFicyh0LnkpPD1NYXRoLmFicyh0aGlzLnkpfSx0b1N0cmluZzpmdW5jdGlvbigpe3JldHVyblwiUG9pbnQoXCIrby5VdGlsLmZvcm1hdE51bSh0aGlzLngpK1wiLCBcIitvLlV0aWwuZm9ybWF0TnVtKHRoaXMueSkrXCIpXCJ9fSxvLnBvaW50PWZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uUG9pbnQ/dDpvLlV0aWwuaXNBcnJheSh0KT9uZXcgby5Qb2ludCh0WzBdLHRbMV0pOnQ9PT1pfHxudWxsPT09dD90Olwib2JqZWN0XCI9PXR5cGVvZiB0JiZcInhcImluIHQmJlwieVwiaW4gdD9uZXcgby5Qb2ludCh0LngsdC55KTpuZXcgby5Qb2ludCh0LGUsbil9LG8uQm91bmRzPWZ1bmN0aW9uKHQsZSl7aWYodClmb3IodmFyIGk9ZT9bdCxlXTp0LG49MCxvPWkubGVuZ3RoO248bztuKyspdGhpcy5leHRlbmQoaVtuXSl9LG8uQm91bmRzLnByb3RvdHlwZT17ZXh0ZW5kOmZ1bmN0aW9uKHQpe3JldHVybiB0PW8ucG9pbnQodCksdGhpcy5taW58fHRoaXMubWF4Pyh0aGlzLm1pbi54PU1hdGgubWluKHQueCx0aGlzLm1pbi54KSx0aGlzLm1heC54PU1hdGgubWF4KHQueCx0aGlzLm1heC54KSx0aGlzLm1pbi55PU1hdGgubWluKHQueSx0aGlzLm1pbi55KSx0aGlzLm1heC55PU1hdGgubWF4KHQueSx0aGlzLm1heC55KSk6KHRoaXMubWluPXQuY2xvbmUoKSx0aGlzLm1heD10LmNsb25lKCkpLHRoaXN9LGdldENlbnRlcjpmdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uUG9pbnQoKHRoaXMubWluLngrdGhpcy5tYXgueCkvMiwodGhpcy5taW4ueSt0aGlzLm1heC55KS8yLHQpfSxnZXRCb3R0b21MZWZ0OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBvLlBvaW50KHRoaXMubWluLngsdGhpcy5tYXgueSl9LGdldFRvcFJpZ2h0OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBvLlBvaW50KHRoaXMubWF4LngsdGhpcy5taW4ueSl9LGdldFNpemU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tYXguc3VidHJhY3QodGhpcy5taW4pfSxjb250YWluczpmdW5jdGlvbih0KXt2YXIgZSxpO3JldHVybiB0PVwibnVtYmVyXCI9PXR5cGVvZiB0WzBdfHx0IGluc3RhbmNlb2Ygby5Qb2ludD9vLnBvaW50KHQpOm8uYm91bmRzKHQpLHQgaW5zdGFuY2VvZiBvLkJvdW5kcz8oZT10Lm1pbixpPXQubWF4KTplPWk9dCxlLng+PXRoaXMubWluLngmJmkueDw9dGhpcy5tYXgueCYmZS55Pj10aGlzLm1pbi55JiZpLnk8PXRoaXMubWF4Lnl9LGludGVyc2VjdHM6ZnVuY3Rpb24odCl7dD1vLmJvdW5kcyh0KTt2YXIgZT10aGlzLm1pbixpPXRoaXMubWF4LG49dC5taW4scz10Lm1heCxyPXMueD49ZS54JiZuLng8PWkueCxhPXMueT49ZS55JiZuLnk8PWkueTtyZXR1cm4gciYmYX0sb3ZlcmxhcHM6ZnVuY3Rpb24odCl7dD1vLmJvdW5kcyh0KTt2YXIgZT10aGlzLm1pbixpPXRoaXMubWF4LG49dC5taW4scz10Lm1heCxyPXMueD5lLngmJm4ueDxpLngsYT1zLnk+ZS55JiZuLnk8aS55O3JldHVybiByJiZhfSxpc1ZhbGlkOmZ1bmN0aW9uKCl7cmV0dXJuISghdGhpcy5taW58fCF0aGlzLm1heCl9fSxvLmJvdW5kcz1mdW5jdGlvbih0LGUpe3JldHVybiF0fHx0IGluc3RhbmNlb2Ygby5Cb3VuZHM/dDpuZXcgby5Cb3VuZHModCxlKX0sby5UcmFuc2Zvcm1hdGlvbj1mdW5jdGlvbih0LGUsaSxuKXt0aGlzLl9hPXQsdGhpcy5fYj1lLHRoaXMuX2M9aSx0aGlzLl9kPW59LG8uVHJhbnNmb3JtYXRpb24ucHJvdG90eXBlPXt0cmFuc2Zvcm06ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5fdHJhbnNmb3JtKHQuY2xvbmUoKSxlKX0sX3RyYW5zZm9ybTpmdW5jdGlvbih0LGUpe3JldHVybiBlPWV8fDEsdC54PWUqKHRoaXMuX2EqdC54K3RoaXMuX2IpLHQueT1lKih0aGlzLl9jKnQueSt0aGlzLl9kKSx0fSx1bnRyYW5zZm9ybTpmdW5jdGlvbih0LGUpe3JldHVybiBlPWV8fDEsbmV3IG8uUG9pbnQoKHQueC9lLXRoaXMuX2IpL3RoaXMuX2EsKHQueS9lLXRoaXMuX2QpL3RoaXMuX2MpfX0sby5Eb21VdGlsPXtnZXQ6ZnVuY3Rpb24odCl7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIHQ/ZS5nZXRFbGVtZW50QnlJZCh0KTp0fSxnZXRTdHlsZTpmdW5jdGlvbih0LGkpe3ZhciBuPXQuc3R5bGVbaV18fHQuY3VycmVudFN0eWxlJiZ0LmN1cnJlbnRTdHlsZVtpXTtpZigoIW58fFwiYXV0b1wiPT09bikmJmUuZGVmYXVsdFZpZXcpe3ZhciBvPWUuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSh0LG51bGwpO249bz9vW2ldOm51bGx9cmV0dXJuXCJhdXRvXCI9PT1uP251bGw6bn0sY3JlYXRlOmZ1bmN0aW9uKHQsaSxuKXt2YXIgbz1lLmNyZWF0ZUVsZW1lbnQodCk7cmV0dXJuIG8uY2xhc3NOYW1lPWl8fFwiXCIsbiYmbi5hcHBlbmRDaGlsZChvKSxvfSxyZW1vdmU6ZnVuY3Rpb24odCl7dmFyIGU9dC5wYXJlbnROb2RlO2UmJmUucmVtb3ZlQ2hpbGQodCl9LGVtcHR5OmZ1bmN0aW9uKHQpe2Zvcig7dC5maXJzdENoaWxkOyl0LnJlbW92ZUNoaWxkKHQuZmlyc3RDaGlsZCl9LHRvRnJvbnQ6ZnVuY3Rpb24odCl7dC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKHQpfSx0b0JhY2s6ZnVuY3Rpb24odCl7dmFyIGU9dC5wYXJlbnROb2RlO2UuaW5zZXJ0QmVmb3JlKHQsZS5maXJzdENoaWxkKX0saGFzQ2xhc3M6ZnVuY3Rpb24odCxlKXtpZih0LmNsYXNzTGlzdCE9PWkpcmV0dXJuIHQuY2xhc3NMaXN0LmNvbnRhaW5zKGUpO3ZhciBuPW8uRG9tVXRpbC5nZXRDbGFzcyh0KTtyZXR1cm4gbi5sZW5ndGg+MCYmbmV3IFJlZ0V4cChcIihefFxcXFxzKVwiK2UrXCIoXFxcXHN8JClcIikudGVzdChuKX0sYWRkQ2xhc3M6ZnVuY3Rpb24odCxlKXtpZih0LmNsYXNzTGlzdCE9PWkpZm9yKHZhciBuPW8uVXRpbC5zcGxpdFdvcmRzKGUpLHM9MCxyPW4ubGVuZ3RoO3M8cjtzKyspdC5jbGFzc0xpc3QuYWRkKG5bc10pO2Vsc2UgaWYoIW8uRG9tVXRpbC5oYXNDbGFzcyh0LGUpKXt2YXIgYT1vLkRvbVV0aWwuZ2V0Q2xhc3ModCk7by5Eb21VdGlsLnNldENsYXNzKHQsKGE/YStcIiBcIjpcIlwiKStlKX19LHJlbW92ZUNsYXNzOmZ1bmN0aW9uKHQsZSl7dC5jbGFzc0xpc3QhPT1pP3QuY2xhc3NMaXN0LnJlbW92ZShlKTpvLkRvbVV0aWwuc2V0Q2xhc3ModCxvLlV0aWwudHJpbSgoXCIgXCIrby5Eb21VdGlsLmdldENsYXNzKHQpK1wiIFwiKS5yZXBsYWNlKFwiIFwiK2UrXCIgXCIsXCIgXCIpKSl9LHNldENsYXNzOmZ1bmN0aW9uKHQsZSl7dC5jbGFzc05hbWUuYmFzZVZhbD09PWk/dC5jbGFzc05hbWU9ZTp0LmNsYXNzTmFtZS5iYXNlVmFsPWV9LGdldENsYXNzOmZ1bmN0aW9uKHQpe3JldHVybiB0LmNsYXNzTmFtZS5iYXNlVmFsPT09aT90LmNsYXNzTmFtZTp0LmNsYXNzTmFtZS5iYXNlVmFsfSxzZXRPcGFjaXR5OmZ1bmN0aW9uKHQsZSl7XCJvcGFjaXR5XCJpbiB0LnN0eWxlP3Quc3R5bGUub3BhY2l0eT1lOlwiZmlsdGVyXCJpbiB0LnN0eWxlJiZvLkRvbVV0aWwuX3NldE9wYWNpdHlJRSh0LGUpfSxfc2V0T3BhY2l0eUlFOmZ1bmN0aW9uKHQsZSl7dmFyIGk9ITEsbj1cIkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LkFscGhhXCI7dHJ5e2k9dC5maWx0ZXJzLml0ZW0obil9Y2F0Y2godCl7aWYoMT09PWUpcmV0dXJufWU9TWF0aC5yb3VuZCgxMDAqZSksaT8oaS5FbmFibGVkPTEwMCE9PWUsaS5PcGFjaXR5PWUpOnQuc3R5bGUuZmlsdGVyKz1cIiBwcm9naWQ6XCIrbitcIihvcGFjaXR5PVwiK2UrXCIpXCJ9LHRlc3RQcm9wOmZ1bmN0aW9uKHQpe2Zvcih2YXIgaT1lLmRvY3VtZW50RWxlbWVudC5zdHlsZSxuPTA7bjx0Lmxlbmd0aDtuKyspaWYodFtuXWluIGkpcmV0dXJuIHRbbl07cmV0dXJuITF9LHNldFRyYW5zZm9ybTpmdW5jdGlvbih0LGUsaSl7dmFyIG49ZXx8bmV3IG8uUG9pbnQoMCwwKTt0LnN0eWxlW28uRG9tVXRpbC5UUkFOU0ZPUk1dPShvLkJyb3dzZXIuaWUzZD9cInRyYW5zbGF0ZShcIituLngrXCJweCxcIituLnkrXCJweClcIjpcInRyYW5zbGF0ZTNkKFwiK24ueCtcInB4LFwiK24ueStcInB4LDApXCIpKyhpP1wiIHNjYWxlKFwiK2krXCIpXCI6XCJcIil9LHNldFBvc2l0aW9uOmZ1bmN0aW9uKHQsZSl7dC5fbGVhZmxldF9wb3M9ZSxvLkJyb3dzZXIuYW55M2Q/by5Eb21VdGlsLnNldFRyYW5zZm9ybSh0LGUpOih0LnN0eWxlLmxlZnQ9ZS54K1wicHhcIix0LnN0eWxlLnRvcD1lLnkrXCJweFwiKX0sZ2V0UG9zaXRpb246ZnVuY3Rpb24odCl7cmV0dXJuIHQuX2xlYWZsZXRfcG9zfHxuZXcgby5Qb2ludCgwLDApfX0sZnVuY3Rpb24oKXtvLkRvbVV0aWwuVFJBTlNGT1JNPW8uRG9tVXRpbC50ZXN0UHJvcChbXCJ0cmFuc2Zvcm1cIixcIldlYmtpdFRyYW5zZm9ybVwiLFwiT1RyYW5zZm9ybVwiLFwiTW96VHJhbnNmb3JtXCIsXCJtc1RyYW5zZm9ybVwiXSk7dmFyIGk9by5Eb21VdGlsLlRSQU5TSVRJT049by5Eb21VdGlsLnRlc3RQcm9wKFtcIndlYmtpdFRyYW5zaXRpb25cIixcInRyYW5zaXRpb25cIixcIk9UcmFuc2l0aW9uXCIsXCJNb3pUcmFuc2l0aW9uXCIsXCJtc1RyYW5zaXRpb25cIl0pO2lmKG8uRG9tVXRpbC5UUkFOU0lUSU9OX0VORD1cIndlYmtpdFRyYW5zaXRpb25cIj09PWl8fFwiT1RyYW5zaXRpb25cIj09PWk/aStcIkVuZFwiOlwidHJhbnNpdGlvbmVuZFwiLFwib25zZWxlY3RzdGFydFwiaW4gZSlvLkRvbVV0aWwuZGlzYWJsZVRleHRTZWxlY3Rpb249ZnVuY3Rpb24oKXtvLkRvbUV2ZW50Lm9uKHQsXCJzZWxlY3RzdGFydFwiLG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQpfSxvLkRvbVV0aWwuZW5hYmxlVGV4dFNlbGVjdGlvbj1mdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKHQsXCJzZWxlY3RzdGFydFwiLG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQpfTtlbHNle3ZhciBuPW8uRG9tVXRpbC50ZXN0UHJvcChbXCJ1c2VyU2VsZWN0XCIsXCJXZWJraXRVc2VyU2VsZWN0XCIsXCJPVXNlclNlbGVjdFwiLFwiTW96VXNlclNlbGVjdFwiLFwibXNVc2VyU2VsZWN0XCJdKTtvLkRvbVV0aWwuZGlzYWJsZVRleHRTZWxlY3Rpb249ZnVuY3Rpb24oKXtpZihuKXt2YXIgdD1lLmRvY3VtZW50RWxlbWVudC5zdHlsZTt0aGlzLl91c2VyU2VsZWN0PXRbbl0sdFtuXT1cIm5vbmVcIn19LG8uRG9tVXRpbC5lbmFibGVUZXh0U2VsZWN0aW9uPWZ1bmN0aW9uKCl7biYmKGUuZG9jdW1lbnRFbGVtZW50LnN0eWxlW25dPXRoaXMuX3VzZXJTZWxlY3QsZGVsZXRlIHRoaXMuX3VzZXJTZWxlY3QpfX1vLkRvbVV0aWwuZGlzYWJsZUltYWdlRHJhZz1mdW5jdGlvbigpe28uRG9tRXZlbnQub24odCxcImRyYWdzdGFydFwiLG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQpfSxvLkRvbVV0aWwuZW5hYmxlSW1hZ2VEcmFnPWZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodCxcImRyYWdzdGFydFwiLG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQpfSxvLkRvbVV0aWwucHJldmVudE91dGxpbmU9ZnVuY3Rpb24oZSl7Zm9yKDtlLnRhYkluZGV4PT09LTE7KWU9ZS5wYXJlbnROb2RlO2UmJmUuc3R5bGUmJihvLkRvbVV0aWwucmVzdG9yZU91dGxpbmUoKSx0aGlzLl9vdXRsaW5lRWxlbWVudD1lLHRoaXMuX291dGxpbmVTdHlsZT1lLnN0eWxlLm91dGxpbmUsZS5zdHlsZS5vdXRsaW5lPVwibm9uZVwiLG8uRG9tRXZlbnQub24odCxcImtleWRvd25cIixvLkRvbVV0aWwucmVzdG9yZU91dGxpbmUsdGhpcykpfSxvLkRvbVV0aWwucmVzdG9yZU91dGxpbmU9ZnVuY3Rpb24oKXt0aGlzLl9vdXRsaW5lRWxlbWVudCYmKHRoaXMuX291dGxpbmVFbGVtZW50LnN0eWxlLm91dGxpbmU9dGhpcy5fb3V0bGluZVN0eWxlLGRlbGV0ZSB0aGlzLl9vdXRsaW5lRWxlbWVudCxkZWxldGUgdGhpcy5fb3V0bGluZVN0eWxlLG8uRG9tRXZlbnQub2ZmKHQsXCJrZXlkb3duXCIsby5Eb21VdGlsLnJlc3RvcmVPdXRsaW5lLHRoaXMpKX19KCksby5MYXRMbmc9ZnVuY3Rpb24odCxlLG4pe2lmKGlzTmFOKHQpfHxpc05hTihlKSl0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIExhdExuZyBvYmplY3Q6IChcIit0K1wiLCBcIitlK1wiKVwiKTt0aGlzLmxhdD0rdCx0aGlzLmxuZz0rZSxuIT09aSYmKHRoaXMuYWx0PStuKX0sby5MYXRMbmcucHJvdG90eXBlPXtlcXVhbHM6ZnVuY3Rpb24odCxlKXtpZighdClyZXR1cm4hMTt0PW8ubGF0TG5nKHQpO3ZhciBuPU1hdGgubWF4KE1hdGguYWJzKHRoaXMubGF0LXQubGF0KSxNYXRoLmFicyh0aGlzLmxuZy10LmxuZykpO3JldHVybiBuPD0oZT09PWk/MWUtOTplKX0sdG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuXCJMYXRMbmcoXCIrby5VdGlsLmZvcm1hdE51bSh0aGlzLmxhdCx0KStcIiwgXCIrby5VdGlsLmZvcm1hdE51bSh0aGlzLmxuZyx0KStcIilcIn0sZGlzdGFuY2VUbzpmdW5jdGlvbih0KXtyZXR1cm4gby5DUlMuRWFydGguZGlzdGFuY2UodGhpcyxvLmxhdExuZyh0KSl9LHdyYXA6ZnVuY3Rpb24oKXtyZXR1cm4gby5DUlMuRWFydGgud3JhcExhdExuZyh0aGlzKX0sdG9Cb3VuZHM6ZnVuY3Rpb24odCl7dmFyIGU9MTgwKnQvNDAwNzUwMTcsaT1lL01hdGguY29zKE1hdGguUEkvMTgwKnRoaXMubGF0KTtyZXR1cm4gby5sYXRMbmdCb3VuZHMoW3RoaXMubGF0LWUsdGhpcy5sbmctaV0sW3RoaXMubGF0K2UsdGhpcy5sbmcraV0pfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiBuZXcgby5MYXRMbmcodGhpcy5sYXQsdGhpcy5sbmcsdGhpcy5hbHQpfX0sby5sYXRMbmc9ZnVuY3Rpb24odCxlLG4pe3JldHVybiB0IGluc3RhbmNlb2Ygby5MYXRMbmc/dDpvLlV0aWwuaXNBcnJheSh0KSYmXCJvYmplY3RcIiE9dHlwZW9mIHRbMF0/Mz09PXQubGVuZ3RoP25ldyBvLkxhdExuZyh0WzBdLHRbMV0sdFsyXSk6Mj09PXQubGVuZ3RoP25ldyBvLkxhdExuZyh0WzBdLHRbMV0pOm51bGw6dD09PWl8fG51bGw9PT10P3Q6XCJvYmplY3RcIj09dHlwZW9mIHQmJlwibGF0XCJpbiB0P25ldyBvLkxhdExuZyh0LmxhdCxcImxuZ1wiaW4gdD90LmxuZzp0Lmxvbix0LmFsdCk6ZT09PWk/bnVsbDpuZXcgby5MYXRMbmcodCxlLG4pfSxvLkxhdExuZ0JvdW5kcz1mdW5jdGlvbih0LGUpe2lmKHQpZm9yKHZhciBpPWU/W3QsZV06dCxuPTAsbz1pLmxlbmd0aDtuPG87bisrKXRoaXMuZXh0ZW5kKGlbbl0pfSxvLkxhdExuZ0JvdW5kcy5wcm90b3R5cGU9e2V4dGVuZDpmdW5jdGlvbih0KXt2YXIgZSxpLG49dGhpcy5fc291dGhXZXN0LHM9dGhpcy5fbm9ydGhFYXN0O2lmKHQgaW5zdGFuY2VvZiBvLkxhdExuZyllPXQsaT10O2Vsc2V7aWYoISh0IGluc3RhbmNlb2Ygby5MYXRMbmdCb3VuZHMpKXJldHVybiB0P3RoaXMuZXh0ZW5kKG8ubGF0TG5nKHQpfHxvLmxhdExuZ0JvdW5kcyh0KSk6dGhpcztpZihlPXQuX3NvdXRoV2VzdCxpPXQuX25vcnRoRWFzdCwhZXx8IWkpcmV0dXJuIHRoaXN9cmV0dXJuIG58fHM/KG4ubGF0PU1hdGgubWluKGUubGF0LG4ubGF0KSxuLmxuZz1NYXRoLm1pbihlLmxuZyxuLmxuZykscy5sYXQ9TWF0aC5tYXgoaS5sYXQscy5sYXQpLHMubG5nPU1hdGgubWF4KGkubG5nLHMubG5nKSk6KHRoaXMuX3NvdXRoV2VzdD1uZXcgby5MYXRMbmcoZS5sYXQsZS5sbmcpLHRoaXMuX25vcnRoRWFzdD1uZXcgby5MYXRMbmcoaS5sYXQsaS5sbmcpKSx0aGlzfSxwYWQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fc291dGhXZXN0LGk9dGhpcy5fbm9ydGhFYXN0LG49TWF0aC5hYnMoZS5sYXQtaS5sYXQpKnQscz1NYXRoLmFicyhlLmxuZy1pLmxuZykqdDtyZXR1cm4gbmV3IG8uTGF0TG5nQm91bmRzKG5ldyBvLkxhdExuZyhlLmxhdC1uLGUubG5nLXMpLG5ldyBvLkxhdExuZyhpLmxhdCtuLGkubG5nK3MpKX0sZ2V0Q2VudGVyOmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBvLkxhdExuZygodGhpcy5fc291dGhXZXN0LmxhdCt0aGlzLl9ub3J0aEVhc3QubGF0KS8yLCh0aGlzLl9zb3V0aFdlc3QubG5nK3RoaXMuX25vcnRoRWFzdC5sbmcpLzIpfSxnZXRTb3V0aFdlc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc291dGhXZXN0fSxnZXROb3J0aEVhc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbm9ydGhFYXN0fSxnZXROb3J0aFdlc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG8uTGF0TG5nKHRoaXMuZ2V0Tm9ydGgoKSx0aGlzLmdldFdlc3QoKSl9LGdldFNvdXRoRWFzdDpmdW5jdGlvbigpe3JldHVybiBuZXcgby5MYXRMbmcodGhpcy5nZXRTb3V0aCgpLHRoaXMuZ2V0RWFzdCgpKX0sZ2V0V2VzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zb3V0aFdlc3QubG5nfSxnZXRTb3V0aDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zb3V0aFdlc3QubGF0fSxnZXRFYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX25vcnRoRWFzdC5sbmd9LGdldE5vcnRoOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX25vcnRoRWFzdC5sYXR9LGNvbnRhaW5zOmZ1bmN0aW9uKHQpe3Q9XCJudW1iZXJcIj09dHlwZW9mIHRbMF18fHQgaW5zdGFuY2VvZiBvLkxhdExuZ3x8XCJsYXRcImluIHQ/by5sYXRMbmcodCk6by5sYXRMbmdCb3VuZHModCk7dmFyIGUsaSxuPXRoaXMuX3NvdXRoV2VzdCxzPXRoaXMuX25vcnRoRWFzdDtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uTGF0TG5nQm91bmRzPyhlPXQuZ2V0U291dGhXZXN0KCksaT10LmdldE5vcnRoRWFzdCgpKTplPWk9dCxlLmxhdD49bi5sYXQmJmkubGF0PD1zLmxhdCYmZS5sbmc+PW4ubG5nJiZpLmxuZzw9cy5sbmd9LGludGVyc2VjdHM6ZnVuY3Rpb24odCl7dD1vLmxhdExuZ0JvdW5kcyh0KTt2YXIgZT10aGlzLl9zb3V0aFdlc3QsaT10aGlzLl9ub3J0aEVhc3Qsbj10LmdldFNvdXRoV2VzdCgpLHM9dC5nZXROb3J0aEVhc3QoKSxyPXMubGF0Pj1lLmxhdCYmbi5sYXQ8PWkubGF0LGE9cy5sbmc+PWUubG5nJiZuLmxuZzw9aS5sbmc7cmV0dXJuIHImJmF9LG92ZXJsYXBzOmZ1bmN0aW9uKHQpe3Q9by5sYXRMbmdCb3VuZHModCk7dmFyIGU9dGhpcy5fc291dGhXZXN0LGk9dGhpcy5fbm9ydGhFYXN0LG49dC5nZXRTb3V0aFdlc3QoKSxzPXQuZ2V0Tm9ydGhFYXN0KCkscj1zLmxhdD5lLmxhdCYmbi5sYXQ8aS5sYXQsYT1zLmxuZz5lLmxuZyYmbi5sbmc8aS5sbmc7cmV0dXJuIHImJmF9LHRvQkJveFN0cmluZzpmdW5jdGlvbigpe3JldHVyblt0aGlzLmdldFdlc3QoKSx0aGlzLmdldFNvdXRoKCksdGhpcy5nZXRFYXN0KCksdGhpcy5nZXROb3J0aCgpXS5qb2luKFwiLFwiKX0sZXF1YWxzOmZ1bmN0aW9uKHQpe3JldHVybiEhdCYmKHQ9by5sYXRMbmdCb3VuZHModCksdGhpcy5fc291dGhXZXN0LmVxdWFscyh0LmdldFNvdXRoV2VzdCgpKSYmdGhpcy5fbm9ydGhFYXN0LmVxdWFscyh0LmdldE5vcnRoRWFzdCgpKSl9LGlzVmFsaWQ6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzLl9zb3V0aFdlc3R8fCF0aGlzLl9ub3J0aEVhc3QpfX0sby5sYXRMbmdCb3VuZHM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uTGF0TG5nQm91bmRzP3Q6bmV3IG8uTGF0TG5nQm91bmRzKHQsZSl9LG8uUHJvamVjdGlvbj17fSxvLlByb2plY3Rpb24uTG9uTGF0PXtwcm9qZWN0OmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5Qb2ludCh0LmxuZyx0LmxhdCl9LHVucHJvamVjdDpmdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uTGF0TG5nKHQueSx0LngpfSxib3VuZHM6by5ib3VuZHMoWy0xODAsLTkwXSxbMTgwLDkwXSl9LG8uUHJvamVjdGlvbi5TcGhlcmljYWxNZXJjYXRvcj17Ujo2Mzc4MTM3LE1BWF9MQVRJVFVERTo4NS4wNTExMjg3Nzk4LHByb2plY3Q6ZnVuY3Rpb24odCl7dmFyIGU9TWF0aC5QSS8xODAsaT10aGlzLk1BWF9MQVRJVFVERSxuPU1hdGgubWF4KE1hdGgubWluKGksdC5sYXQpLC1pKSxzPU1hdGguc2luKG4qZSk7cmV0dXJuIG5ldyBvLlBvaW50KHRoaXMuUip0LmxuZyplLHRoaXMuUipNYXRoLmxvZygoMStzKS8oMS1zKSkvMil9LHVucHJvamVjdDpmdW5jdGlvbih0KXt2YXIgZT0xODAvTWF0aC5QSTtyZXR1cm4gbmV3IG8uTGF0TG5nKCgyKk1hdGguYXRhbihNYXRoLmV4cCh0LnkvdGhpcy5SKSktTWF0aC5QSS8yKSplLHQueCplL3RoaXMuUil9LGJvdW5kczpmdW5jdGlvbigpe3ZhciB0PTYzNzgxMzcqTWF0aC5QSTtyZXR1cm4gby5ib3VuZHMoWy10LC10XSxbdCx0XSl9KCl9LG8uQ1JTPXtsYXRMbmdUb1BvaW50OmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5wcm9qZWN0aW9uLnByb2plY3QodCksbj10aGlzLnNjYWxlKGUpO3JldHVybiB0aGlzLnRyYW5zZm9ybWF0aW9uLl90cmFuc2Zvcm0oaSxuKX0scG9pbnRUb0xhdExuZzpmdW5jdGlvbih0LGUpe3ZhciBpPXRoaXMuc2NhbGUoZSksbj10aGlzLnRyYW5zZm9ybWF0aW9uLnVudHJhbnNmb3JtKHQsaSk7cmV0dXJuIHRoaXMucHJvamVjdGlvbi51bnByb2plY3Qobil9LHByb2plY3Q6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMucHJvamVjdGlvbi5wcm9qZWN0KHQpfSx1bnByb2plY3Q6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMucHJvamVjdGlvbi51bnByb2plY3QodCl9LHNjYWxlOmZ1bmN0aW9uKHQpe3JldHVybiAyNTYqTWF0aC5wb3coMix0KX0sem9vbTpmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5sb2codC8yNTYpL01hdGguTE4yfSxnZXRQcm9qZWN0ZWRCb3VuZHM6ZnVuY3Rpb24odCl7aWYodGhpcy5pbmZpbml0ZSlyZXR1cm4gbnVsbDt2YXIgZT10aGlzLnByb2plY3Rpb24uYm91bmRzLGk9dGhpcy5zY2FsZSh0KSxuPXRoaXMudHJhbnNmb3JtYXRpb24udHJhbnNmb3JtKGUubWluLGkpLHM9dGhpcy50cmFuc2Zvcm1hdGlvbi50cmFuc2Zvcm0oZS5tYXgsaSk7cmV0dXJuIG8uYm91bmRzKG4scyl9LGluZmluaXRlOiExLHdyYXBMYXRMbmc6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy53cmFwTG5nP28uVXRpbC53cmFwTnVtKHQubG5nLHRoaXMud3JhcExuZywhMCk6dC5sbmcsaT10aGlzLndyYXBMYXQ/by5VdGlsLndyYXBOdW0odC5sYXQsdGhpcy53cmFwTGF0LCEwKTp0LmxhdCxuPXQuYWx0O3JldHVybiBvLmxhdExuZyhpLGUsbil9LHdyYXBMYXRMbmdCb3VuZHM6ZnVuY3Rpb24odCl7dmFyIGU9dC5nZXRDZW50ZXIoKSxpPXRoaXMud3JhcExhdExuZyhlKSxuPWUubGF0LWkubGF0LHM9ZS5sbmctaS5sbmc7aWYoMD09PW4mJjA9PT1zKXJldHVybiB0O3ZhciByPXQuZ2V0U291dGhXZXN0KCksYT10LmdldE5vcnRoRWFzdCgpLGg9by5sYXRMbmcoe2xhdDpyLmxhdC1uLGxuZzpyLmxuZy1zfSksbD1vLmxhdExuZyh7bGF0OmEubGF0LW4sbG5nOmEubG5nLXN9KTtyZXR1cm4gbmV3IG8uTGF0TG5nQm91bmRzKGgsbCl9fSxvLkNSUy5TaW1wbGU9by5leHRlbmQoe30sby5DUlMse3Byb2plY3Rpb246by5Qcm9qZWN0aW9uLkxvbkxhdCx0cmFuc2Zvcm1hdGlvbjpuZXcgby5UcmFuc2Zvcm1hdGlvbigxLDAsLTEsMCksc2NhbGU6ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGgucG93KDIsdCl9LHpvb206ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGgubG9nKHQpL01hdGguTE4yfSxkaXN0YW5jZTpmdW5jdGlvbih0LGUpe3ZhciBpPWUubG5nLXQubG5nLG49ZS5sYXQtdC5sYXQ7cmV0dXJuIE1hdGguc3FydChpKmkrbipuKX0saW5maW5pdGU6ITB9KSxvLkNSUy5FYXJ0aD1vLmV4dGVuZCh7fSxvLkNSUyx7d3JhcExuZzpbLTE4MCwxODBdLFI6NjM3MWUzLGRpc3RhbmNlOmZ1bmN0aW9uKHQsZSl7dmFyIGk9TWF0aC5QSS8xODAsbj10LmxhdCppLG89ZS5sYXQqaSxzPU1hdGguc2luKG4pKk1hdGguc2luKG8pK01hdGguY29zKG4pKk1hdGguY29zKG8pKk1hdGguY29zKChlLmxuZy10LmxuZykqaSk7cmV0dXJuIHRoaXMuUipNYXRoLmFjb3MoTWF0aC5taW4ocywxKSl9fSksby5DUlMuRVBTRzM4NTc9by5leHRlbmQoe30sby5DUlMuRWFydGgse2NvZGU6XCJFUFNHOjM4NTdcIixwcm9qZWN0aW9uOm8uUHJvamVjdGlvbi5TcGhlcmljYWxNZXJjYXRvcix0cmFuc2Zvcm1hdGlvbjpmdW5jdGlvbigpe3ZhciB0PS41LyhNYXRoLlBJKm8uUHJvamVjdGlvbi5TcGhlcmljYWxNZXJjYXRvci5SKTtyZXR1cm4gbmV3IG8uVHJhbnNmb3JtYXRpb24odCwuNSwtdCwuNSl9KCl9KSxvLkNSUy5FUFNHOTAwOTEzPW8uZXh0ZW5kKHt9LG8uQ1JTLkVQU0czODU3LHtjb2RlOlwiRVBTRzo5MDA5MTNcIn0pLG8uQ1JTLkVQU0c0MzI2PW8uZXh0ZW5kKHt9LG8uQ1JTLkVhcnRoLHtjb2RlOlwiRVBTRzo0MzI2XCIscHJvamVjdGlvbjpvLlByb2plY3Rpb24uTG9uTGF0LHRyYW5zZm9ybWF0aW9uOm5ldyBvLlRyYW5zZm9ybWF0aW9uKDEvMTgwLDEsLTEvMTgwLC41KX0pLG8uTWFwPW8uRXZlbnRlZC5leHRlbmQoe29wdGlvbnM6e2NyczpvLkNSUy5FUFNHMzg1NyxjZW50ZXI6aSx6b29tOmksbWluWm9vbTppLG1heFpvb206aSxsYXllcnM6W10sbWF4Qm91bmRzOmkscmVuZGVyZXI6aSx6b29tQW5pbWF0aW9uOiEwLHpvb21BbmltYXRpb25UaHJlc2hvbGQ6NCxmYWRlQW5pbWF0aW9uOiEwLG1hcmtlclpvb21BbmltYXRpb246ITAsdHJhbnNmb3JtM0RMaW1pdDo4Mzg4NjA4LHpvb21TbmFwOjEsem9vbURlbHRhOjEsdHJhY2tSZXNpemU6ITB9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtlPW8uc2V0T3B0aW9ucyh0aGlzLGUpLHRoaXMuX2luaXRDb250YWluZXIodCksdGhpcy5faW5pdExheW91dCgpLHRoaXMuX29uUmVzaXplPW8uYmluZCh0aGlzLl9vblJlc2l6ZSx0aGlzKSx0aGlzLl9pbml0RXZlbnRzKCksZS5tYXhCb3VuZHMmJnRoaXMuc2V0TWF4Qm91bmRzKGUubWF4Qm91bmRzKSxlLnpvb20hPT1pJiYodGhpcy5fem9vbT10aGlzLl9saW1pdFpvb20oZS56b29tKSksZS5jZW50ZXImJmUuem9vbSE9PWkmJnRoaXMuc2V0VmlldyhvLmxhdExuZyhlLmNlbnRlciksZS56b29tLHtyZXNldDohMH0pLHRoaXMuX2hhbmRsZXJzPVtdLHRoaXMuX2xheWVycz17fSx0aGlzLl96b29tQm91bmRMYXllcnM9e30sdGhpcy5fc2l6ZUNoYW5nZWQ9ITAsdGhpcy5jYWxsSW5pdEhvb2tzKCksdGhpcy5fem9vbUFuaW1hdGVkPW8uRG9tVXRpbC5UUkFOU0lUSU9OJiZvLkJyb3dzZXIuYW55M2QmJiFvLkJyb3dzZXIubW9iaWxlT3BlcmEmJnRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uLHRoaXMuX3pvb21BbmltYXRlZCYmKHRoaXMuX2NyZWF0ZUFuaW1Qcm94eSgpLG8uRG9tRXZlbnQub24odGhpcy5fcHJveHksby5Eb21VdGlsLlRSQU5TSVRJT05fRU5ELHRoaXMuX2NhdGNoVHJhbnNpdGlvbkVuZCx0aGlzKSksdGhpcy5fYWRkTGF5ZXJzKHRoaXMub3B0aW9ucy5sYXllcnMpfSxzZXRWaWV3OmZ1bmN0aW9uKHQsZSxuKXtpZihlPWU9PT1pP3RoaXMuX3pvb206dGhpcy5fbGltaXRab29tKGUpLHQ9dGhpcy5fbGltaXRDZW50ZXIoby5sYXRMbmcodCksZSx0aGlzLm9wdGlvbnMubWF4Qm91bmRzKSxuPW58fHt9LHRoaXMuX3N0b3AoKSx0aGlzLl9sb2FkZWQmJiFuLnJlc2V0JiZuIT09ITApe24uYW5pbWF0ZSE9PWkmJihuLnpvb209by5leHRlbmQoe2FuaW1hdGU6bi5hbmltYXRlfSxuLnpvb20pLG4ucGFuPW8uZXh0ZW5kKHthbmltYXRlOm4uYW5pbWF0ZSxkdXJhdGlvbjpuLmR1cmF0aW9ufSxuLnBhbikpO3ZhciBzPXRoaXMuX3pvb20hPT1lP3RoaXMuX3RyeUFuaW1hdGVkWm9vbSYmdGhpcy5fdHJ5QW5pbWF0ZWRab29tKHQsZSxuLnpvb20pOnRoaXMuX3RyeUFuaW1hdGVkUGFuKHQsbi5wYW4pO2lmKHMpcmV0dXJuIGNsZWFyVGltZW91dCh0aGlzLl9zaXplVGltZXIpLHRoaXN9cmV0dXJuIHRoaXMuX3Jlc2V0Vmlldyh0LGUpLHRoaXN9LHNldFpvb206ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5fbG9hZGVkP3RoaXMuc2V0Vmlldyh0aGlzLmdldENlbnRlcigpLHQse3pvb206ZX0pOih0aGlzLl96b29tPXQsdGhpcyl9LHpvb21JbjpmdW5jdGlvbih0LGUpe3JldHVybiB0PXR8fChvLkJyb3dzZXIuYW55M2Q/dGhpcy5vcHRpb25zLnpvb21EZWx0YToxKSx0aGlzLnNldFpvb20odGhpcy5fem9vbSt0LGUpfSx6b29tT3V0OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQ9dHx8KG8uQnJvd3Nlci5hbnkzZD90aGlzLm9wdGlvbnMuem9vbURlbHRhOjEpLHRoaXMuc2V0Wm9vbSh0aGlzLl96b29tLXQsZSl9LHNldFpvb21Bcm91bmQ6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPXRoaXMuZ2V0Wm9vbVNjYWxlKGUpLHM9dGhpcy5nZXRTaXplKCkuZGl2aWRlQnkoMikscj10IGluc3RhbmNlb2Ygby5Qb2ludD90OnRoaXMubGF0TG5nVG9Db250YWluZXJQb2ludCh0KSxhPXIuc3VidHJhY3QocykubXVsdGlwbHlCeSgxLTEvbiksaD10aGlzLmNvbnRhaW5lclBvaW50VG9MYXRMbmcocy5hZGQoYSkpO3JldHVybiB0aGlzLnNldFZpZXcoaCxlLHt6b29tOml9KX0sX2dldEJvdW5kc0NlbnRlclpvb206ZnVuY3Rpb24odCxlKXtlPWV8fHt9LHQ9dC5nZXRCb3VuZHM/dC5nZXRCb3VuZHMoKTpvLmxhdExuZ0JvdW5kcyh0KTt2YXIgaT1vLnBvaW50KGUucGFkZGluZ1RvcExlZnR8fGUucGFkZGluZ3x8WzAsMF0pLG49by5wb2ludChlLnBhZGRpbmdCb3R0b21SaWdodHx8ZS5wYWRkaW5nfHxbMCwwXSkscz10aGlzLmdldEJvdW5kc1pvb20odCwhMSxpLmFkZChuKSk7cz1cIm51bWJlclwiPT10eXBlb2YgZS5tYXhab29tP01hdGgubWluKGUubWF4Wm9vbSxzKTpzO3ZhciByPW4uc3VidHJhY3QoaSkuZGl2aWRlQnkoMiksYT10aGlzLnByb2plY3QodC5nZXRTb3V0aFdlc3QoKSxzKSxoPXRoaXMucHJvamVjdCh0LmdldE5vcnRoRWFzdCgpLHMpLGw9dGhpcy51bnByb2plY3QoYS5hZGQoaCkuZGl2aWRlQnkoMikuYWRkKHIpLHMpO3JldHVybntjZW50ZXI6bCx6b29tOnN9fSxmaXRCb3VuZHM6ZnVuY3Rpb24odCxlKXtpZih0PW8ubGF0TG5nQm91bmRzKHQpLCF0LmlzVmFsaWQoKSl0aHJvdyBuZXcgRXJyb3IoXCJCb3VuZHMgYXJlIG5vdCB2YWxpZC5cIik7dmFyIGk9dGhpcy5fZ2V0Qm91bmRzQ2VudGVyWm9vbSh0LGUpO3JldHVybiB0aGlzLnNldFZpZXcoaS5jZW50ZXIsaS56b29tLGUpfSxmaXRXb3JsZDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5maXRCb3VuZHMoW1stOTAsLTE4MF0sWzkwLDE4MF1dLHQpfSxwYW5UbzpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLnNldFZpZXcodCx0aGlzLl96b29tLHtwYW46ZX0pfSxwYW5CeTpmdW5jdGlvbih0LGUpe2lmKHQ9by5wb2ludCh0KS5yb3VuZCgpLGU9ZXx8e30sIXQueCYmIXQueSlyZXR1cm4gdGhpcy5maXJlKFwibW92ZWVuZFwiKTtpZihlLmFuaW1hdGUhPT0hMCYmIXRoaXMuZ2V0U2l6ZSgpLmNvbnRhaW5zKHQpKXJldHVybiB0aGlzLl9yZXNldFZpZXcodGhpcy51bnByb2plY3QodGhpcy5wcm9qZWN0KHRoaXMuZ2V0Q2VudGVyKCkpLmFkZCh0KSksdGhpcy5nZXRab29tKCkpLHRoaXM7aWYodGhpcy5fcGFuQW5pbXx8KHRoaXMuX3BhbkFuaW09bmV3IG8uUG9zQW5pbWF0aW9uLHRoaXMuX3BhbkFuaW0ub24oe3N0ZXA6dGhpcy5fb25QYW5UcmFuc2l0aW9uU3RlcCxlbmQ6dGhpcy5fb25QYW5UcmFuc2l0aW9uRW5kfSx0aGlzKSksZS5ub01vdmVTdGFydHx8dGhpcy5maXJlKFwibW92ZXN0YXJ0XCIpLGUuYW5pbWF0ZSE9PSExKXtvLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fbWFwUGFuZSxcImxlYWZsZXQtcGFuLWFuaW1cIik7dmFyIGk9dGhpcy5fZ2V0TWFwUGFuZVBvcygpLnN1YnRyYWN0KHQpLnJvdW5kKCk7dGhpcy5fcGFuQW5pbS5ydW4odGhpcy5fbWFwUGFuZSxpLGUuZHVyYXRpb258fC4yNSxlLmVhc2VMaW5lYXJpdHkpfWVsc2UgdGhpcy5fcmF3UGFuQnkodCksdGhpcy5maXJlKFwibW92ZVwiKS5maXJlKFwibW92ZWVuZFwiKTtyZXR1cm4gdGhpc30sZmx5VG86ZnVuY3Rpb24odCxlLG4pe2Z1bmN0aW9uIHModCl7dmFyIGU9dD8tMToxLGk9dD92Omcsbj12KnYtZypnK2UqTCpMKnkqeSxvPTIqaSpMKnkscz1uL28scj1NYXRoLnNxcnQocypzKzEpLXMsYT1yPDFlLTk/LTE4Ok1hdGgubG9nKHIpO3JldHVybiBhfWZ1bmN0aW9uIHIodCl7cmV0dXJuKE1hdGguZXhwKHQpLU1hdGguZXhwKC10KSkvMn1mdW5jdGlvbiBhKHQpe3JldHVybihNYXRoLmV4cCh0KStNYXRoLmV4cCgtdCkpLzJ9ZnVuY3Rpb24gaCh0KXtyZXR1cm4gcih0KS9hKHQpfWZ1bmN0aW9uIGwodCl7cmV0dXJuIGcqKGEoeCkvYSh4K1AqdCkpfWZ1bmN0aW9uIHUodCl7cmV0dXJuIGcqKGEoeCkqaCh4K1AqdCktcih4KSkvTH1mdW5jdGlvbiBjKHQpe3JldHVybiAxLU1hdGgucG93KDEtdCwxLjUpfWZ1bmN0aW9uIGQoKXt2YXIgaT0oRGF0ZS5ub3coKS13KS9ULG49YyhpKSpiO2k8PTE/KHRoaXMuX2ZseVRvRnJhbWU9by5VdGlsLnJlcXVlc3RBbmltRnJhbWUoZCx0aGlzKSx0aGlzLl9tb3ZlKHRoaXMudW5wcm9qZWN0KF8uYWRkKG0uc3VidHJhY3QoXykubXVsdGlwbHlCeSh1KG4pL3kpKSxmKSx0aGlzLmdldFNjYWxlWm9vbShnL2wobiksZikse2ZseVRvOiEwfSkpOnRoaXMuX21vdmUodCxlKS5fbW92ZUVuZCghMCl9aWYobj1ufHx7fSxuLmFuaW1hdGU9PT0hMXx8IW8uQnJvd3Nlci5hbnkzZClyZXR1cm4gdGhpcy5zZXRWaWV3KHQsZSxuKTt0aGlzLl9zdG9wKCk7dmFyIF89dGhpcy5wcm9qZWN0KHRoaXMuZ2V0Q2VudGVyKCkpLG09dGhpcy5wcm9qZWN0KHQpLHA9dGhpcy5nZXRTaXplKCksZj10aGlzLl96b29tO3Q9by5sYXRMbmcodCksZT1lPT09aT9mOmU7dmFyIGc9TWF0aC5tYXgocC54LHAueSksdj1nKnRoaXMuZ2V0Wm9vbVNjYWxlKGYsZSkseT1tLmRpc3RhbmNlVG8oXyl8fDEsUD0xLjQyLEw9UCpQLHg9cygwKSx3PURhdGUubm93KCksYj0ocygxKS14KS9QLFQ9bi5kdXJhdGlvbj8xZTMqbi5kdXJhdGlvbjoxZTMqYiouODtyZXR1cm4gdGhpcy5fbW92ZVN0YXJ0KCEwKSxkLmNhbGwodGhpcyksdGhpc30sZmx5VG9Cb3VuZHM6ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9nZXRCb3VuZHNDZW50ZXJab29tKHQsZSk7cmV0dXJuIHRoaXMuZmx5VG8oaS5jZW50ZXIsaS56b29tLGUpfSxzZXRNYXhCb3VuZHM6ZnVuY3Rpb24odCl7cmV0dXJuIHQ9by5sYXRMbmdCb3VuZHModCksdC5pc1ZhbGlkKCk/KHRoaXMub3B0aW9ucy5tYXhCb3VuZHMmJnRoaXMub2ZmKFwibW92ZWVuZFwiLHRoaXMuX3Bhbkluc2lkZU1heEJvdW5kcyksdGhpcy5vcHRpb25zLm1heEJvdW5kcz10LHRoaXMuX2xvYWRlZCYmdGhpcy5fcGFuSW5zaWRlTWF4Qm91bmRzKCksdGhpcy5vbihcIm1vdmVlbmRcIix0aGlzLl9wYW5JbnNpZGVNYXhCb3VuZHMpKToodGhpcy5vcHRpb25zLm1heEJvdW5kcz1udWxsLHRoaXMub2ZmKFwibW92ZWVuZFwiLHRoaXMuX3Bhbkluc2lkZU1heEJvdW5kcykpfSxzZXRNaW5ab29tOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLm9wdGlvbnMubWluWm9vbT10LHRoaXMuX2xvYWRlZCYmdGhpcy5nZXRab29tKCk8dGhpcy5vcHRpb25zLm1pblpvb20/dGhpcy5zZXRab29tKHQpOnRoaXN9LHNldE1heFpvb206ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3B0aW9ucy5tYXhab29tPXQsdGhpcy5fbG9hZGVkJiZ0aGlzLmdldFpvb20oKT50aGlzLm9wdGlvbnMubWF4Wm9vbT90aGlzLnNldFpvb20odCk6dGhpc30scGFuSW5zaWRlQm91bmRzOmZ1bmN0aW9uKHQsZSl7dGhpcy5fZW5mb3JjaW5nQm91bmRzPSEwO3ZhciBpPXRoaXMuZ2V0Q2VudGVyKCksbj10aGlzLl9saW1pdENlbnRlcihpLHRoaXMuX3pvb20sby5sYXRMbmdCb3VuZHModCkpO3JldHVybiBpLmVxdWFscyhuKXx8dGhpcy5wYW5UbyhuLGUpLHRoaXMuX2VuZm9yY2luZ0JvdW5kcz0hMSx0aGlzfSxpbnZhbGlkYXRlU2l6ZTpmdW5jdGlvbih0KXtpZighdGhpcy5fbG9hZGVkKXJldHVybiB0aGlzO3Q9by5leHRlbmQoe2FuaW1hdGU6ITEscGFuOiEwfSx0PT09ITA/e2FuaW1hdGU6ITB9OnQpO3ZhciBlPXRoaXMuZ2V0U2l6ZSgpO3RoaXMuX3NpemVDaGFuZ2VkPSEwLHRoaXMuX2xhc3RDZW50ZXI9bnVsbDt2YXIgaT10aGlzLmdldFNpemUoKSxuPWUuZGl2aWRlQnkoMikucm91bmQoKSxzPWkuZGl2aWRlQnkoMikucm91bmQoKSxyPW4uc3VidHJhY3Qocyk7cmV0dXJuIHIueHx8ci55Pyh0LmFuaW1hdGUmJnQucGFuP3RoaXMucGFuQnkocik6KHQucGFuJiZ0aGlzLl9yYXdQYW5CeShyKSx0aGlzLmZpcmUoXCJtb3ZlXCIpLHQuZGVib3VuY2VNb3ZlZW5kPyhjbGVhclRpbWVvdXQodGhpcy5fc2l6ZVRpbWVyKSx0aGlzLl9zaXplVGltZXI9c2V0VGltZW91dChvLmJpbmQodGhpcy5maXJlLHRoaXMsXCJtb3ZlZW5kXCIpLDIwMCkpOnRoaXMuZmlyZShcIm1vdmVlbmRcIikpLHRoaXMuZmlyZShcInJlc2l6ZVwiLHtvbGRTaXplOmUsbmV3U2l6ZTppfSkpOnRoaXN9LHN0b3A6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zZXRab29tKHRoaXMuX2xpbWl0Wm9vbSh0aGlzLl96b29tKSksdGhpcy5vcHRpb25zLnpvb21TbmFwfHx0aGlzLmZpcmUoXCJ2aWV3cmVzZXRcIiksdGhpcy5fc3RvcCgpfSxsb2NhdGU6ZnVuY3Rpb24odCl7aWYodD10aGlzLl9sb2NhdGVPcHRpb25zPW8uZXh0ZW5kKHt0aW1lb3V0OjFlNCx3YXRjaDohMX0sdCksIShcImdlb2xvY2F0aW9uXCJpbiBuYXZpZ2F0b3IpKXJldHVybiB0aGlzLl9oYW5kbGVHZW9sb2NhdGlvbkVycm9yKHtjb2RlOjAsbWVzc2FnZTpcIkdlb2xvY2F0aW9uIG5vdCBzdXBwb3J0ZWQuXCJ9KSx0aGlzO3ZhciBlPW8uYmluZCh0aGlzLl9oYW5kbGVHZW9sb2NhdGlvblJlc3BvbnNlLHRoaXMpLGk9by5iaW5kKHRoaXMuX2hhbmRsZUdlb2xvY2F0aW9uRXJyb3IsdGhpcyk7cmV0dXJuIHQud2F0Y2g/dGhpcy5fbG9jYXRpb25XYXRjaElkPW5hdmlnYXRvci5nZW9sb2NhdGlvbi53YXRjaFBvc2l0aW9uKGUsaSx0KTpuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGUsaSx0KSx0aGlzfSxzdG9wTG9jYXRlOmZ1bmN0aW9uKCl7cmV0dXJuIG5hdmlnYXRvci5nZW9sb2NhdGlvbiYmbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmNsZWFyV2F0Y2gmJm5hdmlnYXRvci5nZW9sb2NhdGlvbi5jbGVhcldhdGNoKHRoaXMuX2xvY2F0aW9uV2F0Y2hJZCksdGhpcy5fbG9jYXRlT3B0aW9ucyYmKHRoaXMuX2xvY2F0ZU9wdGlvbnMuc2V0Vmlldz0hMSksdGhpc30sX2hhbmRsZUdlb2xvY2F0aW9uRXJyb3I6ZnVuY3Rpb24odCl7dmFyIGU9dC5jb2RlLGk9dC5tZXNzYWdlfHwoMT09PWU/XCJwZXJtaXNzaW9uIGRlbmllZFwiOjI9PT1lP1wicG9zaXRpb24gdW5hdmFpbGFibGVcIjpcInRpbWVvdXRcIik7dGhpcy5fbG9jYXRlT3B0aW9ucy5zZXRWaWV3JiYhdGhpcy5fbG9hZGVkJiZ0aGlzLmZpdFdvcmxkKCksdGhpcy5maXJlKFwibG9jYXRpb25lcnJvclwiLHtjb2RlOmUsbWVzc2FnZTpcIkdlb2xvY2F0aW9uIGVycm9yOiBcIitpK1wiLlwifSl9LF9oYW5kbGVHZW9sb2NhdGlvblJlc3BvbnNlOmZ1bmN0aW9uKHQpe3ZhciBlPXQuY29vcmRzLmxhdGl0dWRlLGk9dC5jb29yZHMubG9uZ2l0dWRlLG49bmV3IG8uTGF0TG5nKGUsaSkscz1uLnRvQm91bmRzKHQuY29vcmRzLmFjY3VyYWN5KSxyPXRoaXMuX2xvY2F0ZU9wdGlvbnM7aWYoci5zZXRWaWV3KXt2YXIgYT10aGlzLmdldEJvdW5kc1pvb20ocyk7dGhpcy5zZXRWaWV3KG4sci5tYXhab29tP01hdGgubWluKGEsci5tYXhab29tKTphKX12YXIgaD17bGF0bG5nOm4sYm91bmRzOnMsdGltZXN0YW1wOnQudGltZXN0YW1wfTtmb3IodmFyIGwgaW4gdC5jb29yZHMpXCJudW1iZXJcIj09dHlwZW9mIHQuY29vcmRzW2xdJiYoaFtsXT10LmNvb3Jkc1tsXSk7dGhpcy5maXJlKFwibG9jYXRpb25mb3VuZFwiLGgpfSxhZGRIYW5kbGVyOmZ1bmN0aW9uKHQsZSl7aWYoIWUpcmV0dXJuIHRoaXM7dmFyIGk9dGhpc1t0XT1uZXcgZSh0aGlzKTtyZXR1cm4gdGhpcy5faGFuZGxlcnMucHVzaChpKSx0aGlzLm9wdGlvbnNbdF0mJmkuZW5hYmxlKCksdGhpc30scmVtb3ZlOmZ1bmN0aW9uKCl7aWYodGhpcy5faW5pdEV2ZW50cyghMCksdGhpcy5fY29udGFpbmVySWQhPT10aGlzLl9jb250YWluZXIuX2xlYWZsZXRfaWQpdGhyb3cgbmV3IEVycm9yKFwiTWFwIGNvbnRhaW5lciBpcyBiZWluZyByZXVzZWQgYnkgYW5vdGhlciBpbnN0YW5jZVwiKTt0cnl7ZGVsZXRlIHRoaXMuX2NvbnRhaW5lci5fbGVhZmxldF9pZCxkZWxldGUgdGhpcy5fY29udGFpbmVySWR9Y2F0Y2godCl7dGhpcy5fY29udGFpbmVyLl9sZWFmbGV0X2lkPWksdGhpcy5fY29udGFpbmVySWQ9aX1vLkRvbVV0aWwucmVtb3ZlKHRoaXMuX21hcFBhbmUpLHRoaXMuX2NsZWFyQ29udHJvbFBvcyYmdGhpcy5fY2xlYXJDb250cm9sUG9zKCksdGhpcy5fY2xlYXJIYW5kbGVycygpLHRoaXMuX2xvYWRlZCYmdGhpcy5maXJlKFwidW5sb2FkXCIpO2Zvcih2YXIgdCBpbiB0aGlzLl9sYXllcnMpdGhpcy5fbGF5ZXJzW3RdLnJlbW92ZSgpO3JldHVybiB0aGlzfSxjcmVhdGVQYW5lOmZ1bmN0aW9uKHQsZSl7dmFyIGk9XCJsZWFmbGV0LXBhbmVcIisodD9cIiBsZWFmbGV0LVwiK3QucmVwbGFjZShcIlBhbmVcIixcIlwiKStcIi1wYW5lXCI6XCJcIiksbj1vLkRvbVV0aWwuY3JlYXRlKFwiZGl2XCIsaSxlfHx0aGlzLl9tYXBQYW5lKTtyZXR1cm4gdCYmKHRoaXMuX3BhbmVzW3RdPW4pLG59LGdldENlbnRlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jaGVja0lmTG9hZGVkKCksdGhpcy5fbGFzdENlbnRlciYmIXRoaXMuX21vdmVkKCk/dGhpcy5fbGFzdENlbnRlcjp0aGlzLmxheWVyUG9pbnRUb0xhdExuZyh0aGlzLl9nZXRDZW50ZXJMYXllclBvaW50KCkpfSxnZXRab29tOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3pvb219LGdldEJvdW5kczpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0UGl4ZWxCb3VuZHMoKSxlPXRoaXMudW5wcm9qZWN0KHQuZ2V0Qm90dG9tTGVmdCgpKSxpPXRoaXMudW5wcm9qZWN0KHQuZ2V0VG9wUmlnaHQoKSk7cmV0dXJuIG5ldyBvLkxhdExuZ0JvdW5kcyhlLGkpfSxnZXRNaW5ab29tOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5taW5ab29tPT09aT90aGlzLl9sYXllcnNNaW5ab29tfHwwOnRoaXMub3B0aW9ucy5taW5ab29tfSxnZXRNYXhab29tOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5tYXhab29tPT09aT90aGlzLl9sYXllcnNNYXhab29tPT09aT8xLzA6dGhpcy5fbGF5ZXJzTWF4Wm9vbTp0aGlzLm9wdGlvbnMubWF4Wm9vbX0sZ2V0Qm91bmRzWm9vbTpmdW5jdGlvbih0LGUsaSl7dD1vLmxhdExuZ0JvdW5kcyh0KSxpPW8ucG9pbnQoaXx8WzAsMF0pO3ZhciBuPXRoaXMuZ2V0Wm9vbSgpfHwwLHM9dGhpcy5nZXRNaW5ab29tKCkscj10aGlzLmdldE1heFpvb20oKSxhPXQuZ2V0Tm9ydGhXZXN0KCksaD10LmdldFNvdXRoRWFzdCgpLGw9dGhpcy5nZXRTaXplKCkuc3VidHJhY3QoaSksdT1vLmJvdW5kcyh0aGlzLnByb2plY3QoaCxuKSx0aGlzLnByb2plY3QoYSxuKSkuZ2V0U2l6ZSgpLGM9by5Ccm93c2VyLmFueTNkP3RoaXMub3B0aW9ucy56b29tU25hcDoxLGQ9TWF0aC5taW4obC54L3UueCxsLnkvdS55KTtyZXR1cm4gbj10aGlzLmdldFNjYWxlWm9vbShkLG4pLGMmJihuPU1hdGgucm91bmQobi8oYy8xMDApKSooYy8xMDApLG49ZT9NYXRoLmNlaWwobi9jKSpjOk1hdGguZmxvb3Iobi9jKSpjKSxNYXRoLm1heChzLE1hdGgubWluKHIsbikpfSxnZXRTaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NpemUmJiF0aGlzLl9zaXplQ2hhbmdlZHx8KHRoaXMuX3NpemU9bmV3IG8uUG9pbnQodGhpcy5fY29udGFpbmVyLmNsaWVudFdpZHRofHwwLHRoaXMuX2NvbnRhaW5lci5jbGllbnRIZWlnaHR8fDApLHRoaXMuX3NpemVDaGFuZ2VkPSExKSx0aGlzLl9zaXplLmNsb25lKCl9LGdldFBpeGVsQm91bmRzOmZ1bmN0aW9uKHQsZSl7dmFyIGk9dGhpcy5fZ2V0VG9wTGVmdFBvaW50KHQsZSk7cmV0dXJuIG5ldyBvLkJvdW5kcyhpLGkuYWRkKHRoaXMuZ2V0U2l6ZSgpKSl9LGdldFBpeGVsT3JpZ2luOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2NoZWNrSWZMb2FkZWQoKSx0aGlzLl9waXhlbE9yaWdpbn0sZ2V0UGl4ZWxXb3JsZEJvdW5kczpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLmNycy5nZXRQcm9qZWN0ZWRCb3VuZHModD09PWk/dGhpcy5nZXRab29tKCk6dCl9LGdldFBhbmU6ZnVuY3Rpb24odCl7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIHQ/dGhpcy5fcGFuZXNbdF06dH0sZ2V0UGFuZXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcGFuZXN9LGdldENvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jb250YWluZXJ9LGdldFpvb21TY2FsZTpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMub3B0aW9ucy5jcnM7cmV0dXJuIGU9ZT09PWk/dGhpcy5fem9vbTplLG4uc2NhbGUodCkvbi5zY2FsZShlKX0sZ2V0U2NhbGVab29tOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5vcHRpb25zLmNycztlPWU9PT1pP3RoaXMuX3pvb206ZTt2YXIgbz1uLnpvb20odCpuLnNjYWxlKGUpKTtyZXR1cm4gaXNOYU4obyk/MS8wOm99LHByb2plY3Q6ZnVuY3Rpb24odCxlKXtyZXR1cm4gZT1lPT09aT90aGlzLl96b29tOmUsdGhpcy5vcHRpb25zLmNycy5sYXRMbmdUb1BvaW50KG8ubGF0TG5nKHQpLGUpfSx1bnByb2plY3Q6ZnVuY3Rpb24odCxlKXtyZXR1cm4gZT1lPT09aT90aGlzLl96b29tOmUsdGhpcy5vcHRpb25zLmNycy5wb2ludFRvTGF0TG5nKG8ucG9pbnQodCksZSl9LGxheWVyUG9pbnRUb0xhdExuZzpmdW5jdGlvbih0KXt2YXIgZT1vLnBvaW50KHQpLmFkZCh0aGlzLmdldFBpeGVsT3JpZ2luKCkpO3JldHVybiB0aGlzLnVucHJvamVjdChlKX0sbGF0TG5nVG9MYXllclBvaW50OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMucHJvamVjdChvLmxhdExuZyh0KSkuX3JvdW5kKCk7cmV0dXJuIGUuX3N1YnRyYWN0KHRoaXMuZ2V0UGl4ZWxPcmlnaW4oKSl9LHdyYXBMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3B0aW9ucy5jcnMud3JhcExhdExuZyhvLmxhdExuZyh0KSl9LHdyYXBMYXRMbmdCb3VuZHM6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3B0aW9ucy5jcnMud3JhcExhdExuZ0JvdW5kcyhvLmxhdExuZ0JvdW5kcyh0KSl9LGRpc3RhbmNlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMub3B0aW9ucy5jcnMuZGlzdGFuY2Uoby5sYXRMbmcodCksby5sYXRMbmcoZSkpfSxjb250YWluZXJQb2ludFRvTGF5ZXJQb2ludDpmdW5jdGlvbih0KXtyZXR1cm4gby5wb2ludCh0KS5zdWJ0cmFjdCh0aGlzLl9nZXRNYXBQYW5lUG9zKCkpfSxsYXllclBvaW50VG9Db250YWluZXJQb2ludDpmdW5jdGlvbih0KXtyZXR1cm4gby5wb2ludCh0KS5hZGQodGhpcy5fZ2V0TWFwUGFuZVBvcygpKX0sY29udGFpbmVyUG9pbnRUb0xhdExuZzpmdW5jdGlvbih0KXt2YXIgZT10aGlzLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KG8ucG9pbnQodCkpO3JldHVybiB0aGlzLmxheWVyUG9pbnRUb0xhdExuZyhlKX0sbGF0TG5nVG9Db250YWluZXJQb2ludDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5sYXllclBvaW50VG9Db250YWluZXJQb2ludCh0aGlzLmxhdExuZ1RvTGF5ZXJQb2ludChvLmxhdExuZyh0KSkpfSxtb3VzZUV2ZW50VG9Db250YWluZXJQb2ludDpmdW5jdGlvbih0KXtyZXR1cm4gby5Eb21FdmVudC5nZXRNb3VzZVBvc2l0aW9uKHQsdGhpcy5fY29udGFpbmVyKX0sbW91c2VFdmVudFRvTGF5ZXJQb2ludDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5jb250YWluZXJQb2ludFRvTGF5ZXJQb2ludCh0aGlzLm1vdXNlRXZlbnRUb0NvbnRhaW5lclBvaW50KHQpKX0sbW91c2VFdmVudFRvTGF0TG5nOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmxheWVyUG9pbnRUb0xhdExuZyh0aGlzLm1vdXNlRXZlbnRUb0xheWVyUG9pbnQodCkpfSxfaW5pdENvbnRhaW5lcjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9jb250YWluZXI9by5Eb21VdGlsLmdldCh0KTtpZighZSl0aHJvdyBuZXcgRXJyb3IoXCJNYXAgY29udGFpbmVyIG5vdCBmb3VuZC5cIik7aWYoZS5fbGVhZmxldF9pZCl0aHJvdyBuZXcgRXJyb3IoXCJNYXAgY29udGFpbmVyIGlzIGFscmVhZHkgaW5pdGlhbGl6ZWQuXCIpO28uRG9tRXZlbnQuYWRkTGlzdGVuZXIoZSxcInNjcm9sbFwiLHRoaXMuX29uU2Nyb2xsLHRoaXMpLHRoaXMuX2NvbnRhaW5lcklkPW8uVXRpbC5zdGFtcChlKX0sX2luaXRMYXlvdXQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9jb250YWluZXI7dGhpcy5fZmFkZUFuaW1hdGVkPXRoaXMub3B0aW9ucy5mYWRlQW5pbWF0aW9uJiZvLkJyb3dzZXIuYW55M2QsXG5vLkRvbVV0aWwuYWRkQ2xhc3ModCxcImxlYWZsZXQtY29udGFpbmVyXCIrKG8uQnJvd3Nlci50b3VjaD9cIiBsZWFmbGV0LXRvdWNoXCI6XCJcIikrKG8uQnJvd3Nlci5yZXRpbmE/XCIgbGVhZmxldC1yZXRpbmFcIjpcIlwiKSsoby5Ccm93c2VyLmllbHQ5P1wiIGxlYWZsZXQtb2xkaWVcIjpcIlwiKSsoby5Ccm93c2VyLnNhZmFyaT9cIiBsZWFmbGV0LXNhZmFyaVwiOlwiXCIpKyh0aGlzLl9mYWRlQW5pbWF0ZWQ/XCIgbGVhZmxldC1mYWRlLWFuaW1cIjpcIlwiKSk7dmFyIGU9by5Eb21VdGlsLmdldFN0eWxlKHQsXCJwb3NpdGlvblwiKTtcImFic29sdXRlXCIhPT1lJiZcInJlbGF0aXZlXCIhPT1lJiZcImZpeGVkXCIhPT1lJiYodC5zdHlsZS5wb3NpdGlvbj1cInJlbGF0aXZlXCIpLHRoaXMuX2luaXRQYW5lcygpLHRoaXMuX2luaXRDb250cm9sUG9zJiZ0aGlzLl9pbml0Q29udHJvbFBvcygpfSxfaW5pdFBhbmVzOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fcGFuZXM9e307dGhpcy5fcGFuZVJlbmRlcmVycz17fSx0aGlzLl9tYXBQYW5lPXRoaXMuY3JlYXRlUGFuZShcIm1hcFBhbmVcIix0aGlzLl9jb250YWluZXIpLG8uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lLG5ldyBvLlBvaW50KDAsMCkpLHRoaXMuY3JlYXRlUGFuZShcInRpbGVQYW5lXCIpLHRoaXMuY3JlYXRlUGFuZShcInNoYWRvd1BhbmVcIiksdGhpcy5jcmVhdGVQYW5lKFwib3ZlcmxheVBhbmVcIiksdGhpcy5jcmVhdGVQYW5lKFwibWFya2VyUGFuZVwiKSx0aGlzLmNyZWF0ZVBhbmUoXCJ0b29sdGlwUGFuZVwiKSx0aGlzLmNyZWF0ZVBhbmUoXCJwb3B1cFBhbmVcIiksdGhpcy5vcHRpb25zLm1hcmtlclpvb21BbmltYXRpb258fChvLkRvbVV0aWwuYWRkQ2xhc3ModC5tYXJrZXJQYW5lLFwibGVhZmxldC16b29tLWhpZGVcIiksby5Eb21VdGlsLmFkZENsYXNzKHQuc2hhZG93UGFuZSxcImxlYWZsZXQtem9vbS1oaWRlXCIpKX0sX3Jlc2V0VmlldzpmdW5jdGlvbih0LGUpe28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lLG5ldyBvLlBvaW50KDAsMCkpO3ZhciBpPSF0aGlzLl9sb2FkZWQ7dGhpcy5fbG9hZGVkPSEwLGU9dGhpcy5fbGltaXRab29tKGUpLHRoaXMuZmlyZShcInZpZXdwcmVyZXNldFwiKTt2YXIgbj10aGlzLl96b29tIT09ZTt0aGlzLl9tb3ZlU3RhcnQobikuX21vdmUodCxlKS5fbW92ZUVuZChuKSx0aGlzLmZpcmUoXCJ2aWV3cmVzZXRcIiksaSYmdGhpcy5maXJlKFwibG9hZFwiKX0sX21vdmVTdGFydDpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5maXJlKFwiem9vbXN0YXJ0XCIpLHRoaXMuZmlyZShcIm1vdmVzdGFydFwiKX0sX21vdmU6ZnVuY3Rpb24odCxlLG4pe2U9PT1pJiYoZT10aGlzLl96b29tKTt2YXIgbz10aGlzLl96b29tIT09ZTtyZXR1cm4gdGhpcy5fem9vbT1lLHRoaXMuX2xhc3RDZW50ZXI9dCx0aGlzLl9waXhlbE9yaWdpbj10aGlzLl9nZXROZXdQaXhlbE9yaWdpbih0KSwob3x8biYmbi5waW5jaCkmJnRoaXMuZmlyZShcInpvb21cIixuKSx0aGlzLmZpcmUoXCJtb3ZlXCIsbil9LF9tb3ZlRW5kOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLmZpcmUoXCJ6b29tZW5kXCIpLHRoaXMuZmlyZShcIm1vdmVlbmRcIil9LF9zdG9wOmZ1bmN0aW9uKCl7cmV0dXJuIG8uVXRpbC5jYW5jZWxBbmltRnJhbWUodGhpcy5fZmx5VG9GcmFtZSksdGhpcy5fcGFuQW5pbSYmdGhpcy5fcGFuQW5pbS5zdG9wKCksdGhpc30sX3Jhd1BhbkJ5OmZ1bmN0aW9uKHQpe28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9tYXBQYW5lLHRoaXMuX2dldE1hcFBhbmVQb3MoKS5zdWJ0cmFjdCh0KSl9LF9nZXRab29tU3BhbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldE1heFpvb20oKS10aGlzLmdldE1pblpvb20oKX0sX3Bhbkluc2lkZU1heEJvdW5kczpmdW5jdGlvbigpe3RoaXMuX2VuZm9yY2luZ0JvdW5kc3x8dGhpcy5wYW5JbnNpZGVCb3VuZHModGhpcy5vcHRpb25zLm1heEJvdW5kcyl9LF9jaGVja0lmTG9hZGVkOmZ1bmN0aW9uKCl7aWYoIXRoaXMuX2xvYWRlZCl0aHJvdyBuZXcgRXJyb3IoXCJTZXQgbWFwIGNlbnRlciBhbmQgem9vbSBmaXJzdC5cIil9LF9pbml0RXZlbnRzOmZ1bmN0aW9uKGUpe2lmKG8uRG9tRXZlbnQpe3RoaXMuX3RhcmdldHM9e30sdGhpcy5fdGFyZ2V0c1tvLnN0YW1wKHRoaXMuX2NvbnRhaW5lcildPXRoaXM7dmFyIGk9ZT9cIm9mZlwiOlwib25cIjtvLkRvbUV2ZW50W2ldKHRoaXMuX2NvbnRhaW5lcixcImNsaWNrIGRibGNsaWNrIG1vdXNlZG93biBtb3VzZXVwIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZW1vdmUgY29udGV4dG1lbnUga2V5cHJlc3NcIix0aGlzLl9oYW5kbGVET01FdmVudCx0aGlzKSx0aGlzLm9wdGlvbnMudHJhY2tSZXNpemUmJm8uRG9tRXZlbnRbaV0odCxcInJlc2l6ZVwiLHRoaXMuX29uUmVzaXplLHRoaXMpLG8uQnJvd3Nlci5hbnkzZCYmdGhpcy5vcHRpb25zLnRyYW5zZm9ybTNETGltaXQmJnRoaXNbaV0oXCJtb3ZlZW5kXCIsdGhpcy5fb25Nb3ZlRW5kKX19LF9vblJlc2l6ZTpmdW5jdGlvbigpe28uVXRpbC5jYW5jZWxBbmltRnJhbWUodGhpcy5fcmVzaXplUmVxdWVzdCksdGhpcy5fcmVzaXplUmVxdWVzdD1vLlV0aWwucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbigpe3RoaXMuaW52YWxpZGF0ZVNpemUoe2RlYm91bmNlTW92ZWVuZDohMH0pfSx0aGlzKX0sX29uU2Nyb2xsOmZ1bmN0aW9uKCl7dGhpcy5fY29udGFpbmVyLnNjcm9sbFRvcD0wLHRoaXMuX2NvbnRhaW5lci5zY3JvbGxMZWZ0PTB9LF9vbk1vdmVFbmQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9nZXRNYXBQYW5lUG9zKCk7TWF0aC5tYXgoTWF0aC5hYnModC54KSxNYXRoLmFicyh0LnkpKT49dGhpcy5vcHRpb25zLnRyYW5zZm9ybTNETGltaXQmJnRoaXMuX3Jlc2V0Vmlldyh0aGlzLmdldENlbnRlcigpLHRoaXMuZ2V0Wm9vbSgpKX0sX2ZpbmRFdmVudFRhcmdldHM6ZnVuY3Rpb24odCxlKXtmb3IodmFyIGksbj1bXSxzPVwibW91c2VvdXRcIj09PWV8fFwibW91c2VvdmVyXCI9PT1lLHI9dC50YXJnZXR8fHQuc3JjRWxlbWVudCxhPSExO3I7KXtpZihpPXRoaXMuX3RhcmdldHNbby5zdGFtcChyKV0saSYmKFwiY2xpY2tcIj09PWV8fFwicHJlY2xpY2tcIj09PWUpJiYhdC5fc2ltdWxhdGVkJiZ0aGlzLl9kcmFnZ2FibGVNb3ZlZChpKSl7YT0hMDticmVha31pZihpJiZpLmxpc3RlbnMoZSwhMCkpe2lmKHMmJiFvLkRvbUV2ZW50Ll9pc0V4dGVybmFsVGFyZ2V0KHIsdCkpYnJlYWs7aWYobi5wdXNoKGkpLHMpYnJlYWt9aWYocj09PXRoaXMuX2NvbnRhaW5lcilicmVhaztyPXIucGFyZW50Tm9kZX1yZXR1cm4gbi5sZW5ndGh8fGF8fHN8fCFvLkRvbUV2ZW50Ll9pc0V4dGVybmFsVGFyZ2V0KHIsdCl8fChuPVt0aGlzXSksbn0sX2hhbmRsZURPTUV2ZW50OmZ1bmN0aW9uKHQpe2lmKHRoaXMuX2xvYWRlZCYmIW8uRG9tRXZlbnQuX3NraXBwZWQodCkpe3ZhciBlPVwia2V5cHJlc3NcIj09PXQudHlwZSYmMTM9PT10LmtleUNvZGU/XCJjbGlja1wiOnQudHlwZTtcIm1vdXNlZG93blwiPT09ZSYmby5Eb21VdGlsLnByZXZlbnRPdXRsaW5lKHQudGFyZ2V0fHx0LnNyY0VsZW1lbnQpLHRoaXMuX2ZpcmVET01FdmVudCh0LGUpfX0sX2ZpcmVET01FdmVudDpmdW5jdGlvbih0LGUsaSl7aWYoXCJjbGlja1wiPT09dC50eXBlKXt2YXIgbj1vLlV0aWwuZXh0ZW5kKHt9LHQpO24udHlwZT1cInByZWNsaWNrXCIsdGhpcy5fZmlyZURPTUV2ZW50KG4sbi50eXBlLGkpfWlmKCF0Ll9zdG9wcGVkJiYoaT0oaXx8W10pLmNvbmNhdCh0aGlzLl9maW5kRXZlbnRUYXJnZXRzKHQsZSkpLGkubGVuZ3RoKSl7dmFyIHM9aVswXTtcImNvbnRleHRtZW51XCI9PT1lJiZzLmxpc3RlbnMoZSwhMCkmJm8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCk7dmFyIHI9e29yaWdpbmFsRXZlbnQ6dH07aWYoXCJrZXlwcmVzc1wiIT09dC50eXBlKXt2YXIgYT1zIGluc3RhbmNlb2Ygby5NYXJrZXI7ci5jb250YWluZXJQb2ludD1hP3RoaXMubGF0TG5nVG9Db250YWluZXJQb2ludChzLmdldExhdExuZygpKTp0aGlzLm1vdXNlRXZlbnRUb0NvbnRhaW5lclBvaW50KHQpLHIubGF5ZXJQb2ludD10aGlzLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KHIuY29udGFpbmVyUG9pbnQpLHIubGF0bG5nPWE/cy5nZXRMYXRMbmcoKTp0aGlzLmxheWVyUG9pbnRUb0xhdExuZyhyLmxheWVyUG9pbnQpfWZvcih2YXIgaD0wO2g8aS5sZW5ndGg7aCsrKWlmKGlbaF0uZmlyZShlLHIsITApLHIub3JpZ2luYWxFdmVudC5fc3RvcHBlZHx8aVtoXS5vcHRpb25zLm5vbkJ1YmJsaW5nRXZlbnRzJiZvLlV0aWwuaW5kZXhPZihpW2hdLm9wdGlvbnMubm9uQnViYmxpbmdFdmVudHMsZSkhPT0tMSlyZXR1cm59fSxfZHJhZ2dhYmxlTW92ZWQ6ZnVuY3Rpb24odCl7cmV0dXJuIHQ9dC5kcmFnZ2luZyYmdC5kcmFnZ2luZy5lbmFibGVkKCk/dDp0aGlzLHQuZHJhZ2dpbmcmJnQuZHJhZ2dpbmcubW92ZWQoKXx8dGhpcy5ib3hab29tJiZ0aGlzLmJveFpvb20ubW92ZWQoKX0sX2NsZWFySGFuZGxlcnM6ZnVuY3Rpb24oKXtmb3IodmFyIHQ9MCxlPXRoaXMuX2hhbmRsZXJzLmxlbmd0aDt0PGU7dCsrKXRoaXMuX2hhbmRsZXJzW3RdLmRpc2FibGUoKX0sd2hlblJlYWR5OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX2xvYWRlZD90LmNhbGwoZXx8dGhpcyx7dGFyZ2V0OnRoaXN9KTp0aGlzLm9uKFwibG9hZFwiLHQsZSksdGhpc30sX2dldE1hcFBhbmVQb3M6ZnVuY3Rpb24oKXtyZXR1cm4gby5Eb21VdGlsLmdldFBvc2l0aW9uKHRoaXMuX21hcFBhbmUpfHxuZXcgby5Qb2ludCgwLDApfSxfbW92ZWQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9nZXRNYXBQYW5lUG9zKCk7cmV0dXJuIHQmJiF0LmVxdWFscyhbMCwwXSl9LF9nZXRUb3BMZWZ0UG9pbnQ6ZnVuY3Rpb24odCxlKXt2YXIgbj10JiZlIT09aT90aGlzLl9nZXROZXdQaXhlbE9yaWdpbih0LGUpOnRoaXMuZ2V0UGl4ZWxPcmlnaW4oKTtyZXR1cm4gbi5zdWJ0cmFjdCh0aGlzLl9nZXRNYXBQYW5lUG9zKCkpfSxfZ2V0TmV3UGl4ZWxPcmlnaW46ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLmdldFNpemUoKS5fZGl2aWRlQnkoMik7cmV0dXJuIHRoaXMucHJvamVjdCh0LGUpLl9zdWJ0cmFjdChpKS5fYWRkKHRoaXMuX2dldE1hcFBhbmVQb3MoKSkuX3JvdW5kKCl9LF9sYXRMbmdUb05ld0xheWVyUG9pbnQ6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPXRoaXMuX2dldE5ld1BpeGVsT3JpZ2luKGksZSk7cmV0dXJuIHRoaXMucHJvamVjdCh0LGUpLl9zdWJ0cmFjdChuKX0sX2xhdExuZ0JvdW5kc1RvTmV3TGF5ZXJCb3VuZHM6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPXRoaXMuX2dldE5ld1BpeGVsT3JpZ2luKGksZSk7cmV0dXJuIG8uYm91bmRzKFt0aGlzLnByb2plY3QodC5nZXRTb3V0aFdlc3QoKSxlKS5fc3VidHJhY3QobiksdGhpcy5wcm9qZWN0KHQuZ2V0Tm9ydGhXZXN0KCksZSkuX3N1YnRyYWN0KG4pLHRoaXMucHJvamVjdCh0LmdldFNvdXRoRWFzdCgpLGUpLl9zdWJ0cmFjdChuKSx0aGlzLnByb2plY3QodC5nZXROb3J0aEVhc3QoKSxlKS5fc3VidHJhY3QobildKX0sX2dldENlbnRlckxheWVyUG9pbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb250YWluZXJQb2ludFRvTGF5ZXJQb2ludCh0aGlzLmdldFNpemUoKS5fZGl2aWRlQnkoMikpfSxfZ2V0Q2VudGVyT2Zmc2V0OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmxhdExuZ1RvTGF5ZXJQb2ludCh0KS5zdWJ0cmFjdCh0aGlzLl9nZXRDZW50ZXJMYXllclBvaW50KCkpfSxfbGltaXRDZW50ZXI6ZnVuY3Rpb24odCxlLGkpe2lmKCFpKXJldHVybiB0O3ZhciBuPXRoaXMucHJvamVjdCh0LGUpLHM9dGhpcy5nZXRTaXplKCkuZGl2aWRlQnkoMikscj1uZXcgby5Cb3VuZHMobi5zdWJ0cmFjdChzKSxuLmFkZChzKSksYT10aGlzLl9nZXRCb3VuZHNPZmZzZXQocixpLGUpO3JldHVybiBhLnJvdW5kKCkuZXF1YWxzKFswLDBdKT90OnRoaXMudW5wcm9qZWN0KG4uYWRkKGEpLGUpfSxfbGltaXRPZmZzZXQ6ZnVuY3Rpb24odCxlKXtpZighZSlyZXR1cm4gdDt2YXIgaT10aGlzLmdldFBpeGVsQm91bmRzKCksbj1uZXcgby5Cb3VuZHMoaS5taW4uYWRkKHQpLGkubWF4LmFkZCh0KSk7cmV0dXJuIHQuYWRkKHRoaXMuX2dldEJvdW5kc09mZnNldChuLGUpKX0sX2dldEJvdW5kc09mZnNldDpmdW5jdGlvbih0LGUsaSl7dmFyIG49by5ib3VuZHModGhpcy5wcm9qZWN0KGUuZ2V0Tm9ydGhFYXN0KCksaSksdGhpcy5wcm9qZWN0KGUuZ2V0U291dGhXZXN0KCksaSkpLHM9bi5taW4uc3VidHJhY3QodC5taW4pLHI9bi5tYXguc3VidHJhY3QodC5tYXgpLGE9dGhpcy5fcmVib3VuZChzLngsLXIueCksaD10aGlzLl9yZWJvdW5kKHMueSwtci55KTtyZXR1cm4gbmV3IG8uUG9pbnQoYSxoKX0sX3JlYm91bmQ6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCtlPjA/TWF0aC5yb3VuZCh0LWUpLzI6TWF0aC5tYXgoMCxNYXRoLmNlaWwodCkpLU1hdGgubWF4KDAsTWF0aC5mbG9vcihlKSl9LF9saW1pdFpvb206ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5nZXRNaW5ab29tKCksaT10aGlzLmdldE1heFpvb20oKSxuPW8uQnJvd3Nlci5hbnkzZD90aGlzLm9wdGlvbnMuem9vbVNuYXA6MTtyZXR1cm4gbiYmKHQ9TWF0aC5yb3VuZCh0L24pKm4pLE1hdGgubWF4KGUsTWF0aC5taW4oaSx0KSl9LF9vblBhblRyYW5zaXRpb25TdGVwOmZ1bmN0aW9uKCl7dGhpcy5maXJlKFwibW92ZVwiKX0sX29uUGFuVHJhbnNpdGlvbkVuZDpmdW5jdGlvbigpe28uRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9tYXBQYW5lLFwibGVhZmxldC1wYW4tYW5pbVwiKSx0aGlzLmZpcmUoXCJtb3ZlZW5kXCIpfSxfdHJ5QW5pbWF0ZWRQYW46ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9nZXRDZW50ZXJPZmZzZXQodCkuX2Zsb29yKCk7cmV0dXJuISgoZSYmZS5hbmltYXRlKSE9PSEwJiYhdGhpcy5nZXRTaXplKCkuY29udGFpbnMoaSkpJiYodGhpcy5wYW5CeShpLGUpLCEwKX0sX2NyZWF0ZUFuaW1Qcm94eTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX3Byb3h5PW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixcImxlYWZsZXQtcHJveHkgbGVhZmxldC16b29tLWFuaW1hdGVkXCIpO3RoaXMuX3BhbmVzLm1hcFBhbmUuYXBwZW5kQ2hpbGQodCksdGhpcy5vbihcInpvb21hbmltXCIsZnVuY3Rpb24oZSl7dmFyIGk9by5Eb21VdGlsLlRSQU5TRk9STSxuPXQuc3R5bGVbaV07by5Eb21VdGlsLnNldFRyYW5zZm9ybSh0LHRoaXMucHJvamVjdChlLmNlbnRlcixlLnpvb20pLHRoaXMuZ2V0Wm9vbVNjYWxlKGUuem9vbSwxKSksbj09PXQuc3R5bGVbaV0mJnRoaXMuX2FuaW1hdGluZ1pvb20mJnRoaXMuX29uWm9vbVRyYW5zaXRpb25FbmQoKX0sdGhpcyksdGhpcy5vbihcImxvYWQgbW92ZWVuZFwiLGZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5nZXRDZW50ZXIoKSxpPXRoaXMuZ2V0Wm9vbSgpO28uRG9tVXRpbC5zZXRUcmFuc2Zvcm0odCx0aGlzLnByb2plY3QoZSxpKSx0aGlzLmdldFpvb21TY2FsZShpLDEpKX0sdGhpcyl9LF9jYXRjaFRyYW5zaXRpb25FbmQ6ZnVuY3Rpb24odCl7dGhpcy5fYW5pbWF0aW5nWm9vbSYmdC5wcm9wZXJ0eU5hbWUuaW5kZXhPZihcInRyYW5zZm9ybVwiKT49MCYmdGhpcy5fb25ab29tVHJhbnNpdGlvbkVuZCgpfSxfbm90aGluZ1RvQW5pbWF0ZTpmdW5jdGlvbigpe3JldHVybiF0aGlzLl9jb250YWluZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImxlYWZsZXQtem9vbS1hbmltYXRlZFwiKS5sZW5ndGh9LF90cnlBbmltYXRlZFpvb206ZnVuY3Rpb24odCxlLGkpe2lmKHRoaXMuX2FuaW1hdGluZ1pvb20pcmV0dXJuITA7aWYoaT1pfHx7fSwhdGhpcy5fem9vbUFuaW1hdGVkfHxpLmFuaW1hdGU9PT0hMXx8dGhpcy5fbm90aGluZ1RvQW5pbWF0ZSgpfHxNYXRoLmFicyhlLXRoaXMuX3pvb20pPnRoaXMub3B0aW9ucy56b29tQW5pbWF0aW9uVGhyZXNob2xkKXJldHVybiExO3ZhciBuPXRoaXMuZ2V0Wm9vbVNjYWxlKGUpLHM9dGhpcy5fZ2V0Q2VudGVyT2Zmc2V0KHQpLl9kaXZpZGVCeSgxLTEvbik7cmV0dXJuIShpLmFuaW1hdGUhPT0hMCYmIXRoaXMuZ2V0U2l6ZSgpLmNvbnRhaW5zKHMpKSYmKG8uVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uKCl7dGhpcy5fbW92ZVN0YXJ0KCEwKS5fYW5pbWF0ZVpvb20odCxlLCEwKX0sdGhpcyksITApfSxfYW5pbWF0ZVpvb206ZnVuY3Rpb24odCxlLGksbil7aSYmKHRoaXMuX2FuaW1hdGluZ1pvb209ITAsdGhpcy5fYW5pbWF0ZVRvQ2VudGVyPXQsdGhpcy5fYW5pbWF0ZVRvWm9vbT1lLG8uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9tYXBQYW5lLFwibGVhZmxldC16b29tLWFuaW1cIikpLHRoaXMuZmlyZShcInpvb21hbmltXCIse2NlbnRlcjp0LHpvb206ZSxub1VwZGF0ZTpufSksc2V0VGltZW91dChvLmJpbmQodGhpcy5fb25ab29tVHJhbnNpdGlvbkVuZCx0aGlzKSwyNTApfSxfb25ab29tVHJhbnNpdGlvbkVuZDpmdW5jdGlvbigpe3RoaXMuX2FuaW1hdGluZ1pvb20mJihvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fbWFwUGFuZSxcImxlYWZsZXQtem9vbS1hbmltXCIpLHRoaXMuX2FuaW1hdGluZ1pvb209ITEsdGhpcy5fbW92ZSh0aGlzLl9hbmltYXRlVG9DZW50ZXIsdGhpcy5fYW5pbWF0ZVRvWm9vbSksby5VdGlsLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24oKXt0aGlzLl9tb3ZlRW5kKCEwKX0sdGhpcykpfX0pLG8ubWFwPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLk1hcCh0LGUpfSxvLkxheWVyPW8uRXZlbnRlZC5leHRlbmQoe29wdGlvbnM6e3BhbmU6XCJvdmVybGF5UGFuZVwiLG5vbkJ1YmJsaW5nRXZlbnRzOltdLGF0dHJpYnV0aW9uOm51bGx9LGFkZFRvOmZ1bmN0aW9uKHQpe3JldHVybiB0LmFkZExheWVyKHRoaXMpLHRoaXN9LHJlbW92ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLnJlbW92ZUZyb20odGhpcy5fbWFwfHx0aGlzLl9tYXBUb0FkZCl9LHJlbW92ZUZyb206ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQucmVtb3ZlTGF5ZXIodGhpcyksdGhpc30sZ2V0UGFuZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fbWFwLmdldFBhbmUodD90aGlzLm9wdGlvbnNbdF18fHQ6dGhpcy5vcHRpb25zLnBhbmUpfSxhZGRJbnRlcmFjdGl2ZVRhcmdldDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fbWFwLl90YXJnZXRzW28uc3RhbXAodCldPXRoaXMsdGhpc30scmVtb3ZlSW50ZXJhY3RpdmVUYXJnZXQ6ZnVuY3Rpb24odCl7cmV0dXJuIGRlbGV0ZSB0aGlzLl9tYXAuX3RhcmdldHNbby5zdGFtcCh0KV0sdGhpc30sZ2V0QXR0cmlidXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLmF0dHJpYnV0aW9ufSxfbGF5ZXJBZGQ6ZnVuY3Rpb24odCl7dmFyIGU9dC50YXJnZXQ7aWYoZS5oYXNMYXllcih0aGlzKSl7aWYodGhpcy5fbWFwPWUsdGhpcy5fem9vbUFuaW1hdGVkPWUuX3pvb21BbmltYXRlZCx0aGlzLmdldEV2ZW50cyl7dmFyIGk9dGhpcy5nZXRFdmVudHMoKTtlLm9uKGksdGhpcyksdGhpcy5vbmNlKFwicmVtb3ZlXCIsZnVuY3Rpb24oKXtlLm9mZihpLHRoaXMpfSx0aGlzKX10aGlzLm9uQWRkKGUpLHRoaXMuZ2V0QXR0cmlidXRpb24mJmUuYXR0cmlidXRpb25Db250cm9sJiZlLmF0dHJpYnV0aW9uQ29udHJvbC5hZGRBdHRyaWJ1dGlvbih0aGlzLmdldEF0dHJpYnV0aW9uKCkpLHRoaXMuZmlyZShcImFkZFwiKSxlLmZpcmUoXCJsYXllcmFkZFwiLHtsYXllcjp0aGlzfSl9fX0pLG8uTWFwLmluY2x1ZGUoe2FkZExheWVyOmZ1bmN0aW9uKHQpe3ZhciBlPW8uc3RhbXAodCk7cmV0dXJuIHRoaXMuX2xheWVyc1tlXT90aGlzOih0aGlzLl9sYXllcnNbZV09dCx0Ll9tYXBUb0FkZD10aGlzLHQuYmVmb3JlQWRkJiZ0LmJlZm9yZUFkZCh0aGlzKSx0aGlzLndoZW5SZWFkeSh0Ll9sYXllckFkZCx0KSx0aGlzKX0scmVtb3ZlTGF5ZXI6ZnVuY3Rpb24odCl7dmFyIGU9by5zdGFtcCh0KTtyZXR1cm4gdGhpcy5fbGF5ZXJzW2VdPyh0aGlzLl9sb2FkZWQmJnQub25SZW1vdmUodGhpcyksdC5nZXRBdHRyaWJ1dGlvbiYmdGhpcy5hdHRyaWJ1dGlvbkNvbnRyb2wmJnRoaXMuYXR0cmlidXRpb25Db250cm9sLnJlbW92ZUF0dHJpYnV0aW9uKHQuZ2V0QXR0cmlidXRpb24oKSksZGVsZXRlIHRoaXMuX2xheWVyc1tlXSx0aGlzLl9sb2FkZWQmJih0aGlzLmZpcmUoXCJsYXllcnJlbW92ZVwiLHtsYXllcjp0fSksdC5maXJlKFwicmVtb3ZlXCIpKSx0Ll9tYXA9dC5fbWFwVG9BZGQ9bnVsbCx0aGlzKTp0aGlzfSxoYXNMYXllcjpmdW5jdGlvbih0KXtyZXR1cm4hIXQmJm8uc3RhbXAodClpbiB0aGlzLl9sYXllcnN9LGVhY2hMYXllcjpmdW5jdGlvbih0LGUpe2Zvcih2YXIgaSBpbiB0aGlzLl9sYXllcnMpdC5jYWxsKGUsdGhpcy5fbGF5ZXJzW2ldKTtyZXR1cm4gdGhpc30sX2FkZExheWVyczpmdW5jdGlvbih0KXt0PXQ/by5VdGlsLmlzQXJyYXkodCk/dDpbdF06W107Zm9yKHZhciBlPTAsaT10Lmxlbmd0aDtlPGk7ZSsrKXRoaXMuYWRkTGF5ZXIodFtlXSl9LF9hZGRab29tTGltaXQ6ZnVuY3Rpb24odCl7IWlzTmFOKHQub3B0aW9ucy5tYXhab29tKSYmaXNOYU4odC5vcHRpb25zLm1pblpvb20pfHwodGhpcy5fem9vbUJvdW5kTGF5ZXJzW28uc3RhbXAodCldPXQsdGhpcy5fdXBkYXRlWm9vbUxldmVscygpKX0sX3JlbW92ZVpvb21MaW1pdDpmdW5jdGlvbih0KXt2YXIgZT1vLnN0YW1wKHQpO3RoaXMuX3pvb21Cb3VuZExheWVyc1tlXSYmKGRlbGV0ZSB0aGlzLl96b29tQm91bmRMYXllcnNbZV0sdGhpcy5fdXBkYXRlWm9vbUxldmVscygpKX0sX3VwZGF0ZVpvb21MZXZlbHM6ZnVuY3Rpb24oKXt2YXIgdD0xLzAsZT0tKDEvMCksbj10aGlzLl9nZXRab29tU3BhbigpO2Zvcih2YXIgbyBpbiB0aGlzLl96b29tQm91bmRMYXllcnMpe3ZhciBzPXRoaXMuX3pvb21Cb3VuZExheWVyc1tvXS5vcHRpb25zO3Q9cy5taW5ab29tPT09aT90Ok1hdGgubWluKHQscy5taW5ab29tKSxlPXMubWF4Wm9vbT09PWk/ZTpNYXRoLm1heChlLHMubWF4Wm9vbSl9dGhpcy5fbGF5ZXJzTWF4Wm9vbT1lPT09LSgxLzApP2k6ZSx0aGlzLl9sYXllcnNNaW5ab29tPXQ9PT0xLzA/aTp0LG4hPT10aGlzLl9nZXRab29tU3BhbigpJiZ0aGlzLmZpcmUoXCJ6b29tbGV2ZWxzY2hhbmdlXCIpLHRoaXMub3B0aW9ucy5tYXhab29tPT09aSYmdGhpcy5fbGF5ZXJzTWF4Wm9vbSYmdGhpcy5nZXRab29tKCk+dGhpcy5fbGF5ZXJzTWF4Wm9vbSYmdGhpcy5zZXRab29tKHRoaXMuX2xheWVyc01heFpvb20pLHRoaXMub3B0aW9ucy5taW5ab29tPT09aSYmdGhpcy5fbGF5ZXJzTWluWm9vbSYmdGhpcy5nZXRab29tKCk8dGhpcy5fbGF5ZXJzTWluWm9vbSYmdGhpcy5zZXRab29tKHRoaXMuX2xheWVyc01pblpvb20pfX0pO3ZhciByPVwiX2xlYWZsZXRfZXZlbnRzXCI7by5Eb21FdmVudD17b246ZnVuY3Rpb24odCxlLGksbil7aWYoXCJvYmplY3RcIj09dHlwZW9mIGUpZm9yKHZhciBzIGluIGUpdGhpcy5fb24odCxzLGVbc10saSk7ZWxzZXtlPW8uVXRpbC5zcGxpdFdvcmRzKGUpO2Zvcih2YXIgcj0wLGE9ZS5sZW5ndGg7cjxhO3IrKyl0aGlzLl9vbih0LGVbcl0saSxuKX1yZXR1cm4gdGhpc30sb2ZmOmZ1bmN0aW9uKHQsZSxpLG4pe2lmKFwib2JqZWN0XCI9PXR5cGVvZiBlKWZvcih2YXIgcyBpbiBlKXRoaXMuX29mZih0LHMsZVtzXSxpKTtlbHNle2U9by5VdGlsLnNwbGl0V29yZHMoZSk7Zm9yKHZhciByPTAsYT1lLmxlbmd0aDtyPGE7cisrKXRoaXMuX29mZih0LGVbcl0saSxuKX1yZXR1cm4gdGhpc30sX29uOmZ1bmN0aW9uKGUsaSxuLHMpe3ZhciBhPWkrby5zdGFtcChuKSsocz9cIl9cIitvLnN0YW1wKHMpOlwiXCIpO2lmKGVbcl0mJmVbcl1bYV0pcmV0dXJuIHRoaXM7dmFyIGg9ZnVuY3Rpb24oaSl7cmV0dXJuIG4uY2FsbChzfHxlLGl8fHQuZXZlbnQpfSxsPWg7cmV0dXJuIG8uQnJvd3Nlci5wb2ludGVyJiYwPT09aS5pbmRleE9mKFwidG91Y2hcIik/dGhpcy5hZGRQb2ludGVyTGlzdGVuZXIoZSxpLGgsYSk6IW8uQnJvd3Nlci50b3VjaHx8XCJkYmxjbGlja1wiIT09aXx8IXRoaXMuYWRkRG91YmxlVGFwTGlzdGVuZXJ8fG8uQnJvd3Nlci5wb2ludGVyJiZvLkJyb3dzZXIuY2hyb21lP1wiYWRkRXZlbnRMaXN0ZW5lclwiaW4gZT9cIm1vdXNld2hlZWxcIj09PWk/ZS5hZGRFdmVudExpc3RlbmVyKFwib253aGVlbFwiaW4gZT9cIndoZWVsXCI6XCJtb3VzZXdoZWVsXCIsaCwhMSk6XCJtb3VzZWVudGVyXCI9PT1pfHxcIm1vdXNlbGVhdmVcIj09PWk/KGg9ZnVuY3Rpb24oaSl7aT1pfHx0LmV2ZW50LG8uRG9tRXZlbnQuX2lzRXh0ZXJuYWxUYXJnZXQoZSxpKSYmbChpKX0sZS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiPT09aT9cIm1vdXNlb3ZlclwiOlwibW91c2VvdXRcIixoLCExKSk6KFwiY2xpY2tcIj09PWkmJm8uQnJvd3Nlci5hbmRyb2lkJiYoaD1mdW5jdGlvbih0KXtyZXR1cm4gby5Eb21FdmVudC5fZmlsdGVyQ2xpY2sodCxsKX0pLGUuYWRkRXZlbnRMaXN0ZW5lcihpLGgsITEpKTpcImF0dGFjaEV2ZW50XCJpbiBlJiZlLmF0dGFjaEV2ZW50KFwib25cIitpLGgpOnRoaXMuYWRkRG91YmxlVGFwTGlzdGVuZXIoZSxoLGEpLGVbcl09ZVtyXXx8e30sZVtyXVthXT1oLHRoaXN9LF9vZmY6ZnVuY3Rpb24odCxlLGksbil7dmFyIHM9ZStvLnN0YW1wKGkpKyhuP1wiX1wiK28uc3RhbXAobik6XCJcIiksYT10W3JdJiZ0W3JdW3NdO3JldHVybiBhPyhvLkJyb3dzZXIucG9pbnRlciYmMD09PWUuaW5kZXhPZihcInRvdWNoXCIpP3RoaXMucmVtb3ZlUG9pbnRlckxpc3RlbmVyKHQsZSxzKTpvLkJyb3dzZXIudG91Y2gmJlwiZGJsY2xpY2tcIj09PWUmJnRoaXMucmVtb3ZlRG91YmxlVGFwTGlzdGVuZXI/dGhpcy5yZW1vdmVEb3VibGVUYXBMaXN0ZW5lcih0LHMpOlwicmVtb3ZlRXZlbnRMaXN0ZW5lclwiaW4gdD9cIm1vdXNld2hlZWxcIj09PWU/dC5yZW1vdmVFdmVudExpc3RlbmVyKFwib253aGVlbFwiaW4gdD9cIndoZWVsXCI6XCJtb3VzZXdoZWVsXCIsYSwhMSk6dC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiPT09ZT9cIm1vdXNlb3ZlclwiOlwibW91c2VsZWF2ZVwiPT09ZT9cIm1vdXNlb3V0XCI6ZSxhLCExKTpcImRldGFjaEV2ZW50XCJpbiB0JiZ0LmRldGFjaEV2ZW50KFwib25cIitlLGEpLHRbcl1bc109bnVsbCx0aGlzKTp0aGlzfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24odCl7cmV0dXJuIHQuc3RvcFByb3BhZ2F0aW9uP3Quc3RvcFByb3BhZ2F0aW9uKCk6dC5vcmlnaW5hbEV2ZW50P3Qub3JpZ2luYWxFdmVudC5fc3RvcHBlZD0hMDp0LmNhbmNlbEJ1YmJsZT0hMCxvLkRvbUV2ZW50Ll9za2lwcGVkKHQpLHRoaXN9LGRpc2FibGVTY3JvbGxQcm9wYWdhdGlvbjpmdW5jdGlvbih0KXtyZXR1cm4gby5Eb21FdmVudC5vbih0LFwibW91c2V3aGVlbFwiLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKX0sZGlzYWJsZUNsaWNrUHJvcGFnYXRpb246ZnVuY3Rpb24odCl7dmFyIGU9by5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb247cmV0dXJuIG8uRG9tRXZlbnQub24odCxvLkRyYWdnYWJsZS5TVEFSVC5qb2luKFwiIFwiKSxlKSxvLkRvbUV2ZW50Lm9uKHQse2NsaWNrOm8uRG9tRXZlbnQuX2Zha2VTdG9wLGRibGNsaWNrOmV9KX0scHJldmVudERlZmF1bHQ6ZnVuY3Rpb24odCl7cmV0dXJuIHQucHJldmVudERlZmF1bHQ/dC5wcmV2ZW50RGVmYXVsdCgpOnQucmV0dXJuVmFsdWU9ITEsdGhpc30sc3RvcDpmdW5jdGlvbih0KXtyZXR1cm4gby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KS5zdG9wUHJvcGFnYXRpb24odCl9LGdldE1vdXNlUG9zaXRpb246ZnVuY3Rpb24odCxlKXtpZighZSlyZXR1cm4gbmV3IG8uUG9pbnQodC5jbGllbnRYLHQuY2xpZW50WSk7dmFyIGk9ZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtyZXR1cm4gbmV3IG8uUG9pbnQodC5jbGllbnRYLWkubGVmdC1lLmNsaWVudExlZnQsdC5jbGllbnRZLWkudG9wLWUuY2xpZW50VG9wKX0sX3doZWVsUHhGYWN0b3I6by5Ccm93c2VyLndpbiYmby5Ccm93c2VyLmNocm9tZT8yOm8uQnJvd3Nlci5nZWNrbz90LmRldmljZVBpeGVsUmF0aW86MSxnZXRXaGVlbERlbHRhOmZ1bmN0aW9uKHQpe3JldHVybiBvLkJyb3dzZXIuZWRnZT90LndoZWVsRGVsdGFZLzI6dC5kZWx0YVkmJjA9PT10LmRlbHRhTW9kZT8tdC5kZWx0YVkvby5Eb21FdmVudC5fd2hlZWxQeEZhY3Rvcjp0LmRlbHRhWSYmMT09PXQuZGVsdGFNb2RlPzIwKi10LmRlbHRhWTp0LmRlbHRhWSYmMj09PXQuZGVsdGFNb2RlPzYwKi10LmRlbHRhWTp0LmRlbHRhWHx8dC5kZWx0YVo/MDp0LndoZWVsRGVsdGE/KHQud2hlZWxEZWx0YVl8fHQud2hlZWxEZWx0YSkvMjp0LmRldGFpbCYmTWF0aC5hYnModC5kZXRhaWwpPDMyNzY1PzIwKi10LmRldGFpbDp0LmRldGFpbD90LmRldGFpbC8tMzI3NjUqNjA6MH0sX3NraXBFdmVudHM6e30sX2Zha2VTdG9wOmZ1bmN0aW9uKHQpe28uRG9tRXZlbnQuX3NraXBFdmVudHNbdC50eXBlXT0hMH0sX3NraXBwZWQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fc2tpcEV2ZW50c1t0LnR5cGVdO3JldHVybiB0aGlzLl9za2lwRXZlbnRzW3QudHlwZV09ITEsZX0sX2lzRXh0ZXJuYWxUYXJnZXQ6ZnVuY3Rpb24odCxlKXt2YXIgaT1lLnJlbGF0ZWRUYXJnZXQ7aWYoIWkpcmV0dXJuITA7dHJ5e2Zvcig7aSYmaSE9PXQ7KWk9aS5wYXJlbnROb2RlfWNhdGNoKHQpe3JldHVybiExfXJldHVybiBpIT09dH0sX2ZpbHRlckNsaWNrOmZ1bmN0aW9uKHQsZSl7dmFyIGk9dC50aW1lU3RhbXB8fHQub3JpZ2luYWxFdmVudCYmdC5vcmlnaW5hbEV2ZW50LnRpbWVTdGFtcCxuPW8uRG9tRXZlbnQuX2xhc3RDbGljayYmaS1vLkRvbUV2ZW50Ll9sYXN0Q2xpY2s7cmV0dXJuIG4mJm4+MTAwJiZuPDUwMHx8dC50YXJnZXQuX3NpbXVsYXRlZENsaWNrJiYhdC5fc2ltdWxhdGVkP3ZvaWQgby5Eb21FdmVudC5zdG9wKHQpOihvLkRvbUV2ZW50Ll9sYXN0Q2xpY2s9aSx2b2lkIGUodCkpfX0sby5Eb21FdmVudC5hZGRMaXN0ZW5lcj1vLkRvbUV2ZW50Lm9uLG8uRG9tRXZlbnQucmVtb3ZlTGlzdGVuZXI9by5Eb21FdmVudC5vZmYsby5Qb3NBbmltYXRpb249by5FdmVudGVkLmV4dGVuZCh7cnVuOmZ1bmN0aW9uKHQsZSxpLG4pe3RoaXMuc3RvcCgpLHRoaXMuX2VsPXQsdGhpcy5faW5Qcm9ncmVzcz0hMCx0aGlzLl9kdXJhdGlvbj1pfHwuMjUsdGhpcy5fZWFzZU91dFBvd2VyPTEvTWF0aC5tYXgobnx8LjUsLjIpLHRoaXMuX3N0YXJ0UG9zPW8uRG9tVXRpbC5nZXRQb3NpdGlvbih0KSx0aGlzLl9vZmZzZXQ9ZS5zdWJ0cmFjdCh0aGlzLl9zdGFydFBvcyksdGhpcy5fc3RhcnRUaW1lPStuZXcgRGF0ZSx0aGlzLmZpcmUoXCJzdGFydFwiKSx0aGlzLl9hbmltYXRlKCl9LHN0b3A6ZnVuY3Rpb24oKXt0aGlzLl9pblByb2dyZXNzJiYodGhpcy5fc3RlcCghMCksdGhpcy5fY29tcGxldGUoKSl9LF9hbmltYXRlOmZ1bmN0aW9uKCl7dGhpcy5fYW5pbUlkPW8uVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKHRoaXMuX2FuaW1hdGUsdGhpcyksdGhpcy5fc3RlcCgpfSxfc3RlcDpmdW5jdGlvbih0KXt2YXIgZT0rbmV3IERhdGUtdGhpcy5fc3RhcnRUaW1lLGk9MWUzKnRoaXMuX2R1cmF0aW9uO2U8aT90aGlzLl9ydW5GcmFtZSh0aGlzLl9lYXNlT3V0KGUvaSksdCk6KHRoaXMuX3J1bkZyYW1lKDEpLHRoaXMuX2NvbXBsZXRlKCkpfSxfcnVuRnJhbWU6ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9zdGFydFBvcy5hZGQodGhpcy5fb2Zmc2V0Lm11bHRpcGx5QnkodCkpO2UmJmkuX3JvdW5kKCksby5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX2VsLGkpLHRoaXMuZmlyZShcInN0ZXBcIil9LF9jb21wbGV0ZTpmdW5jdGlvbigpe28uVXRpbC5jYW5jZWxBbmltRnJhbWUodGhpcy5fYW5pbUlkKSx0aGlzLl9pblByb2dyZXNzPSExLHRoaXMuZmlyZShcImVuZFwiKX0sX2Vhc2VPdXQ6ZnVuY3Rpb24odCl7cmV0dXJuIDEtTWF0aC5wb3coMS10LHRoaXMuX2Vhc2VPdXRQb3dlcil9fSksby5Qcm9qZWN0aW9uLk1lcmNhdG9yPXtSOjYzNzgxMzcsUl9NSU5PUjo2MzU2NzUyLjMxNDI0NTE3OSxib3VuZHM6by5ib3VuZHMoWy0yMDAzNzUwOC4zNDI3OSwtMTU0OTY1NzAuNzM5NzJdLFsyMDAzNzUwOC4zNDI3OSwxODc2NDY1Ni4yMzEzOF0pLHByb2plY3Q6ZnVuY3Rpb24odCl7dmFyIGU9TWF0aC5QSS8xODAsaT10aGlzLlIsbj10LmxhdCplLHM9dGhpcy5SX01JTk9SL2kscj1NYXRoLnNxcnQoMS1zKnMpLGE9cipNYXRoLnNpbihuKSxoPU1hdGgudGFuKE1hdGguUEkvNC1uLzIpL01hdGgucG93KCgxLWEpLygxK2EpLHIvMik7cmV0dXJuIG49LWkqTWF0aC5sb2coTWF0aC5tYXgoaCwxZS0xMCkpLG5ldyBvLlBvaW50KHQubG5nKmUqaSxuKX0sdW5wcm9qZWN0OmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSxpPTE4MC9NYXRoLlBJLG49dGhpcy5SLHM9dGhpcy5SX01JTk9SL24scj1NYXRoLnNxcnQoMS1zKnMpLGE9TWF0aC5leHAoLXQueS9uKSxoPU1hdGguUEkvMi0yKk1hdGguYXRhbihhKSxsPTAsdT0uMTtsPDE1JiZNYXRoLmFicyh1KT4xZS03O2wrKyllPXIqTWF0aC5zaW4oaCksZT1NYXRoLnBvdygoMS1lKS8oMStlKSxyLzIpLHU9TWF0aC5QSS8yLTIqTWF0aC5hdGFuKGEqZSktaCxoKz11O3JldHVybiBuZXcgby5MYXRMbmcoaCppLHQueCppL24pfX0sby5DUlMuRVBTRzMzOTU9by5leHRlbmQoe30sby5DUlMuRWFydGgse2NvZGU6XCJFUFNHOjMzOTVcIixwcm9qZWN0aW9uOm8uUHJvamVjdGlvbi5NZXJjYXRvcix0cmFuc2Zvcm1hdGlvbjpmdW5jdGlvbigpe3ZhciB0PS41LyhNYXRoLlBJKm8uUHJvamVjdGlvbi5NZXJjYXRvci5SKTtyZXR1cm4gbmV3IG8uVHJhbnNmb3JtYXRpb24odCwuNSwtdCwuNSl9KCl9KSxvLkdyaWRMYXllcj1vLkxheWVyLmV4dGVuZCh7b3B0aW9uczp7dGlsZVNpemU6MjU2LG9wYWNpdHk6MSx1cGRhdGVXaGVuSWRsZTpvLkJyb3dzZXIubW9iaWxlLHVwZGF0ZVdoZW5ab29taW5nOiEwLHVwZGF0ZUludGVydmFsOjIwMCx6SW5kZXg6MSxib3VuZHM6bnVsbCxtaW5ab29tOjAsbWF4Wm9vbTppLG5vV3JhcDohMSxwYW5lOlwidGlsZVBhbmVcIixjbGFzc05hbWU6XCJcIixrZWVwQnVmZmVyOjJ9LGluaXRpYWxpemU6ZnVuY3Rpb24odCl7by5zZXRPcHRpb25zKHRoaXMsdCl9LG9uQWRkOmZ1bmN0aW9uKCl7dGhpcy5faW5pdENvbnRhaW5lcigpLHRoaXMuX2xldmVscz17fSx0aGlzLl90aWxlcz17fSx0aGlzLl9yZXNldFZpZXcoKSx0aGlzLl91cGRhdGUoKX0sYmVmb3JlQWRkOmZ1bmN0aW9uKHQpe3QuX2FkZFpvb21MaW1pdCh0aGlzKX0sb25SZW1vdmU6ZnVuY3Rpb24odCl7dGhpcy5fcmVtb3ZlQWxsVGlsZXMoKSxvLkRvbVV0aWwucmVtb3ZlKHRoaXMuX2NvbnRhaW5lciksdC5fcmVtb3ZlWm9vbUxpbWl0KHRoaXMpLHRoaXMuX2NvbnRhaW5lcj1udWxsLHRoaXMuX3RpbGVab29tPW51bGx9LGJyaW5nVG9Gcm9udDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXAmJihvLkRvbVV0aWwudG9Gcm9udCh0aGlzLl9jb250YWluZXIpLHRoaXMuX3NldEF1dG9aSW5kZXgoTWF0aC5tYXgpKSx0aGlzfSxicmluZ1RvQmFjazpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tYXAmJihvLkRvbVV0aWwudG9CYWNrKHRoaXMuX2NvbnRhaW5lciksdGhpcy5fc2V0QXV0b1pJbmRleChNYXRoLm1pbikpLHRoaXN9LGdldENvbnRhaW5lcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jb250YWluZXJ9LHNldE9wYWNpdHk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3B0aW9ucy5vcGFjaXR5PXQsdGhpcy5fdXBkYXRlT3BhY2l0eSgpLHRoaXN9LHNldFpJbmRleDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLnpJbmRleD10LHRoaXMuX3VwZGF0ZVpJbmRleCgpLHRoaXN9LGlzTG9hZGluZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9sb2FkaW5nfSxyZWRyYXc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbWFwJiYodGhpcy5fcmVtb3ZlQWxsVGlsZXMoKSx0aGlzLl91cGRhdGUoKSksdGhpc30sZ2V0RXZlbnRzOmZ1bmN0aW9uKCl7dmFyIHQ9e3ZpZXdwcmVyZXNldDp0aGlzLl9pbnZhbGlkYXRlQWxsLHZpZXdyZXNldDp0aGlzLl9yZXNldFZpZXcsem9vbTp0aGlzLl9yZXNldFZpZXcsbW92ZWVuZDp0aGlzLl9vbk1vdmVFbmR9O3JldHVybiB0aGlzLm9wdGlvbnMudXBkYXRlV2hlbklkbGV8fCh0aGlzLl9vbk1vdmV8fCh0aGlzLl9vbk1vdmU9by5VdGlsLnRocm90dGxlKHRoaXMuX29uTW92ZUVuZCx0aGlzLm9wdGlvbnMudXBkYXRlSW50ZXJ2YWwsdGhpcykpLHQubW92ZT10aGlzLl9vbk1vdmUpLHRoaXMuX3pvb21BbmltYXRlZCYmKHQuem9vbWFuaW09dGhpcy5fYW5pbWF0ZVpvb20pLHR9LGNyZWF0ZVRpbGU6ZnVuY3Rpb24oKXtyZXR1cm4gZS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpfSxnZXRUaWxlU2l6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMub3B0aW9ucy50aWxlU2l6ZTtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uUG9pbnQ/dDpuZXcgby5Qb2ludCh0LHQpfSxfdXBkYXRlWkluZGV4OmZ1bmN0aW9uKCl7dGhpcy5fY29udGFpbmVyJiZ0aGlzLm9wdGlvbnMuekluZGV4IT09aSYmbnVsbCE9PXRoaXMub3B0aW9ucy56SW5kZXgmJih0aGlzLl9jb250YWluZXIuc3R5bGUuekluZGV4PXRoaXMub3B0aW9ucy56SW5kZXgpfSxfc2V0QXV0b1pJbmRleDpmdW5jdGlvbih0KXtmb3IodmFyIGUsaT10aGlzLmdldFBhbmUoKS5jaGlsZHJlbixuPS10KC0oMS8wKSwxLzApLG89MCxzPWkubGVuZ3RoO288cztvKyspZT1pW29dLnN0eWxlLnpJbmRleCxpW29dIT09dGhpcy5fY29udGFpbmVyJiZlJiYobj10KG4sK2UpKTtpc0Zpbml0ZShuKSYmKHRoaXMub3B0aW9ucy56SW5kZXg9bit0KC0xLDEpLHRoaXMuX3VwZGF0ZVpJbmRleCgpKX0sX3VwZGF0ZU9wYWNpdHk6ZnVuY3Rpb24oKXtpZih0aGlzLl9tYXAmJiFvLkJyb3dzZXIuaWVsdDkpe28uRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2NvbnRhaW5lcix0aGlzLm9wdGlvbnMub3BhY2l0eSk7dmFyIHQ9K25ldyBEYXRlLGU9ITEsaT0hMTtmb3IodmFyIG4gaW4gdGhpcy5fdGlsZXMpe3ZhciBzPXRoaXMuX3RpbGVzW25dO2lmKHMuY3VycmVudCYmcy5sb2FkZWQpe3ZhciByPU1hdGgubWluKDEsKHQtcy5sb2FkZWQpLzIwMCk7by5Eb21VdGlsLnNldE9wYWNpdHkocy5lbCxyKSxyPDE/ZT0hMDoocy5hY3RpdmUmJihpPSEwKSxzLmFjdGl2ZT0hMCl9fWkmJiF0aGlzLl9ub1BydW5lJiZ0aGlzLl9wcnVuZVRpbGVzKCksZSYmKG8uVXRpbC5jYW5jZWxBbmltRnJhbWUodGhpcy5fZmFkZUZyYW1lKSx0aGlzLl9mYWRlRnJhbWU9by5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fdXBkYXRlT3BhY2l0eSx0aGlzKSl9fSxfaW5pdENvbnRhaW5lcjpmdW5jdGlvbigpe3RoaXMuX2NvbnRhaW5lcnx8KHRoaXMuX2NvbnRhaW5lcj1vLkRvbVV0aWwuY3JlYXRlKFwiZGl2XCIsXCJsZWFmbGV0LWxheWVyIFwiKyh0aGlzLm9wdGlvbnMuY2xhc3NOYW1lfHxcIlwiKSksdGhpcy5fdXBkYXRlWkluZGV4KCksdGhpcy5vcHRpb25zLm9wYWNpdHk8MSYmdGhpcy5fdXBkYXRlT3BhY2l0eSgpLHRoaXMuZ2V0UGFuZSgpLmFwcGVuZENoaWxkKHRoaXMuX2NvbnRhaW5lcikpfSxfdXBkYXRlTGV2ZWxzOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fdGlsZVpvb20sZT10aGlzLm9wdGlvbnMubWF4Wm9vbTtpZih0PT09aSlyZXR1cm4gaTtmb3IodmFyIG4gaW4gdGhpcy5fbGV2ZWxzKXRoaXMuX2xldmVsc1tuXS5lbC5jaGlsZHJlbi5sZW5ndGh8fG49PT10P3RoaXMuX2xldmVsc1tuXS5lbC5zdHlsZS56SW5kZXg9ZS1NYXRoLmFicyh0LW4pOihvLkRvbVV0aWwucmVtb3ZlKHRoaXMuX2xldmVsc1tuXS5lbCksdGhpcy5fcmVtb3ZlVGlsZXNBdFpvb20obiksZGVsZXRlIHRoaXMuX2xldmVsc1tuXSk7dmFyIHM9dGhpcy5fbGV2ZWxzW3RdLHI9dGhpcy5fbWFwO3JldHVybiBzfHwocz10aGlzLl9sZXZlbHNbdF09e30scy5lbD1vLkRvbVV0aWwuY3JlYXRlKFwiZGl2XCIsXCJsZWFmbGV0LXRpbGUtY29udGFpbmVyIGxlYWZsZXQtem9vbS1hbmltYXRlZFwiLHRoaXMuX2NvbnRhaW5lcikscy5lbC5zdHlsZS56SW5kZXg9ZSxzLm9yaWdpbj1yLnByb2plY3Qoci51bnByb2plY3Qoci5nZXRQaXhlbE9yaWdpbigpKSx0KS5yb3VuZCgpLHMuem9vbT10LHRoaXMuX3NldFpvb21UcmFuc2Zvcm0ocyxyLmdldENlbnRlcigpLHIuZ2V0Wm9vbSgpKSxvLlV0aWwuZmFsc2VGbihzLmVsLm9mZnNldFdpZHRoKSksdGhpcy5fbGV2ZWw9cyxzfSxfcHJ1bmVUaWxlczpmdW5jdGlvbigpe2lmKHRoaXMuX21hcCl7dmFyIHQsZSxpPXRoaXMuX21hcC5nZXRab29tKCk7aWYoaT50aGlzLm9wdGlvbnMubWF4Wm9vbXx8aTx0aGlzLm9wdGlvbnMubWluWm9vbSlyZXR1cm4gdm9pZCB0aGlzLl9yZW1vdmVBbGxUaWxlcygpO2Zvcih0IGluIHRoaXMuX3RpbGVzKWU9dGhpcy5fdGlsZXNbdF0sZS5yZXRhaW49ZS5jdXJyZW50O2Zvcih0IGluIHRoaXMuX3RpbGVzKWlmKGU9dGhpcy5fdGlsZXNbdF0sZS5jdXJyZW50JiYhZS5hY3RpdmUpe3ZhciBuPWUuY29vcmRzO3RoaXMuX3JldGFpblBhcmVudChuLngsbi55LG4ueixuLnotNSl8fHRoaXMuX3JldGFpbkNoaWxkcmVuKG4ueCxuLnksbi56LG4ueisyKX1mb3IodCBpbiB0aGlzLl90aWxlcyl0aGlzLl90aWxlc1t0XS5yZXRhaW58fHRoaXMuX3JlbW92ZVRpbGUodCl9fSxfcmVtb3ZlVGlsZXNBdFpvb206ZnVuY3Rpb24odCl7Zm9yKHZhciBlIGluIHRoaXMuX3RpbGVzKXRoaXMuX3RpbGVzW2VdLmNvb3Jkcy56PT09dCYmdGhpcy5fcmVtb3ZlVGlsZShlKX0sX3JlbW92ZUFsbFRpbGVzOmZ1bmN0aW9uKCl7Zm9yKHZhciB0IGluIHRoaXMuX3RpbGVzKXRoaXMuX3JlbW92ZVRpbGUodCl9LF9pbnZhbGlkYXRlQWxsOmZ1bmN0aW9uKCl7Zm9yKHZhciB0IGluIHRoaXMuX2xldmVscylvLkRvbVV0aWwucmVtb3ZlKHRoaXMuX2xldmVsc1t0XS5lbCksZGVsZXRlIHRoaXMuX2xldmVsc1t0XTt0aGlzLl9yZW1vdmVBbGxUaWxlcygpLHRoaXMuX3RpbGVab29tPW51bGx9LF9yZXRhaW5QYXJlbnQ6ZnVuY3Rpb24odCxlLGksbil7dmFyIHM9TWF0aC5mbG9vcih0LzIpLHI9TWF0aC5mbG9vcihlLzIpLGE9aS0xLGg9bmV3IG8uUG9pbnQoK3MsK3IpO2guej0rYTt2YXIgbD10aGlzLl90aWxlQ29vcmRzVG9LZXkoaCksdT10aGlzLl90aWxlc1tsXTtyZXR1cm4gdSYmdS5hY3RpdmU/KHUucmV0YWluPSEwLCEwKToodSYmdS5sb2FkZWQmJih1LnJldGFpbj0hMCksYT5uJiZ0aGlzLl9yZXRhaW5QYXJlbnQocyxyLGEsbikpfSxfcmV0YWluQ2hpbGRyZW46ZnVuY3Rpb24odCxlLGksbil7Zm9yKHZhciBzPTIqdDtzPDIqdCsyO3MrKylmb3IodmFyIHI9MiplO3I8MiplKzI7cisrKXt2YXIgYT1uZXcgby5Qb2ludChzLHIpO2Euej1pKzE7dmFyIGg9dGhpcy5fdGlsZUNvb3Jkc1RvS2V5KGEpLGw9dGhpcy5fdGlsZXNbaF07bCYmbC5hY3RpdmU/bC5yZXRhaW49ITA6KGwmJmwubG9hZGVkJiYobC5yZXRhaW49ITApLGkrMTxuJiZ0aGlzLl9yZXRhaW5DaGlsZHJlbihzLHIsaSsxLG4pKX19LF9yZXNldFZpZXc6ZnVuY3Rpb24odCl7dmFyIGU9dCYmKHQucGluY2h8fHQuZmx5VG8pO3RoaXMuX3NldFZpZXcodGhpcy5fbWFwLmdldENlbnRlcigpLHRoaXMuX21hcC5nZXRab29tKCksZSxlKX0sX2FuaW1hdGVab29tOmZ1bmN0aW9uKHQpe3RoaXMuX3NldFZpZXcodC5jZW50ZXIsdC56b29tLCEwLHQubm9VcGRhdGUpfSxfc2V0VmlldzpmdW5jdGlvbih0LGUsbixvKXt2YXIgcz1NYXRoLnJvdW5kKGUpOyh0aGlzLm9wdGlvbnMubWF4Wm9vbSE9PWkmJnM+dGhpcy5vcHRpb25zLm1heFpvb218fHRoaXMub3B0aW9ucy5taW5ab29tIT09aSYmczx0aGlzLm9wdGlvbnMubWluWm9vbSkmJihzPWkpO3ZhciByPXRoaXMub3B0aW9ucy51cGRhdGVXaGVuWm9vbWluZyYmcyE9PXRoaXMuX3RpbGVab29tO28mJiFyfHwodGhpcy5fdGlsZVpvb209cyx0aGlzLl9hYm9ydExvYWRpbmcmJnRoaXMuX2Fib3J0TG9hZGluZygpLHRoaXMuX3VwZGF0ZUxldmVscygpLHRoaXMuX3Jlc2V0R3JpZCgpLHMhPT1pJiZ0aGlzLl91cGRhdGUodCksbnx8dGhpcy5fcHJ1bmVUaWxlcygpLHRoaXMuX25vUHJ1bmU9ISFuKSx0aGlzLl9zZXRab29tVHJhbnNmb3Jtcyh0LGUpfSxfc2V0Wm9vbVRyYW5zZm9ybXM6ZnVuY3Rpb24odCxlKXtmb3IodmFyIGkgaW4gdGhpcy5fbGV2ZWxzKXRoaXMuX3NldFpvb21UcmFuc2Zvcm0odGhpcy5fbGV2ZWxzW2ldLHQsZSl9LF9zZXRab29tVHJhbnNmb3JtOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbj10aGlzLl9tYXAuZ2V0Wm9vbVNjYWxlKGksdC56b29tKSxzPXQub3JpZ2luLm11bHRpcGx5Qnkobikuc3VidHJhY3QodGhpcy5fbWFwLl9nZXROZXdQaXhlbE9yaWdpbihlLGkpKS5yb3VuZCgpO28uQnJvd3Nlci5hbnkzZD9vLkRvbVV0aWwuc2V0VHJhbnNmb3JtKHQuZWwscyxuKTpvLkRvbVV0aWwuc2V0UG9zaXRpb24odC5lbCxzKX0sX3Jlc2V0R3JpZDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPXQub3B0aW9ucy5jcnMsaT10aGlzLl90aWxlU2l6ZT10aGlzLmdldFRpbGVTaXplKCksbj10aGlzLl90aWxlWm9vbSxvPXRoaXMuX21hcC5nZXRQaXhlbFdvcmxkQm91bmRzKHRoaXMuX3RpbGVab29tKTtvJiYodGhpcy5fZ2xvYmFsVGlsZVJhbmdlPXRoaXMuX3B4Qm91bmRzVG9UaWxlUmFuZ2UobykpLHRoaXMuX3dyYXBYPWUud3JhcExuZyYmIXRoaXMub3B0aW9ucy5ub1dyYXAmJltNYXRoLmZsb29yKHQucHJvamVjdChbMCxlLndyYXBMbmdbMF1dLG4pLngvaS54KSxNYXRoLmNlaWwodC5wcm9qZWN0KFswLGUud3JhcExuZ1sxXV0sbikueC9pLnkpXSx0aGlzLl93cmFwWT1lLndyYXBMYXQmJiF0aGlzLm9wdGlvbnMubm9XcmFwJiZbTWF0aC5mbG9vcih0LnByb2plY3QoW2Uud3JhcExhdFswXSwwXSxuKS55L2kueCksTWF0aC5jZWlsKHQucHJvamVjdChbZS53cmFwTGF0WzFdLDBdLG4pLnkvaS55KV19LF9vbk1vdmVFbmQ6ZnVuY3Rpb24oKXt0aGlzLl9tYXAmJiF0aGlzLl9tYXAuX2FuaW1hdGluZ1pvb20mJnRoaXMuX3VwZGF0ZSgpfSxfZ2V0VGlsZWRQaXhlbEJvdW5kczpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAsaT1lLl9hbmltYXRpbmdab29tP01hdGgubWF4KGUuX2FuaW1hdGVUb1pvb20sZS5nZXRab29tKCkpOmUuZ2V0Wm9vbSgpLG49ZS5nZXRab29tU2NhbGUoaSx0aGlzLl90aWxlWm9vbSkscz1lLnByb2plY3QodCx0aGlzLl90aWxlWm9vbSkuZmxvb3IoKSxyPWUuZ2V0U2l6ZSgpLmRpdmlkZUJ5KDIqbik7cmV0dXJuIG5ldyBvLkJvdW5kcyhzLnN1YnRyYWN0KHIpLHMuYWRkKHIpKX0sX3VwZGF0ZTpmdW5jdGlvbih0KXt2YXIgbj10aGlzLl9tYXA7aWYobil7dmFyIHM9bi5nZXRab29tKCk7aWYodD09PWkmJih0PW4uZ2V0Q2VudGVyKCkpLHRoaXMuX3RpbGVab29tIT09aSl7dmFyIHI9dGhpcy5fZ2V0VGlsZWRQaXhlbEJvdW5kcyh0KSxhPXRoaXMuX3B4Qm91bmRzVG9UaWxlUmFuZ2UociksaD1hLmdldENlbnRlcigpLGw9W10sdT10aGlzLm9wdGlvbnMua2VlcEJ1ZmZlcixjPW5ldyBvLkJvdW5kcyhhLmdldEJvdHRvbUxlZnQoKS5zdWJ0cmFjdChbdSwtdV0pLGEuZ2V0VG9wUmlnaHQoKS5hZGQoW3UsLXVdKSk7Zm9yKHZhciBkIGluIHRoaXMuX3RpbGVzKXt2YXIgXz10aGlzLl90aWxlc1tkXS5jb29yZHM7Xy56PT09dGhpcy5fdGlsZVpvb20mJmMuY29udGFpbnMoby5wb2ludChfLngsXy55KSl8fCh0aGlzLl90aWxlc1tkXS5jdXJyZW50PSExKX1pZihNYXRoLmFicyhzLXRoaXMuX3RpbGVab29tKT4xKXJldHVybiB2b2lkIHRoaXMuX3NldFZpZXcodCxzKTtmb3IodmFyIG09YS5taW4ueTttPD1hLm1heC55O20rKylmb3IodmFyIHA9YS5taW4ueDtwPD1hLm1heC54O3ArKyl7dmFyIGY9bmV3IG8uUG9pbnQocCxtKTtpZihmLno9dGhpcy5fdGlsZVpvb20sdGhpcy5faXNWYWxpZFRpbGUoZikpe3ZhciBnPXRoaXMuX3RpbGVzW3RoaXMuX3RpbGVDb29yZHNUb0tleShmKV07Zz9nLmN1cnJlbnQ9ITA6bC5wdXNoKGYpfX1pZihsLnNvcnQoZnVuY3Rpb24odCxlKXtyZXR1cm4gdC5kaXN0YW5jZVRvKGgpLWUuZGlzdGFuY2VUbyhoKX0pLDAhPT1sLmxlbmd0aCl7dGhpcy5fbG9hZGluZ3x8KHRoaXMuX2xvYWRpbmc9ITAsdGhpcy5maXJlKFwibG9hZGluZ1wiKSk7dmFyIHY9ZS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7Zm9yKHA9MDtwPGwubGVuZ3RoO3ArKyl0aGlzLl9hZGRUaWxlKGxbcF0sdik7dGhpcy5fbGV2ZWwuZWwuYXBwZW5kQ2hpbGQodil9fX19LF9pc1ZhbGlkVGlsZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAub3B0aW9ucy5jcnM7aWYoIWUuaW5maW5pdGUpe3ZhciBpPXRoaXMuX2dsb2JhbFRpbGVSYW5nZTtpZighZS53cmFwTG5nJiYodC54PGkubWluLnh8fHQueD5pLm1heC54KXx8IWUud3JhcExhdCYmKHQueTxpLm1pbi55fHx0Lnk+aS5tYXgueSkpcmV0dXJuITF9aWYoIXRoaXMub3B0aW9ucy5ib3VuZHMpcmV0dXJuITA7dmFyIG49dGhpcy5fdGlsZUNvb3Jkc1RvQm91bmRzKHQpO3JldHVybiBvLmxhdExuZ0JvdW5kcyh0aGlzLm9wdGlvbnMuYm91bmRzKS5vdmVybGFwcyhuKX0sX2tleVRvQm91bmRzOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl90aWxlQ29vcmRzVG9Cb3VuZHModGhpcy5fa2V5VG9UaWxlQ29vcmRzKHQpKX0sX3RpbGVDb29yZHNUb0JvdW5kczpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAsaT10aGlzLmdldFRpbGVTaXplKCksbj10LnNjYWxlQnkoaSkscz1uLmFkZChpKSxyPWUudW5wcm9qZWN0KG4sdC56KSxhPWUudW5wcm9qZWN0KHMsdC56KSxoPW5ldyBvLkxhdExuZ0JvdW5kcyhyLGEpO3JldHVybiB0aGlzLm9wdGlvbnMubm9XcmFwfHxlLndyYXBMYXRMbmdCb3VuZHMoaCksaH0sX3RpbGVDb29yZHNUb0tleTpmdW5jdGlvbih0KXtyZXR1cm4gdC54K1wiOlwiK3QueStcIjpcIit0Lnp9LF9rZXlUb1RpbGVDb29yZHM6ZnVuY3Rpb24odCl7dmFyIGU9dC5zcGxpdChcIjpcIiksaT1uZXcgby5Qb2ludCgrZVswXSwrZVsxXSk7cmV0dXJuIGkuej0rZVsyXSxpfSxfcmVtb3ZlVGlsZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl90aWxlc1t0XTtlJiYoby5Eb21VdGlsLnJlbW92ZShlLmVsKSxkZWxldGUgdGhpcy5fdGlsZXNbdF0sdGhpcy5maXJlKFwidGlsZXVubG9hZFwiLHt0aWxlOmUuZWwsY29vcmRzOnRoaXMuX2tleVRvVGlsZUNvb3Jkcyh0KX0pKX0sX2luaXRUaWxlOmZ1bmN0aW9uKHQpe28uRG9tVXRpbC5hZGRDbGFzcyh0LFwibGVhZmxldC10aWxlXCIpO3ZhciBlPXRoaXMuZ2V0VGlsZVNpemUoKTt0LnN0eWxlLndpZHRoPWUueCtcInB4XCIsdC5zdHlsZS5oZWlnaHQ9ZS55K1wicHhcIix0Lm9uc2VsZWN0c3RhcnQ9by5VdGlsLmZhbHNlRm4sdC5vbm1vdXNlbW92ZT1vLlV0aWwuZmFsc2VGbixvLkJyb3dzZXIuaWVsdDkmJnRoaXMub3B0aW9ucy5vcGFjaXR5PDEmJm8uRG9tVXRpbC5zZXRPcGFjaXR5KHQsdGhpcy5vcHRpb25zLm9wYWNpdHkpLG8uQnJvd3Nlci5hbmRyb2lkJiYhby5Ccm93c2VyLmFuZHJvaWQyMyYmKHQuc3R5bGUuV2Via2l0QmFja2ZhY2VWaXNpYmlsaXR5PVwiaGlkZGVuXCIpfSxfYWRkVGlsZTpmdW5jdGlvbih0LGUpe3ZhciBpPXRoaXMuX2dldFRpbGVQb3ModCksbj10aGlzLl90aWxlQ29vcmRzVG9LZXkodCkscz10aGlzLmNyZWF0ZVRpbGUodGhpcy5fd3JhcENvb3Jkcyh0KSxvLmJpbmQodGhpcy5fdGlsZVJlYWR5LHRoaXMsdCkpO3RoaXMuX2luaXRUaWxlKHMpLHRoaXMuY3JlYXRlVGlsZS5sZW5ndGg8MiYmby5VdGlsLnJlcXVlc3RBbmltRnJhbWUoby5iaW5kKHRoaXMuX3RpbGVSZWFkeSx0aGlzLHQsbnVsbCxzKSksby5Eb21VdGlsLnNldFBvc2l0aW9uKHMsaSksdGhpcy5fdGlsZXNbbl09e2VsOnMsY29vcmRzOnQsY3VycmVudDohMH0sZS5hcHBlbmRDaGlsZChzKSx0aGlzLmZpcmUoXCJ0aWxlbG9hZHN0YXJ0XCIse3RpbGU6cyxjb29yZHM6dH0pfSxfdGlsZVJlYWR5OmZ1bmN0aW9uKHQsZSxpKXtpZih0aGlzLl9tYXApe2UmJnRoaXMuZmlyZShcInRpbGVlcnJvclwiLHtlcnJvcjplLHRpbGU6aSxjb29yZHM6dH0pO3ZhciBuPXRoaXMuX3RpbGVDb29yZHNUb0tleSh0KTtpPXRoaXMuX3RpbGVzW25dLGkmJihpLmxvYWRlZD0rbmV3IERhdGUsdGhpcy5fbWFwLl9mYWRlQW5pbWF0ZWQ/KG8uRG9tVXRpbC5zZXRPcGFjaXR5KGkuZWwsMCksby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9mYWRlRnJhbWUpLHRoaXMuX2ZhZGVGcmFtZT1vLlV0aWwucmVxdWVzdEFuaW1GcmFtZSh0aGlzLl91cGRhdGVPcGFjaXR5LHRoaXMpKTooaS5hY3RpdmU9ITAsdGhpcy5fcHJ1bmVUaWxlcygpKSxlfHwoby5Eb21VdGlsLmFkZENsYXNzKGkuZWwsXCJsZWFmbGV0LXRpbGUtbG9hZGVkXCIpLHRoaXMuZmlyZShcInRpbGVsb2FkXCIse3RpbGU6aS5lbCxjb29yZHM6dH0pKSx0aGlzLl9ub1RpbGVzVG9Mb2FkKCkmJih0aGlzLl9sb2FkaW5nPSExLHRoaXMuZmlyZShcImxvYWRcIiksby5Ccm93c2VyLmllbHQ5fHwhdGhpcy5fbWFwLl9mYWRlQW5pbWF0ZWQ/by5VdGlsLnJlcXVlc3RBbmltRnJhbWUodGhpcy5fcHJ1bmVUaWxlcyx0aGlzKTpzZXRUaW1lb3V0KG8uYmluZCh0aGlzLl9wcnVuZVRpbGVzLHRoaXMpLDI1MCkpKX19LF9nZXRUaWxlUG9zOmZ1bmN0aW9uKHQpe3JldHVybiB0LnNjYWxlQnkodGhpcy5nZXRUaWxlU2l6ZSgpKS5zdWJ0cmFjdCh0aGlzLl9sZXZlbC5vcmlnaW4pfSxfd3JhcENvb3JkczpmdW5jdGlvbih0KXt2YXIgZT1uZXcgby5Qb2ludCh0aGlzLl93cmFwWD9vLlV0aWwud3JhcE51bSh0LngsdGhpcy5fd3JhcFgpOnQueCx0aGlzLl93cmFwWT9vLlV0aWwud3JhcE51bSh0LnksdGhpcy5fd3JhcFkpOnQueSk7cmV0dXJuIGUuej10LnosZX0sX3B4Qm91bmRzVG9UaWxlUmFuZ2U6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5nZXRUaWxlU2l6ZSgpO3JldHVybiBuZXcgby5Cb3VuZHModC5taW4udW5zY2FsZUJ5KGUpLmZsb29yKCksdC5tYXgudW5zY2FsZUJ5KGUpLmNlaWwoKS5zdWJ0cmFjdChbMSwxXSkpfSxfbm9UaWxlc1RvTG9hZDpmdW5jdGlvbigpe2Zvcih2YXIgdCBpbiB0aGlzLl90aWxlcylpZighdGhpcy5fdGlsZXNbdF0ubG9hZGVkKXJldHVybiExO3JldHVybiEwfX0pLG8uZ3JpZExheWVyPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5HcmlkTGF5ZXIodCl9LG8uVGlsZUxheWVyPW8uR3JpZExheWVyLmV4dGVuZCh7b3B0aW9uczp7bWluWm9vbTowLG1heFpvb206MTgsbWF4TmF0aXZlWm9vbTpudWxsLG1pbk5hdGl2ZVpvb206bnVsbCxzdWJkb21haW5zOlwiYWJjXCIsZXJyb3JUaWxlVXJsOlwiXCIsem9vbU9mZnNldDowLHRtczohMSx6b29tUmV2ZXJzZTohMSxkZXRlY3RSZXRpbmE6ITEsY3Jvc3NPcmlnaW46ITF9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXt0aGlzLl91cmw9dCxlPW8uc2V0T3B0aW9ucyh0aGlzLGUpLGUuZGV0ZWN0UmV0aW5hJiZvLkJyb3dzZXIucmV0aW5hJiZlLm1heFpvb20+MCYmKGUudGlsZVNpemU9TWF0aC5mbG9vcihlLnRpbGVTaXplLzIpLGUuem9vbVJldmVyc2U/KGUuem9vbU9mZnNldC0tLGUubWluWm9vbSsrKTooZS56b29tT2Zmc2V0KyssZS5tYXhab29tLS0pLGUubWluWm9vbT1NYXRoLm1heCgwLGUubWluWm9vbSkpLFwic3RyaW5nXCI9PXR5cGVvZiBlLnN1YmRvbWFpbnMmJihlLnN1YmRvbWFpbnM9ZS5zdWJkb21haW5zLnNwbGl0KFwiXCIpKSxvLkJyb3dzZXIuYW5kcm9pZHx8dGhpcy5vbihcInRpbGV1bmxvYWRcIix0aGlzLl9vblRpbGVSZW1vdmUpfSxzZXRVcmw6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5fdXJsPXQsZXx8dGhpcy5yZWRyYXcoKSx0aGlzfSxjcmVhdGVUaWxlOmZ1bmN0aW9uKHQsaSl7dmFyIG49ZS5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO3JldHVybiBvLkRvbUV2ZW50Lm9uKG4sXCJsb2FkXCIsby5iaW5kKHRoaXMuX3RpbGVPbkxvYWQsdGhpcyxpLG4pKSxvLkRvbUV2ZW50Lm9uKG4sXCJlcnJvclwiLG8uYmluZCh0aGlzLl90aWxlT25FcnJvcix0aGlzLGksbikpLHRoaXMub3B0aW9ucy5jcm9zc09yaWdpbiYmKG4uY3Jvc3NPcmlnaW49XCJcIiksbi5hbHQ9XCJcIixuLnNldEF0dHJpYnV0ZShcInJvbGVcIixcInByZXNlbnRhdGlvblwiKSxuLnNyYz10aGlzLmdldFRpbGVVcmwodCksbn0sZ2V0VGlsZVVybDpmdW5jdGlvbih0KXt2YXIgZT17cjpvLkJyb3dzZXIucmV0aW5hP1wiQDJ4XCI6XCJcIixzOnRoaXMuX2dldFN1YmRvbWFpbih0KSx4OnQueCx5OnQueSx6OnRoaXMuX2dldFpvb21Gb3JVcmwoKX07aWYodGhpcy5fbWFwJiYhdGhpcy5fbWFwLm9wdGlvbnMuY3JzLmluZmluaXRlKXt2YXIgaT10aGlzLl9nbG9iYWxUaWxlUmFuZ2UubWF4LnktdC55O3RoaXMub3B0aW9ucy50bXMmJihlLnk9aSksZVtcIi15XCJdPWl9cmV0dXJuIG8uVXRpbC50ZW1wbGF0ZSh0aGlzLl91cmwsby5leHRlbmQoZSx0aGlzLm9wdGlvbnMpKX0sX3RpbGVPbkxvYWQ6ZnVuY3Rpb24odCxlKXtvLkJyb3dzZXIuaWVsdDk/c2V0VGltZW91dChvLmJpbmQodCx0aGlzLG51bGwsZSksMCk6dChudWxsLGUpfSxfdGlsZU9uRXJyb3I6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPXRoaXMub3B0aW9ucy5lcnJvclRpbGVVcmw7biYmZS5zcmMhPT1uJiYoZS5zcmM9biksdChpLGUpfSxnZXRUaWxlU2l6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPW8uR3JpZExheWVyLnByb3RvdHlwZS5nZXRUaWxlU2l6ZS5jYWxsKHRoaXMpLGk9dGhpcy5fdGlsZVpvb20rdGhpcy5vcHRpb25zLnpvb21PZmZzZXQsbj10aGlzLm9wdGlvbnMubWluTmF0aXZlWm9vbSxzPXRoaXMub3B0aW9ucy5tYXhOYXRpdmVab29tO3JldHVybiBudWxsIT09biYmaTxuP2UuZGl2aWRlQnkodC5nZXRab29tU2NhbGUobixpKSkucm91bmQoKTpudWxsIT09cyYmaT5zP2UuZGl2aWRlQnkodC5nZXRab29tU2NhbGUocyxpKSkucm91bmQoKTplfSxfb25UaWxlUmVtb3ZlOmZ1bmN0aW9uKHQpe3QudGlsZS5vbmxvYWQ9bnVsbH0sX2dldFpvb21Gb3JVcmw6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl90aWxlWm9vbSxlPXRoaXMub3B0aW9ucy5tYXhab29tLGk9dGhpcy5vcHRpb25zLnpvb21SZXZlcnNlLG49dGhpcy5vcHRpb25zLnpvb21PZmZzZXQsbz10aGlzLm9wdGlvbnMubWluTmF0aXZlWm9vbSxzPXRoaXMub3B0aW9ucy5tYXhOYXRpdmVab29tO3JldHVybiBpJiYodD1lLXQpLHQrPW4sbnVsbCE9PW8mJnQ8bz9vOm51bGwhPT1zJiZ0PnM/czp0fSxfZ2V0U3ViZG9tYWluOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGguYWJzKHQueCt0LnkpJXRoaXMub3B0aW9ucy5zdWJkb21haW5zLmxlbmd0aDtyZXR1cm4gdGhpcy5vcHRpb25zLnN1YmRvbWFpbnNbZV19LF9hYm9ydExvYWRpbmc6ZnVuY3Rpb24oKXt2YXIgdCxlO2Zvcih0IGluIHRoaXMuX3RpbGVzKXRoaXMuX3RpbGVzW3RdLmNvb3Jkcy56IT09dGhpcy5fdGlsZVpvb20mJihlPXRoaXMuX3RpbGVzW3RdLmVsLGUub25sb2FkPW8uVXRpbC5mYWxzZUZuLGUub25lcnJvcj1vLlV0aWwuZmFsc2VGbixlLmNvbXBsZXRlfHwoZS5zcmM9by5VdGlsLmVtcHR5SW1hZ2VVcmwsby5Eb21VdGlsLnJlbW92ZShlKSkpfX0pLG8udGlsZUxheWVyPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLlRpbGVMYXllcih0LGUpfSxvLlRpbGVMYXllci5XTVM9by5UaWxlTGF5ZXIuZXh0ZW5kKHtkZWZhdWx0V21zUGFyYW1zOntzZXJ2aWNlOlwiV01TXCIscmVxdWVzdDpcIkdldE1hcFwiLGxheWVyczpcIlwiLHN0eWxlczpcIlwiLGZvcm1hdDpcImltYWdlL2pwZWdcIix0cmFuc3BhcmVudDohMSx2ZXJzaW9uOlwiMS4xLjFcIn0sb3B0aW9uczp7Y3JzOm51bGwsdXBwZXJjYXNlOiExfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7dGhpcy5fdXJsPXQ7dmFyIGk9by5leHRlbmQoe30sdGhpcy5kZWZhdWx0V21zUGFyYW1zKTtmb3IodmFyIG4gaW4gZSluIGluIHRoaXMub3B0aW9uc3x8KGlbbl09ZVtuXSk7ZT1vLnNldE9wdGlvbnModGhpcyxlKSxpLndpZHRoPWkuaGVpZ2h0PWUudGlsZVNpemUqKGUuZGV0ZWN0UmV0aW5hJiZvLkJyb3dzZXIucmV0aW5hPzI6MSksdGhpcy53bXNQYXJhbXM9aX0sb25BZGQ6ZnVuY3Rpb24odCl7dGhpcy5fY3JzPXRoaXMub3B0aW9ucy5jcnN8fHQub3B0aW9ucy5jcnMsdGhpcy5fd21zVmVyc2lvbj1wYXJzZUZsb2F0KHRoaXMud21zUGFyYW1zLnZlcnNpb24pO3ZhciBlPXRoaXMuX3dtc1ZlcnNpb24+PTEuMz9cImNyc1wiOlwic3JzXCI7dGhpcy53bXNQYXJhbXNbZV09dGhpcy5fY3JzLmNvZGUsby5UaWxlTGF5ZXIucHJvdG90eXBlLm9uQWRkLmNhbGwodGhpcyx0KX0sZ2V0VGlsZVVybDpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl90aWxlQ29vcmRzVG9Cb3VuZHModCksaT10aGlzLl9jcnMucHJvamVjdChlLmdldE5vcnRoV2VzdCgpKSxuPXRoaXMuX2Nycy5wcm9qZWN0KGUuZ2V0U291dGhFYXN0KCkpLHM9KHRoaXMuX3dtc1ZlcnNpb24+PTEuMyYmdGhpcy5fY3JzPT09by5DUlMuRVBTRzQzMjY/W24ueSxpLngsaS55LG4ueF06W2kueCxuLnksbi54LGkueV0pLmpvaW4oXCIsXCIpLHI9by5UaWxlTGF5ZXIucHJvdG90eXBlLmdldFRpbGVVcmwuY2FsbCh0aGlzLHQpO3JldHVybiByK28uVXRpbC5nZXRQYXJhbVN0cmluZyh0aGlzLndtc1BhcmFtcyxyLHRoaXMub3B0aW9ucy51cHBlcmNhc2UpKyh0aGlzLm9wdGlvbnMudXBwZXJjYXNlP1wiJkJCT1g9XCI6XCImYmJveD1cIikrc30sc2V0UGFyYW1zOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIG8uZXh0ZW5kKHRoaXMud21zUGFyYW1zLHQpLGV8fHRoaXMucmVkcmF3KCksdGhpc319KSxvLnRpbGVMYXllci53bXM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uVGlsZUxheWVyLldNUyh0LGUpfSxvLkltYWdlT3ZlcmxheT1vLkxheWVyLmV4dGVuZCh7b3B0aW9uczp7b3BhY2l0eToxLGFsdDpcIlwiLGludGVyYWN0aXZlOiExLGNyb3NzT3JpZ2luOiExfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSxpKXt0aGlzLl91cmw9dCx0aGlzLl9ib3VuZHM9by5sYXRMbmdCb3VuZHMoZSksby5zZXRPcHRpb25zKHRoaXMsaSl9LG9uQWRkOmZ1bmN0aW9uKCl7dGhpcy5faW1hZ2V8fCh0aGlzLl9pbml0SW1hZ2UoKSx0aGlzLm9wdGlvbnMub3BhY2l0eTwxJiZ0aGlzLl91cGRhdGVPcGFjaXR5KCkpLHRoaXMub3B0aW9ucy5pbnRlcmFjdGl2ZSYmKG8uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9pbWFnZSxcImxlYWZsZXQtaW50ZXJhY3RpdmVcIiksdGhpcy5hZGRJbnRlcmFjdGl2ZVRhcmdldCh0aGlzLl9pbWFnZSkpLHRoaXMuZ2V0UGFuZSgpLmFwcGVuZENoaWxkKHRoaXMuX2ltYWdlKSx0aGlzLl9yZXNldCgpfSxvblJlbW92ZTpmdW5jdGlvbigpe28uRG9tVXRpbC5yZW1vdmUodGhpcy5faW1hZ2UpLHRoaXMub3B0aW9ucy5pbnRlcmFjdGl2ZSYmdGhpcy5yZW1vdmVJbnRlcmFjdGl2ZVRhcmdldCh0aGlzLl9pbWFnZSl9LHNldE9wYWNpdHk6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3B0aW9ucy5vcGFjaXR5PXQsdGhpcy5faW1hZ2UmJnRoaXMuX3VwZGF0ZU9wYWNpdHkoKSx0aGlzfSxzZXRTdHlsZTpmdW5jdGlvbih0KXtyZXR1cm4gdC5vcGFjaXR5JiZ0aGlzLnNldE9wYWNpdHkodC5vcGFjaXR5KSx0aGlzfSxicmluZ1RvRnJvbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbWFwJiZvLkRvbVV0aWwudG9Gcm9udCh0aGlzLl9pbWFnZSksdGhpc30sYnJpbmdUb0JhY2s6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbWFwJiZvLkRvbVV0aWwudG9CYWNrKHRoaXMuX2ltYWdlKSx0aGlzfSxzZXRVcmw6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX3VybD10LHRoaXMuX2ltYWdlJiYodGhpcy5faW1hZ2Uuc3JjPXQpLHRoaXN9LHNldEJvdW5kczpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYm91bmRzPXQsdGhpcy5fbWFwJiZ0aGlzLl9yZXNldCgpLHRoaXN9LGdldEV2ZW50czpmdW5jdGlvbigpe3ZhciB0PXt6b29tOnRoaXMuX3Jlc2V0LHZpZXdyZXNldDp0aGlzLl9yZXNldH07cmV0dXJuIHRoaXMuX3pvb21BbmltYXRlZCYmKHQuem9vbWFuaW09dGhpcy5fYW5pbWF0ZVpvb20pLHR9LGdldEJvdW5kczpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9ib3VuZHN9LGdldEVsZW1lbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5faW1hZ2V9LF9pbml0SW1hZ2U6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9pbWFnZT1vLkRvbVV0aWwuY3JlYXRlKFwiaW1nXCIsXCJsZWFmbGV0LWltYWdlLWxheWVyIFwiKyh0aGlzLl96b29tQW5pbWF0ZWQ/XCJsZWFmbGV0LXpvb20tYW5pbWF0ZWRcIjpcIlwiKSk7dC5vbnNlbGVjdHN0YXJ0PW8uVXRpbC5mYWxzZUZuLHQub25tb3VzZW1vdmU9by5VdGlsLmZhbHNlRm4sdC5vbmxvYWQ9by5iaW5kKHRoaXMuZmlyZSx0aGlzLFwibG9hZFwiKSx0aGlzLm9wdGlvbnMuY3Jvc3NPcmlnaW4mJih0LmNyb3NzT3JpZ2luPVwiXCIpLHQuc3JjPXRoaXMuX3VybCx0LmFsdD10aGlzLm9wdGlvbnMuYWx0fSxfYW5pbWF0ZVpvb206ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fbWFwLmdldFpvb21TY2FsZSh0Lnpvb20pLGk9dGhpcy5fbWFwLl9sYXRMbmdCb3VuZHNUb05ld0xheWVyQm91bmRzKHRoaXMuX2JvdW5kcyx0Lnpvb20sdC5jZW50ZXIpLm1pbjtcbm8uRG9tVXRpbC5zZXRUcmFuc2Zvcm0odGhpcy5faW1hZ2UsaSxlKX0sX3Jlc2V0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5faW1hZ2UsZT1uZXcgby5Cb3VuZHModGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9ib3VuZHMuZ2V0Tm9ydGhXZXN0KCkpLHRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fYm91bmRzLmdldFNvdXRoRWFzdCgpKSksaT1lLmdldFNpemUoKTtvLkRvbVV0aWwuc2V0UG9zaXRpb24odCxlLm1pbiksdC5zdHlsZS53aWR0aD1pLngrXCJweFwiLHQuc3R5bGUuaGVpZ2h0PWkueStcInB4XCJ9LF91cGRhdGVPcGFjaXR5OmZ1bmN0aW9uKCl7by5Eb21VdGlsLnNldE9wYWNpdHkodGhpcy5faW1hZ2UsdGhpcy5vcHRpb25zLm9wYWNpdHkpfX0pLG8uaW1hZ2VPdmVybGF5PWZ1bmN0aW9uKHQsZSxpKXtyZXR1cm4gbmV3IG8uSW1hZ2VPdmVybGF5KHQsZSxpKX0sby5JY29uPW8uQ2xhc3MuZXh0ZW5kKHtpbml0aWFsaXplOmZ1bmN0aW9uKHQpe28uc2V0T3B0aW9ucyh0aGlzLHQpfSxjcmVhdGVJY29uOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9jcmVhdGVJY29uKFwiaWNvblwiLHQpfSxjcmVhdGVTaGFkb3c6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2NyZWF0ZUljb24oXCJzaGFkb3dcIix0KX0sX2NyZWF0ZUljb246ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9nZXRJY29uVXJsKHQpO2lmKCFpKXtpZihcImljb25cIj09PXQpdGhyb3cgbmV3IEVycm9yKFwiaWNvblVybCBub3Qgc2V0IGluIEljb24gb3B0aW9ucyAoc2VlIHRoZSBkb2NzKS5cIik7cmV0dXJuIG51bGx9dmFyIG49dGhpcy5fY3JlYXRlSW1nKGksZSYmXCJJTUdcIj09PWUudGFnTmFtZT9lOm51bGwpO3JldHVybiB0aGlzLl9zZXRJY29uU3R5bGVzKG4sdCksbn0sX3NldEljb25TdHlsZXM6ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLm9wdGlvbnMsbj1pW2UrXCJTaXplXCJdO1wibnVtYmVyXCI9PXR5cGVvZiBuJiYobj1bbixuXSk7dmFyIHM9by5wb2ludChuKSxyPW8ucG9pbnQoXCJzaGFkb3dcIj09PWUmJmkuc2hhZG93QW5jaG9yfHxpLmljb25BbmNob3J8fHMmJnMuZGl2aWRlQnkoMiwhMCkpO3QuY2xhc3NOYW1lPVwibGVhZmxldC1tYXJrZXItXCIrZStcIiBcIisoaS5jbGFzc05hbWV8fFwiXCIpLHImJih0LnN0eWxlLm1hcmdpbkxlZnQ9LXIueCtcInB4XCIsdC5zdHlsZS5tYXJnaW5Ub3A9LXIueStcInB4XCIpLHMmJih0LnN0eWxlLndpZHRoPXMueCtcInB4XCIsdC5zdHlsZS5oZWlnaHQ9cy55K1wicHhcIil9LF9jcmVhdGVJbWc6ZnVuY3Rpb24odCxpKXtyZXR1cm4gaT1pfHxlLmNyZWF0ZUVsZW1lbnQoXCJpbWdcIiksaS5zcmM9dCxpfSxfZ2V0SWNvblVybDpmdW5jdGlvbih0KXtyZXR1cm4gby5Ccm93c2VyLnJldGluYSYmdGhpcy5vcHRpb25zW3QrXCJSZXRpbmFVcmxcIl18fHRoaXMub3B0aW9uc1t0K1wiVXJsXCJdfX0pLG8uaWNvbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uSWNvbih0KX0sby5JY29uLkRlZmF1bHQ9by5JY29uLmV4dGVuZCh7b3B0aW9uczp7aWNvblVybDpcIm1hcmtlci1pY29uLnBuZ1wiLGljb25SZXRpbmFVcmw6XCJtYXJrZXItaWNvbi0yeC5wbmdcIixzaGFkb3dVcmw6XCJtYXJrZXItc2hhZG93LnBuZ1wiLGljb25TaXplOlsyNSw0MV0saWNvbkFuY2hvcjpbMTIsNDFdLHBvcHVwQW5jaG9yOlsxLC0zNF0sdG9vbHRpcEFuY2hvcjpbMTYsLTI4XSxzaGFkb3dTaXplOls0MSw0MV19LF9nZXRJY29uVXJsOmZ1bmN0aW9uKHQpe3JldHVybiBvLkljb24uRGVmYXVsdC5pbWFnZVBhdGh8fChvLkljb24uRGVmYXVsdC5pbWFnZVBhdGg9dGhpcy5fZGV0ZWN0SWNvblBhdGgoKSksKHRoaXMub3B0aW9ucy5pbWFnZVBhdGh8fG8uSWNvbi5EZWZhdWx0LmltYWdlUGF0aCkrby5JY29uLnByb3RvdHlwZS5fZ2V0SWNvblVybC5jYWxsKHRoaXMsdCl9LF9kZXRlY3RJY29uUGF0aDpmdW5jdGlvbigpe3ZhciB0PW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixcImxlYWZsZXQtZGVmYXVsdC1pY29uLXBhdGhcIixlLmJvZHkpLGk9by5Eb21VdGlsLmdldFN0eWxlKHQsXCJiYWNrZ3JvdW5kLWltYWdlXCIpfHxvLkRvbVV0aWwuZ2V0U3R5bGUodCxcImJhY2tncm91bmRJbWFnZVwiKTtyZXR1cm4gZS5ib2R5LnJlbW92ZUNoaWxkKHQpLDA9PT1pLmluZGV4T2YoXCJ1cmxcIik/aS5yZXBsYWNlKC9edXJsXFwoW1xcXCJcXCddPy8sXCJcIikucmVwbGFjZSgvbWFya2VyLWljb25cXC5wbmdbXFxcIlxcJ10/XFwpJC8sXCJcIik6XCJcIn19KSxvLk1hcmtlcj1vLkxheWVyLmV4dGVuZCh7b3B0aW9uczp7aWNvbjpuZXcgby5JY29uLkRlZmF1bHQsaW50ZXJhY3RpdmU6ITAsZHJhZ2dhYmxlOiExLGtleWJvYXJkOiEwLHRpdGxlOlwiXCIsYWx0OlwiXCIsekluZGV4T2Zmc2V0OjAsb3BhY2l0eToxLHJpc2VPbkhvdmVyOiExLHJpc2VPZmZzZXQ6MjUwLHBhbmU6XCJtYXJrZXJQYW5lXCIsbm9uQnViYmxpbmdFdmVudHM6W1wiY2xpY2tcIixcImRibGNsaWNrXCIsXCJtb3VzZW92ZXJcIixcIm1vdXNlb3V0XCIsXCJjb250ZXh0bWVudVwiXX0saW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUpe28uc2V0T3B0aW9ucyh0aGlzLGUpLHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KX0sb25BZGQ6ZnVuY3Rpb24odCl7dGhpcy5fem9vbUFuaW1hdGVkPXRoaXMuX3pvb21BbmltYXRlZCYmdC5vcHRpb25zLm1hcmtlclpvb21BbmltYXRpb24sdGhpcy5fem9vbUFuaW1hdGVkJiZ0Lm9uKFwiem9vbWFuaW1cIix0aGlzLl9hbmltYXRlWm9vbSx0aGlzKSx0aGlzLl9pbml0SWNvbigpLHRoaXMudXBkYXRlKCl9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3RoaXMuZHJhZ2dpbmcmJnRoaXMuZHJhZ2dpbmcuZW5hYmxlZCgpJiYodGhpcy5vcHRpb25zLmRyYWdnYWJsZT0hMCx0aGlzLmRyYWdnaW5nLnJlbW92ZUhvb2tzKCkpLHRoaXMuX3pvb21BbmltYXRlZCYmdC5vZmYoXCJ6b29tYW5pbVwiLHRoaXMuX2FuaW1hdGVab29tLHRoaXMpLHRoaXMuX3JlbW92ZUljb24oKSx0aGlzLl9yZW1vdmVTaGFkb3coKX0sZ2V0RXZlbnRzOmZ1bmN0aW9uKCl7cmV0dXJue3pvb206dGhpcy51cGRhdGUsdmlld3Jlc2V0OnRoaXMudXBkYXRlfX0sZ2V0TGF0TG5nOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2xhdGxuZ30sc2V0TGF0TG5nOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2xhdGxuZztyZXR1cm4gdGhpcy5fbGF0bG5nPW8ubGF0TG5nKHQpLHRoaXMudXBkYXRlKCksdGhpcy5maXJlKFwibW92ZVwiLHtvbGRMYXRMbmc6ZSxsYXRsbmc6dGhpcy5fbGF0bG5nfSl9LHNldFpJbmRleE9mZnNldDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLnpJbmRleE9mZnNldD10LHRoaXMudXBkYXRlKCl9LHNldEljb246ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3B0aW9ucy5pY29uPXQsdGhpcy5fbWFwJiYodGhpcy5faW5pdEljb24oKSx0aGlzLnVwZGF0ZSgpKSx0aGlzLl9wb3B1cCYmdGhpcy5iaW5kUG9wdXAodGhpcy5fcG9wdXAsdGhpcy5fcG9wdXAub3B0aW9ucyksdGhpc30sZ2V0RWxlbWVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9pY29ufSx1cGRhdGU6ZnVuY3Rpb24oKXtpZih0aGlzLl9pY29uKXt2YXIgdD10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2xhdGxuZykucm91bmQoKTt0aGlzLl9zZXRQb3ModCl9cmV0dXJuIHRoaXN9LF9pbml0SWNvbjpmdW5jdGlvbigpe3ZhciB0PXRoaXMub3B0aW9ucyxlPVwibGVhZmxldC16b29tLVwiKyh0aGlzLl96b29tQW5pbWF0ZWQ/XCJhbmltYXRlZFwiOlwiaGlkZVwiKSxpPXQuaWNvbi5jcmVhdGVJY29uKHRoaXMuX2ljb24pLG49ITE7aSE9PXRoaXMuX2ljb24mJih0aGlzLl9pY29uJiZ0aGlzLl9yZW1vdmVJY29uKCksbj0hMCx0LnRpdGxlJiYoaS50aXRsZT10LnRpdGxlKSx0LmFsdCYmKGkuYWx0PXQuYWx0KSksby5Eb21VdGlsLmFkZENsYXNzKGksZSksdC5rZXlib2FyZCYmKGkudGFiSW5kZXg9XCIwXCIpLHRoaXMuX2ljb249aSx0LnJpc2VPbkhvdmVyJiZ0aGlzLm9uKHttb3VzZW92ZXI6dGhpcy5fYnJpbmdUb0Zyb250LG1vdXNlb3V0OnRoaXMuX3Jlc2V0WkluZGV4fSk7dmFyIHM9dC5pY29uLmNyZWF0ZVNoYWRvdyh0aGlzLl9zaGFkb3cpLHI9ITE7cyE9PXRoaXMuX3NoYWRvdyYmKHRoaXMuX3JlbW92ZVNoYWRvdygpLHI9ITApLHMmJihvLkRvbVV0aWwuYWRkQ2xhc3MocyxlKSxzLmFsdD1cIlwiKSx0aGlzLl9zaGFkb3c9cyx0Lm9wYWNpdHk8MSYmdGhpcy5fdXBkYXRlT3BhY2l0eSgpLG4mJnRoaXMuZ2V0UGFuZSgpLmFwcGVuZENoaWxkKHRoaXMuX2ljb24pLHRoaXMuX2luaXRJbnRlcmFjdGlvbigpLHMmJnImJnRoaXMuZ2V0UGFuZShcInNoYWRvd1BhbmVcIikuYXBwZW5kQ2hpbGQodGhpcy5fc2hhZG93KX0sX3JlbW92ZUljb246ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMucmlzZU9uSG92ZXImJnRoaXMub2ZmKHttb3VzZW92ZXI6dGhpcy5fYnJpbmdUb0Zyb250LG1vdXNlb3V0OnRoaXMuX3Jlc2V0WkluZGV4fSksby5Eb21VdGlsLnJlbW92ZSh0aGlzLl9pY29uKSx0aGlzLnJlbW92ZUludGVyYWN0aXZlVGFyZ2V0KHRoaXMuX2ljb24pLHRoaXMuX2ljb249bnVsbH0sX3JlbW92ZVNoYWRvdzpmdW5jdGlvbigpe3RoaXMuX3NoYWRvdyYmby5Eb21VdGlsLnJlbW92ZSh0aGlzLl9zaGFkb3cpLHRoaXMuX3NoYWRvdz1udWxsfSxfc2V0UG9zOmZ1bmN0aW9uKHQpe28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9pY29uLHQpLHRoaXMuX3NoYWRvdyYmby5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX3NoYWRvdyx0KSx0aGlzLl96SW5kZXg9dC55K3RoaXMub3B0aW9ucy56SW5kZXhPZmZzZXQsdGhpcy5fcmVzZXRaSW5kZXgoKX0sX3VwZGF0ZVpJbmRleDpmdW5jdGlvbih0KXt0aGlzLl9pY29uLnN0eWxlLnpJbmRleD10aGlzLl96SW5kZXgrdH0sX2FuaW1hdGVab29tOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX21hcC5fbGF0TG5nVG9OZXdMYXllclBvaW50KHRoaXMuX2xhdGxuZyx0Lnpvb20sdC5jZW50ZXIpLnJvdW5kKCk7dGhpcy5fc2V0UG9zKGUpfSxfaW5pdEludGVyYWN0aW9uOmZ1bmN0aW9uKCl7aWYodGhpcy5vcHRpb25zLmludGVyYWN0aXZlJiYoby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2ljb24sXCJsZWFmbGV0LWludGVyYWN0aXZlXCIpLHRoaXMuYWRkSW50ZXJhY3RpdmVUYXJnZXQodGhpcy5faWNvbiksby5IYW5kbGVyLk1hcmtlckRyYWcpKXt2YXIgdD10aGlzLm9wdGlvbnMuZHJhZ2dhYmxlO3RoaXMuZHJhZ2dpbmcmJih0PXRoaXMuZHJhZ2dpbmcuZW5hYmxlZCgpLHRoaXMuZHJhZ2dpbmcuZGlzYWJsZSgpKSx0aGlzLmRyYWdnaW5nPW5ldyBvLkhhbmRsZXIuTWFya2VyRHJhZyh0aGlzKSx0JiZ0aGlzLmRyYWdnaW5nLmVuYWJsZSgpfX0sc2V0T3BhY2l0eTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLm9wYWNpdHk9dCx0aGlzLl9tYXAmJnRoaXMuX3VwZGF0ZU9wYWNpdHkoKSx0aGlzfSxfdXBkYXRlT3BhY2l0eTpmdW5jdGlvbigpe3ZhciB0PXRoaXMub3B0aW9ucy5vcGFjaXR5O28uRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2ljb24sdCksdGhpcy5fc2hhZG93JiZvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9zaGFkb3csdCl9LF9icmluZ1RvRnJvbnQ6ZnVuY3Rpb24oKXt0aGlzLl91cGRhdGVaSW5kZXgodGhpcy5vcHRpb25zLnJpc2VPZmZzZXQpfSxfcmVzZXRaSW5kZXg6ZnVuY3Rpb24oKXt0aGlzLl91cGRhdGVaSW5kZXgoMCl9LF9nZXRQb3B1cEFuY2hvcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9wdGlvbnMuaWNvbi5vcHRpb25zLnBvcHVwQW5jaG9yfHxbMCwwXX0sX2dldFRvb2x0aXBBbmNob3I6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLmljb24ub3B0aW9ucy50b29sdGlwQW5jaG9yfHxbMCwwXX19KSxvLm1hcmtlcj1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5NYXJrZXIodCxlKX0sby5EaXZJY29uPW8uSWNvbi5leHRlbmQoe29wdGlvbnM6e2ljb25TaXplOlsxMiwxMl0saHRtbDohMSxiZ1BvczpudWxsLGNsYXNzTmFtZTpcImxlYWZsZXQtZGl2LWljb25cIn0sY3JlYXRlSWNvbjpmdW5jdGlvbih0KXt2YXIgaT10JiZcIkRJVlwiPT09dC50YWdOYW1lP3Q6ZS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLG49dGhpcy5vcHRpb25zO2lmKGkuaW5uZXJIVE1MPW4uaHRtbCE9PSExP24uaHRtbDpcIlwiLG4uYmdQb3Mpe3ZhciBzPW8ucG9pbnQobi5iZ1Bvcyk7aS5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb249LXMueCtcInB4IFwiKy1zLnkrXCJweFwifXJldHVybiB0aGlzLl9zZXRJY29uU3R5bGVzKGksXCJpY29uXCIpLGl9LGNyZWF0ZVNoYWRvdzpmdW5jdGlvbigpe3JldHVybiBudWxsfX0pLG8uZGl2SWNvbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uRGl2SWNvbih0KX0sby5EaXZPdmVybGF5PW8uTGF5ZXIuZXh0ZW5kKHtvcHRpb25zOntvZmZzZXQ6WzAsN10sY2xhc3NOYW1lOlwiXCIscGFuZTpcInBvcHVwUGFuZVwifSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7by5zZXRPcHRpb25zKHRoaXMsdCksdGhpcy5fc291cmNlPWV9LG9uQWRkOmZ1bmN0aW9uKHQpe3RoaXMuX3pvb21BbmltYXRlZD10Ll96b29tQW5pbWF0ZWQsdGhpcy5fY29udGFpbmVyfHx0aGlzLl9pbml0TGF5b3V0KCksdC5fZmFkZUFuaW1hdGVkJiZvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9jb250YWluZXIsMCksY2xlYXJUaW1lb3V0KHRoaXMuX3JlbW92ZVRpbWVvdXQpLHRoaXMuZ2V0UGFuZSgpLmFwcGVuZENoaWxkKHRoaXMuX2NvbnRhaW5lciksdGhpcy51cGRhdGUoKSx0Ll9mYWRlQW5pbWF0ZWQmJm8uRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2NvbnRhaW5lciwxKSx0aGlzLmJyaW5nVG9Gcm9udCgpfSxvblJlbW92ZTpmdW5jdGlvbih0KXt0Ll9mYWRlQW5pbWF0ZWQ/KG8uRG9tVXRpbC5zZXRPcGFjaXR5KHRoaXMuX2NvbnRhaW5lciwwKSx0aGlzLl9yZW1vdmVUaW1lb3V0PXNldFRpbWVvdXQoby5iaW5kKG8uRG9tVXRpbC5yZW1vdmUsby5Eb21VdGlsLHRoaXMuX2NvbnRhaW5lciksMjAwKSk6by5Eb21VdGlsLnJlbW92ZSh0aGlzLl9jb250YWluZXIpfSxnZXRMYXRMbmc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbGF0bG5nfSxzZXRMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KSx0aGlzLl9tYXAmJih0aGlzLl91cGRhdGVQb3NpdGlvbigpLHRoaXMuX2FkanVzdFBhbigpKSx0aGlzfSxnZXRDb250ZW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2NvbnRlbnR9LHNldENvbnRlbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2NvbnRlbnQ9dCx0aGlzLnVwZGF0ZSgpLHRoaXN9LGdldEVsZW1lbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fY29udGFpbmVyfSx1cGRhdGU6ZnVuY3Rpb24oKXt0aGlzLl9tYXAmJih0aGlzLl9jb250YWluZXIuc3R5bGUudmlzaWJpbGl0eT1cImhpZGRlblwiLHRoaXMuX3VwZGF0ZUNvbnRlbnQoKSx0aGlzLl91cGRhdGVMYXlvdXQoKSx0aGlzLl91cGRhdGVQb3NpdGlvbigpLHRoaXMuX2NvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5PVwiXCIsdGhpcy5fYWRqdXN0UGFuKCkpfSxnZXRFdmVudHM6ZnVuY3Rpb24oKXt2YXIgdD17em9vbTp0aGlzLl91cGRhdGVQb3NpdGlvbix2aWV3cmVzZXQ6dGhpcy5fdXBkYXRlUG9zaXRpb259O3JldHVybiB0aGlzLl96b29tQW5pbWF0ZWQmJih0Lnpvb21hbmltPXRoaXMuX2FuaW1hdGVab29tKSx0fSxpc09wZW46ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuX21hcCYmdGhpcy5fbWFwLmhhc0xheWVyKHRoaXMpfSxicmluZ1RvRnJvbnQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbWFwJiZvLkRvbVV0aWwudG9Gcm9udCh0aGlzLl9jb250YWluZXIpLHRoaXN9LGJyaW5nVG9CYWNrOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21hcCYmby5Eb21VdGlsLnRvQmFjayh0aGlzLl9jb250YWluZXIpLHRoaXN9LF91cGRhdGVDb250ZW50OmZ1bmN0aW9uKCl7aWYodGhpcy5fY29udGVudCl7dmFyIHQ9dGhpcy5fY29udGVudE5vZGUsZT1cImZ1bmN0aW9uXCI9PXR5cGVvZiB0aGlzLl9jb250ZW50P3RoaXMuX2NvbnRlbnQodGhpcy5fc291cmNlfHx0aGlzKTp0aGlzLl9jb250ZW50O2lmKFwic3RyaW5nXCI9PXR5cGVvZiBlKXQuaW5uZXJIVE1MPWU7ZWxzZXtmb3IoO3QuaGFzQ2hpbGROb2RlcygpOyl0LnJlbW92ZUNoaWxkKHQuZmlyc3RDaGlsZCk7dC5hcHBlbmRDaGlsZChlKX10aGlzLmZpcmUoXCJjb250ZW50dXBkYXRlXCIpfX0sX3VwZGF0ZVBvc2l0aW9uOmZ1bmN0aW9uKCl7aWYodGhpcy5fbWFwKXt2YXIgdD10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2xhdGxuZyksZT1vLnBvaW50KHRoaXMub3B0aW9ucy5vZmZzZXQpLGk9dGhpcy5fZ2V0QW5jaG9yKCk7dGhpcy5fem9vbUFuaW1hdGVkP28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9jb250YWluZXIsdC5hZGQoaSkpOmU9ZS5hZGQodCkuYWRkKGkpO3ZhciBuPXRoaXMuX2NvbnRhaW5lckJvdHRvbT0tZS55LHM9dGhpcy5fY29udGFpbmVyTGVmdD0tTWF0aC5yb3VuZCh0aGlzLl9jb250YWluZXJXaWR0aC8yKStlLng7dGhpcy5fY29udGFpbmVyLnN0eWxlLmJvdHRvbT1uK1wicHhcIix0aGlzLl9jb250YWluZXIuc3R5bGUubGVmdD1zK1wicHhcIn19LF9nZXRBbmNob3I6ZnVuY3Rpb24oKXtyZXR1cm5bMCwwXX19KSxvLlBvcHVwPW8uRGl2T3ZlcmxheS5leHRlbmQoe29wdGlvbnM6e21heFdpZHRoOjMwMCxtaW5XaWR0aDo1MCxtYXhIZWlnaHQ6bnVsbCxhdXRvUGFuOiEwLGF1dG9QYW5QYWRkaW5nVG9wTGVmdDpudWxsLGF1dG9QYW5QYWRkaW5nQm90dG9tUmlnaHQ6bnVsbCxhdXRvUGFuUGFkZGluZzpbNSw1XSxrZWVwSW5WaWV3OiExLGNsb3NlQnV0dG9uOiEwLGF1dG9DbG9zZTohMCxjbGFzc05hbWU6XCJcIn0sb3Blbk9uOmZ1bmN0aW9uKHQpe3JldHVybiB0Lm9wZW5Qb3B1cCh0aGlzKSx0aGlzfSxvbkFkZDpmdW5jdGlvbih0KXtvLkRpdk92ZXJsYXkucHJvdG90eXBlLm9uQWRkLmNhbGwodGhpcyx0KSx0LmZpcmUoXCJwb3B1cG9wZW5cIix7cG9wdXA6dGhpc30pLHRoaXMuX3NvdXJjZSYmKHRoaXMuX3NvdXJjZS5maXJlKFwicG9wdXBvcGVuXCIse3BvcHVwOnRoaXN9LCEwKSx0aGlzLl9zb3VyY2UgaW5zdGFuY2VvZiBvLlBhdGh8fHRoaXMuX3NvdXJjZS5vbihcInByZWNsaWNrXCIsby5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pKX0sb25SZW1vdmU6ZnVuY3Rpb24odCl7by5EaXZPdmVybGF5LnByb3RvdHlwZS5vblJlbW92ZS5jYWxsKHRoaXMsdCksdC5maXJlKFwicG9wdXBjbG9zZVwiLHtwb3B1cDp0aGlzfSksdGhpcy5fc291cmNlJiYodGhpcy5fc291cmNlLmZpcmUoXCJwb3B1cGNsb3NlXCIse3BvcHVwOnRoaXN9LCEwKSx0aGlzLl9zb3VyY2UgaW5zdGFuY2VvZiBvLlBhdGh8fHRoaXMuX3NvdXJjZS5vZmYoXCJwcmVjbGlja1wiLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKSl9LGdldEV2ZW50czpmdW5jdGlvbigpe3ZhciB0PW8uRGl2T3ZlcmxheS5wcm90b3R5cGUuZ2V0RXZlbnRzLmNhbGwodGhpcyk7cmV0dXJuKFwiY2xvc2VPbkNsaWNrXCJpbiB0aGlzLm9wdGlvbnM/dGhpcy5vcHRpb25zLmNsb3NlT25DbGljazp0aGlzLl9tYXAub3B0aW9ucy5jbG9zZVBvcHVwT25DbGljaykmJih0LnByZWNsaWNrPXRoaXMuX2Nsb3NlKSx0aGlzLm9wdGlvbnMua2VlcEluVmlldyYmKHQubW92ZWVuZD10aGlzLl9hZGp1c3RQYW4pLHR9LF9jbG9zZTpmdW5jdGlvbigpe3RoaXMuX21hcCYmdGhpcy5fbWFwLmNsb3NlUG9wdXAodGhpcyl9LF9pbml0TGF5b3V0OmZ1bmN0aW9uKCl7dmFyIHQ9XCJsZWFmbGV0LXBvcHVwXCIsZT10aGlzLl9jb250YWluZXI9by5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLHQrXCIgXCIrKHRoaXMub3B0aW9ucy5jbGFzc05hbWV8fFwiXCIpK1wiIGxlYWZsZXQtem9vbS1hbmltYXRlZFwiKTtpZih0aGlzLm9wdGlvbnMuY2xvc2VCdXR0b24pe3ZhciBpPXRoaXMuX2Nsb3NlQnV0dG9uPW8uRG9tVXRpbC5jcmVhdGUoXCJhXCIsdCtcIi1jbG9zZS1idXR0b25cIixlKTtpLmhyZWY9XCIjY2xvc2VcIixpLmlubmVySFRNTD1cIiYjMjE1O1wiLG8uRG9tRXZlbnQub24oaSxcImNsaWNrXCIsdGhpcy5fb25DbG9zZUJ1dHRvbkNsaWNrLHRoaXMpfXZhciBuPXRoaXMuX3dyYXBwZXI9by5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLHQrXCItY29udGVudC13cmFwcGVyXCIsZSk7dGhpcy5fY29udGVudE5vZGU9by5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLHQrXCItY29udGVudFwiLG4pLG8uRG9tRXZlbnQuZGlzYWJsZUNsaWNrUHJvcGFnYXRpb24obikuZGlzYWJsZVNjcm9sbFByb3BhZ2F0aW9uKHRoaXMuX2NvbnRlbnROb2RlKS5vbihuLFwiY29udGV4dG1lbnVcIixvLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbiksdGhpcy5fdGlwQ29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIix0K1wiLXRpcC1jb250YWluZXJcIixlKSx0aGlzLl90aXA9by5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLHQrXCItdGlwXCIsdGhpcy5fdGlwQ29udGFpbmVyKX0sX3VwZGF0ZUxheW91dDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2NvbnRlbnROb2RlLGU9dC5zdHlsZTtlLndpZHRoPVwiXCIsZS53aGl0ZVNwYWNlPVwibm93cmFwXCI7dmFyIGk9dC5vZmZzZXRXaWR0aDtpPU1hdGgubWluKGksdGhpcy5vcHRpb25zLm1heFdpZHRoKSxpPU1hdGgubWF4KGksdGhpcy5vcHRpb25zLm1pbldpZHRoKSxlLndpZHRoPWkrMStcInB4XCIsZS53aGl0ZVNwYWNlPVwiXCIsZS5oZWlnaHQ9XCJcIjt2YXIgbj10Lm9mZnNldEhlaWdodCxzPXRoaXMub3B0aW9ucy5tYXhIZWlnaHQscj1cImxlYWZsZXQtcG9wdXAtc2Nyb2xsZWRcIjtzJiZuPnM/KGUuaGVpZ2h0PXMrXCJweFwiLG8uRG9tVXRpbC5hZGRDbGFzcyh0LHIpKTpvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModCxyKSx0aGlzLl9jb250YWluZXJXaWR0aD10aGlzLl9jb250YWluZXIub2Zmc2V0V2lkdGh9LF9hbmltYXRlWm9vbTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAuX2xhdExuZ1RvTmV3TGF5ZXJQb2ludCh0aGlzLl9sYXRsbmcsdC56b29tLHQuY2VudGVyKSxpPXRoaXMuX2dldEFuY2hvcigpO28uRG9tVXRpbC5zZXRQb3NpdGlvbih0aGlzLl9jb250YWluZXIsZS5hZGQoaSkpfSxfYWRqdXN0UGFuOmZ1bmN0aW9uKCl7aWYoISghdGhpcy5vcHRpb25zLmF1dG9QYW58fHRoaXMuX21hcC5fcGFuQW5pbSYmdGhpcy5fbWFwLl9wYW5BbmltLl9pblByb2dyZXNzKSl7dmFyIHQ9dGhpcy5fbWFwLGU9cGFyc2VJbnQoby5Eb21VdGlsLmdldFN0eWxlKHRoaXMuX2NvbnRhaW5lcixcIm1hcmdpbkJvdHRvbVwiKSwxMCl8fDAsaT10aGlzLl9jb250YWluZXIub2Zmc2V0SGVpZ2h0K2Usbj10aGlzLl9jb250YWluZXJXaWR0aCxzPW5ldyBvLlBvaW50KHRoaXMuX2NvbnRhaW5lckxlZnQsLWktdGhpcy5fY29udGFpbmVyQm90dG9tKTtzLl9hZGQoby5Eb21VdGlsLmdldFBvc2l0aW9uKHRoaXMuX2NvbnRhaW5lcikpO3ZhciByPXQubGF5ZXJQb2ludFRvQ29udGFpbmVyUG9pbnQocyksYT1vLnBvaW50KHRoaXMub3B0aW9ucy5hdXRvUGFuUGFkZGluZyksaD1vLnBvaW50KHRoaXMub3B0aW9ucy5hdXRvUGFuUGFkZGluZ1RvcExlZnR8fGEpLGw9by5wb2ludCh0aGlzLm9wdGlvbnMuYXV0b1BhblBhZGRpbmdCb3R0b21SaWdodHx8YSksdT10LmdldFNpemUoKSxjPTAsZD0wO3IueCtuK2wueD51LngmJihjPXIueCtuLXUueCtsLngpLHIueC1jLWgueDwwJiYoYz1yLngtaC54KSxyLnkraStsLnk+dS55JiYoZD1yLnkraS11LnkrbC55KSxyLnktZC1oLnk8MCYmKGQ9ci55LWgueSksKGN8fGQpJiZ0LmZpcmUoXCJhdXRvcGFuc3RhcnRcIikucGFuQnkoW2MsZF0pfX0sX29uQ2xvc2VCdXR0b25DbGljazpmdW5jdGlvbih0KXt0aGlzLl9jbG9zZSgpLG8uRG9tRXZlbnQuc3RvcCh0KX0sX2dldEFuY2hvcjpmdW5jdGlvbigpe3JldHVybiBvLnBvaW50KHRoaXMuX3NvdXJjZSYmdGhpcy5fc291cmNlLl9nZXRQb3B1cEFuY2hvcj90aGlzLl9zb3VyY2UuX2dldFBvcHVwQW5jaG9yKCk6WzAsMF0pfX0pLG8ucG9wdXA9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uUG9wdXAodCxlKX0sby5NYXAubWVyZ2VPcHRpb25zKHtjbG9zZVBvcHVwT25DbGljazohMH0pLG8uTWFwLmluY2x1ZGUoe29wZW5Qb3B1cDpmdW5jdGlvbih0LGUsaSl7cmV0dXJuIHQgaW5zdGFuY2VvZiBvLlBvcHVwfHwodD1uZXcgby5Qb3B1cChpKS5zZXRDb250ZW50KHQpKSxlJiZ0LnNldExhdExuZyhlKSx0aGlzLmhhc0xheWVyKHQpP3RoaXM6KHRoaXMuX3BvcHVwJiZ0aGlzLl9wb3B1cC5vcHRpb25zLmF1dG9DbG9zZSYmdGhpcy5jbG9zZVBvcHVwKCksdGhpcy5fcG9wdXA9dCx0aGlzLmFkZExheWVyKHQpKX0sY2xvc2VQb3B1cDpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdCE9PXRoaXMuX3BvcHVwfHwodD10aGlzLl9wb3B1cCx0aGlzLl9wb3B1cD1udWxsKSx0JiZ0aGlzLnJlbW92ZUxheWVyKHQpLHRoaXN9fSksby5MYXllci5pbmNsdWRlKHtiaW5kUG9wdXA6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdCBpbnN0YW5jZW9mIG8uUG9wdXA/KG8uc2V0T3B0aW9ucyh0LGUpLHRoaXMuX3BvcHVwPXQsdC5fc291cmNlPXRoaXMpOih0aGlzLl9wb3B1cCYmIWV8fCh0aGlzLl9wb3B1cD1uZXcgby5Qb3B1cChlLHRoaXMpKSx0aGlzLl9wb3B1cC5zZXRDb250ZW50KHQpKSx0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWR8fCh0aGlzLm9uKHtjbGljazp0aGlzLl9vcGVuUG9wdXAscmVtb3ZlOnRoaXMuY2xvc2VQb3B1cCxtb3ZlOnRoaXMuX21vdmVQb3B1cH0pLHRoaXMuX3BvcHVwSGFuZGxlcnNBZGRlZD0hMCksdGhpc30sdW5iaW5kUG9wdXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcG9wdXAmJih0aGlzLm9mZih7Y2xpY2s6dGhpcy5fb3BlblBvcHVwLHJlbW92ZTp0aGlzLmNsb3NlUG9wdXAsbW92ZTp0aGlzLl9tb3ZlUG9wdXB9KSx0aGlzLl9wb3B1cEhhbmRsZXJzQWRkZWQ9ITEsdGhpcy5fcG9wdXA9bnVsbCksdGhpc30sb3BlblBvcHVwOmZ1bmN0aW9uKHQsZSl7aWYodCBpbnN0YW5jZW9mIG8uTGF5ZXJ8fChlPXQsdD10aGlzKSx0IGluc3RhbmNlb2Ygby5GZWF0dXJlR3JvdXApZm9yKHZhciBpIGluIHRoaXMuX2xheWVycyl7dD10aGlzLl9sYXllcnNbaV07YnJlYWt9cmV0dXJuIGV8fChlPXQuZ2V0Q2VudGVyP3QuZ2V0Q2VudGVyKCk6dC5nZXRMYXRMbmcoKSksdGhpcy5fcG9wdXAmJnRoaXMuX21hcCYmKHRoaXMuX3BvcHVwLl9zb3VyY2U9dCx0aGlzLl9wb3B1cC51cGRhdGUoKSx0aGlzLl9tYXAub3BlblBvcHVwKHRoaXMuX3BvcHVwLGUpKSx0aGlzfSxjbG9zZVBvcHVwOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3BvcHVwJiZ0aGlzLl9wb3B1cC5fY2xvc2UoKSx0aGlzfSx0b2dnbGVQb3B1cDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fcG9wdXAmJih0aGlzLl9wb3B1cC5fbWFwP3RoaXMuY2xvc2VQb3B1cCgpOnRoaXMub3BlblBvcHVwKHQpKSx0aGlzfSxpc1BvcHVwT3BlbjpmdW5jdGlvbigpe3JldHVybiEhdGhpcy5fcG9wdXAmJnRoaXMuX3BvcHVwLmlzT3BlbigpfSxzZXRQb3B1cENvbnRlbnQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX3BvcHVwJiZ0aGlzLl9wb3B1cC5zZXRDb250ZW50KHQpLHRoaXN9LGdldFBvcHVwOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3BvcHVwfSxfb3BlblBvcHVwOmZ1bmN0aW9uKHQpe3ZhciBlPXQubGF5ZXJ8fHQudGFyZ2V0O2lmKHRoaXMuX3BvcHVwJiZ0aGlzLl9tYXApcmV0dXJuIG8uRG9tRXZlbnQuc3RvcCh0KSxlIGluc3RhbmNlb2Ygby5QYXRoP3ZvaWQgdGhpcy5vcGVuUG9wdXAodC5sYXllcnx8dC50YXJnZXQsdC5sYXRsbmcpOnZvaWQodGhpcy5fbWFwLmhhc0xheWVyKHRoaXMuX3BvcHVwKSYmdGhpcy5fcG9wdXAuX3NvdXJjZT09PWU/dGhpcy5jbG9zZVBvcHVwKCk6dGhpcy5vcGVuUG9wdXAoZSx0LmxhdGxuZykpfSxfbW92ZVBvcHVwOmZ1bmN0aW9uKHQpe3RoaXMuX3BvcHVwLnNldExhdExuZyh0LmxhdGxuZyl9fSksby5Ub29sdGlwPW8uRGl2T3ZlcmxheS5leHRlbmQoe29wdGlvbnM6e3BhbmU6XCJ0b29sdGlwUGFuZVwiLG9mZnNldDpbMCwwXSxkaXJlY3Rpb246XCJhdXRvXCIscGVybWFuZW50OiExLHN0aWNreTohMSxpbnRlcmFjdGl2ZTohMSxvcGFjaXR5Oi45fSxvbkFkZDpmdW5jdGlvbih0KXtvLkRpdk92ZXJsYXkucHJvdG90eXBlLm9uQWRkLmNhbGwodGhpcyx0KSx0aGlzLnNldE9wYWNpdHkodGhpcy5vcHRpb25zLm9wYWNpdHkpLHQuZmlyZShcInRvb2x0aXBvcGVuXCIse3Rvb2x0aXA6dGhpc30pLHRoaXMuX3NvdXJjZSYmdGhpcy5fc291cmNlLmZpcmUoXCJ0b29sdGlwb3BlblwiLHt0b29sdGlwOnRoaXN9LCEwKX0sb25SZW1vdmU6ZnVuY3Rpb24odCl7by5EaXZPdmVybGF5LnByb3RvdHlwZS5vblJlbW92ZS5jYWxsKHRoaXMsdCksdC5maXJlKFwidG9vbHRpcGNsb3NlXCIse3Rvb2x0aXA6dGhpc30pLHRoaXMuX3NvdXJjZSYmdGhpcy5fc291cmNlLmZpcmUoXCJ0b29sdGlwY2xvc2VcIix7dG9vbHRpcDp0aGlzfSwhMCl9LGdldEV2ZW50czpmdW5jdGlvbigpe3ZhciB0PW8uRGl2T3ZlcmxheS5wcm90b3R5cGUuZ2V0RXZlbnRzLmNhbGwodGhpcyk7cmV0dXJuIG8uQnJvd3Nlci50b3VjaCYmIXRoaXMub3B0aW9ucy5wZXJtYW5lbnQmJih0LnByZWNsaWNrPXRoaXMuX2Nsb3NlKSx0fSxfY2xvc2U6ZnVuY3Rpb24oKXt0aGlzLl9tYXAmJnRoaXMuX21hcC5jbG9zZVRvb2x0aXAodGhpcyl9LF9pbml0TGF5b3V0OmZ1bmN0aW9uKCl7dmFyIHQ9XCJsZWFmbGV0LXRvb2x0aXBcIixlPXQrXCIgXCIrKHRoaXMub3B0aW9ucy5jbGFzc05hbWV8fFwiXCIpK1wiIGxlYWZsZXQtem9vbS1cIisodGhpcy5fem9vbUFuaW1hdGVkP1wiYW5pbWF0ZWRcIjpcImhpZGVcIik7dGhpcy5fY29udGVudE5vZGU9dGhpcy5fY29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixlKX0sX3VwZGF0ZUxheW91dDpmdW5jdGlvbigpe30sX2FkanVzdFBhbjpmdW5jdGlvbigpe30sX3NldFBvc2l0aW9uOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX21hcCxpPXRoaXMuX2NvbnRhaW5lcixuPWUubGF0TG5nVG9Db250YWluZXJQb2ludChlLmdldENlbnRlcigpKSxzPWUubGF5ZXJQb2ludFRvQ29udGFpbmVyUG9pbnQodCkscj10aGlzLm9wdGlvbnMuZGlyZWN0aW9uLGE9aS5vZmZzZXRXaWR0aCxoPWkub2Zmc2V0SGVpZ2h0LGw9by5wb2ludCh0aGlzLm9wdGlvbnMub2Zmc2V0KSx1PXRoaXMuX2dldEFuY2hvcigpO1widG9wXCI9PT1yP3Q9dC5hZGQoby5wb2ludCgtYS8yK2wueCwtaCtsLnkrdS55LCEwKSk6XCJib3R0b21cIj09PXI/dD10LnN1YnRyYWN0KG8ucG9pbnQoYS8yLWwueCwtbC55LCEwKSk6XCJjZW50ZXJcIj09PXI/dD10LnN1YnRyYWN0KG8ucG9pbnQoYS8yK2wueCxoLzItdS55K2wueSwhMCkpOlwicmlnaHRcIj09PXJ8fFwiYXV0b1wiPT09ciYmcy54PG4ueD8ocj1cInJpZ2h0XCIsdD10LmFkZChvLnBvaW50KGwueCt1LngsdS55LWgvMitsLnksITApKSk6KHI9XCJsZWZ0XCIsdD10LnN1YnRyYWN0KG8ucG9pbnQoYSt1LngtbC54LGgvMi11LnktbC55LCEwKSkpLG8uRG9tVXRpbC5yZW1vdmVDbGFzcyhpLFwibGVhZmxldC10b29sdGlwLXJpZ2h0XCIpLG8uRG9tVXRpbC5yZW1vdmVDbGFzcyhpLFwibGVhZmxldC10b29sdGlwLWxlZnRcIiksby5Eb21VdGlsLnJlbW92ZUNsYXNzKGksXCJsZWFmbGV0LXRvb2x0aXAtdG9wXCIpLG8uRG9tVXRpbC5yZW1vdmVDbGFzcyhpLFwibGVhZmxldC10b29sdGlwLWJvdHRvbVwiKSxvLkRvbVV0aWwuYWRkQ2xhc3MoaSxcImxlYWZsZXQtdG9vbHRpcC1cIityKSxvLkRvbVV0aWwuc2V0UG9zaXRpb24oaSx0KX0sX3VwZGF0ZVBvc2l0aW9uOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLmxhdExuZ1RvTGF5ZXJQb2ludCh0aGlzLl9sYXRsbmcpO3RoaXMuX3NldFBvc2l0aW9uKHQpfSxzZXRPcGFjaXR5OmZ1bmN0aW9uKHQpe3RoaXMub3B0aW9ucy5vcGFjaXR5PXQsdGhpcy5fY29udGFpbmVyJiZvLkRvbVV0aWwuc2V0T3BhY2l0eSh0aGlzLl9jb250YWluZXIsdCl9LF9hbmltYXRlWm9vbTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXAuX2xhdExuZ1RvTmV3TGF5ZXJQb2ludCh0aGlzLl9sYXRsbmcsdC56b29tLHQuY2VudGVyKTt0aGlzLl9zZXRQb3NpdGlvbihlKX0sX2dldEFuY2hvcjpmdW5jdGlvbigpe3JldHVybiBvLnBvaW50KHRoaXMuX3NvdXJjZSYmdGhpcy5fc291cmNlLl9nZXRUb29sdGlwQW5jaG9yJiYhdGhpcy5vcHRpb25zLnN0aWNreT90aGlzLl9zb3VyY2UuX2dldFRvb2x0aXBBbmNob3IoKTpbMCwwXSl9fSksby50b29sdGlwPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLlRvb2x0aXAodCxlKX0sby5NYXAuaW5jbHVkZSh7b3BlblRvb2x0aXA6ZnVuY3Rpb24odCxlLGkpe3JldHVybiB0IGluc3RhbmNlb2Ygby5Ub29sdGlwfHwodD1uZXcgby5Ub29sdGlwKGkpLnNldENvbnRlbnQodCkpLGUmJnQuc2V0TGF0TG5nKGUpLHRoaXMuaGFzTGF5ZXIodCk/dGhpczp0aGlzLmFkZExheWVyKHQpfSxjbG9zZVRvb2x0aXA6ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnRoaXMucmVtb3ZlTGF5ZXIodCksdGhpc319KSxvLkxheWVyLmluY2x1ZGUoe2JpbmRUb29sdGlwOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQgaW5zdGFuY2VvZiBvLlRvb2x0aXA/KG8uc2V0T3B0aW9ucyh0LGUpLHRoaXMuX3Rvb2x0aXA9dCx0Ll9zb3VyY2U9dGhpcyk6KHRoaXMuX3Rvb2x0aXAmJiFlfHwodGhpcy5fdG9vbHRpcD1vLnRvb2x0aXAoZSx0aGlzKSksdGhpcy5fdG9vbHRpcC5zZXRDb250ZW50KHQpKSx0aGlzLl9pbml0VG9vbHRpcEludGVyYWN0aW9ucygpLHRoaXMuX3Rvb2x0aXAub3B0aW9ucy5wZXJtYW5lbnQmJnRoaXMuX21hcCYmdGhpcy5fbWFwLmhhc0xheWVyKHRoaXMpJiZ0aGlzLm9wZW5Ub29sdGlwKCksdGhpc30sdW5iaW5kVG9vbHRpcDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl90b29sdGlwJiYodGhpcy5faW5pdFRvb2x0aXBJbnRlcmFjdGlvbnMoITApLHRoaXMuY2xvc2VUb29sdGlwKCksdGhpcy5fdG9vbHRpcD1udWxsKSx0aGlzfSxfaW5pdFRvb2x0aXBJbnRlcmFjdGlvbnM6ZnVuY3Rpb24odCl7aWYodHx8IXRoaXMuX3Rvb2x0aXBIYW5kbGVyc0FkZGVkKXt2YXIgZT10P1wib2ZmXCI6XCJvblwiLGk9e3JlbW92ZTp0aGlzLmNsb3NlVG9vbHRpcCxtb3ZlOnRoaXMuX21vdmVUb29sdGlwfTt0aGlzLl90b29sdGlwLm9wdGlvbnMucGVybWFuZW50P2kuYWRkPXRoaXMuX29wZW5Ub29sdGlwOihpLm1vdXNlb3Zlcj10aGlzLl9vcGVuVG9vbHRpcCxpLm1vdXNlb3V0PXRoaXMuY2xvc2VUb29sdGlwLHRoaXMuX3Rvb2x0aXAub3B0aW9ucy5zdGlja3kmJihpLm1vdXNlbW92ZT10aGlzLl9tb3ZlVG9vbHRpcCksby5Ccm93c2VyLnRvdWNoJiYoaS5jbGljaz10aGlzLl9vcGVuVG9vbHRpcCkpLHRoaXNbZV0oaSksdGhpcy5fdG9vbHRpcEhhbmRsZXJzQWRkZWQ9IXR9fSxvcGVuVG9vbHRpcDpmdW5jdGlvbih0LGUpe2lmKHQgaW5zdGFuY2VvZiBvLkxheWVyfHwoZT10LHQ9dGhpcyksdCBpbnN0YW5jZW9mIG8uRmVhdHVyZUdyb3VwKWZvcih2YXIgaSBpbiB0aGlzLl9sYXllcnMpe3Q9dGhpcy5fbGF5ZXJzW2ldO2JyZWFrfXJldHVybiBlfHwoZT10LmdldENlbnRlcj90LmdldENlbnRlcigpOnQuZ2V0TGF0TG5nKCkpLHRoaXMuX3Rvb2x0aXAmJnRoaXMuX21hcCYmKHRoaXMuX3Rvb2x0aXAuX3NvdXJjZT10LHRoaXMuX3Rvb2x0aXAudXBkYXRlKCksdGhpcy5fbWFwLm9wZW5Ub29sdGlwKHRoaXMuX3Rvb2x0aXAsZSksdGhpcy5fdG9vbHRpcC5vcHRpb25zLmludGVyYWN0aXZlJiZ0aGlzLl90b29sdGlwLl9jb250YWluZXImJihvLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fdG9vbHRpcC5fY29udGFpbmVyLFwibGVhZmxldC1jbGlja2FibGVcIiksdGhpcy5hZGRJbnRlcmFjdGl2ZVRhcmdldCh0aGlzLl90b29sdGlwLl9jb250YWluZXIpKSksdGhpc30sY2xvc2VUb29sdGlwOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3Rvb2x0aXAmJih0aGlzLl90b29sdGlwLl9jbG9zZSgpLHRoaXMuX3Rvb2x0aXAub3B0aW9ucy5pbnRlcmFjdGl2ZSYmdGhpcy5fdG9vbHRpcC5fY29udGFpbmVyJiYoby5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX3Rvb2x0aXAuX2NvbnRhaW5lcixcImxlYWZsZXQtY2xpY2thYmxlXCIpLHRoaXMucmVtb3ZlSW50ZXJhY3RpdmVUYXJnZXQodGhpcy5fdG9vbHRpcC5fY29udGFpbmVyKSkpLHRoaXN9LHRvZ2dsZVRvb2x0aXA6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX3Rvb2x0aXAmJih0aGlzLl90b29sdGlwLl9tYXA/dGhpcy5jbG9zZVRvb2x0aXAoKTp0aGlzLm9wZW5Ub29sdGlwKHQpKSx0aGlzfSxpc1Rvb2x0aXBPcGVuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3Rvb2x0aXAuaXNPcGVuKCl9LHNldFRvb2x0aXBDb250ZW50OmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl90b29sdGlwJiZ0aGlzLl90b29sdGlwLnNldENvbnRlbnQodCksdGhpc30sZ2V0VG9vbHRpcDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl90b29sdGlwfSxfb3BlblRvb2x0aXA6ZnVuY3Rpb24odCl7dmFyIGU9dC5sYXllcnx8dC50YXJnZXQ7dGhpcy5fdG9vbHRpcCYmdGhpcy5fbWFwJiZ0aGlzLm9wZW5Ub29sdGlwKGUsdGhpcy5fdG9vbHRpcC5vcHRpb25zLnN0aWNreT90LmxhdGxuZzppKX0sX21vdmVUb29sdGlwOmZ1bmN0aW9uKHQpe3ZhciBlLGksbj10LmxhdGxuZzt0aGlzLl90b29sdGlwLm9wdGlvbnMuc3RpY2t5JiZ0Lm9yaWdpbmFsRXZlbnQmJihlPXRoaXMuX21hcC5tb3VzZUV2ZW50VG9Db250YWluZXJQb2ludCh0Lm9yaWdpbmFsRXZlbnQpLGk9dGhpcy5fbWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KGUpLG49dGhpcy5fbWFwLmxheWVyUG9pbnRUb0xhdExuZyhpKSksdGhpcy5fdG9vbHRpcC5zZXRMYXRMbmcobil9fSksby5MYXllckdyb3VwPW8uTGF5ZXIuZXh0ZW5kKHtpbml0aWFsaXplOmZ1bmN0aW9uKHQpe3RoaXMuX2xheWVycz17fTt2YXIgZSxpO2lmKHQpZm9yKGU9MCxpPXQubGVuZ3RoO2U8aTtlKyspdGhpcy5hZGRMYXllcih0W2VdKX0sYWRkTGF5ZXI6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5nZXRMYXllcklkKHQpO3JldHVybiB0aGlzLl9sYXllcnNbZV09dCx0aGlzLl9tYXAmJnRoaXMuX21hcC5hZGRMYXllcih0KSx0aGlzfSxyZW1vdmVMYXllcjpmdW5jdGlvbih0KXt2YXIgZT10IGluIHRoaXMuX2xheWVycz90OnRoaXMuZ2V0TGF5ZXJJZCh0KTtyZXR1cm4gdGhpcy5fbWFwJiZ0aGlzLl9sYXllcnNbZV0mJnRoaXMuX21hcC5yZW1vdmVMYXllcih0aGlzLl9sYXllcnNbZV0pLGRlbGV0ZSB0aGlzLl9sYXllcnNbZV0sdGhpc30saGFzTGF5ZXI6ZnVuY3Rpb24odCl7cmV0dXJuISF0JiYodCBpbiB0aGlzLl9sYXllcnN8fHRoaXMuZ2V0TGF5ZXJJZCh0KWluIHRoaXMuX2xheWVycyl9LGNsZWFyTGF5ZXJzOmZ1bmN0aW9uKCl7Zm9yKHZhciB0IGluIHRoaXMuX2xheWVycyl0aGlzLnJlbW92ZUxheWVyKHRoaXMuX2xheWVyc1t0XSk7cmV0dXJuIHRoaXN9LGludm9rZTpmdW5jdGlvbih0KXt2YXIgZSxpLG49QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2ZvcihlIGluIHRoaXMuX2xheWVycylpPXRoaXMuX2xheWVyc1tlXSxpW3RdJiZpW3RdLmFwcGx5KGksbik7cmV0dXJuIHRoaXN9LG9uQWRkOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSBpbiB0aGlzLl9sYXllcnMpdC5hZGRMYXllcih0aGlzLl9sYXllcnNbZV0pfSxvblJlbW92ZTpmdW5jdGlvbih0KXtmb3IodmFyIGUgaW4gdGhpcy5fbGF5ZXJzKXQucmVtb3ZlTGF5ZXIodGhpcy5fbGF5ZXJzW2VdKX0sZWFjaExheWVyOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBpIGluIHRoaXMuX2xheWVycyl0LmNhbGwoZSx0aGlzLl9sYXllcnNbaV0pO3JldHVybiB0aGlzfSxnZXRMYXllcjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fbGF5ZXJzW3RdfSxnZXRMYXllcnM6ZnVuY3Rpb24oKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gdGhpcy5fbGF5ZXJzKXQucHVzaCh0aGlzLl9sYXllcnNbZV0pO3JldHVybiB0fSxzZXRaSW5kZXg6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuaW52b2tlKFwic2V0WkluZGV4XCIsdCl9LGdldExheWVySWQ6ZnVuY3Rpb24odCl7cmV0dXJuIG8uc3RhbXAodCl9fSksby5sYXllckdyb3VwPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5MYXllckdyb3VwKHQpfSxvLkZlYXR1cmVHcm91cD1vLkxheWVyR3JvdXAuZXh0ZW5kKHthZGRMYXllcjpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5oYXNMYXllcih0KT90aGlzOih0LmFkZEV2ZW50UGFyZW50KHRoaXMpLG8uTGF5ZXJHcm91cC5wcm90b3R5cGUuYWRkTGF5ZXIuY2FsbCh0aGlzLHQpLHRoaXMuZmlyZShcImxheWVyYWRkXCIse2xheWVyOnR9KSl9LHJlbW92ZUxheWVyOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmhhc0xheWVyKHQpPyh0IGluIHRoaXMuX2xheWVycyYmKHQ9dGhpcy5fbGF5ZXJzW3RdKSx0LnJlbW92ZUV2ZW50UGFyZW50KHRoaXMpLG8uTGF5ZXJHcm91cC5wcm90b3R5cGUucmVtb3ZlTGF5ZXIuY2FsbCh0aGlzLHQpLHRoaXMuZmlyZShcImxheWVycmVtb3ZlXCIse2xheWVyOnR9KSk6dGhpc30sc2V0U3R5bGU6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuaW52b2tlKFwic2V0U3R5bGVcIix0KX0sYnJpbmdUb0Zyb250OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW52b2tlKFwiYnJpbmdUb0Zyb250XCIpfSxicmluZ1RvQmFjazpmdW5jdGlvbigpe3JldHVybiB0aGlzLmludm9rZShcImJyaW5nVG9CYWNrXCIpfSxnZXRCb3VuZHM6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgby5MYXRMbmdCb3VuZHM7Zm9yKHZhciBlIGluIHRoaXMuX2xheWVycyl7dmFyIGk9dGhpcy5fbGF5ZXJzW2VdO3QuZXh0ZW5kKGkuZ2V0Qm91bmRzP2kuZ2V0Qm91bmRzKCk6aS5nZXRMYXRMbmcoKSl9cmV0dXJuIHR9fSksby5mZWF0dXJlR3JvdXA9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLkZlYXR1cmVHcm91cCh0KX0sby5SZW5kZXJlcj1vLkxheWVyLmV4dGVuZCh7b3B0aW9uczp7cGFkZGluZzouMX0saW5pdGlhbGl6ZTpmdW5jdGlvbih0KXtvLnNldE9wdGlvbnModGhpcyx0KSxvLnN0YW1wKHRoaXMpLHRoaXMuX2xheWVycz10aGlzLl9sYXllcnN8fHt9fSxvbkFkZDpmdW5jdGlvbigpe3RoaXMuX2NvbnRhaW5lcnx8KHRoaXMuX2luaXRDb250YWluZXIoKSx0aGlzLl96b29tQW5pbWF0ZWQmJm8uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9jb250YWluZXIsXCJsZWFmbGV0LXpvb20tYW5pbWF0ZWRcIikpLHRoaXMuZ2V0UGFuZSgpLmFwcGVuZENoaWxkKHRoaXMuX2NvbnRhaW5lciksdGhpcy5fdXBkYXRlKCksdGhpcy5vbihcInVwZGF0ZVwiLHRoaXMuX3VwZGF0ZVBhdGhzLHRoaXMpfSxvblJlbW92ZTpmdW5jdGlvbigpe28uRG9tVXRpbC5yZW1vdmUodGhpcy5fY29udGFpbmVyKSx0aGlzLm9mZihcInVwZGF0ZVwiLHRoaXMuX3VwZGF0ZVBhdGhzLHRoaXMpfSxnZXRFdmVudHM6ZnVuY3Rpb24oKXt2YXIgdD17dmlld3Jlc2V0OnRoaXMuX3Jlc2V0LHpvb206dGhpcy5fb25ab29tLG1vdmVlbmQ6dGhpcy5fdXBkYXRlLHpvb21lbmQ6dGhpcy5fb25ab29tRW5kfTtyZXR1cm4gdGhpcy5fem9vbUFuaW1hdGVkJiYodC56b29tYW5pbT10aGlzLl9vbkFuaW1ab29tKSx0fSxfb25BbmltWm9vbTpmdW5jdGlvbih0KXt0aGlzLl91cGRhdGVUcmFuc2Zvcm0odC5jZW50ZXIsdC56b29tKX0sX29uWm9vbTpmdW5jdGlvbigpe3RoaXMuX3VwZGF0ZVRyYW5zZm9ybSh0aGlzLl9tYXAuZ2V0Q2VudGVyKCksdGhpcy5fbWFwLmdldFpvb20oKSl9LF91cGRhdGVUcmFuc2Zvcm06ZnVuY3Rpb24odCxlKXt2YXIgaT10aGlzLl9tYXAuZ2V0Wm9vbVNjYWxlKGUsdGhpcy5fem9vbSksbj1vLkRvbVV0aWwuZ2V0UG9zaXRpb24odGhpcy5fY29udGFpbmVyKSxzPXRoaXMuX21hcC5nZXRTaXplKCkubXVsdGlwbHlCeSguNSt0aGlzLm9wdGlvbnMucGFkZGluZykscj10aGlzLl9tYXAucHJvamVjdCh0aGlzLl9jZW50ZXIsZSksYT10aGlzLl9tYXAucHJvamVjdCh0LGUpLGg9YS5zdWJ0cmFjdChyKSxsPXMubXVsdGlwbHlCeSgtaSkuYWRkKG4pLmFkZChzKS5zdWJ0cmFjdChoKTtvLkJyb3dzZXIuYW55M2Q/by5Eb21VdGlsLnNldFRyYW5zZm9ybSh0aGlzLl9jb250YWluZXIsbCxpKTpvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fY29udGFpbmVyLGwpfSxfcmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl91cGRhdGUoKSx0aGlzLl91cGRhdGVUcmFuc2Zvcm0odGhpcy5fY2VudGVyLHRoaXMuX3pvb20pO2Zvcih2YXIgdCBpbiB0aGlzLl9sYXllcnMpdGhpcy5fbGF5ZXJzW3RdLl9yZXNldCgpfSxfb25ab29tRW5kOmZ1bmN0aW9uKCl7Zm9yKHZhciB0IGluIHRoaXMuX2xheWVycyl0aGlzLl9sYXllcnNbdF0uX3Byb2plY3QoKX0sX3VwZGF0ZVBhdGhzOmZ1bmN0aW9uKCl7Zm9yKHZhciB0IGluIHRoaXMuX2xheWVycyl0aGlzLl9sYXllcnNbdF0uX3VwZGF0ZSgpfSxfdXBkYXRlOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5vcHRpb25zLnBhZGRpbmcsZT10aGlzLl9tYXAuZ2V0U2l6ZSgpLGk9dGhpcy5fbWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KGUubXVsdGlwbHlCeSgtdCkpLnJvdW5kKCk7dGhpcy5fYm91bmRzPW5ldyBvLkJvdW5kcyhpLGkuYWRkKGUubXVsdGlwbHlCeSgxKzIqdCkpLnJvdW5kKCkpLHRoaXMuX2NlbnRlcj10aGlzLl9tYXAuZ2V0Q2VudGVyKCksdGhpcy5fem9vbT10aGlzLl9tYXAuZ2V0Wm9vbSgpfX0pLG8uTWFwLmluY2x1ZGUoe2dldFJlbmRlcmVyOmZ1bmN0aW9uKHQpe3ZhciBlPXQub3B0aW9ucy5yZW5kZXJlcnx8dGhpcy5fZ2V0UGFuZVJlbmRlcmVyKHQub3B0aW9ucy5wYW5lKXx8dGhpcy5vcHRpb25zLnJlbmRlcmVyfHx0aGlzLl9yZW5kZXJlcjtyZXR1cm4gZXx8KGU9dGhpcy5fcmVuZGVyZXI9dGhpcy5vcHRpb25zLnByZWZlckNhbnZhcyYmby5jYW52YXMoKXx8by5zdmcoKSksdGhpcy5oYXNMYXllcihlKXx8dGhpcy5hZGRMYXllcihlKSxlfSxfZ2V0UGFuZVJlbmRlcmVyOmZ1bmN0aW9uKHQpe2lmKFwib3ZlcmxheVBhbmVcIj09PXR8fHQ9PT1pKXJldHVybiExO3ZhciBlPXRoaXMuX3BhbmVSZW5kZXJlcnNbdF07cmV0dXJuIGU9PT1pJiYoZT1vLlNWRyYmby5zdmcoe3BhbmU6dH0pfHxvLkNhbnZhcyYmby5jYW52YXMoe3BhbmU6dH0pLHRoaXMuX3BhbmVSZW5kZXJlcnNbdF09ZSksZX19KSxvLlBhdGg9by5MYXllci5leHRlbmQoe29wdGlvbnM6e3N0cm9rZTohMCxjb2xvcjpcIiMzMzg4ZmZcIix3ZWlnaHQ6MyxvcGFjaXR5OjEsbGluZUNhcDpcInJvdW5kXCIsbGluZUpvaW46XCJyb3VuZFwiLGRhc2hBcnJheTpudWxsLGRhc2hPZmZzZXQ6bnVsbCxmaWxsOiExLGZpbGxDb2xvcjpudWxsLGZpbGxPcGFjaXR5Oi4yLGZpbGxSdWxlOlwiZXZlbm9kZFwiLGludGVyYWN0aXZlOiEwfSxiZWZvcmVBZGQ6ZnVuY3Rpb24odCl7dGhpcy5fcmVuZGVyZXI9dC5nZXRSZW5kZXJlcih0aGlzKX0sb25BZGQ6ZnVuY3Rpb24oKXt0aGlzLl9yZW5kZXJlci5faW5pdFBhdGgodGhpcyksdGhpcy5fcmVzZXQoKSx0aGlzLl9yZW5kZXJlci5fYWRkUGF0aCh0aGlzKX0sb25SZW1vdmU6ZnVuY3Rpb24oKXt0aGlzLl9yZW5kZXJlci5fcmVtb3ZlUGF0aCh0aGlzKX0scmVkcmF3OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21hcCYmdGhpcy5fcmVuZGVyZXIuX3VwZGF0ZVBhdGgodGhpcyksdGhpc30sc2V0U3R5bGU6ZnVuY3Rpb24odCl7cmV0dXJuIG8uc2V0T3B0aW9ucyh0aGlzLHQpLHRoaXMuX3JlbmRlcmVyJiZ0aGlzLl9yZW5kZXJlci5fdXBkYXRlU3R5bGUodGhpcyksdGhpc30sYnJpbmdUb0Zyb250OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3JlbmRlcmVyJiZ0aGlzLl9yZW5kZXJlci5fYnJpbmdUb0Zyb250KHRoaXMpLHRoaXN9LGJyaW5nVG9CYWNrOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3JlbmRlcmVyJiZ0aGlzLl9yZW5kZXJlci5fYnJpbmdUb0JhY2sodGhpcyksdGhpc30sZ2V0RWxlbWVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wYXRofSxfcmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9wcm9qZWN0KCksdGhpcy5fdXBkYXRlKCl9LF9jbGlja1RvbGVyYW5jZTpmdW5jdGlvbigpe3JldHVybih0aGlzLm9wdGlvbnMuc3Ryb2tlP3RoaXMub3B0aW9ucy53ZWlnaHQvMjowKSsoby5Ccm93c2VyLnRvdWNoPzEwOjApfX0pLG8uTGluZVV0aWw9e3NpbXBsaWZ5OmZ1bmN0aW9uKHQsZSl7aWYoIWV8fCF0Lmxlbmd0aClyZXR1cm4gdC5zbGljZSgpO3ZhciBpPWUqZTtyZXR1cm4gdD10aGlzLl9yZWR1Y2VQb2ludHModCxpKSx0PXRoaXMuX3NpbXBsaWZ5RFAodCxpKX0scG9pbnRUb1NlZ21lbnREaXN0YW5jZTpmdW5jdGlvbih0LGUsaSl7cmV0dXJuIE1hdGguc3FydCh0aGlzLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0LGUsaSwhMCkpfSxjbG9zZXN0UG9pbnRPblNlZ21lbnQ6ZnVuY3Rpb24odCxlLGkpe3JldHVybiB0aGlzLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0LGUsaSl9LF9zaW1wbGlmeURQOmZ1bmN0aW9uKHQsZSl7dmFyIG49dC5sZW5ndGgsbz10eXBlb2YgVWludDhBcnJheSE9aStcIlwiP1VpbnQ4QXJyYXk6QXJyYXkscz1uZXcgbyhuKTtzWzBdPXNbbi0xXT0xLHRoaXMuX3NpbXBsaWZ5RFBTdGVwKHQscyxlLDAsbi0xKTt2YXIgcixhPVtdO2ZvcihyPTA7cjxuO3IrKylzW3JdJiZhLnB1c2godFtyXSk7cmV0dXJuIGF9LF9zaW1wbGlmeURQU3RlcDpmdW5jdGlvbih0LGUsaSxuLG8pe3ZhciBzLHIsYSxoPTA7Zm9yKHI9bisxO3I8PW8tMTtyKyspYT10aGlzLl9zcUNsb3Nlc3RQb2ludE9uU2VnbWVudCh0W3JdLHRbbl0sdFtvXSwhMCksYT5oJiYocz1yLGg9YSk7aD5pJiYoZVtzXT0xLHRoaXMuX3NpbXBsaWZ5RFBTdGVwKHQsZSxpLG4scyksdGhpcy5fc2ltcGxpZnlEUFN0ZXAodCxlLGkscyxvKSl9LF9yZWR1Y2VQb2ludHM6ZnVuY3Rpb24odCxlKXtmb3IodmFyIGk9W3RbMF1dLG49MSxvPTAscz10Lmxlbmd0aDtuPHM7bisrKXRoaXMuX3NxRGlzdCh0W25dLHRbb10pPmUmJihpLnB1c2godFtuXSksbz1uKTtyZXR1cm4gbzxzLTEmJmkucHVzaCh0W3MtMV0pLGl9LGNsaXBTZWdtZW50OmZ1bmN0aW9uKHQsZSxpLG4sbyl7dmFyIHMscixhLGg9bj90aGlzLl9sYXN0Q29kZTp0aGlzLl9nZXRCaXRDb2RlKHQsaSksbD10aGlzLl9nZXRCaXRDb2RlKGUsaSk7Zm9yKHRoaXMuX2xhc3RDb2RlPWw7Oyl7aWYoIShofGwpKXJldHVyblt0LGVdO2lmKGgmbClyZXR1cm4hMTtzPWh8fGwscj10aGlzLl9nZXRFZGdlSW50ZXJzZWN0aW9uKHQsZSxzLGksbyksYT10aGlzLl9nZXRCaXRDb2RlKHIsaSkscz09PWg/KHQ9cixoPWEpOihlPXIsbD1hKX19LF9nZXRFZGdlSW50ZXJzZWN0aW9uOmZ1bmN0aW9uKHQsZSxpLG4scyl7dmFyIHIsYSxoPWUueC10LngsbD1lLnktdC55LHU9bi5taW4sYz1uLm1heDtyZXR1cm4gOCZpPyhyPXQueCtoKihjLnktdC55KS9sLGE9Yy55KTo0Jmk/KHI9dC54K2gqKHUueS10LnkpL2wsYT11LnkpOjImaT8ocj1jLngsYT10LnkrbCooYy54LXQueCkvaCk6MSZpJiYocj11LngsYT10LnkrbCoodS54LXQueCkvaCksbmV3IG8uUG9pbnQocixhLHMpfSxfZ2V0Qml0Q29kZTpmdW5jdGlvbih0LGUpe3ZhciBpPTA7cmV0dXJuIHQueDxlLm1pbi54P2l8PTE6dC54PmUubWF4LngmJihpfD0yKSx0Lnk8ZS5taW4ueT9pfD00OnQueT5lLm1heC55JiYoaXw9OCksaX0sX3NxRGlzdDpmdW5jdGlvbih0LGUpe3ZhciBpPWUueC10Lngsbj1lLnktdC55O3JldHVybiBpKmkrbipufSxfc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQ6ZnVuY3Rpb24odCxlLGksbil7dmFyIHMscj1lLngsYT1lLnksaD1pLngtcixsPWkueS1hLHU9aCpoK2wqbDtyZXR1cm4gdT4wJiYocz0oKHQueC1yKSpoKyh0LnktYSkqbCkvdSxzPjE/KHI9aS54LGE9aS55KTpzPjAmJihyKz1oKnMsYSs9bCpzKSksaD10LngtcixsPXQueS1hLG4/aCpoK2wqbDpuZXcgby5Qb2ludChyLGEpfX0sby5Qb2x5bGluZT1vLlBhdGguZXh0ZW5kKHtvcHRpb25zOntzbW9vdGhGYWN0b3I6MSxub0NsaXA6ITF9LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtvLnNldE9wdGlvbnModGhpcyxlKSx0aGlzLl9zZXRMYXRMbmdzKHQpfSxnZXRMYXRMbmdzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2xhdGxuZ3N9LHNldExhdExuZ3M6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX3NldExhdExuZ3ModCksdGhpcy5yZWRyYXcoKX0saXNFbXB0eTpmdW5jdGlvbigpe3JldHVybiF0aGlzLl9sYXRsbmdzLmxlbmd0aH0sY2xvc2VzdExheWVyUG9pbnQ6ZnVuY3Rpb24odCl7Zm9yKHZhciBlLGksbj0xLzAscz1udWxsLHI9by5MaW5lVXRpbC5fc3FDbG9zZXN0UG9pbnRPblNlZ21lbnQsYT0wLGg9dGhpcy5fcGFydHMubGVuZ3RoO2E8aDthKyspZm9yKHZhciBsPXRoaXMuX3BhcnRzW2FdLHU9MSxjPWwubGVuZ3RoO3U8Yzt1Kyspe2U9bFt1LTFdLGk9bFt1XTt2YXIgZD1yKHQsZSxpLCEwKTtkPG4mJihuPWQscz1yKHQsZSxpKSl9cmV0dXJuIHMmJihzLmRpc3RhbmNlPU1hdGguc3FydChuKSksc30sZ2V0Q2VudGVyOmZ1bmN0aW9uKCl7aWYoIXRoaXMuX21hcCl0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IGFkZCBsYXllciB0byBtYXAgYmVmb3JlIHVzaW5nIGdldENlbnRlcigpXCIpO3ZhciB0LGUsaSxuLG8scyxyLGE9dGhpcy5fcmluZ3NbMF0saD1hLmxlbmd0aDtpZighaClyZXR1cm4gbnVsbDtmb3IodD0wLGU9MDt0PGgtMTt0KyspZSs9YVt0XS5kaXN0YW5jZVRvKGFbdCsxXSkvMjtpZigwPT09ZSlyZXR1cm4gdGhpcy5fbWFwLmxheWVyUG9pbnRUb0xhdExuZyhhWzBdKTtmb3IodD0wLG49MDt0PGgtMTt0KyspaWYobz1hW3RdLHM9YVt0KzFdLGk9by5kaXN0YW5jZVRvKHMpLG4rPWksbj5lKXJldHVybiByPShuLWUpL2ksdGhpcy5fbWFwLmxheWVyUG9pbnRUb0xhdExuZyhbcy54LXIqKHMueC1vLngpLHMueS1yKihzLnktby55KV0pfSxnZXRCb3VuZHM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fYm91bmRzfSxhZGRMYXRMbmc6ZnVuY3Rpb24odCxlKXtyZXR1cm4gZT1lfHx0aGlzLl9kZWZhdWx0U2hhcGUoKSx0PW8ubGF0TG5nKHQpLGUucHVzaCh0KSx0aGlzLl9ib3VuZHMuZXh0ZW5kKHQpLHRoaXMucmVkcmF3KCl9LF9zZXRMYXRMbmdzOmZ1bmN0aW9uKHQpe3RoaXMuX2JvdW5kcz1uZXcgby5MYXRMbmdCb3VuZHMsdGhpcy5fbGF0bG5ncz10aGlzLl9jb252ZXJ0TGF0TG5ncyh0KX0sX2RlZmF1bHRTaGFwZTpmdW5jdGlvbigpe3JldHVybiBvLlBvbHlsaW5lLl9mbGF0KHRoaXMuX2xhdGxuZ3MpP3RoaXMuX2xhdGxuZ3M6dGhpcy5fbGF0bG5nc1swXX0sX2NvbnZlcnRMYXRMbmdzOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1bXSxpPW8uUG9seWxpbmUuX2ZsYXQodCksbj0wLHM9dC5sZW5ndGg7bjxzO24rKylpPyhlW25dPW8ubGF0TG5nKHRbbl0pLHRoaXMuX2JvdW5kcy5leHRlbmQoZVtuXSkpOmVbbl09dGhpcy5fY29udmVydExhdExuZ3ModFtuXSk7cmV0dXJuIGV9LF9wcm9qZWN0OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IG8uQm91bmRzO3RoaXMuX3JpbmdzPVtdLHRoaXMuX3Byb2plY3RMYXRsbmdzKHRoaXMuX2xhdGxuZ3MsdGhpcy5fcmluZ3MsdCk7dmFyIGU9dGhpcy5fY2xpY2tUb2xlcmFuY2UoKSxpPW5ldyBvLlBvaW50KGUsZSk7dGhpcy5fYm91bmRzLmlzVmFsaWQoKSYmdC5pc1ZhbGlkKCkmJih0Lm1pbi5fc3VidHJhY3QoaSksdC5tYXguX2FkZChpKSx0aGlzLl9weEJvdW5kcz10KX0sX3Byb2plY3RMYXRsbmdzOmZ1bmN0aW9uKHQsZSxpKXt2YXIgbixzLHI9dFswXWluc3RhbmNlb2Ygby5MYXRMbmcsYT10Lmxlbmd0aDtpZihyKXtmb3Iocz1bXSxuPTA7bjxhO24rKylzW25dPXRoaXMuX21hcC5sYXRMbmdUb0xheWVyUG9pbnQodFtuXSksaS5leHRlbmQoc1tuXSk7ZS5wdXNoKHMpfWVsc2UgZm9yKG49MDtuPGE7bisrKXRoaXMuX3Byb2plY3RMYXRsbmdzKHRbbl0sZSxpKX0sX2NsaXBQb2ludHM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9yZW5kZXJlci5fYm91bmRzO2lmKHRoaXMuX3BhcnRzPVtdLHRoaXMuX3B4Qm91bmRzJiZ0aGlzLl9weEJvdW5kcy5pbnRlcnNlY3RzKHQpKXtpZih0aGlzLm9wdGlvbnMubm9DbGlwKXJldHVybiB2b2lkKHRoaXMuX3BhcnRzPXRoaXMuX3JpbmdzKTt2YXIgZSxpLG4scyxyLGEsaCxsPXRoaXMuX3BhcnRzO2ZvcihlPTAsbj0wLHM9dGhpcy5fcmluZ3MubGVuZ3RoO2U8cztlKyspZm9yKGg9dGhpcy5fcmluZ3NbZV0saT0wLHI9aC5sZW5ndGg7aTxyLTE7aSsrKWE9by5MaW5lVXRpbC5jbGlwU2VnbWVudChoW2ldLGhbaSsxXSx0LGksITApLGEmJihsW25dPWxbbl18fFtdLGxbbl0ucHVzaChhWzBdKSxhWzFdPT09aFtpKzFdJiZpIT09ci0yfHwobFtuXS5wdXNoKGFbMV0pLG4rKykpfX0sX3NpbXBsaWZ5UG9pbnRzOmZ1bmN0aW9uKCl7Zm9yKHZhciB0PXRoaXMuX3BhcnRzLGU9dGhpcy5vcHRpb25zLnNtb290aEZhY3RvcixpPTAsbj10Lmxlbmd0aDtpPG47aSsrKXRbaV09by5MaW5lVXRpbC5zaW1wbGlmeSh0W2ldLGUpfSxfdXBkYXRlOmZ1bmN0aW9uKCl7dGhpcy5fbWFwJiYodGhpcy5fY2xpcFBvaW50cygpLHRoaXMuX3NpbXBsaWZ5UG9pbnRzKCksdGhpcy5fdXBkYXRlUGF0aCgpKX0sX3VwZGF0ZVBhdGg6ZnVuY3Rpb24oKXt0aGlzLl9yZW5kZXJlci5fdXBkYXRlUG9seSh0aGlzKX19KSxvLnBvbHlsaW5lPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLlBvbHlsaW5lKHQsZSl9LG8uUG9seWxpbmUuX2ZsYXQ9ZnVuY3Rpb24odCl7cmV0dXJuIW8uVXRpbC5pc0FycmF5KHRbMF0pfHxcIm9iamVjdFwiIT10eXBlb2YgdFswXVswXSYmXCJ1bmRlZmluZWRcIiE9dHlwZW9mIHRbMF1bMF19LG8uUG9seVV0aWw9e30sby5Qb2x5VXRpbC5jbGlwUG9seWdvbj1mdW5jdGlvbih0LGUsaSl7dmFyIG4scyxyLGEsaCxsLHUsYyxkLF89WzEsNCwyLDhdLG09by5MaW5lVXRpbDtmb3Iocz0wLHU9dC5sZW5ndGg7czx1O3MrKyl0W3NdLl9jb2RlPW0uX2dldEJpdENvZGUodFtzXSxlKTtmb3IoYT0wO2E8NDthKyspe2ZvcihjPV9bYV0sbj1bXSxzPTAsdT10Lmxlbmd0aCxyPXUtMTtzPHU7cj1zKyspaD10W3NdLGw9dFtyXSxoLl9jb2RlJmM/bC5fY29kZSZjfHwoZD1tLl9nZXRFZGdlSW50ZXJzZWN0aW9uKGwsaCxjLGUsaSksZC5fY29kZT1tLl9nZXRCaXRDb2RlKGQsZSksbi5wdXNoKGQpKToobC5fY29kZSZjJiYoZD1tLl9nZXRFZGdlSW50ZXJzZWN0aW9uKGwsaCxjLGUsaSksZC5fY29kZT1tLl9nZXRCaXRDb2RlKGQsZSksbi5wdXNoKGQpKSxuLnB1c2goaCkpO3Q9bn1yZXR1cm4gdH0sby5Qb2x5Z29uPW8uUG9seWxpbmUuZXh0ZW5kKHtvcHRpb25zOntmaWxsOiEwfSxpc0VtcHR5OmZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMuX2xhdGxuZ3MubGVuZ3RofHwhdGhpcy5fbGF0bG5nc1swXS5sZW5ndGh9LGdldENlbnRlcjpmdW5jdGlvbigpe2lmKCF0aGlzLl9tYXApdGhyb3cgbmV3IEVycm9yKFwiTXVzdCBhZGQgbGF5ZXIgdG8gbWFwIGJlZm9yZSB1c2luZyBnZXRDZW50ZXIoKVwiKTt2YXIgdCxlLGksbixvLHMscixhLGgsbD10aGlzLl9yaW5nc1swXSx1PWwubGVuZ3RoO2lmKCF1KXJldHVybiBudWxsO2ZvcihzPXI9YT0wLHQ9MCxlPXUtMTt0PHU7ZT10KyspaT1sW3RdLG49bFtlXSxvPWkueSpuLngtbi55KmkueCxyKz0oaS54K24ueCkqbyxhKz0oaS55K24ueSkqbyxzKz0zKm87cmV0dXJuIGg9MD09PXM/bFswXTpbci9zLGEvc10sdGhpcy5fbWFwLmxheWVyUG9pbnRUb0xhdExuZyhoKX0sX2NvbnZlcnRMYXRMbmdzOmZ1bmN0aW9uKHQpe3ZhciBlPW8uUG9seWxpbmUucHJvdG90eXBlLl9jb252ZXJ0TGF0TG5ncy5jYWxsKHRoaXMsdCksaT1lLmxlbmd0aDtyZXR1cm4gaT49MiYmZVswXWluc3RhbmNlb2Ygby5MYXRMbmcmJmVbMF0uZXF1YWxzKGVbaS0xXSkmJmUucG9wKCksZX0sX3NldExhdExuZ3M6ZnVuY3Rpb24odCl7by5Qb2x5bGluZS5wcm90b3R5cGUuX3NldExhdExuZ3MuY2FsbCh0aGlzLHQpLG8uUG9seWxpbmUuX2ZsYXQodGhpcy5fbGF0bG5ncykmJih0aGlzLl9sYXRsbmdzPVt0aGlzLl9sYXRsbmdzXSl9LF9kZWZhdWx0U2hhcGU6ZnVuY3Rpb24oKXtyZXR1cm4gby5Qb2x5bGluZS5fZmxhdCh0aGlzLl9sYXRsbmdzWzBdKT90aGlzLl9sYXRsbmdzWzBdOnRoaXMuX2xhdGxuZ3NbMF1bMF19LF9jbGlwUG9pbnRzOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fcmVuZGVyZXIuX2JvdW5kcyxlPXRoaXMub3B0aW9ucy53ZWlnaHQsaT1uZXcgby5Qb2ludChlLGUpO2lmKHQ9bmV3IG8uQm91bmRzKHQubWluLnN1YnRyYWN0KGkpLHQubWF4LmFkZChpKSksdGhpcy5fcGFydHM9W10sdGhpcy5fcHhCb3VuZHMmJnRoaXMuX3B4Qm91bmRzLmludGVyc2VjdHModCkpe2lmKHRoaXMub3B0aW9ucy5ub0NsaXApcmV0dXJuIHZvaWQodGhpcy5fcGFydHM9dGhpcy5fcmluZ3MpO2Zvcih2YXIgbixzPTAscj10aGlzLl9yaW5ncy5sZW5ndGg7czxyO3MrKyluPW8uUG9seVV0aWwuY2xpcFBvbHlnb24odGhpcy5fcmluZ3Nbc10sdCwhMCksbi5sZW5ndGgmJnRoaXMuX3BhcnRzLnB1c2gobil9fSxfdXBkYXRlUGF0aDpmdW5jdGlvbigpe3RoaXMuX3JlbmRlcmVyLl91cGRhdGVQb2x5KHRoaXMsITApfX0pLG8ucG9seWdvbj1mdW5jdGlvbih0LGUpe3JldHVybiBuZXcgby5Qb2x5Z29uKHQsZSl9LG8uUmVjdGFuZ2xlPW8uUG9seWdvbi5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCxlKXtvLlBvbHlnb24ucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLHRoaXMuX2JvdW5kc1RvTGF0TG5ncyh0KSxlKX0sc2V0Qm91bmRzOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLnNldExhdExuZ3ModGhpcy5fYm91bmRzVG9MYXRMbmdzKHQpKX0sX2JvdW5kc1RvTGF0TG5nczpmdW5jdGlvbih0KXtyZXR1cm4gdD1vLmxhdExuZ0JvdW5kcyh0KSxbdC5nZXRTb3V0aFdlc3QoKSx0LmdldE5vcnRoV2VzdCgpLHQuZ2V0Tm9ydGhFYXN0KCksdC5nZXRTb3V0aEVhc3QoKV19fSksby5yZWN0YW5nbGU9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uUmVjdGFuZ2xlKHQsZSl9LG8uQ2lyY2xlTWFya2VyPW8uUGF0aC5leHRlbmQoe29wdGlvbnM6e2ZpbGw6ITAscmFkaXVzOjEwfSxpbml0aWFsaXplOmZ1bmN0aW9uKHQsZSl7by5zZXRPcHRpb25zKHRoaXMsZSksdGhpcy5fbGF0bG5nPW8ubGF0TG5nKHQpLHRoaXMuX3JhZGl1cz10aGlzLm9wdGlvbnMucmFkaXVzfSxzZXRMYXRMbmc6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2xhdGxuZz1vLmxhdExuZyh0KSx0aGlzLnJlZHJhdygpLHRoaXMuZmlyZShcIm1vdmVcIix7bGF0bG5nOnRoaXMuX2xhdGxuZ30pfSxnZXRMYXRMbmc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbGF0bG5nfSxzZXRSYWRpdXM6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMub3B0aW9ucy5yYWRpdXM9dGhpcy5fcmFkaXVzPXQsdGhpcy5yZWRyYXcoKX0sZ2V0UmFkaXVzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3JhZGl1c30sc2V0U3R5bGU6ZnVuY3Rpb24odCl7dmFyIGU9dCYmdC5yYWRpdXN8fHRoaXMuX3JhZGl1cztyZXR1cm4gby5QYXRoLnByb3RvdHlwZS5zZXRTdHlsZS5jYWxsKHRoaXMsdCksdGhpcy5zZXRSYWRpdXMoZSksdGhpc30sX3Byb2plY3Q6ZnVuY3Rpb24oKXt0aGlzLl9wb2ludD10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KHRoaXMuX2xhdGxuZyksdGhpcy5fdXBkYXRlQm91bmRzKCl9LF91cGRhdGVCb3VuZHM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9yYWRpdXMsZT10aGlzLl9yYWRpdXNZfHx0LGk9dGhpcy5fY2xpY2tUb2xlcmFuY2UoKSxuPVt0K2ksZStpXTt0aGlzLl9weEJvdW5kcz1uZXcgby5Cb3VuZHModGhpcy5fcG9pbnQuc3VidHJhY3QobiksdGhpcy5fcG9pbnQuYWRkKG4pKX0sX3VwZGF0ZTpmdW5jdGlvbigpe3RoaXMuX21hcCYmdGhpcy5fdXBkYXRlUGF0aCgpfSxfdXBkYXRlUGF0aDpmdW5jdGlvbigpe3RoaXMuX3JlbmRlcmVyLl91cGRhdGVDaXJjbGUodGhpcyl9LF9lbXB0eTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9yYWRpdXMmJiF0aGlzLl9yZW5kZXJlci5fYm91bmRzLmludGVyc2VjdHModGhpcy5fcHhCb3VuZHMpfX0pLG8uY2lyY2xlTWFya2VyPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBvLkNpcmNsZU1hcmtlcih0LGUpfSxvLkNpcmNsZT1vLkNpcmNsZU1hcmtlci5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCxlLGkpe2lmKFwibnVtYmVyXCI9PXR5cGVvZiBlJiYoZT1vLmV4dGVuZCh7fSxpLHtyYWRpdXM6ZX0pKSxvLnNldE9wdGlvbnModGhpcyxlKSx0aGlzLl9sYXRsbmc9by5sYXRMbmcodCksaXNOYU4odGhpcy5vcHRpb25zLnJhZGl1cykpdGhyb3cgbmV3IEVycm9yKFwiQ2lyY2xlIHJhZGl1cyBjYW5ub3QgYmUgTmFOXCIpO3RoaXMuX21SYWRpdXM9dGhpcy5vcHRpb25zLnJhZGl1c30sc2V0UmFkaXVzOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9tUmFkaXVzPXQsXG50aGlzLnJlZHJhdygpfSxnZXRSYWRpdXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbVJhZGl1c30sZ2V0Qm91bmRzOmZ1bmN0aW9uKCl7dmFyIHQ9W3RoaXMuX3JhZGl1cyx0aGlzLl9yYWRpdXNZfHx0aGlzLl9yYWRpdXNdO3JldHVybiBuZXcgby5MYXRMbmdCb3VuZHModGhpcy5fbWFwLmxheWVyUG9pbnRUb0xhdExuZyh0aGlzLl9wb2ludC5zdWJ0cmFjdCh0KSksdGhpcy5fbWFwLmxheWVyUG9pbnRUb0xhdExuZyh0aGlzLl9wb2ludC5hZGQodCkpKX0sc2V0U3R5bGU6by5QYXRoLnByb3RvdHlwZS5zZXRTdHlsZSxfcHJvamVjdDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2xhdGxuZy5sbmcsZT10aGlzLl9sYXRsbmcubGF0LGk9dGhpcy5fbWFwLG49aS5vcHRpb25zLmNycztpZihuLmRpc3RhbmNlPT09by5DUlMuRWFydGguZGlzdGFuY2Upe3ZhciBzPU1hdGguUEkvMTgwLHI9dGhpcy5fbVJhZGl1cy9vLkNSUy5FYXJ0aC5SL3MsYT1pLnByb2plY3QoW2Urcix0XSksaD1pLnByb2plY3QoW2Utcix0XSksbD1hLmFkZChoKS5kaXZpZGVCeSgyKSx1PWkudW5wcm9qZWN0KGwpLmxhdCxjPU1hdGguYWNvcygoTWF0aC5jb3MocipzKS1NYXRoLnNpbihlKnMpKk1hdGguc2luKHUqcykpLyhNYXRoLmNvcyhlKnMpKk1hdGguY29zKHUqcykpKS9zOyhpc05hTihjKXx8MD09PWMpJiYoYz1yL01hdGguY29zKE1hdGguUEkvMTgwKmUpKSx0aGlzLl9wb2ludD1sLnN1YnRyYWN0KGkuZ2V0UGl4ZWxPcmlnaW4oKSksdGhpcy5fcmFkaXVzPWlzTmFOKGMpPzA6TWF0aC5tYXgoTWF0aC5yb3VuZChsLngtaS5wcm9qZWN0KFt1LHQtY10pLngpLDEpLHRoaXMuX3JhZGl1c1k9TWF0aC5tYXgoTWF0aC5yb3VuZChsLnktYS55KSwxKX1lbHNle3ZhciBkPW4udW5wcm9qZWN0KG4ucHJvamVjdCh0aGlzLl9sYXRsbmcpLnN1YnRyYWN0KFt0aGlzLl9tUmFkaXVzLDBdKSk7dGhpcy5fcG9pbnQ9aS5sYXRMbmdUb0xheWVyUG9pbnQodGhpcy5fbGF0bG5nKSx0aGlzLl9yYWRpdXM9dGhpcy5fcG9pbnQueC1pLmxhdExuZ1RvTGF5ZXJQb2ludChkKS54fXRoaXMuX3VwZGF0ZUJvdW5kcygpfX0pLG8uY2lyY2xlPWZ1bmN0aW9uKHQsZSxpKXtyZXR1cm4gbmV3IG8uQ2lyY2xlKHQsZSxpKX0sby5TVkc9by5SZW5kZXJlci5leHRlbmQoe2dldEV2ZW50czpmdW5jdGlvbigpe3ZhciB0PW8uUmVuZGVyZXIucHJvdG90eXBlLmdldEV2ZW50cy5jYWxsKHRoaXMpO3JldHVybiB0Lnpvb21zdGFydD10aGlzLl9vblpvb21TdGFydCx0fSxfaW5pdENvbnRhaW5lcjpmdW5jdGlvbigpe3RoaXMuX2NvbnRhaW5lcj1vLlNWRy5jcmVhdGUoXCJzdmdcIiksdGhpcy5fY29udGFpbmVyLnNldEF0dHJpYnV0ZShcInBvaW50ZXItZXZlbnRzXCIsXCJub25lXCIpLHRoaXMuX3Jvb3RHcm91cD1vLlNWRy5jcmVhdGUoXCJnXCIpLHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9yb290R3JvdXApfSxfb25ab29tU3RhcnQ6ZnVuY3Rpb24oKXt0aGlzLl91cGRhdGUoKX0sX3VwZGF0ZTpmdW5jdGlvbigpe2lmKCF0aGlzLl9tYXAuX2FuaW1hdGluZ1pvb218fCF0aGlzLl9ib3VuZHMpe28uUmVuZGVyZXIucHJvdG90eXBlLl91cGRhdGUuY2FsbCh0aGlzKTt2YXIgdD10aGlzLl9ib3VuZHMsZT10LmdldFNpemUoKSxpPXRoaXMuX2NvbnRhaW5lcjt0aGlzLl9zdmdTaXplJiZ0aGlzLl9zdmdTaXplLmVxdWFscyhlKXx8KHRoaXMuX3N2Z1NpemU9ZSxpLnNldEF0dHJpYnV0ZShcIndpZHRoXCIsZS54KSxpLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLGUueSkpLG8uRG9tVXRpbC5zZXRQb3NpdGlvbihpLHQubWluKSxpLnNldEF0dHJpYnV0ZShcInZpZXdCb3hcIixbdC5taW4ueCx0Lm1pbi55LGUueCxlLnldLmpvaW4oXCIgXCIpKSx0aGlzLmZpcmUoXCJ1cGRhdGVcIil9fSxfaW5pdFBhdGg6ZnVuY3Rpb24odCl7dmFyIGU9dC5fcGF0aD1vLlNWRy5jcmVhdGUoXCJwYXRoXCIpO3Qub3B0aW9ucy5jbGFzc05hbWUmJm8uRG9tVXRpbC5hZGRDbGFzcyhlLHQub3B0aW9ucy5jbGFzc05hbWUpLHQub3B0aW9ucy5pbnRlcmFjdGl2ZSYmby5Eb21VdGlsLmFkZENsYXNzKGUsXCJsZWFmbGV0LWludGVyYWN0aXZlXCIpLHRoaXMuX3VwZGF0ZVN0eWxlKHQpLHRoaXMuX2xheWVyc1tvLnN0YW1wKHQpXT10fSxfYWRkUGF0aDpmdW5jdGlvbih0KXt0aGlzLl9yb290R3JvdXAuYXBwZW5kQ2hpbGQodC5fcGF0aCksdC5hZGRJbnRlcmFjdGl2ZVRhcmdldCh0Ll9wYXRoKX0sX3JlbW92ZVBhdGg6ZnVuY3Rpb24odCl7by5Eb21VdGlsLnJlbW92ZSh0Ll9wYXRoKSx0LnJlbW92ZUludGVyYWN0aXZlVGFyZ2V0KHQuX3BhdGgpLGRlbGV0ZSB0aGlzLl9sYXllcnNbby5zdGFtcCh0KV19LF91cGRhdGVQYXRoOmZ1bmN0aW9uKHQpe3QuX3Byb2plY3QoKSx0Ll91cGRhdGUoKX0sX3VwZGF0ZVN0eWxlOmZ1bmN0aW9uKHQpe3ZhciBlPXQuX3BhdGgsaT10Lm9wdGlvbnM7ZSYmKGkuc3Ryb2tlPyhlLnNldEF0dHJpYnV0ZShcInN0cm9rZVwiLGkuY29sb3IpLGUuc2V0QXR0cmlidXRlKFwic3Ryb2tlLW9wYWNpdHlcIixpLm9wYWNpdHkpLGUuc2V0QXR0cmlidXRlKFwic3Ryb2tlLXdpZHRoXCIsaS53ZWlnaHQpLGUuc2V0QXR0cmlidXRlKFwic3Ryb2tlLWxpbmVjYXBcIixpLmxpbmVDYXApLGUuc2V0QXR0cmlidXRlKFwic3Ryb2tlLWxpbmVqb2luXCIsaS5saW5lSm9pbiksaS5kYXNoQXJyYXk/ZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2UtZGFzaGFycmF5XCIsaS5kYXNoQXJyYXkpOmUucmVtb3ZlQXR0cmlidXRlKFwic3Ryb2tlLWRhc2hhcnJheVwiKSxpLmRhc2hPZmZzZXQ/ZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2UtZGFzaG9mZnNldFwiLGkuZGFzaE9mZnNldCk6ZS5yZW1vdmVBdHRyaWJ1dGUoXCJzdHJva2UtZGFzaG9mZnNldFwiKSk6ZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIixcIm5vbmVcIiksaS5maWxsPyhlLnNldEF0dHJpYnV0ZShcImZpbGxcIixpLmZpbGxDb2xvcnx8aS5jb2xvciksZS5zZXRBdHRyaWJ1dGUoXCJmaWxsLW9wYWNpdHlcIixpLmZpbGxPcGFjaXR5KSxlLnNldEF0dHJpYnV0ZShcImZpbGwtcnVsZVwiLGkuZmlsbFJ1bGV8fFwiZXZlbm9kZFwiKSk6ZS5zZXRBdHRyaWJ1dGUoXCJmaWxsXCIsXCJub25lXCIpKX0sX3VwZGF0ZVBvbHk6ZnVuY3Rpb24odCxlKXt0aGlzLl9zZXRQYXRoKHQsby5TVkcucG9pbnRzVG9QYXRoKHQuX3BhcnRzLGUpKX0sX3VwZGF0ZUNpcmNsZTpmdW5jdGlvbih0KXt2YXIgZT10Ll9wb2ludCxpPXQuX3JhZGl1cyxuPXQuX3JhZGl1c1l8fGksbz1cImFcIitpK1wiLFwiK24rXCIgMCAxLDAgXCIscz10Ll9lbXB0eSgpP1wiTTAgMFwiOlwiTVwiKyhlLngtaSkrXCIsXCIrZS55K28rMippK1wiLDAgXCIrbysyKi1pK1wiLDAgXCI7dGhpcy5fc2V0UGF0aCh0LHMpfSxfc2V0UGF0aDpmdW5jdGlvbih0LGUpe3QuX3BhdGguc2V0QXR0cmlidXRlKFwiZFwiLGUpfSxfYnJpbmdUb0Zyb250OmZ1bmN0aW9uKHQpe28uRG9tVXRpbC50b0Zyb250KHQuX3BhdGgpfSxfYnJpbmdUb0JhY2s6ZnVuY3Rpb24odCl7by5Eb21VdGlsLnRvQmFjayh0Ll9wYXRoKX19KSxvLmV4dGVuZChvLlNWRyx7Y3JlYXRlOmZ1bmN0aW9uKHQpe3JldHVybiBlLmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsdCl9LHBvaW50c1RvUGF0aDpmdW5jdGlvbih0LGUpe3ZhciBpLG4scyxyLGEsaCxsPVwiXCI7Zm9yKGk9MCxzPXQubGVuZ3RoO2k8cztpKyspe2ZvcihhPXRbaV0sbj0wLHI9YS5sZW5ndGg7bjxyO24rKyloPWFbbl0sbCs9KG4/XCJMXCI6XCJNXCIpK2gueCtcIiBcIitoLnk7bCs9ZT9vLkJyb3dzZXIuc3ZnP1wielwiOlwieFwiOlwiXCJ9cmV0dXJuIGx8fFwiTTAgMFwifX0pLG8uQnJvd3Nlci5zdmc9ISghZS5jcmVhdGVFbGVtZW50TlN8fCFvLlNWRy5jcmVhdGUoXCJzdmdcIikuY3JlYXRlU1ZHUmVjdCksby5zdmc9ZnVuY3Rpb24odCl7cmV0dXJuIG8uQnJvd3Nlci5zdmd8fG8uQnJvd3Nlci52bWw/bmV3IG8uU1ZHKHQpOm51bGx9LG8uQnJvd3Nlci52bWw9IW8uQnJvd3Nlci5zdmcmJmZ1bmN0aW9uKCl7dHJ5e3ZhciB0PWUuY3JlYXRlRWxlbWVudChcImRpdlwiKTt0LmlubmVySFRNTD0nPHY6c2hhcGUgYWRqPVwiMVwiLz4nO3ZhciBpPXQuZmlyc3RDaGlsZDtyZXR1cm4gaS5zdHlsZS5iZWhhdmlvcj1cInVybCgjZGVmYXVsdCNWTUwpXCIsaSYmXCJvYmplY3RcIj09dHlwZW9mIGkuYWRqfWNhdGNoKHQpe3JldHVybiExfX0oKSxvLlNWRy5pbmNsdWRlKG8uQnJvd3Nlci52bWw/e19pbml0Q29udGFpbmVyOmZ1bmN0aW9uKCl7dGhpcy5fY29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixcImxlYWZsZXQtdm1sLWNvbnRhaW5lclwiKX0sX3VwZGF0ZTpmdW5jdGlvbigpe3RoaXMuX21hcC5fYW5pbWF0aW5nWm9vbXx8KG8uUmVuZGVyZXIucHJvdG90eXBlLl91cGRhdGUuY2FsbCh0aGlzKSx0aGlzLmZpcmUoXCJ1cGRhdGVcIikpfSxfaW5pdFBhdGg6ZnVuY3Rpb24odCl7dmFyIGU9dC5fY29udGFpbmVyPW8uU1ZHLmNyZWF0ZShcInNoYXBlXCIpO28uRG9tVXRpbC5hZGRDbGFzcyhlLFwibGVhZmxldC12bWwtc2hhcGUgXCIrKHRoaXMub3B0aW9ucy5jbGFzc05hbWV8fFwiXCIpKSxlLmNvb3Jkc2l6ZT1cIjEgMVwiLHQuX3BhdGg9by5TVkcuY3JlYXRlKFwicGF0aFwiKSxlLmFwcGVuZENoaWxkKHQuX3BhdGgpLHRoaXMuX3VwZGF0ZVN0eWxlKHQpLHRoaXMuX2xheWVyc1tvLnN0YW1wKHQpXT10fSxfYWRkUGF0aDpmdW5jdGlvbih0KXt2YXIgZT10Ll9jb250YWluZXI7dGhpcy5fY29udGFpbmVyLmFwcGVuZENoaWxkKGUpLHQub3B0aW9ucy5pbnRlcmFjdGl2ZSYmdC5hZGRJbnRlcmFjdGl2ZVRhcmdldChlKX0sX3JlbW92ZVBhdGg6ZnVuY3Rpb24odCl7dmFyIGU9dC5fY29udGFpbmVyO28uRG9tVXRpbC5yZW1vdmUoZSksdC5yZW1vdmVJbnRlcmFjdGl2ZVRhcmdldChlKSxkZWxldGUgdGhpcy5fbGF5ZXJzW28uc3RhbXAodCldfSxfdXBkYXRlU3R5bGU6ZnVuY3Rpb24odCl7dmFyIGU9dC5fc3Ryb2tlLGk9dC5fZmlsbCxuPXQub3B0aW9ucyxzPXQuX2NvbnRhaW5lcjtzLnN0cm9rZWQ9ISFuLnN0cm9rZSxzLmZpbGxlZD0hIW4uZmlsbCxuLnN0cm9rZT8oZXx8KGU9dC5fc3Ryb2tlPW8uU1ZHLmNyZWF0ZShcInN0cm9rZVwiKSkscy5hcHBlbmRDaGlsZChlKSxlLndlaWdodD1uLndlaWdodCtcInB4XCIsZS5jb2xvcj1uLmNvbG9yLGUub3BhY2l0eT1uLm9wYWNpdHksbi5kYXNoQXJyYXk/ZS5kYXNoU3R5bGU9by5VdGlsLmlzQXJyYXkobi5kYXNoQXJyYXkpP24uZGFzaEFycmF5LmpvaW4oXCIgXCIpOm4uZGFzaEFycmF5LnJlcGxhY2UoLyggKiwgKikvZyxcIiBcIik6ZS5kYXNoU3R5bGU9XCJcIixlLmVuZGNhcD1uLmxpbmVDYXAucmVwbGFjZShcImJ1dHRcIixcImZsYXRcIiksZS5qb2luc3R5bGU9bi5saW5lSm9pbik6ZSYmKHMucmVtb3ZlQ2hpbGQoZSksdC5fc3Ryb2tlPW51bGwpLG4uZmlsbD8oaXx8KGk9dC5fZmlsbD1vLlNWRy5jcmVhdGUoXCJmaWxsXCIpKSxzLmFwcGVuZENoaWxkKGkpLGkuY29sb3I9bi5maWxsQ29sb3J8fG4uY29sb3IsaS5vcGFjaXR5PW4uZmlsbE9wYWNpdHkpOmkmJihzLnJlbW92ZUNoaWxkKGkpLHQuX2ZpbGw9bnVsbCl9LF91cGRhdGVDaXJjbGU6ZnVuY3Rpb24odCl7dmFyIGU9dC5fcG9pbnQucm91bmQoKSxpPU1hdGgucm91bmQodC5fcmFkaXVzKSxuPU1hdGgucm91bmQodC5fcmFkaXVzWXx8aSk7dGhpcy5fc2V0UGF0aCh0LHQuX2VtcHR5KCk/XCJNMCAwXCI6XCJBTCBcIitlLngrXCIsXCIrZS55K1wiIFwiK2krXCIsXCIrbitcIiAwLDIzNTkyNjAwXCIpfSxfc2V0UGF0aDpmdW5jdGlvbih0LGUpe3QuX3BhdGgudj1lfSxfYnJpbmdUb0Zyb250OmZ1bmN0aW9uKHQpe28uRG9tVXRpbC50b0Zyb250KHQuX2NvbnRhaW5lcil9LF9icmluZ1RvQmFjazpmdW5jdGlvbih0KXtvLkRvbVV0aWwudG9CYWNrKHQuX2NvbnRhaW5lcil9fTp7fSksby5Ccm93c2VyLnZtbCYmKG8uU1ZHLmNyZWF0ZT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gZS5uYW1lc3BhY2VzLmFkZChcImx2bWxcIixcInVybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206dm1sXCIpLGZ1bmN0aW9uKHQpe3JldHVybiBlLmNyZWF0ZUVsZW1lbnQoXCI8bHZtbDpcIit0KycgY2xhc3M9XCJsdm1sXCI+Jyl9fWNhdGNoKHQpe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gZS5jcmVhdGVFbGVtZW50KFwiPFwiK3QrJyB4bWxucz1cInVybjpzY2hlbWFzLW1pY3Jvc29mdC5jb206dm1sXCIgY2xhc3M9XCJsdm1sXCI+Jyl9fX0oKSksby5DYW52YXM9by5SZW5kZXJlci5leHRlbmQoe2dldEV2ZW50czpmdW5jdGlvbigpe3ZhciB0PW8uUmVuZGVyZXIucHJvdG90eXBlLmdldEV2ZW50cy5jYWxsKHRoaXMpO3JldHVybiB0LnZpZXdwcmVyZXNldD10aGlzLl9vblZpZXdQcmVSZXNldCx0fSxfb25WaWV3UHJlUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9wb3N0cG9uZVVwZGF0ZVBhdGhzPSEwfSxvbkFkZDpmdW5jdGlvbigpe28uUmVuZGVyZXIucHJvdG90eXBlLm9uQWRkLmNhbGwodGhpcyksdGhpcy5fZHJhdygpfSxfaW5pdENvbnRhaW5lcjpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2NvbnRhaW5lcj1lLmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7by5Eb21FdmVudC5vbih0LFwibW91c2Vtb3ZlXCIsby5VdGlsLnRocm90dGxlKHRoaXMuX29uTW91c2VNb3ZlLDMyLHRoaXMpLHRoaXMpLm9uKHQsXCJjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBjb250ZXh0bWVudVwiLHRoaXMuX29uQ2xpY2ssdGhpcykub24odCxcIm1vdXNlb3V0XCIsdGhpcy5faGFuZGxlTW91c2VPdXQsdGhpcyksdGhpcy5fY3R4PXQuZ2V0Q29udGV4dChcIjJkXCIpfSxfdXBkYXRlUGF0aHM6ZnVuY3Rpb24oKXtpZighdGhpcy5fcG9zdHBvbmVVcGRhdGVQYXRocyl7dmFyIHQ7dGhpcy5fcmVkcmF3Qm91bmRzPW51bGw7Zm9yKHZhciBlIGluIHRoaXMuX2xheWVycyl0PXRoaXMuX2xheWVyc1tlXSx0Ll91cGRhdGUoKTt0aGlzLl9yZWRyYXcoKX19LF91cGRhdGU6ZnVuY3Rpb24oKXtpZighdGhpcy5fbWFwLl9hbmltYXRpbmdab29tfHwhdGhpcy5fYm91bmRzKXt0aGlzLl9kcmF3bkxheWVycz17fSxvLlJlbmRlcmVyLnByb3RvdHlwZS5fdXBkYXRlLmNhbGwodGhpcyk7dmFyIHQ9dGhpcy5fYm91bmRzLGU9dGhpcy5fY29udGFpbmVyLGk9dC5nZXRTaXplKCksbj1vLkJyb3dzZXIucmV0aW5hPzI6MTtvLkRvbVV0aWwuc2V0UG9zaXRpb24oZSx0Lm1pbiksZS53aWR0aD1uKmkueCxlLmhlaWdodD1uKmkueSxlLnN0eWxlLndpZHRoPWkueCtcInB4XCIsZS5zdHlsZS5oZWlnaHQ9aS55K1wicHhcIixvLkJyb3dzZXIucmV0aW5hJiZ0aGlzLl9jdHguc2NhbGUoMiwyKSx0aGlzLl9jdHgudHJhbnNsYXRlKC10Lm1pbi54LC10Lm1pbi55KSx0aGlzLmZpcmUoXCJ1cGRhdGVcIil9fSxfcmVzZXQ6ZnVuY3Rpb24oKXtvLlJlbmRlcmVyLnByb3RvdHlwZS5fcmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9wb3N0cG9uZVVwZGF0ZVBhdGhzJiYodGhpcy5fcG9zdHBvbmVVcGRhdGVQYXRocz0hMSx0aGlzLl91cGRhdGVQYXRocygpKX0sX2luaXRQYXRoOmZ1bmN0aW9uKHQpe3RoaXMuX3VwZGF0ZURhc2hBcnJheSh0KSx0aGlzLl9sYXllcnNbby5zdGFtcCh0KV09dDt2YXIgZT10Ll9vcmRlcj17bGF5ZXI6dCxwcmV2OnRoaXMuX2RyYXdMYXN0LG5leHQ6bnVsbH07dGhpcy5fZHJhd0xhc3QmJih0aGlzLl9kcmF3TGFzdC5uZXh0PWUpLHRoaXMuX2RyYXdMYXN0PWUsdGhpcy5fZHJhd0ZpcnN0PXRoaXMuX2RyYXdGaXJzdHx8dGhpcy5fZHJhd0xhc3R9LF9hZGRQYXRoOmZ1bmN0aW9uKHQpe3RoaXMuX3JlcXVlc3RSZWRyYXcodCl9LF9yZW1vdmVQYXRoOmZ1bmN0aW9uKHQpe3ZhciBlPXQuX29yZGVyLGk9ZS5uZXh0LG49ZS5wcmV2O2k/aS5wcmV2PW46dGhpcy5fZHJhd0xhc3Q9bixuP24ubmV4dD1pOnRoaXMuX2RyYXdGaXJzdD1pLGRlbGV0ZSB0Ll9vcmRlcixkZWxldGUgdGhpcy5fbGF5ZXJzW28uc3RhbXAodCldLHRoaXMuX3JlcXVlc3RSZWRyYXcodCl9LF91cGRhdGVQYXRoOmZ1bmN0aW9uKHQpe3RoaXMuX2V4dGVuZFJlZHJhd0JvdW5kcyh0KSx0Ll9wcm9qZWN0KCksdC5fdXBkYXRlKCksdGhpcy5fcmVxdWVzdFJlZHJhdyh0KX0sX3VwZGF0ZVN0eWxlOmZ1bmN0aW9uKHQpe3RoaXMuX3VwZGF0ZURhc2hBcnJheSh0KSx0aGlzLl9yZXF1ZXN0UmVkcmF3KHQpfSxfdXBkYXRlRGFzaEFycmF5OmZ1bmN0aW9uKHQpe2lmKHQub3B0aW9ucy5kYXNoQXJyYXkpe3ZhciBlLGk9dC5vcHRpb25zLmRhc2hBcnJheS5zcGxpdChcIixcIiksbj1bXTtmb3IoZT0wO2U8aS5sZW5ndGg7ZSsrKW4ucHVzaChOdW1iZXIoaVtlXSkpO3Qub3B0aW9ucy5fZGFzaEFycmF5PW59fSxfcmVxdWVzdFJlZHJhdzpmdW5jdGlvbih0KXt0aGlzLl9tYXAmJih0aGlzLl9leHRlbmRSZWRyYXdCb3VuZHModCksdGhpcy5fcmVkcmF3UmVxdWVzdD10aGlzLl9yZWRyYXdSZXF1ZXN0fHxvLlV0aWwucmVxdWVzdEFuaW1GcmFtZSh0aGlzLl9yZWRyYXcsdGhpcykpfSxfZXh0ZW5kUmVkcmF3Qm91bmRzOmZ1bmN0aW9uKHQpe3ZhciBlPSh0Lm9wdGlvbnMud2VpZ2h0fHwwKSsxO3RoaXMuX3JlZHJhd0JvdW5kcz10aGlzLl9yZWRyYXdCb3VuZHN8fG5ldyBvLkJvdW5kcyx0aGlzLl9yZWRyYXdCb3VuZHMuZXh0ZW5kKHQuX3B4Qm91bmRzLm1pbi5zdWJ0cmFjdChbZSxlXSkpLHRoaXMuX3JlZHJhd0JvdW5kcy5leHRlbmQodC5fcHhCb3VuZHMubWF4LmFkZChbZSxlXSkpfSxfcmVkcmF3OmZ1bmN0aW9uKCl7dGhpcy5fcmVkcmF3UmVxdWVzdD1udWxsLHRoaXMuX3JlZHJhd0JvdW5kcyYmKHRoaXMuX3JlZHJhd0JvdW5kcy5taW4uX2Zsb29yKCksdGhpcy5fcmVkcmF3Qm91bmRzLm1heC5fY2VpbCgpKSx0aGlzLl9jbGVhcigpLHRoaXMuX2RyYXcoKSx0aGlzLl9yZWRyYXdCb3VuZHM9bnVsbH0sX2NsZWFyOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fcmVkcmF3Qm91bmRzO2lmKHQpe3ZhciBlPXQuZ2V0U2l6ZSgpO3RoaXMuX2N0eC5jbGVhclJlY3QodC5taW4ueCx0Lm1pbi55LGUueCxlLnkpfWVsc2UgdGhpcy5fY3R4LmNsZWFyUmVjdCgwLDAsdGhpcy5fY29udGFpbmVyLndpZHRoLHRoaXMuX2NvbnRhaW5lci5oZWlnaHQpfSxfZHJhdzpmdW5jdGlvbigpe3ZhciB0LGU9dGhpcy5fcmVkcmF3Qm91bmRzO2lmKHRoaXMuX2N0eC5zYXZlKCksZSl7dmFyIGk9ZS5nZXRTaXplKCk7dGhpcy5fY3R4LmJlZ2luUGF0aCgpLHRoaXMuX2N0eC5yZWN0KGUubWluLngsZS5taW4ueSxpLngsaS55KSx0aGlzLl9jdHguY2xpcCgpfXRoaXMuX2RyYXdpbmc9ITA7Zm9yKHZhciBuPXRoaXMuX2RyYXdGaXJzdDtuO249bi5uZXh0KXQ9bi5sYXllciwoIWV8fHQuX3B4Qm91bmRzJiZ0Ll9weEJvdW5kcy5pbnRlcnNlY3RzKGUpKSYmdC5fdXBkYXRlUGF0aCgpO3RoaXMuX2RyYXdpbmc9ITEsdGhpcy5fY3R4LnJlc3RvcmUoKX0sX3VwZGF0ZVBvbHk6ZnVuY3Rpb24odCxlKXtpZih0aGlzLl9kcmF3aW5nKXt2YXIgaSxuLG8scyxyPXQuX3BhcnRzLGE9ci5sZW5ndGgsaD10aGlzLl9jdHg7aWYoYSl7Zm9yKHRoaXMuX2RyYXduTGF5ZXJzW3QuX2xlYWZsZXRfaWRdPXQsaC5iZWdpblBhdGgoKSxoLnNldExpbmVEYXNoJiZoLnNldExpbmVEYXNoKHQub3B0aW9ucyYmdC5vcHRpb25zLl9kYXNoQXJyYXl8fFtdKSxpPTA7aTxhO2krKyl7Zm9yKG49MCxvPXJbaV0ubGVuZ3RoO248bztuKyspcz1yW2ldW25dLGhbbj9cImxpbmVUb1wiOlwibW92ZVRvXCJdKHMueCxzLnkpO2UmJmguY2xvc2VQYXRoKCl9dGhpcy5fZmlsbFN0cm9rZShoLHQpfX19LF91cGRhdGVDaXJjbGU6ZnVuY3Rpb24odCl7aWYodGhpcy5fZHJhd2luZyYmIXQuX2VtcHR5KCkpe3ZhciBlPXQuX3BvaW50LGk9dGhpcy5fY3R4LG49dC5fcmFkaXVzLG89KHQuX3JhZGl1c1l8fG4pL247dGhpcy5fZHJhd25MYXllcnNbdC5fbGVhZmxldF9pZF09dCwxIT09byYmKGkuc2F2ZSgpLGkuc2NhbGUoMSxvKSksaS5iZWdpblBhdGgoKSxpLmFyYyhlLngsZS55L28sbiwwLDIqTWF0aC5QSSwhMSksMSE9PW8mJmkucmVzdG9yZSgpLHRoaXMuX2ZpbGxTdHJva2UoaSx0KX19LF9maWxsU3Ryb2tlOmZ1bmN0aW9uKHQsZSl7dmFyIGk9ZS5vcHRpb25zO2kuZmlsbCYmKHQuZ2xvYmFsQWxwaGE9aS5maWxsT3BhY2l0eSx0LmZpbGxTdHlsZT1pLmZpbGxDb2xvcnx8aS5jb2xvcix0LmZpbGwoaS5maWxsUnVsZXx8XCJldmVub2RkXCIpKSxpLnN0cm9rZSYmMCE9PWkud2VpZ2h0JiYodC5nbG9iYWxBbHBoYT1pLm9wYWNpdHksdC5saW5lV2lkdGg9aS53ZWlnaHQsdC5zdHJva2VTdHlsZT1pLmNvbG9yLHQubGluZUNhcD1pLmxpbmVDYXAsdC5saW5lSm9pbj1pLmxpbmVKb2luLHQuc3Ryb2tlKCkpfSxfb25DbGljazpmdW5jdGlvbih0KXtmb3IodmFyIGUsaSxuPXRoaXMuX21hcC5tb3VzZUV2ZW50VG9MYXllclBvaW50KHQpLHM9dGhpcy5fZHJhd0ZpcnN0O3M7cz1zLm5leHQpZT1zLmxheWVyLGUub3B0aW9ucy5pbnRlcmFjdGl2ZSYmZS5fY29udGFpbnNQb2ludChuKSYmIXRoaXMuX21hcC5fZHJhZ2dhYmxlTW92ZWQoZSkmJihpPWUpO2kmJihvLkRvbUV2ZW50Ll9mYWtlU3RvcCh0KSx0aGlzLl9maXJlRXZlbnQoW2ldLHQpKX0sX29uTW91c2VNb3ZlOmZ1bmN0aW9uKHQpe2lmKHRoaXMuX21hcCYmIXRoaXMuX21hcC5kcmFnZ2luZy5tb3ZpbmcoKSYmIXRoaXMuX21hcC5fYW5pbWF0aW5nWm9vbSl7dmFyIGU9dGhpcy5fbWFwLm1vdXNlRXZlbnRUb0xheWVyUG9pbnQodCk7dGhpcy5faGFuZGxlTW91c2VIb3Zlcih0LGUpfX0sX2hhbmRsZU1vdXNlT3V0OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2hvdmVyZWRMYXllcjtlJiYoby5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX2NvbnRhaW5lcixcImxlYWZsZXQtaW50ZXJhY3RpdmVcIiksdGhpcy5fZmlyZUV2ZW50KFtlXSx0LFwibW91c2VvdXRcIiksdGhpcy5faG92ZXJlZExheWVyPW51bGwpfSxfaGFuZGxlTW91c2VIb3ZlcjpmdW5jdGlvbih0LGUpe2Zvcih2YXIgaSxuLHM9dGhpcy5fZHJhd0ZpcnN0O3M7cz1zLm5leHQpaT1zLmxheWVyLGkub3B0aW9ucy5pbnRlcmFjdGl2ZSYmaS5fY29udGFpbnNQb2ludChlKSYmKG49aSk7biE9PXRoaXMuX2hvdmVyZWRMYXllciYmKHRoaXMuX2hhbmRsZU1vdXNlT3V0KHQpLG4mJihvLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fY29udGFpbmVyLFwibGVhZmxldC1pbnRlcmFjdGl2ZVwiKSx0aGlzLl9maXJlRXZlbnQoW25dLHQsXCJtb3VzZW92ZXJcIiksdGhpcy5faG92ZXJlZExheWVyPW4pKSx0aGlzLl9ob3ZlcmVkTGF5ZXImJnRoaXMuX2ZpcmVFdmVudChbdGhpcy5faG92ZXJlZExheWVyXSx0KX0sX2ZpcmVFdmVudDpmdW5jdGlvbih0LGUsaSl7dGhpcy5fbWFwLl9maXJlRE9NRXZlbnQoZSxpfHxlLnR5cGUsdCl9LF9icmluZ1RvRnJvbnQ6ZnVuY3Rpb24odCl7dmFyIGU9dC5fb3JkZXIsaT1lLm5leHQsbj1lLnByZXY7aSYmKGkucHJldj1uLG4/bi5uZXh0PWk6aSYmKHRoaXMuX2RyYXdGaXJzdD1pKSxlLnByZXY9dGhpcy5fZHJhd0xhc3QsdGhpcy5fZHJhd0xhc3QubmV4dD1lLGUubmV4dD1udWxsLHRoaXMuX2RyYXdMYXN0PWUsdGhpcy5fcmVxdWVzdFJlZHJhdyh0KSl9LF9icmluZ1RvQmFjazpmdW5jdGlvbih0KXt2YXIgZT10Ll9vcmRlcixpPWUubmV4dCxuPWUucHJldjtuJiYobi5uZXh0PWksaT9pLnByZXY9bjpuJiYodGhpcy5fZHJhd0xhc3Q9biksZS5wcmV2PW51bGwsZS5uZXh0PXRoaXMuX2RyYXdGaXJzdCx0aGlzLl9kcmF3Rmlyc3QucHJldj1lLHRoaXMuX2RyYXdGaXJzdD1lLHRoaXMuX3JlcXVlc3RSZWRyYXcodCkpfX0pLG8uQnJvd3Nlci5jYW52YXM9ZnVuY3Rpb24oKXtyZXR1cm4hIWUuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKS5nZXRDb250ZXh0fSgpLG8uY2FudmFzPWZ1bmN0aW9uKHQpe3JldHVybiBvLkJyb3dzZXIuY2FudmFzP25ldyBvLkNhbnZhcyh0KTpudWxsfSxvLlBvbHlsaW5lLnByb3RvdHlwZS5fY29udGFpbnNQb2ludD1mdW5jdGlvbih0LGUpe3ZhciBpLG4scyxyLGEsaCxsPXRoaXMuX2NsaWNrVG9sZXJhbmNlKCk7aWYoIXRoaXMuX3B4Qm91bmRzLmNvbnRhaW5zKHQpKXJldHVybiExO2ZvcihpPTAscj10aGlzLl9wYXJ0cy5sZW5ndGg7aTxyO2krKylmb3IoaD10aGlzLl9wYXJ0c1tpXSxuPTAsYT1oLmxlbmd0aCxzPWEtMTtuPGE7cz1uKyspaWYoKGV8fDAhPT1uKSYmby5MaW5lVXRpbC5wb2ludFRvU2VnbWVudERpc3RhbmNlKHQsaFtzXSxoW25dKTw9bClyZXR1cm4hMDtyZXR1cm4hMX0sby5Qb2x5Z29uLnByb3RvdHlwZS5fY29udGFpbnNQb2ludD1mdW5jdGlvbih0KXt2YXIgZSxpLG4scyxyLGEsaCxsLHU9ITE7aWYoIXRoaXMuX3B4Qm91bmRzLmNvbnRhaW5zKHQpKXJldHVybiExO2ZvcihzPTAsaD10aGlzLl9wYXJ0cy5sZW5ndGg7czxoO3MrKylmb3IoZT10aGlzLl9wYXJ0c1tzXSxyPTAsbD1lLmxlbmd0aCxhPWwtMTtyPGw7YT1yKyspaT1lW3JdLG49ZVthXSxpLnk+dC55IT1uLnk+dC55JiZ0Lng8KG4ueC1pLngpKih0LnktaS55KS8obi55LWkueSkraS54JiYodT0hdSk7cmV0dXJuIHV8fG8uUG9seWxpbmUucHJvdG90eXBlLl9jb250YWluc1BvaW50LmNhbGwodGhpcyx0LCEwKX0sby5DaXJjbGVNYXJrZXIucHJvdG90eXBlLl9jb250YWluc1BvaW50PWZ1bmN0aW9uKHQpe3JldHVybiB0LmRpc3RhbmNlVG8odGhpcy5fcG9pbnQpPD10aGlzLl9yYWRpdXMrdGhpcy5fY2xpY2tUb2xlcmFuY2UoKX0sby5HZW9KU09OPW8uRmVhdHVyZUdyb3VwLmV4dGVuZCh7aW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUpe28uc2V0T3B0aW9ucyh0aGlzLGUpLHRoaXMuX2xheWVycz17fSx0JiZ0aGlzLmFkZERhdGEodCl9LGFkZERhdGE6ZnVuY3Rpb24odCl7dmFyIGUsaSxuLHM9by5VdGlsLmlzQXJyYXkodCk/dDp0LmZlYXR1cmVzO2lmKHMpe2ZvcihlPTAsaT1zLmxlbmd0aDtlPGk7ZSsrKW49c1tlXSwobi5nZW9tZXRyaWVzfHxuLmdlb21ldHJ5fHxuLmZlYXR1cmVzfHxuLmNvb3JkaW5hdGVzKSYmdGhpcy5hZGREYXRhKG4pO3JldHVybiB0aGlzfXZhciByPXRoaXMub3B0aW9ucztpZihyLmZpbHRlciYmIXIuZmlsdGVyKHQpKXJldHVybiB0aGlzO3ZhciBhPW8uR2VvSlNPTi5nZW9tZXRyeVRvTGF5ZXIodCxyKTtyZXR1cm4gYT8oYS5mZWF0dXJlPW8uR2VvSlNPTi5hc0ZlYXR1cmUodCksYS5kZWZhdWx0T3B0aW9ucz1hLm9wdGlvbnMsdGhpcy5yZXNldFN0eWxlKGEpLHIub25FYWNoRmVhdHVyZSYmci5vbkVhY2hGZWF0dXJlKHQsYSksdGhpcy5hZGRMYXllcihhKSk6dGhpc30scmVzZXRTdHlsZTpmdW5jdGlvbih0KXtyZXR1cm4gdC5vcHRpb25zPW8uVXRpbC5leHRlbmQoe30sdC5kZWZhdWx0T3B0aW9ucyksdGhpcy5fc2V0TGF5ZXJTdHlsZSh0LHRoaXMub3B0aW9ucy5zdHlsZSksdGhpc30sc2V0U3R5bGU6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuZWFjaExheWVyKGZ1bmN0aW9uKGUpe3RoaXMuX3NldExheWVyU3R5bGUoZSx0KX0sdGhpcyl9LF9zZXRMYXllclN0eWxlOmZ1bmN0aW9uKHQsZSl7XCJmdW5jdGlvblwiPT10eXBlb2YgZSYmKGU9ZSh0LmZlYXR1cmUpKSx0LnNldFN0eWxlJiZ0LnNldFN0eWxlKGUpfX0pLG8uZXh0ZW5kKG8uR2VvSlNPTix7Z2VvbWV0cnlUb0xheWVyOmZ1bmN0aW9uKHQsZSl7dmFyIGksbixzLHIsYT1cIkZlYXR1cmVcIj09PXQudHlwZT90Lmdlb21ldHJ5OnQsaD1hP2EuY29vcmRpbmF0ZXM6bnVsbCxsPVtdLHU9ZSYmZS5wb2ludFRvTGF5ZXIsYz1lJiZlLmNvb3Jkc1RvTGF0TG5nfHx0aGlzLmNvb3Jkc1RvTGF0TG5nO2lmKCFoJiYhYSlyZXR1cm4gbnVsbDtzd2l0Y2goYS50eXBlKXtjYXNlXCJQb2ludFwiOnJldHVybiBpPWMoaCksdT91KHQsaSk6bmV3IG8uTWFya2VyKGkpO2Nhc2VcIk11bHRpUG9pbnRcIjpmb3Iocz0wLHI9aC5sZW5ndGg7czxyO3MrKylpPWMoaFtzXSksbC5wdXNoKHU/dSh0LGkpOm5ldyBvLk1hcmtlcihpKSk7cmV0dXJuIG5ldyBvLkZlYXR1cmVHcm91cChsKTtjYXNlXCJMaW5lU3RyaW5nXCI6Y2FzZVwiTXVsdGlMaW5lU3RyaW5nXCI6cmV0dXJuIG49dGhpcy5jb29yZHNUb0xhdExuZ3MoaCxcIkxpbmVTdHJpbmdcIj09PWEudHlwZT8wOjEsYyksbmV3IG8uUG9seWxpbmUobixlKTtjYXNlXCJQb2x5Z29uXCI6Y2FzZVwiTXVsdGlQb2x5Z29uXCI6cmV0dXJuIG49dGhpcy5jb29yZHNUb0xhdExuZ3MoaCxcIlBvbHlnb25cIj09PWEudHlwZT8xOjIsYyksbmV3IG8uUG9seWdvbihuLGUpO2Nhc2VcIkdlb21ldHJ5Q29sbGVjdGlvblwiOmZvcihzPTAscj1hLmdlb21ldHJpZXMubGVuZ3RoO3M8cjtzKyspe3ZhciBkPXRoaXMuZ2VvbWV0cnlUb0xheWVyKHtnZW9tZXRyeTphLmdlb21ldHJpZXNbc10sdHlwZTpcIkZlYXR1cmVcIixwcm9wZXJ0aWVzOnQucHJvcGVydGllc30sZSk7ZCYmbC5wdXNoKGQpfXJldHVybiBuZXcgby5GZWF0dXJlR3JvdXAobCk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIEdlb0pTT04gb2JqZWN0LlwiKX19LGNvb3Jkc1RvTGF0TG5nOmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5MYXRMbmcodFsxXSx0WzBdLHRbMl0pfSxjb29yZHNUb0xhdExuZ3M6ZnVuY3Rpb24odCxlLGkpe2Zvcih2YXIgbixvPVtdLHM9MCxyPXQubGVuZ3RoO3M8cjtzKyspbj1lP3RoaXMuY29vcmRzVG9MYXRMbmdzKHRbc10sZS0xLGkpOihpfHx0aGlzLmNvb3Jkc1RvTGF0TG5nKSh0W3NdKSxvLnB1c2gobik7cmV0dXJuIG99LGxhdExuZ1RvQ29vcmRzOmZ1bmN0aW9uKHQpe3JldHVybiB0LmFsdCE9PWk/W3QubG5nLHQubGF0LHQuYWx0XTpbdC5sbmcsdC5sYXRdfSxsYXRMbmdzVG9Db29yZHM6ZnVuY3Rpb24odCxlLGkpe2Zvcih2YXIgbj1bXSxzPTAscj10Lmxlbmd0aDtzPHI7cysrKW4ucHVzaChlP28uR2VvSlNPTi5sYXRMbmdzVG9Db29yZHModFtzXSxlLTEsaSk6by5HZW9KU09OLmxhdExuZ1RvQ29vcmRzKHRbc10pKTtyZXR1cm4hZSYmaSYmbi5wdXNoKG5bMF0pLG59LGdldEZlYXR1cmU6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdC5mZWF0dXJlP28uZXh0ZW5kKHt9LHQuZmVhdHVyZSx7Z2VvbWV0cnk6ZX0pOm8uR2VvSlNPTi5hc0ZlYXR1cmUoZSl9LGFzRmVhdHVyZTpmdW5jdGlvbih0KXtyZXR1cm5cIkZlYXR1cmVcIj09PXQudHlwZXx8XCJGZWF0dXJlQ29sbGVjdGlvblwiPT09dC50eXBlP3Q6e3R5cGU6XCJGZWF0dXJlXCIscHJvcGVydGllczp7fSxnZW9tZXRyeTp0fX19KTt2YXIgYT17dG9HZW9KU09OOmZ1bmN0aW9uKCl7cmV0dXJuIG8uR2VvSlNPTi5nZXRGZWF0dXJlKHRoaXMse3R5cGU6XCJQb2ludFwiLGNvb3JkaW5hdGVzOm8uR2VvSlNPTi5sYXRMbmdUb0Nvb3Jkcyh0aGlzLmdldExhdExuZygpKX0pfX07by5NYXJrZXIuaW5jbHVkZShhKSxvLkNpcmNsZS5pbmNsdWRlKGEpLG8uQ2lyY2xlTWFya2VyLmluY2x1ZGUoYSksby5Qb2x5bGluZS5wcm90b3R5cGUudG9HZW9KU09OPWZ1bmN0aW9uKCl7dmFyIHQ9IW8uUG9seWxpbmUuX2ZsYXQodGhpcy5fbGF0bG5ncyksZT1vLkdlb0pTT04ubGF0TG5nc1RvQ29vcmRzKHRoaXMuX2xhdGxuZ3MsdD8xOjApO3JldHVybiBvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOih0P1wiTXVsdGlcIjpcIlwiKStcIkxpbmVTdHJpbmdcIixjb29yZGluYXRlczplfSl9LG8uUG9seWdvbi5wcm90b3R5cGUudG9HZW9KU09OPWZ1bmN0aW9uKCl7dmFyIHQ9IW8uUG9seWxpbmUuX2ZsYXQodGhpcy5fbGF0bG5ncyksZT10JiYhby5Qb2x5bGluZS5fZmxhdCh0aGlzLl9sYXRsbmdzWzBdKSxpPW8uR2VvSlNPTi5sYXRMbmdzVG9Db29yZHModGhpcy5fbGF0bG5ncyxlPzI6dD8xOjAsITApO3JldHVybiB0fHwoaT1baV0pLG8uR2VvSlNPTi5nZXRGZWF0dXJlKHRoaXMse3R5cGU6KGU/XCJNdWx0aVwiOlwiXCIpK1wiUG9seWdvblwiLGNvb3JkaW5hdGVzOml9KX0sby5MYXllckdyb3VwLmluY2x1ZGUoe3RvTXVsdGlQb2ludDpmdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbihlKXt0LnB1c2goZS50b0dlb0pTT04oKS5nZW9tZXRyeS5jb29yZGluYXRlcyl9KSxvLkdlb0pTT04uZ2V0RmVhdHVyZSh0aGlzLHt0eXBlOlwiTXVsdGlQb2ludFwiLGNvb3JkaW5hdGVzOnR9KX0sdG9HZW9KU09OOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5mZWF0dXJlJiZ0aGlzLmZlYXR1cmUuZ2VvbWV0cnkmJnRoaXMuZmVhdHVyZS5nZW9tZXRyeS50eXBlO2lmKFwiTXVsdGlQb2ludFwiPT09dClyZXR1cm4gdGhpcy50b011bHRpUG9pbnQoKTt2YXIgZT1cIkdlb21ldHJ5Q29sbGVjdGlvblwiPT09dCxpPVtdO3JldHVybiB0aGlzLmVhY2hMYXllcihmdW5jdGlvbih0KXtpZih0LnRvR2VvSlNPTil7dmFyIG49dC50b0dlb0pTT04oKTtpLnB1c2goZT9uLmdlb21ldHJ5Om8uR2VvSlNPTi5hc0ZlYXR1cmUobikpfX0pLGU/by5HZW9KU09OLmdldEZlYXR1cmUodGhpcyx7Z2VvbWV0cmllczppLHR5cGU6XCJHZW9tZXRyeUNvbGxlY3Rpb25cIn0pOnt0eXBlOlwiRmVhdHVyZUNvbGxlY3Rpb25cIixmZWF0dXJlczppfX19KSxvLmdlb0pTT049ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IG8uR2VvSlNPTih0LGUpfSxvLmdlb0pzb249by5nZW9KU09OLG8uRHJhZ2dhYmxlPW8uRXZlbnRlZC5leHRlbmQoe29wdGlvbnM6e2NsaWNrVG9sZXJhbmNlOjN9LHN0YXRpY3M6e1NUQVJUOm8uQnJvd3Nlci50b3VjaD9bXCJ0b3VjaHN0YXJ0XCIsXCJtb3VzZWRvd25cIl06W1wibW91c2Vkb3duXCJdLEVORDp7bW91c2Vkb3duOlwibW91c2V1cFwiLHRvdWNoc3RhcnQ6XCJ0b3VjaGVuZFwiLHBvaW50ZXJkb3duOlwidG91Y2hlbmRcIixNU1BvaW50ZXJEb3duOlwidG91Y2hlbmRcIn0sTU9WRTp7bW91c2Vkb3duOlwibW91c2Vtb3ZlXCIsdG91Y2hzdGFydDpcInRvdWNobW92ZVwiLHBvaW50ZXJkb3duOlwidG91Y2htb3ZlXCIsTVNQb2ludGVyRG93bjpcInRvdWNobW92ZVwifX0saW5pdGlhbGl6ZTpmdW5jdGlvbih0LGUsaSl7dGhpcy5fZWxlbWVudD10LHRoaXMuX2RyYWdTdGFydFRhcmdldD1lfHx0LHRoaXMuX3ByZXZlbnRPdXRsaW5lPWl9LGVuYWJsZTpmdW5jdGlvbigpe3RoaXMuX2VuYWJsZWR8fChvLkRvbUV2ZW50Lm9uKHRoaXMuX2RyYWdTdGFydFRhcmdldCxvLkRyYWdnYWJsZS5TVEFSVC5qb2luKFwiIFwiKSx0aGlzLl9vbkRvd24sdGhpcyksdGhpcy5fZW5hYmxlZD0hMCl9LGRpc2FibGU6ZnVuY3Rpb24oKXt0aGlzLl9lbmFibGVkJiYoby5EcmFnZ2FibGUuX2RyYWdnaW5nPT09dGhpcyYmdGhpcy5maW5pc2hEcmFnKCksby5Eb21FdmVudC5vZmYodGhpcy5fZHJhZ1N0YXJ0VGFyZ2V0LG8uRHJhZ2dhYmxlLlNUQVJULmpvaW4oXCIgXCIpLHRoaXMuX29uRG93bix0aGlzKSx0aGlzLl9lbmFibGVkPSExLHRoaXMuX21vdmVkPSExKX0sX29uRG93bjpmdW5jdGlvbih0KXtpZighdC5fc2ltdWxhdGVkJiZ0aGlzLl9lbmFibGVkJiYodGhpcy5fbW92ZWQ9ITEsIW8uRG9tVXRpbC5oYXNDbGFzcyh0aGlzLl9lbGVtZW50LFwibGVhZmxldC16b29tLWFuaW1cIikmJiEoby5EcmFnZ2FibGUuX2RyYWdnaW5nfHx0LnNoaWZ0S2V5fHwxIT09dC53aGljaCYmMSE9PXQuYnV0dG9uJiYhdC50b3VjaGVzfHwoby5EcmFnZ2FibGUuX2RyYWdnaW5nPXRoaXMsdGhpcy5fcHJldmVudE91dGxpbmUmJm8uRG9tVXRpbC5wcmV2ZW50T3V0bGluZSh0aGlzLl9lbGVtZW50KSxvLkRvbVV0aWwuZGlzYWJsZUltYWdlRHJhZygpLG8uRG9tVXRpbC5kaXNhYmxlVGV4dFNlbGVjdGlvbigpLHRoaXMuX21vdmluZykpKSl7dGhpcy5maXJlKFwiZG93blwiKTt2YXIgaT10LnRvdWNoZXM/dC50b3VjaGVzWzBdOnQ7dGhpcy5fc3RhcnRQb2ludD1uZXcgby5Qb2ludChpLmNsaWVudFgsaS5jbGllbnRZKSxvLkRvbUV2ZW50Lm9uKGUsby5EcmFnZ2FibGUuTU9WRVt0LnR5cGVdLHRoaXMuX29uTW92ZSx0aGlzKS5vbihlLG8uRHJhZ2dhYmxlLkVORFt0LnR5cGVdLHRoaXMuX29uVXAsdGhpcyl9fSxfb25Nb3ZlOmZ1bmN0aW9uKGkpe2lmKCFpLl9zaW11bGF0ZWQmJnRoaXMuX2VuYWJsZWQpe2lmKGkudG91Y2hlcyYmaS50b3VjaGVzLmxlbmd0aD4xKXJldHVybiB2b2lkKHRoaXMuX21vdmVkPSEwKTt2YXIgbj1pLnRvdWNoZXMmJjE9PT1pLnRvdWNoZXMubGVuZ3RoP2kudG91Y2hlc1swXTppLHM9bmV3IG8uUG9pbnQobi5jbGllbnRYLG4uY2xpZW50WSkscj1zLnN1YnRyYWN0KHRoaXMuX3N0YXJ0UG9pbnQpOyhyLnh8fHIueSkmJihNYXRoLmFicyhyLngpK01hdGguYWJzKHIueSk8dGhpcy5vcHRpb25zLmNsaWNrVG9sZXJhbmNlfHwoby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdChpKSx0aGlzLl9tb3ZlZHx8KHRoaXMuZmlyZShcImRyYWdzdGFydFwiKSx0aGlzLl9tb3ZlZD0hMCx0aGlzLl9zdGFydFBvcz1vLkRvbVV0aWwuZ2V0UG9zaXRpb24odGhpcy5fZWxlbWVudCkuc3VidHJhY3Qociksby5Eb21VdGlsLmFkZENsYXNzKGUuYm9keSxcImxlYWZsZXQtZHJhZ2dpbmdcIiksdGhpcy5fbGFzdFRhcmdldD1pLnRhcmdldHx8aS5zcmNFbGVtZW50LHQuU1ZHRWxlbWVudEluc3RhbmNlJiZ0aGlzLl9sYXN0VGFyZ2V0IGluc3RhbmNlb2YgU1ZHRWxlbWVudEluc3RhbmNlJiYodGhpcy5fbGFzdFRhcmdldD10aGlzLl9sYXN0VGFyZ2V0LmNvcnJlc3BvbmRpbmdVc2VFbGVtZW50KSxvLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fbGFzdFRhcmdldCxcImxlYWZsZXQtZHJhZy10YXJnZXRcIikpLHRoaXMuX25ld1Bvcz10aGlzLl9zdGFydFBvcy5hZGQociksdGhpcy5fbW92aW5nPSEwLG8uVXRpbC5jYW5jZWxBbmltRnJhbWUodGhpcy5fYW5pbVJlcXVlc3QpLHRoaXMuX2xhc3RFdmVudD1pLHRoaXMuX2FuaW1SZXF1ZXN0PW8uVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKHRoaXMuX3VwZGF0ZVBvc2l0aW9uLHRoaXMsITApKSl9fSxfdXBkYXRlUG9zaXRpb246ZnVuY3Rpb24oKXt2YXIgdD17b3JpZ2luYWxFdmVudDp0aGlzLl9sYXN0RXZlbnR9O3RoaXMuZmlyZShcInByZWRyYWdcIix0KSxvLkRvbVV0aWwuc2V0UG9zaXRpb24odGhpcy5fZWxlbWVudCx0aGlzLl9uZXdQb3MpLHRoaXMuZmlyZShcImRyYWdcIix0KX0sX29uVXA6ZnVuY3Rpb24odCl7IXQuX3NpbXVsYXRlZCYmdGhpcy5fZW5hYmxlZCYmdGhpcy5maW5pc2hEcmFnKCl9LGZpbmlzaERyYWc6ZnVuY3Rpb24oKXtvLkRvbVV0aWwucmVtb3ZlQ2xhc3MoZS5ib2R5LFwibGVhZmxldC1kcmFnZ2luZ1wiKSx0aGlzLl9sYXN0VGFyZ2V0JiYoby5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX2xhc3RUYXJnZXQsXCJsZWFmbGV0LWRyYWctdGFyZ2V0XCIpLHRoaXMuX2xhc3RUYXJnZXQ9bnVsbCk7Zm9yKHZhciB0IGluIG8uRHJhZ2dhYmxlLk1PVkUpby5Eb21FdmVudC5vZmYoZSxvLkRyYWdnYWJsZS5NT1ZFW3RdLHRoaXMuX29uTW92ZSx0aGlzKS5vZmYoZSxvLkRyYWdnYWJsZS5FTkRbdF0sdGhpcy5fb25VcCx0aGlzKTtvLkRvbVV0aWwuZW5hYmxlSW1hZ2VEcmFnKCksby5Eb21VdGlsLmVuYWJsZVRleHRTZWxlY3Rpb24oKSx0aGlzLl9tb3ZlZCYmdGhpcy5fbW92aW5nJiYoby5VdGlsLmNhbmNlbEFuaW1GcmFtZSh0aGlzLl9hbmltUmVxdWVzdCksdGhpcy5maXJlKFwiZHJhZ2VuZFwiLHtkaXN0YW5jZTp0aGlzLl9uZXdQb3MuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFBvcyl9KSksdGhpcy5fbW92aW5nPSExLG8uRHJhZ2dhYmxlLl9kcmFnZ2luZz0hMX19KSxvLkhhbmRsZXI9by5DbGFzcy5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXR9LGVuYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9lbmFibGVkP3RoaXM6KHRoaXMuX2VuYWJsZWQ9ITAsdGhpcy5hZGRIb29rcygpLHRoaXMpfSxkaXNhYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2VuYWJsZWQ/KHRoaXMuX2VuYWJsZWQ9ITEsdGhpcy5yZW1vdmVIb29rcygpLHRoaXMpOnRoaXN9LGVuYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuX2VuYWJsZWR9fSksby5NYXAubWVyZ2VPcHRpb25zKHtkcmFnZ2luZzohMCxpbmVydGlhOiFvLkJyb3dzZXIuYW5kcm9pZDIzLGluZXJ0aWFEZWNlbGVyYXRpb246MzQwMCxpbmVydGlhTWF4U3BlZWQ6MS8wLGVhc2VMaW5lYXJpdHk6LjIsd29ybGRDb3B5SnVtcDohMSxtYXhCb3VuZHNWaXNjb3NpdHk6MH0pLG8uTWFwLkRyYWc9by5IYW5kbGVyLmV4dGVuZCh7YWRkSG9va3M6ZnVuY3Rpb24oKXtpZighdGhpcy5fZHJhZ2dhYmxlKXt2YXIgdD10aGlzLl9tYXA7dGhpcy5fZHJhZ2dhYmxlPW5ldyBvLkRyYWdnYWJsZSh0Ll9tYXBQYW5lLHQuX2NvbnRhaW5lciksdGhpcy5fZHJhZ2dhYmxlLm9uKHtkb3duOnRoaXMuX29uRG93bixkcmFnc3RhcnQ6dGhpcy5fb25EcmFnU3RhcnQsZHJhZzp0aGlzLl9vbkRyYWcsZHJhZ2VuZDp0aGlzLl9vbkRyYWdFbmR9LHRoaXMpLHRoaXMuX2RyYWdnYWJsZS5vbihcInByZWRyYWdcIix0aGlzLl9vblByZURyYWdMaW1pdCx0aGlzKSx0Lm9wdGlvbnMud29ybGRDb3B5SnVtcCYmKHRoaXMuX2RyYWdnYWJsZS5vbihcInByZWRyYWdcIix0aGlzLl9vblByZURyYWdXcmFwLHRoaXMpLHQub24oXCJ6b29tZW5kXCIsdGhpcy5fb25ab29tRW5kLHRoaXMpLHQud2hlblJlYWR5KHRoaXMuX29uWm9vbUVuZCx0aGlzKSl9by5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX21hcC5fY29udGFpbmVyLFwibGVhZmxldC1ncmFiIGxlYWZsZXQtdG91Y2gtZHJhZ1wiKSx0aGlzLl9kcmFnZ2FibGUuZW5hYmxlKCksdGhpcy5fcG9zaXRpb25zPVtdLHRoaXMuX3RpbWVzPVtdfSxyZW1vdmVIb29rczpmdW5jdGlvbigpe28uRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9tYXAuX2NvbnRhaW5lcixcImxlYWZsZXQtZ3JhYlwiKSxvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fbWFwLl9jb250YWluZXIsXCJsZWFmbGV0LXRvdWNoLWRyYWdcIiksdGhpcy5fZHJhZ2dhYmxlLmRpc2FibGUoKX0sbW92ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZHJhZ2dhYmxlJiZ0aGlzLl9kcmFnZ2FibGUuX21vdmVkfSxtb3Zpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZHJhZ2dhYmxlJiZ0aGlzLl9kcmFnZ2FibGUuX21vdmluZ30sX29uRG93bjpmdW5jdGlvbigpe3RoaXMuX21hcC5fc3RvcCgpfSxfb25EcmFnU3RhcnQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXA7aWYodGhpcy5fbWFwLm9wdGlvbnMubWF4Qm91bmRzJiZ0aGlzLl9tYXAub3B0aW9ucy5tYXhCb3VuZHNWaXNjb3NpdHkpe3ZhciBlPW8ubGF0TG5nQm91bmRzKHRoaXMuX21hcC5vcHRpb25zLm1heEJvdW5kcyk7dGhpcy5fb2Zmc2V0TGltaXQ9by5ib3VuZHModGhpcy5fbWFwLmxhdExuZ1RvQ29udGFpbmVyUG9pbnQoZS5nZXROb3J0aFdlc3QoKSkubXVsdGlwbHlCeSgtMSksdGhpcy5fbWFwLmxhdExuZ1RvQ29udGFpbmVyUG9pbnQoZS5nZXRTb3V0aEVhc3QoKSkubXVsdGlwbHlCeSgtMSkuYWRkKHRoaXMuX21hcC5nZXRTaXplKCkpKSx0aGlzLl92aXNjb3NpdHk9TWF0aC5taW4oMSxNYXRoLm1heCgwLHRoaXMuX21hcC5vcHRpb25zLm1heEJvdW5kc1Zpc2Nvc2l0eSkpfWVsc2UgdGhpcy5fb2Zmc2V0TGltaXQ9bnVsbDt0LmZpcmUoXCJtb3Zlc3RhcnRcIikuZmlyZShcImRyYWdzdGFydFwiKSx0Lm9wdGlvbnMuaW5lcnRpYSYmKHRoaXMuX3Bvc2l0aW9ucz1bXSx0aGlzLl90aW1lcz1bXSl9LF9vbkRyYWc6ZnVuY3Rpb24odCl7aWYodGhpcy5fbWFwLm9wdGlvbnMuaW5lcnRpYSl7dmFyIGU9dGhpcy5fbGFzdFRpbWU9K25ldyBEYXRlLGk9dGhpcy5fbGFzdFBvcz10aGlzLl9kcmFnZ2FibGUuX2Fic1Bvc3x8dGhpcy5fZHJhZ2dhYmxlLl9uZXdQb3M7dGhpcy5fcG9zaXRpb25zLnB1c2goaSksdGhpcy5fdGltZXMucHVzaChlKSxlLXRoaXMuX3RpbWVzWzBdPjUwJiYodGhpcy5fcG9zaXRpb25zLnNoaWZ0KCksdGhpcy5fdGltZXMuc2hpZnQoKSl9dGhpcy5fbWFwLmZpcmUoXCJtb3ZlXCIsdCkuZmlyZShcImRyYWdcIix0KX0sX29uWm9vbUVuZDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcC5nZXRTaXplKCkuZGl2aWRlQnkoMiksZT10aGlzLl9tYXAubGF0TG5nVG9MYXllclBvaW50KFswLDBdKTt0aGlzLl9pbml0aWFsV29ybGRPZmZzZXQ9ZS5zdWJ0cmFjdCh0KS54LHRoaXMuX3dvcmxkV2lkdGg9dGhpcy5fbWFwLmdldFBpeGVsV29ybGRCb3VuZHMoKS5nZXRTaXplKCkueH0sX3Zpc2NvdXNMaW1pdDpmdW5jdGlvbih0LGUpe3JldHVybiB0LSh0LWUpKnRoaXMuX3Zpc2Nvc2l0eX0sX29uUHJlRHJhZ0xpbWl0OmZ1bmN0aW9uKCl7aWYodGhpcy5fdmlzY29zaXR5JiZ0aGlzLl9vZmZzZXRMaW1pdCl7dmFyIHQ9dGhpcy5fZHJhZ2dhYmxlLl9uZXdQb3Muc3VidHJhY3QodGhpcy5fZHJhZ2dhYmxlLl9zdGFydFBvcyksZT10aGlzLl9vZmZzZXRMaW1pdDt0Lng8ZS5taW4ueCYmKHQueD10aGlzLl92aXNjb3VzTGltaXQodC54LGUubWluLngpKSx0Lnk8ZS5taW4ueSYmKHQueT10aGlzLl92aXNjb3VzTGltaXQodC55LGUubWluLnkpKSx0Lng+ZS5tYXgueCYmKHQueD10aGlzLl92aXNjb3VzTGltaXQodC54LGUubWF4LngpKSx0Lnk+ZS5tYXgueSYmKHQueT10aGlzLl92aXNjb3VzTGltaXQodC55LGUubWF4LnkpKSx0aGlzLl9kcmFnZ2FibGUuX25ld1Bvcz10aGlzLl9kcmFnZ2FibGUuX3N0YXJ0UG9zLmFkZCh0KX19LF9vblByZURyYWdXcmFwOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fd29ybGRXaWR0aCxlPU1hdGgucm91bmQodC8yKSxpPXRoaXMuX2luaXRpYWxXb3JsZE9mZnNldCxuPXRoaXMuX2RyYWdnYWJsZS5fbmV3UG9zLngsbz0obi1lK2kpJXQrZS1pLHM9KG4rZStpKSV0LWUtaSxyPU1hdGguYWJzKG8raSk8TWF0aC5hYnMocytpKT9vOnM7dGhpcy5fZHJhZ2dhYmxlLl9hYnNQb3M9dGhpcy5fZHJhZ2dhYmxlLl9uZXdQb3MuY2xvbmUoKSx0aGlzLl9kcmFnZ2FibGUuX25ld1Bvcy54PXJ9LF9vbkRyYWdFbmQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fbWFwLGk9ZS5vcHRpb25zLG49IWkuaW5lcnRpYXx8dGhpcy5fdGltZXMubGVuZ3RoPDI7aWYoZS5maXJlKFwiZHJhZ2VuZFwiLHQpLG4pZS5maXJlKFwibW92ZWVuZFwiKTtlbHNle3ZhciBzPXRoaXMuX2xhc3RQb3Muc3VidHJhY3QodGhpcy5fcG9zaXRpb25zWzBdKSxyPSh0aGlzLl9sYXN0VGltZS10aGlzLl90aW1lc1swXSkvMWUzLGE9aS5lYXNlTGluZWFyaXR5LGg9cy5tdWx0aXBseUJ5KGEvciksbD1oLmRpc3RhbmNlVG8oWzAsMF0pLHU9TWF0aC5taW4oaS5pbmVydGlhTWF4U3BlZWQsbCksYz1oLm11bHRpcGx5QnkodS9sKSxkPXUvKGkuaW5lcnRpYURlY2VsZXJhdGlvbiphKSxfPWMubXVsdGlwbHlCeSgtZC8yKS5yb3VuZCgpO18ueHx8Xy55PyhfPWUuX2xpbWl0T2Zmc2V0KF8sZS5vcHRpb25zLm1heEJvdW5kcyksby5VdGlsLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24oKXtlLnBhbkJ5KF8se2R1cmF0aW9uOmQsZWFzZUxpbmVhcml0eTphLG5vTW92ZVN0YXJ0OiEwLGFuaW1hdGU6ITB9KX0pKTplLmZpcmUoXCJtb3ZlZW5kXCIpfX19KSxvLk1hcC5hZGRJbml0SG9vayhcImFkZEhhbmRsZXJcIixcImRyYWdnaW5nXCIsby5NYXAuRHJhZyksby5NYXAubWVyZ2VPcHRpb25zKHtkb3VibGVDbGlja1pvb206ITB9KSxvLk1hcC5Eb3VibGVDbGlja1pvb209by5IYW5kbGVyLmV4dGVuZCh7YWRkSG9va3M6ZnVuY3Rpb24oKXt0aGlzLl9tYXAub24oXCJkYmxjbGlja1wiLHRoaXMuX29uRG91YmxlQ2xpY2ssdGhpcyl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7dGhpcy5fbWFwLm9mZihcImRibGNsaWNrXCIsdGhpcy5fb25Eb3VibGVDbGljayx0aGlzKX0sX29uRG91YmxlQ2xpY2s6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5fbWFwLGk9ZS5nZXRab29tKCksbj1lLm9wdGlvbnMuem9vbURlbHRhLG89dC5vcmlnaW5hbEV2ZW50LnNoaWZ0S2V5P2ktbjppK247XCJjZW50ZXJcIj09PWUub3B0aW9ucy5kb3VibGVDbGlja1pvb20/ZS5zZXRab29tKG8pOmUuc2V0Wm9vbUFyb3VuZCh0LmNvbnRhaW5lclBvaW50LG8pfX0pLG8uTWFwLmFkZEluaXRIb29rKFwiYWRkSGFuZGxlclwiLFwiZG91YmxlQ2xpY2tab29tXCIsby5NYXAuRG91YmxlQ2xpY2tab29tKSxvLk1hcC5tZXJnZU9wdGlvbnMoe3Njcm9sbFdoZWVsWm9vbTohMCx3aGVlbERlYm91bmNlVGltZTo0MCx3aGVlbFB4UGVyWm9vbUxldmVsOjYwfSksby5NYXAuU2Nyb2xsV2hlZWxab29tPW8uSGFuZGxlci5leHRlbmQoe2FkZEhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vbih0aGlzLl9tYXAuX2NvbnRhaW5lcixcIm1vdXNld2hlZWxcIix0aGlzLl9vbldoZWVsU2Nyb2xsLHRoaXMpLHRoaXMuX2RlbHRhPTB9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodGhpcy5fbWFwLl9jb250YWluZXIsXCJtb3VzZXdoZWVsXCIsdGhpcy5fb25XaGVlbFNjcm9sbCx0aGlzKX0sX29uV2hlZWxTY3JvbGw6ZnVuY3Rpb24odCl7dmFyIGU9by5Eb21FdmVudC5nZXRXaGVlbERlbHRhKHQpLGk9dGhpcy5fbWFwLm9wdGlvbnMud2hlZWxEZWJvdW5jZVRpbWU7dGhpcy5fZGVsdGErPWUsdGhpcy5fbGFzdE1vdXNlUG9zPXRoaXMuX21hcC5tb3VzZUV2ZW50VG9Db250YWluZXJQb2ludCh0KSx0aGlzLl9zdGFydFRpbWV8fCh0aGlzLl9zdGFydFRpbWU9K25ldyBEYXRlKTt2YXIgbj1NYXRoLm1heChpLSgrbmV3IERhdGUtdGhpcy5fc3RhcnRUaW1lKSwwKTtjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpLHRoaXMuX3RpbWVyPXNldFRpbWVvdXQoby5iaW5kKHRoaXMuX3BlcmZvcm1ab29tLHRoaXMpLG4pLG8uRG9tRXZlbnQuc3RvcCh0KX0sX3BlcmZvcm1ab29tOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFwLGU9dC5nZXRab29tKCksaT10aGlzLl9tYXAub3B0aW9ucy56b29tU25hcHx8MDt0Ll9zdG9wKCk7dmFyIG49dGhpcy5fZGVsdGEvKDQqdGhpcy5fbWFwLm9wdGlvbnMud2hlZWxQeFBlclpvb21MZXZlbCksbz00Kk1hdGgubG9nKDIvKDErTWF0aC5leHAoLU1hdGguYWJzKG4pKSkpL01hdGguTE4yLHM9aT9NYXRoLmNlaWwoby9pKSppOm8scj10Ll9saW1pdFpvb20oZSsodGhpcy5fZGVsdGE+MD9zOi1zKSktZTt0aGlzLl9kZWx0YT0wLHRoaXMuX3N0YXJ0VGltZT1udWxsLHImJihcImNlbnRlclwiPT09dC5vcHRpb25zLnNjcm9sbFdoZWVsWm9vbT90LnNldFpvb20oZStyKTp0LnNldFpvb21Bcm91bmQodGhpcy5fbGFzdE1vdXNlUG9zLGUrcikpfX0pLG8uTWFwLmFkZEluaXRIb29rKFwiYWRkSGFuZGxlclwiLFwic2Nyb2xsV2hlZWxab29tXCIsby5NYXAuU2Nyb2xsV2hlZWxab29tKSxvLmV4dGVuZChvLkRvbUV2ZW50LHtfdG91Y2hzdGFydDpvLkJyb3dzZXIubXNQb2ludGVyP1wiTVNQb2ludGVyRG93blwiOm8uQnJvd3Nlci5wb2ludGVyP1wicG9pbnRlcmRvd25cIjpcInRvdWNoc3RhcnRcIixfdG91Y2hlbmQ6by5Ccm93c2VyLm1zUG9pbnRlcj9cIk1TUG9pbnRlclVwXCI6by5Ccm93c2VyLnBvaW50ZXI/XCJwb2ludGVydXBcIjpcInRvdWNoZW5kXCIsYWRkRG91YmxlVGFwTGlzdGVuZXI6ZnVuY3Rpb24odCxlLGkpe2Z1bmN0aW9uIG4odCl7dmFyIGU7aWYoby5Ccm93c2VyLnBvaW50ZXIpe2lmKCFvLkJyb3dzZXIuZWRnZXx8XCJtb3VzZVwiPT09dC5wb2ludGVyVHlwZSlyZXR1cm47ZT1vLkRvbUV2ZW50Ll9wb2ludGVyc0NvdW50fWVsc2UgZT10LnRvdWNoZXMubGVuZ3RoO2lmKCEoZT4xKSl7dmFyIGk9RGF0ZS5ub3coKSxuPWktKHJ8fGkpO2E9dC50b3VjaGVzP3QudG91Y2hlc1swXTp0LGg9bj4wJiZuPD1sLHI9aX19ZnVuY3Rpb24gcyh0KXtpZihoJiYhYS5jYW5jZWxCdWJibGUpe2lmKG8uQnJvd3Nlci5wb2ludGVyKXtpZighby5Ccm93c2VyLmVkZ2V8fFwibW91c2VcIj09PXQucG9pbnRlclR5cGUpcmV0dXJuO3ZhciBpLG4scz17fTtmb3IobiBpbiBhKWk9YVtuXSxzW25dPWkmJmkuYmluZD9pLmJpbmQoYSk6aTthPXN9YS50eXBlPVwiZGJsY2xpY2tcIixlKGEpLHI9bnVsbH19dmFyIHIsYSxoPSExLGw9MjUwLHU9XCJfbGVhZmxldF9cIixjPXRoaXMuX3RvdWNoc3RhcnQsZD10aGlzLl90b3VjaGVuZDtyZXR1cm4gdFt1K2MraV09bix0W3UrZCtpXT1zLHRbdStcImRibGNsaWNrXCIraV09ZSx0LmFkZEV2ZW50TGlzdGVuZXIoYyxuLCExKSx0LmFkZEV2ZW50TGlzdGVuZXIoZCxzLCExKSx0LmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLGUsITEpLHRoaXN9LHJlbW92ZURvdWJsZVRhcExpc3RlbmVyOmZ1bmN0aW9uKHQsZSl7dmFyIGk9XCJfbGVhZmxldF9cIixuPXRbaSt0aGlzLl90b3VjaHN0YXJ0K2VdLHM9dFtpK3RoaXMuX3RvdWNoZW5kK2VdLHI9dFtpK1wiZGJsY2xpY2tcIitlXTtyZXR1cm4gdC5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuX3RvdWNoc3RhcnQsbiwhMSksdC5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuX3RvdWNoZW5kLHMsITEpLG8uQnJvd3Nlci5lZGdlfHx0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLHIsITEpLHRoaXN9fSksby5leHRlbmQoby5Eb21FdmVudCx7UE9JTlRFUl9ET1dOOm8uQnJvd3Nlci5tc1BvaW50ZXI/XCJNU1BvaW50ZXJEb3duXCI6XCJwb2ludGVyZG93blwiLFBPSU5URVJfTU9WRTpvLkJyb3dzZXIubXNQb2ludGVyP1wiTVNQb2ludGVyTW92ZVwiOlwicG9pbnRlcm1vdmVcIixQT0lOVEVSX1VQOm8uQnJvd3Nlci5tc1BvaW50ZXI/XCJNU1BvaW50ZXJVcFwiOlwicG9pbnRlcnVwXCIsUE9JTlRFUl9DQU5DRUw6by5Ccm93c2VyLm1zUG9pbnRlcj9cIk1TUG9pbnRlckNhbmNlbFwiOlwicG9pbnRlcmNhbmNlbFwiLFRBR19XSElURV9MSVNUOltcIklOUFVUXCIsXCJTRUxFQ1RcIixcIk9QVElPTlwiXSxfcG9pbnRlcnM6e30sX3BvaW50ZXJzQ291bnQ6MCxhZGRQb2ludGVyTGlzdGVuZXI6ZnVuY3Rpb24odCxlLGksbil7cmV0dXJuXCJ0b3VjaHN0YXJ0XCI9PT1lP3RoaXMuX2FkZFBvaW50ZXJTdGFydCh0LGksbik6XCJ0b3VjaG1vdmVcIj09PWU/dGhpcy5fYWRkUG9pbnRlck1vdmUodCxpLG4pOlwidG91Y2hlbmRcIj09PWUmJnRoaXMuX2FkZFBvaW50ZXJFbmQodCxpLG4pLHRoaXN9LHJlbW92ZVBvaW50ZXJMaXN0ZW5lcjpmdW5jdGlvbih0LGUsaSl7dmFyIG49dFtcIl9sZWFmbGV0X1wiK2UraV07cmV0dXJuXCJ0b3VjaHN0YXJ0XCI9PT1lP3QucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLlBPSU5URVJfRE9XTixuLCExKTpcInRvdWNobW92ZVwiPT09ZT90LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5QT0lOVEVSX01PVkUsbiwhMSk6XCJ0b3VjaGVuZFwiPT09ZSYmKHQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLlBPSU5URVJfVVAsbiwhMSksdC5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9DQU5DRUwsbiwhMSkpLHRoaXN9LF9hZGRQb2ludGVyU3RhcnQ6ZnVuY3Rpb24odCxpLG4pe3ZhciBzPW8uYmluZChmdW5jdGlvbih0KXtpZihcIm1vdXNlXCIhPT10LnBvaW50ZXJUeXBlJiZ0Lk1TUE9JTlRFUl9UWVBFX01PVVNFJiZ0LnBvaW50ZXJUeXBlIT09dC5NU1BPSU5URVJfVFlQRV9NT1VTRSl7aWYoISh0aGlzLlRBR19XSElURV9MSVNULmluZGV4T2YodC50YXJnZXQudGFnTmFtZSk8MCkpcmV0dXJuO28uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCl9dGhpcy5faGFuZGxlUG9pbnRlcih0LGkpfSx0aGlzKTtpZih0W1wiX2xlYWZsZXRfdG91Y2hzdGFydFwiK25dPXMsdC5hZGRFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9ET1dOLHMsITEpLCF0aGlzLl9wb2ludGVyRG9jTGlzdGVuZXIpe3ZhciByPW8uYmluZCh0aGlzLl9nbG9iYWxQb2ludGVyVXAsdGhpcyk7ZS5kb2N1bWVudEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLlBPSU5URVJfRE9XTixvLmJpbmQodGhpcy5fZ2xvYmFsUG9pbnRlckRvd24sdGhpcyksITApLGUuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIodGhpcy5QT0lOVEVSX01PVkUsby5iaW5kKHRoaXMuX2dsb2JhbFBvaW50ZXJNb3ZlLHRoaXMpLCEwKSxlLmRvY3VtZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9VUCxyLCEwKSxlLmRvY3VtZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9DQU5DRUwsciwhMCksdGhpcy5fcG9pbnRlckRvY0xpc3RlbmVyPSEwfX0sX2dsb2JhbFBvaW50ZXJEb3duOmZ1bmN0aW9uKHQpe3RoaXMuX3BvaW50ZXJzW3QucG9pbnRlcklkXT10LHRoaXMuX3BvaW50ZXJzQ291bnQrK30sX2dsb2JhbFBvaW50ZXJNb3ZlOmZ1bmN0aW9uKHQpe3RoaXMuX3BvaW50ZXJzW3QucG9pbnRlcklkXSYmKHRoaXMuX3BvaW50ZXJzW3QucG9pbnRlcklkXT10KX0sX2dsb2JhbFBvaW50ZXJVcDpmdW5jdGlvbih0KXtkZWxldGUgdGhpcy5fcG9pbnRlcnNbdC5wb2ludGVySWRdLHRoaXMuX3BvaW50ZXJzQ291bnQtLX0sX2hhbmRsZVBvaW50ZXI6ZnVuY3Rpb24odCxlKXt0LnRvdWNoZXM9W107Zm9yKHZhciBpIGluIHRoaXMuX3BvaW50ZXJzKXQudG91Y2hlcy5wdXNoKHRoaXMuX3BvaW50ZXJzW2ldKTt0LmNoYW5nZWRUb3VjaGVzPVt0XSxlKHQpfSxfYWRkUG9pbnRlck1vdmU6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPW8uYmluZChmdW5jdGlvbih0KXsodC5wb2ludGVyVHlwZSE9PXQuTVNQT0lOVEVSX1RZUEVfTU9VU0UmJlwibW91c2VcIiE9PXQucG9pbnRlclR5cGV8fDAhPT10LmJ1dHRvbnMpJiZ0aGlzLl9oYW5kbGVQb2ludGVyKHQsZSl9LHRoaXMpO3RbXCJfbGVhZmxldF90b3VjaG1vdmVcIitpXT1uLHQuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLlBPSU5URVJfTU9WRSxuLCExKX0sX2FkZFBvaW50ZXJFbmQ6ZnVuY3Rpb24odCxlLGkpe3ZhciBuPW8uYmluZChmdW5jdGlvbih0KXt0aGlzLl9oYW5kbGVQb2ludGVyKHQsZSl9LHRoaXMpO3RbXCJfbGVhZmxldF90b3VjaGVuZFwiK2ldPW4sdC5hZGRFdmVudExpc3RlbmVyKHRoaXMuUE9JTlRFUl9VUCxuLCExKSx0LmFkZEV2ZW50TGlzdGVuZXIodGhpcy5QT0lOVEVSX0NBTkNFTCxuLCExKX19KSxvLk1hcC5tZXJnZU9wdGlvbnMoe3RvdWNoWm9vbTpvLkJyb3dzZXIudG91Y2gmJiFvLkJyb3dzZXIuYW5kcm9pZDIzLGJvdW5jZUF0Wm9vbUxpbWl0czohMH0pLG8uTWFwLlRvdWNoWm9vbT1vLkhhbmRsZXIuZXh0ZW5kKHthZGRIb29rczpmdW5jdGlvbigpe28uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9tYXAuX2NvbnRhaW5lcixcImxlYWZsZXQtdG91Y2gtem9vbVwiKSxvLkRvbUV2ZW50Lm9uKHRoaXMuX21hcC5fY29udGFpbmVyLFwidG91Y2hzdGFydFwiLHRoaXMuX29uVG91Y2hTdGFydCx0aGlzKX0scmVtb3ZlSG9va3M6ZnVuY3Rpb24oKXtvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fbWFwLl9jb250YWluZXIsXCJsZWFmbGV0LXRvdWNoLXpvb21cIiksby5Eb21FdmVudC5vZmYodGhpcy5fbWFwLl9jb250YWluZXIsXCJ0b3VjaHN0YXJ0XCIsdGhpcy5fb25Ub3VjaFN0YXJ0LHRoaXMpfSxfb25Ub3VjaFN0YXJ0OmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuX21hcDtpZih0LnRvdWNoZXMmJjI9PT10LnRvdWNoZXMubGVuZ3RoJiYhaS5fYW5pbWF0aW5nWm9vbSYmIXRoaXMuX3pvb21pbmcpe3ZhciBuPWkubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQodC50b3VjaGVzWzBdKSxzPWkubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQodC50b3VjaGVzWzFdKTt0aGlzLl9jZW50ZXJQb2ludD1pLmdldFNpemUoKS5fZGl2aWRlQnkoMiksdGhpcy5fc3RhcnRMYXRMbmc9aS5jb250YWluZXJQb2ludFRvTGF0TG5nKHRoaXMuX2NlbnRlclBvaW50KSxcImNlbnRlclwiIT09aS5vcHRpb25zLnRvdWNoWm9vbSYmKHRoaXMuX3BpbmNoU3RhcnRMYXRMbmc9aS5jb250YWluZXJQb2ludFRvTGF0TG5nKG4uYWRkKHMpLl9kaXZpZGVCeSgyKSkpLHRoaXMuX3N0YXJ0RGlzdD1uLmRpc3RhbmNlVG8ocyksdGhpcy5fc3RhcnRab29tPWkuZ2V0Wm9vbSgpLHRoaXMuX21vdmVkPSExLHRoaXMuX3pvb21pbmc9ITAsaS5fc3RvcCgpLG8uRG9tRXZlbnQub24oZSxcInRvdWNobW92ZVwiLHRoaXMuX29uVG91Y2hNb3ZlLHRoaXMpLm9uKGUsXCJ0b3VjaGVuZFwiLHRoaXMuX29uVG91Y2hFbmQsdGhpcyksby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KX19LF9vblRvdWNoTW92ZTpmdW5jdGlvbih0KXtpZih0LnRvdWNoZXMmJjI9PT10LnRvdWNoZXMubGVuZ3RoJiZ0aGlzLl96b29taW5nKXt2YXIgZT10aGlzLl9tYXAsaT1lLm1vdXNlRXZlbnRUb0NvbnRhaW5lclBvaW50KHQudG91Y2hlc1swXSksbj1lLm1vdXNlRXZlbnRUb0NvbnRhaW5lclBvaW50KHQudG91Y2hlc1sxXSkscz1pLmRpc3RhbmNlVG8obikvdGhpcy5fc3RhcnREaXN0O2lmKHRoaXMuX3pvb209ZS5nZXRTY2FsZVpvb20ocyx0aGlzLl9zdGFydFpvb20pLCFlLm9wdGlvbnMuYm91bmNlQXRab29tTGltaXRzJiYodGhpcy5fem9vbTxlLmdldE1pblpvb20oKSYmczwxfHx0aGlzLl96b29tPmUuZ2V0TWF4Wm9vbSgpJiZzPjEpJiYodGhpcy5fem9vbT1lLl9saW1pdFpvb20odGhpcy5fem9vbSkpLFwiY2VudGVyXCI9PT1lLm9wdGlvbnMudG91Y2hab29tKXtpZih0aGlzLl9jZW50ZXI9dGhpcy5fc3RhcnRMYXRMbmcsMT09PXMpcmV0dXJufWVsc2V7dmFyIHI9aS5fYWRkKG4pLl9kaXZpZGVCeSgyKS5fc3VidHJhY3QodGhpcy5fY2VudGVyUG9pbnQpO2lmKDE9PT1zJiYwPT09ci54JiYwPT09ci55KXJldHVybjt0aGlzLl9jZW50ZXI9ZS51bnByb2plY3QoZS5wcm9qZWN0KHRoaXMuX3BpbmNoU3RhcnRMYXRMbmcsdGhpcy5fem9vbSkuc3VidHJhY3QociksdGhpcy5fem9vbSl9dGhpcy5fbW92ZWR8fChlLl9tb3ZlU3RhcnQoITApLHRoaXMuX21vdmVkPSEwKSxvLlV0aWwuY2FuY2VsQW5pbUZyYW1lKHRoaXMuX2FuaW1SZXF1ZXN0KTt2YXIgYT1vLmJpbmQoZS5fbW92ZSxlLHRoaXMuX2NlbnRlcix0aGlzLl96b29tLHtwaW5jaDohMCxyb3VuZDohMX0pO3RoaXMuX2FuaW1SZXF1ZXN0PW8uVXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGEsdGhpcywhMCksby5Eb21FdmVudC5wcmV2ZW50RGVmYXVsdCh0KX19LF9vblRvdWNoRW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21vdmVkJiZ0aGlzLl96b29taW5nPyh0aGlzLl96b29taW5nPSExLG8uVXRpbC5jYW5jZWxBbmltRnJhbWUodGhpcy5fYW5pbVJlcXVlc3QpLG8uRG9tRXZlbnQub2ZmKGUsXCJ0b3VjaG1vdmVcIix0aGlzLl9vblRvdWNoTW92ZSkub2ZmKGUsXCJ0b3VjaGVuZFwiLHRoaXMuX29uVG91Y2hFbmQpLHZvaWQodGhpcy5fbWFwLm9wdGlvbnMuem9vbUFuaW1hdGlvbj90aGlzLl9tYXAuX2FuaW1hdGVab29tKHRoaXMuX2NlbnRlcix0aGlzLl9tYXAuX2xpbWl0Wm9vbSh0aGlzLl96b29tKSwhMCx0aGlzLl9tYXAub3B0aW9ucy56b29tU25hcCk6dGhpcy5fbWFwLl9yZXNldFZpZXcodGhpcy5fY2VudGVyLHRoaXMuX21hcC5fbGltaXRab29tKHRoaXMuX3pvb20pKSkpOnZvaWQodGhpcy5fem9vbWluZz0hMSl9fSksby5NYXAuYWRkSW5pdEhvb2soXCJhZGRIYW5kbGVyXCIsXCJ0b3VjaFpvb21cIixvLk1hcC5Ub3VjaFpvb20pLG8uTWFwLm1lcmdlT3B0aW9ucyh7dGFwOiEwLHRhcFRvbGVyYW5jZToxNX0pLG8uTWFwLlRhcD1vLkhhbmRsZXIuZXh0ZW5kKHthZGRIb29rczpmdW5jdGlvbigpe28uRG9tRXZlbnQub24odGhpcy5fbWFwLl9jb250YWluZXIsXCJ0b3VjaHN0YXJ0XCIsdGhpcy5fb25Eb3duLHRoaXMpfSxyZW1vdmVIb29rczpmdW5jdGlvbigpe28uRG9tRXZlbnQub2ZmKHRoaXMuX21hcC5fY29udGFpbmVyLFwidG91Y2hzdGFydFwiLHRoaXMuX29uRG93bix0aGlzKX0sX29uRG93bjpmdW5jdGlvbih0KXtpZih0LnRvdWNoZXMpe2lmKG8uRG9tRXZlbnQucHJldmVudERlZmF1bHQodCksdGhpcy5fZmlyZUNsaWNrPSEwLHQudG91Y2hlcy5sZW5ndGg+MSlyZXR1cm4gdGhpcy5fZmlyZUNsaWNrPSExLHZvaWQgY2xlYXJUaW1lb3V0KHRoaXMuX2hvbGRUaW1lb3V0KTt2YXIgaT10LnRvdWNoZXNbMF0sbj1pLnRhcmdldDt0aGlzLl9zdGFydFBvcz10aGlzLl9uZXdQb3M9bmV3IG8uUG9pbnQoaS5jbGllbnRYLGkuY2xpZW50WSksbi50YWdOYW1lJiZcImFcIj09PW4udGFnTmFtZS50b0xvd2VyQ2FzZSgpJiZvLkRvbVV0aWwuYWRkQ2xhc3MobixcImxlYWZsZXQtYWN0aXZlXCIpLHRoaXMuX2hvbGRUaW1lb3V0PXNldFRpbWVvdXQoby5iaW5kKGZ1bmN0aW9uKCl7dGhpcy5faXNUYXBWYWxpZCgpJiYodGhpcy5fZmlyZUNsaWNrPSExLHRoaXMuX29uVXAoKSx0aGlzLl9zaW11bGF0ZUV2ZW50KFwiY29udGV4dG1lbnVcIixpKSl9LHRoaXMpLDFlMyksdGhpcy5fc2ltdWxhdGVFdmVudChcIm1vdXNlZG93blwiLGkpLG8uRG9tRXZlbnQub24oZSx7dG91Y2htb3ZlOnRoaXMuX29uTW92ZSx0b3VjaGVuZDp0aGlzLl9vblVwfSx0aGlzKX19LF9vblVwOmZ1bmN0aW9uKHQpe2lmKGNsZWFyVGltZW91dCh0aGlzLl9ob2xkVGltZW91dCksby5Eb21FdmVudC5vZmYoZSx7dG91Y2htb3ZlOnRoaXMuX29uTW92ZSx0b3VjaGVuZDp0aGlzLl9vblVwfSx0aGlzKSx0aGlzLl9maXJlQ2xpY2smJnQmJnQuY2hhbmdlZFRvdWNoZXMpe3ZhciBpPXQuY2hhbmdlZFRvdWNoZXNbMF0sbj1pLnRhcmdldDtuJiZuLnRhZ05hbWUmJlwiYVwiPT09bi50YWdOYW1lLnRvTG93ZXJDYXNlKCkmJm8uRG9tVXRpbC5yZW1vdmVDbGFzcyhuLFwibGVhZmxldC1hY3RpdmVcIiksdGhpcy5fc2ltdWxhdGVFdmVudChcIm1vdXNldXBcIixpKSxcbnRoaXMuX2lzVGFwVmFsaWQoKSYmdGhpcy5fc2ltdWxhdGVFdmVudChcImNsaWNrXCIsaSl9fSxfaXNUYXBWYWxpZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9uZXdQb3MuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFBvcyk8PXRoaXMuX21hcC5vcHRpb25zLnRhcFRvbGVyYW5jZX0sX29uTW92ZTpmdW5jdGlvbih0KXt2YXIgZT10LnRvdWNoZXNbMF07dGhpcy5fbmV3UG9zPW5ldyBvLlBvaW50KGUuY2xpZW50WCxlLmNsaWVudFkpLHRoaXMuX3NpbXVsYXRlRXZlbnQoXCJtb3VzZW1vdmVcIixlKX0sX3NpbXVsYXRlRXZlbnQ6ZnVuY3Rpb24oaSxuKXt2YXIgbz1lLmNyZWF0ZUV2ZW50KFwiTW91c2VFdmVudHNcIik7by5fc2ltdWxhdGVkPSEwLG4udGFyZ2V0Ll9zaW11bGF0ZWRDbGljaz0hMCxvLmluaXRNb3VzZUV2ZW50KGksITAsITAsdCwxLG4uc2NyZWVuWCxuLnNjcmVlblksbi5jbGllbnRYLG4uY2xpZW50WSwhMSwhMSwhMSwhMSwwLG51bGwpLG4udGFyZ2V0LmRpc3BhdGNoRXZlbnQobyl9fSksby5Ccm93c2VyLnRvdWNoJiYhby5Ccm93c2VyLnBvaW50ZXImJm8uTWFwLmFkZEluaXRIb29rKFwiYWRkSGFuZGxlclwiLFwidGFwXCIsby5NYXAuVGFwKSxvLk1hcC5tZXJnZU9wdGlvbnMoe2JveFpvb206ITB9KSxvLk1hcC5Cb3hab29tPW8uSGFuZGxlci5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXQsdGhpcy5fY29udGFpbmVyPXQuX2NvbnRhaW5lcix0aGlzLl9wYW5lPXQuX3BhbmVzLm92ZXJsYXlQYW5lfSxhZGRIb29rczpmdW5jdGlvbigpe28uRG9tRXZlbnQub24odGhpcy5fY29udGFpbmVyLFwibW91c2Vkb3duXCIsdGhpcy5fb25Nb3VzZURvd24sdGhpcyl9LHJlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYodGhpcy5fY29udGFpbmVyLFwibW91c2Vkb3duXCIsdGhpcy5fb25Nb3VzZURvd24sdGhpcyl9LG1vdmVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX21vdmVkfSxfcmVzZXRTdGF0ZTpmdW5jdGlvbigpe3RoaXMuX21vdmVkPSExfSxfb25Nb3VzZURvd246ZnVuY3Rpb24odCl7cmV0dXJuISghdC5zaGlmdEtleXx8MSE9PXQud2hpY2gmJjEhPT10LmJ1dHRvbikmJih0aGlzLl9yZXNldFN0YXRlKCksby5Eb21VdGlsLmRpc2FibGVUZXh0U2VsZWN0aW9uKCksby5Eb21VdGlsLmRpc2FibGVJbWFnZURyYWcoKSx0aGlzLl9zdGFydFBvaW50PXRoaXMuX21hcC5tb3VzZUV2ZW50VG9Db250YWluZXJQb2ludCh0KSx2b2lkIG8uRG9tRXZlbnQub24oZSx7Y29udGV4dG1lbnU6by5Eb21FdmVudC5zdG9wLG1vdXNlbW92ZTp0aGlzLl9vbk1vdXNlTW92ZSxtb3VzZXVwOnRoaXMuX29uTW91c2VVcCxrZXlkb3duOnRoaXMuX29uS2V5RG93bn0sdGhpcykpfSxfb25Nb3VzZU1vdmU6ZnVuY3Rpb24odCl7dGhpcy5fbW92ZWR8fCh0aGlzLl9tb3ZlZD0hMCx0aGlzLl9ib3g9by5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLFwibGVhZmxldC16b29tLWJveFwiLHRoaXMuX2NvbnRhaW5lciksby5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2NvbnRhaW5lcixcImxlYWZsZXQtY3Jvc3NoYWlyXCIpLHRoaXMuX21hcC5maXJlKFwiYm94em9vbXN0YXJ0XCIpKSx0aGlzLl9wb2ludD10aGlzLl9tYXAubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQodCk7dmFyIGU9bmV3IG8uQm91bmRzKHRoaXMuX3BvaW50LHRoaXMuX3N0YXJ0UG9pbnQpLGk9ZS5nZXRTaXplKCk7by5Eb21VdGlsLnNldFBvc2l0aW9uKHRoaXMuX2JveCxlLm1pbiksdGhpcy5fYm94LnN0eWxlLndpZHRoPWkueCtcInB4XCIsdGhpcy5fYm94LnN0eWxlLmhlaWdodD1pLnkrXCJweFwifSxfZmluaXNoOmZ1bmN0aW9uKCl7dGhpcy5fbW92ZWQmJihvLkRvbVV0aWwucmVtb3ZlKHRoaXMuX2JveCksby5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX2NvbnRhaW5lcixcImxlYWZsZXQtY3Jvc3NoYWlyXCIpKSxvLkRvbVV0aWwuZW5hYmxlVGV4dFNlbGVjdGlvbigpLG8uRG9tVXRpbC5lbmFibGVJbWFnZURyYWcoKSxvLkRvbUV2ZW50Lm9mZihlLHtjb250ZXh0bWVudTpvLkRvbUV2ZW50LnN0b3AsbW91c2Vtb3ZlOnRoaXMuX29uTW91c2VNb3ZlLG1vdXNldXA6dGhpcy5fb25Nb3VzZVVwLGtleWRvd246dGhpcy5fb25LZXlEb3dufSx0aGlzKX0sX29uTW91c2VVcDpmdW5jdGlvbih0KXtpZigoMT09PXQud2hpY2h8fDE9PT10LmJ1dHRvbikmJih0aGlzLl9maW5pc2goKSx0aGlzLl9tb3ZlZCkpe3NldFRpbWVvdXQoby5iaW5kKHRoaXMuX3Jlc2V0U3RhdGUsdGhpcyksMCk7dmFyIGU9bmV3IG8uTGF0TG5nQm91bmRzKHRoaXMuX21hcC5jb250YWluZXJQb2ludFRvTGF0TG5nKHRoaXMuX3N0YXJ0UG9pbnQpLHRoaXMuX21hcC5jb250YWluZXJQb2ludFRvTGF0TG5nKHRoaXMuX3BvaW50KSk7dGhpcy5fbWFwLmZpdEJvdW5kcyhlKS5maXJlKFwiYm94em9vbWVuZFwiLHtib3hab29tQm91bmRzOmV9KX19LF9vbktleURvd246ZnVuY3Rpb24odCl7Mjc9PT10LmtleUNvZGUmJnRoaXMuX2ZpbmlzaCgpfX0pLG8uTWFwLmFkZEluaXRIb29rKFwiYWRkSGFuZGxlclwiLFwiYm94Wm9vbVwiLG8uTWFwLkJveFpvb20pLG8uTWFwLm1lcmdlT3B0aW9ucyh7a2V5Ym9hcmQ6ITAsa2V5Ym9hcmRQYW5EZWx0YTo4MH0pLG8uTWFwLktleWJvYXJkPW8uSGFuZGxlci5leHRlbmQoe2tleUNvZGVzOntsZWZ0OlszN10scmlnaHQ6WzM5XSxkb3duOls0MF0sdXA6WzM4XSx6b29tSW46WzE4NywxMDcsNjEsMTcxXSx6b29tT3V0OlsxODksMTA5LDU0LDE3M119LGluaXRpYWxpemU6ZnVuY3Rpb24odCl7dGhpcy5fbWFwPXQsdGhpcy5fc2V0UGFuRGVsdGEodC5vcHRpb25zLmtleWJvYXJkUGFuRGVsdGEpLHRoaXMuX3NldFpvb21EZWx0YSh0Lm9wdGlvbnMuem9vbURlbHRhKX0sYWRkSG9va3M6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXAuX2NvbnRhaW5lcjt0LnRhYkluZGV4PD0wJiYodC50YWJJbmRleD1cIjBcIiksby5Eb21FdmVudC5vbih0LHtmb2N1czp0aGlzLl9vbkZvY3VzLGJsdXI6dGhpcy5fb25CbHVyLG1vdXNlZG93bjp0aGlzLl9vbk1vdXNlRG93bn0sdGhpcyksdGhpcy5fbWFwLm9uKHtmb2N1czp0aGlzLl9hZGRIb29rcyxibHVyOnRoaXMuX3JlbW92ZUhvb2tzfSx0aGlzKX0scmVtb3ZlSG9va3M6ZnVuY3Rpb24oKXt0aGlzLl9yZW1vdmVIb29rcygpLG8uRG9tRXZlbnQub2ZmKHRoaXMuX21hcC5fY29udGFpbmVyLHtmb2N1czp0aGlzLl9vbkZvY3VzLGJsdXI6dGhpcy5fb25CbHVyLG1vdXNlZG93bjp0aGlzLl9vbk1vdXNlRG93bn0sdGhpcyksdGhpcy5fbWFwLm9mZih7Zm9jdXM6dGhpcy5fYWRkSG9va3MsYmx1cjp0aGlzLl9yZW1vdmVIb29rc30sdGhpcyl9LF9vbk1vdXNlRG93bjpmdW5jdGlvbigpe2lmKCF0aGlzLl9mb2N1c2VkKXt2YXIgaT1lLmJvZHksbj1lLmRvY3VtZW50RWxlbWVudCxvPWkuc2Nyb2xsVG9wfHxuLnNjcm9sbFRvcCxzPWkuc2Nyb2xsTGVmdHx8bi5zY3JvbGxMZWZ0O3RoaXMuX21hcC5fY29udGFpbmVyLmZvY3VzKCksdC5zY3JvbGxUbyhzLG8pfX0sX29uRm9jdXM6ZnVuY3Rpb24oKXt0aGlzLl9mb2N1c2VkPSEwLHRoaXMuX21hcC5maXJlKFwiZm9jdXNcIil9LF9vbkJsdXI6ZnVuY3Rpb24oKXt0aGlzLl9mb2N1c2VkPSExLHRoaXMuX21hcC5maXJlKFwiYmx1clwiKX0sX3NldFBhbkRlbHRhOmZ1bmN0aW9uKHQpe3ZhciBlLGksbj10aGlzLl9wYW5LZXlzPXt9LG89dGhpcy5rZXlDb2Rlcztmb3IoZT0wLGk9by5sZWZ0Lmxlbmd0aDtlPGk7ZSsrKW5bby5sZWZ0W2VdXT1bLTEqdCwwXTtmb3IoZT0wLGk9by5yaWdodC5sZW5ndGg7ZTxpO2UrKyluW28ucmlnaHRbZV1dPVt0LDBdO2ZvcihlPTAsaT1vLmRvd24ubGVuZ3RoO2U8aTtlKyspbltvLmRvd25bZV1dPVswLHRdO2ZvcihlPTAsaT1vLnVwLmxlbmd0aDtlPGk7ZSsrKW5bby51cFtlXV09WzAsLTEqdF19LF9zZXRab29tRGVsdGE6ZnVuY3Rpb24odCl7dmFyIGUsaSxuPXRoaXMuX3pvb21LZXlzPXt9LG89dGhpcy5rZXlDb2Rlcztmb3IoZT0wLGk9by56b29tSW4ubGVuZ3RoO2U8aTtlKyspbltvLnpvb21JbltlXV09dDtmb3IoZT0wLGk9by56b29tT3V0Lmxlbmd0aDtlPGk7ZSsrKW5bby56b29tT3V0W2VdXT0tdH0sX2FkZEhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vbihlLFwia2V5ZG93blwiLHRoaXMuX29uS2V5RG93bix0aGlzKX0sX3JlbW92ZUhvb2tzOmZ1bmN0aW9uKCl7by5Eb21FdmVudC5vZmYoZSxcImtleWRvd25cIix0aGlzLl9vbktleURvd24sdGhpcyl9LF9vbktleURvd246ZnVuY3Rpb24odCl7aWYoISh0LmFsdEtleXx8dC5jdHJsS2V5fHx0Lm1ldGFLZXkpKXt2YXIgZSxpPXQua2V5Q29kZSxuPXRoaXMuX21hcDtpZihpIGluIHRoaXMuX3BhbktleXMpe2lmKG4uX3BhbkFuaW0mJm4uX3BhbkFuaW0uX2luUHJvZ3Jlc3MpcmV0dXJuO2U9dGhpcy5fcGFuS2V5c1tpXSx0LnNoaWZ0S2V5JiYoZT1vLnBvaW50KGUpLm11bHRpcGx5QnkoMykpLG4ucGFuQnkoZSksbi5vcHRpb25zLm1heEJvdW5kcyYmbi5wYW5JbnNpZGVCb3VuZHMobi5vcHRpb25zLm1heEJvdW5kcyl9ZWxzZSBpZihpIGluIHRoaXMuX3pvb21LZXlzKW4uc2V0Wm9vbShuLmdldFpvb20oKSsodC5zaGlmdEtleT8zOjEpKnRoaXMuX3pvb21LZXlzW2ldKTtlbHNle2lmKDI3IT09aSlyZXR1cm47bi5jbG9zZVBvcHVwKCl9by5Eb21FdmVudC5zdG9wKHQpfX19KSxvLk1hcC5hZGRJbml0SG9vayhcImFkZEhhbmRsZXJcIixcImtleWJvYXJkXCIsby5NYXAuS2V5Ym9hcmQpLG8uSGFuZGxlci5NYXJrZXJEcmFnPW8uSGFuZGxlci5leHRlbmQoe2luaXRpYWxpemU6ZnVuY3Rpb24odCl7dGhpcy5fbWFya2VyPXR9LGFkZEhvb2tzOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fbWFya2VyLl9pY29uO3RoaXMuX2RyYWdnYWJsZXx8KHRoaXMuX2RyYWdnYWJsZT1uZXcgby5EcmFnZ2FibGUodCx0LCEwKSksdGhpcy5fZHJhZ2dhYmxlLm9uKHtkcmFnc3RhcnQ6dGhpcy5fb25EcmFnU3RhcnQsZHJhZzp0aGlzLl9vbkRyYWcsZHJhZ2VuZDp0aGlzLl9vbkRyYWdFbmR9LHRoaXMpLmVuYWJsZSgpLG8uRG9tVXRpbC5hZGRDbGFzcyh0LFwibGVhZmxldC1tYXJrZXItZHJhZ2dhYmxlXCIpfSxyZW1vdmVIb29rczpmdW5jdGlvbigpe3RoaXMuX2RyYWdnYWJsZS5vZmYoe2RyYWdzdGFydDp0aGlzLl9vbkRyYWdTdGFydCxkcmFnOnRoaXMuX29uRHJhZyxkcmFnZW5kOnRoaXMuX29uRHJhZ0VuZH0sdGhpcykuZGlzYWJsZSgpLHRoaXMuX21hcmtlci5faWNvbiYmby5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX21hcmtlci5faWNvbixcImxlYWZsZXQtbWFya2VyLWRyYWdnYWJsZVwiKX0sbW92ZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZHJhZ2dhYmxlJiZ0aGlzLl9kcmFnZ2FibGUuX21vdmVkfSxfb25EcmFnU3RhcnQ6ZnVuY3Rpb24oKXt0aGlzLl9vbGRMYXRMbmc9dGhpcy5fbWFya2VyLmdldExhdExuZygpLHRoaXMuX21hcmtlci5jbG9zZVBvcHVwKCkuZmlyZShcIm1vdmVzdGFydFwiKS5maXJlKFwiZHJhZ3N0YXJ0XCIpfSxfb25EcmFnOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX21hcmtlcixpPWUuX3NoYWRvdyxuPW8uRG9tVXRpbC5nZXRQb3NpdGlvbihlLl9pY29uKSxzPWUuX21hcC5sYXllclBvaW50VG9MYXRMbmcobik7aSYmby5Eb21VdGlsLnNldFBvc2l0aW9uKGksbiksZS5fbGF0bG5nPXMsdC5sYXRsbmc9cyx0Lm9sZExhdExuZz10aGlzLl9vbGRMYXRMbmcsZS5maXJlKFwibW92ZVwiLHQpLmZpcmUoXCJkcmFnXCIsdCl9LF9vbkRyYWdFbmQ6ZnVuY3Rpb24odCl7ZGVsZXRlIHRoaXMuX29sZExhdExuZyx0aGlzLl9tYXJrZXIuZmlyZShcIm1vdmVlbmRcIikuZmlyZShcImRyYWdlbmRcIix0KX19KSxvLkNvbnRyb2w9by5DbGFzcy5leHRlbmQoe29wdGlvbnM6e3Bvc2l0aW9uOlwidG9wcmlnaHRcIn0saW5pdGlhbGl6ZTpmdW5jdGlvbih0KXtvLnNldE9wdGlvbnModGhpcyx0KX0sZ2V0UG9zaXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLnBvc2l0aW9ufSxzZXRQb3NpdGlvbjpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9tYXA7cmV0dXJuIGUmJmUucmVtb3ZlQ29udHJvbCh0aGlzKSx0aGlzLm9wdGlvbnMucG9zaXRpb249dCxlJiZlLmFkZENvbnRyb2wodGhpcyksdGhpc30sZ2V0Q29udGFpbmVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2NvbnRhaW5lcn0sYWRkVG86ZnVuY3Rpb24odCl7dGhpcy5yZW1vdmUoKSx0aGlzLl9tYXA9dDt2YXIgZT10aGlzLl9jb250YWluZXI9dGhpcy5vbkFkZCh0KSxpPXRoaXMuZ2V0UG9zaXRpb24oKSxuPXQuX2NvbnRyb2xDb3JuZXJzW2ldO3JldHVybiBvLkRvbVV0aWwuYWRkQ2xhc3MoZSxcImxlYWZsZXQtY29udHJvbFwiKSxpLmluZGV4T2YoXCJib3R0b21cIikhPT0tMT9uLmluc2VydEJlZm9yZShlLG4uZmlyc3RDaGlsZCk6bi5hcHBlbmRDaGlsZChlKSx0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbWFwPyhvLkRvbVV0aWwucmVtb3ZlKHRoaXMuX2NvbnRhaW5lciksdGhpcy5vblJlbW92ZSYmdGhpcy5vblJlbW92ZSh0aGlzLl9tYXApLHRoaXMuX21hcD1udWxsLHRoaXMpOnRoaXN9LF9yZWZvY3VzT25NYXA6ZnVuY3Rpb24odCl7dGhpcy5fbWFwJiZ0JiZ0LnNjcmVlblg+MCYmdC5zY3JlZW5ZPjAmJnRoaXMuX21hcC5nZXRDb250YWluZXIoKS5mb2N1cygpfX0pLG8uY29udHJvbD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uQ29udHJvbCh0KX0sby5NYXAuaW5jbHVkZSh7YWRkQ29udHJvbDpmdW5jdGlvbih0KXtyZXR1cm4gdC5hZGRUbyh0aGlzKSx0aGlzfSxyZW1vdmVDb250cm9sOmZ1bmN0aW9uKHQpe3JldHVybiB0LnJlbW92ZSgpLHRoaXN9LF9pbml0Q29udHJvbFBvczpmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCxzKXt2YXIgcj1pK3QrXCIgXCIraStzO2VbdCtzXT1vLkRvbVV0aWwuY3JlYXRlKFwiZGl2XCIscixuKX12YXIgZT10aGlzLl9jb250cm9sQ29ybmVycz17fSxpPVwibGVhZmxldC1cIixuPXRoaXMuX2NvbnRyb2xDb250YWluZXI9by5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLGkrXCJjb250cm9sLWNvbnRhaW5lclwiLHRoaXMuX2NvbnRhaW5lcik7dChcInRvcFwiLFwibGVmdFwiKSx0KFwidG9wXCIsXCJyaWdodFwiKSx0KFwiYm90dG9tXCIsXCJsZWZ0XCIpLHQoXCJib3R0b21cIixcInJpZ2h0XCIpfSxfY2xlYXJDb250cm9sUG9zOmZ1bmN0aW9uKCl7by5Eb21VdGlsLnJlbW92ZSh0aGlzLl9jb250cm9sQ29udGFpbmVyKX19KSxvLkNvbnRyb2wuWm9vbT1vLkNvbnRyb2wuZXh0ZW5kKHtvcHRpb25zOntwb3NpdGlvbjpcInRvcGxlZnRcIix6b29tSW5UZXh0OlwiK1wiLHpvb21JblRpdGxlOlwiWm9vbSBpblwiLHpvb21PdXRUZXh0OlwiLVwiLHpvb21PdXRUaXRsZTpcIlpvb20gb3V0XCJ9LG9uQWRkOmZ1bmN0aW9uKHQpe3ZhciBlPVwibGVhZmxldC1jb250cm9sLXpvb21cIixpPW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixlK1wiIGxlYWZsZXQtYmFyXCIpLG49dGhpcy5vcHRpb25zO3JldHVybiB0aGlzLl96b29tSW5CdXR0b249dGhpcy5fY3JlYXRlQnV0dG9uKG4uem9vbUluVGV4dCxuLnpvb21JblRpdGxlLGUrXCItaW5cIixpLHRoaXMuX3pvb21JbiksdGhpcy5fem9vbU91dEJ1dHRvbj10aGlzLl9jcmVhdGVCdXR0b24obi56b29tT3V0VGV4dCxuLnpvb21PdXRUaXRsZSxlK1wiLW91dFwiLGksdGhpcy5fem9vbU91dCksdGhpcy5fdXBkYXRlRGlzYWJsZWQoKSx0Lm9uKFwiem9vbWVuZCB6b29tbGV2ZWxzY2hhbmdlXCIsdGhpcy5fdXBkYXRlRGlzYWJsZWQsdGhpcyksaX0sb25SZW1vdmU6ZnVuY3Rpb24odCl7dC5vZmYoXCJ6b29tZW5kIHpvb21sZXZlbHNjaGFuZ2VcIix0aGlzLl91cGRhdGVEaXNhYmxlZCx0aGlzKX0sZGlzYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kaXNhYmxlZD0hMCx0aGlzLl91cGRhdGVEaXNhYmxlZCgpLHRoaXN9LGVuYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9kaXNhYmxlZD0hMSx0aGlzLl91cGRhdGVEaXNhYmxlZCgpLHRoaXN9LF96b29tSW46ZnVuY3Rpb24odCl7IXRoaXMuX2Rpc2FibGVkJiZ0aGlzLl9tYXAuX3pvb208dGhpcy5fbWFwLmdldE1heFpvb20oKSYmdGhpcy5fbWFwLnpvb21Jbih0aGlzLl9tYXAub3B0aW9ucy56b29tRGVsdGEqKHQuc2hpZnRLZXk/MzoxKSl9LF96b29tT3V0OmZ1bmN0aW9uKHQpeyF0aGlzLl9kaXNhYmxlZCYmdGhpcy5fbWFwLl96b29tPnRoaXMuX21hcC5nZXRNaW5ab29tKCkmJnRoaXMuX21hcC56b29tT3V0KHRoaXMuX21hcC5vcHRpb25zLnpvb21EZWx0YSoodC5zaGlmdEtleT8zOjEpKX0sX2NyZWF0ZUJ1dHRvbjpmdW5jdGlvbih0LGUsaSxuLHMpe3ZhciByPW8uRG9tVXRpbC5jcmVhdGUoXCJhXCIsaSxuKTtyZXR1cm4gci5pbm5lckhUTUw9dCxyLmhyZWY9XCIjXCIsci50aXRsZT1lLHIuc2V0QXR0cmlidXRlKFwicm9sZVwiLFwiYnV0dG9uXCIpLHIuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLGUpLG8uRG9tRXZlbnQub24ocixcIm1vdXNlZG93biBkYmxjbGlja1wiLG8uRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKS5vbihyLFwiY2xpY2tcIixvLkRvbUV2ZW50LnN0b3ApLm9uKHIsXCJjbGlja1wiLHMsdGhpcykub24ocixcImNsaWNrXCIsdGhpcy5fcmVmb2N1c09uTWFwLHRoaXMpLHJ9LF91cGRhdGVEaXNhYmxlZDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPVwibGVhZmxldC1kaXNhYmxlZFwiO28uRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl96b29tSW5CdXR0b24sZSksby5Eb21VdGlsLnJlbW92ZUNsYXNzKHRoaXMuX3pvb21PdXRCdXR0b24sZSksKHRoaXMuX2Rpc2FibGVkfHx0Ll96b29tPT09dC5nZXRNaW5ab29tKCkpJiZvLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fem9vbU91dEJ1dHRvbixlKSwodGhpcy5fZGlzYWJsZWR8fHQuX3pvb209PT10LmdldE1heFpvb20oKSkmJm8uRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl96b29tSW5CdXR0b24sZSl9fSksby5NYXAubWVyZ2VPcHRpb25zKHt6b29tQ29udHJvbDohMH0pLG8uTWFwLmFkZEluaXRIb29rKGZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLnpvb21Db250cm9sJiYodGhpcy56b29tQ29udHJvbD1uZXcgby5Db250cm9sLlpvb20sdGhpcy5hZGRDb250cm9sKHRoaXMuem9vbUNvbnRyb2wpKX0pLG8uY29udHJvbC56b29tPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgby5Db250cm9sLlpvb20odCl9LG8uQ29udHJvbC5BdHRyaWJ1dGlvbj1vLkNvbnRyb2wuZXh0ZW5kKHtvcHRpb25zOntwb3NpdGlvbjpcImJvdHRvbXJpZ2h0XCIscHJlZml4Oic8YSBocmVmPVwiaHR0cDovL2xlYWZsZXRqcy5jb21cIiB0aXRsZT1cIkEgSlMgbGlicmFyeSBmb3IgaW50ZXJhY3RpdmUgbWFwc1wiPkxlYWZsZXQ8L2E+J30saW5pdGlhbGl6ZTpmdW5jdGlvbih0KXtvLnNldE9wdGlvbnModGhpcyx0KSx0aGlzLl9hdHRyaWJ1dGlvbnM9e319LG9uQWRkOmZ1bmN0aW9uKHQpe3QuYXR0cmlidXRpb25Db250cm9sPXRoaXMsdGhpcy5fY29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixcImxlYWZsZXQtY29udHJvbC1hdHRyaWJ1dGlvblwiKSxvLkRvbUV2ZW50JiZvLkRvbUV2ZW50LmRpc2FibGVDbGlja1Byb3BhZ2F0aW9uKHRoaXMuX2NvbnRhaW5lcik7Zm9yKHZhciBlIGluIHQuX2xheWVycyl0Ll9sYXllcnNbZV0uZ2V0QXR0cmlidXRpb24mJnRoaXMuYWRkQXR0cmlidXRpb24odC5fbGF5ZXJzW2VdLmdldEF0dHJpYnV0aW9uKCkpO3JldHVybiB0aGlzLl91cGRhdGUoKSx0aGlzLl9jb250YWluZXJ9LHNldFByZWZpeDpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLnByZWZpeD10LHRoaXMuX3VwZGF0ZSgpLHRoaXN9LGFkZEF0dHJpYnV0aW9uOmZ1bmN0aW9uKHQpe3JldHVybiB0Pyh0aGlzLl9hdHRyaWJ1dGlvbnNbdF18fCh0aGlzLl9hdHRyaWJ1dGlvbnNbdF09MCksdGhpcy5fYXR0cmlidXRpb25zW3RdKyssdGhpcy5fdXBkYXRlKCksdGhpcyk6dGhpc30scmVtb3ZlQXR0cmlidXRpb246ZnVuY3Rpb24odCl7cmV0dXJuIHQ/KHRoaXMuX2F0dHJpYnV0aW9uc1t0XSYmKHRoaXMuX2F0dHJpYnV0aW9uc1t0XS0tLHRoaXMuX3VwZGF0ZSgpKSx0aGlzKTp0aGlzfSxfdXBkYXRlOmZ1bmN0aW9uKCl7aWYodGhpcy5fbWFwKXt2YXIgdD1bXTtmb3IodmFyIGUgaW4gdGhpcy5fYXR0cmlidXRpb25zKXRoaXMuX2F0dHJpYnV0aW9uc1tlXSYmdC5wdXNoKGUpO3ZhciBpPVtdO3RoaXMub3B0aW9ucy5wcmVmaXgmJmkucHVzaCh0aGlzLm9wdGlvbnMucHJlZml4KSx0Lmxlbmd0aCYmaS5wdXNoKHQuam9pbihcIiwgXCIpKSx0aGlzLl9jb250YWluZXIuaW5uZXJIVE1MPWkuam9pbihcIiB8IFwiKX19fSksby5NYXAubWVyZ2VPcHRpb25zKHthdHRyaWJ1dGlvbkNvbnRyb2w6ITB9KSxvLk1hcC5hZGRJbml0SG9vayhmdW5jdGlvbigpe3RoaXMub3B0aW9ucy5hdHRyaWJ1dGlvbkNvbnRyb2wmJihuZXcgby5Db250cm9sLkF0dHJpYnV0aW9uKS5hZGRUbyh0aGlzKX0pLG8uY29udHJvbC5hdHRyaWJ1dGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG8uQ29udHJvbC5BdHRyaWJ1dGlvbih0KX0sby5Db250cm9sLlNjYWxlPW8uQ29udHJvbC5leHRlbmQoe29wdGlvbnM6e3Bvc2l0aW9uOlwiYm90dG9tbGVmdFwiLG1heFdpZHRoOjEwMCxtZXRyaWM6ITAsaW1wZXJpYWw6ITB9LG9uQWRkOmZ1bmN0aW9uKHQpe3ZhciBlPVwibGVhZmxldC1jb250cm9sLXNjYWxlXCIsaT1vLkRvbVV0aWwuY3JlYXRlKFwiZGl2XCIsZSksbj10aGlzLm9wdGlvbnM7cmV0dXJuIHRoaXMuX2FkZFNjYWxlcyhuLGUrXCItbGluZVwiLGkpLHQub24obi51cGRhdGVXaGVuSWRsZT9cIm1vdmVlbmRcIjpcIm1vdmVcIix0aGlzLl91cGRhdGUsdGhpcyksdC53aGVuUmVhZHkodGhpcy5fdXBkYXRlLHRoaXMpLGl9LG9uUmVtb3ZlOmZ1bmN0aW9uKHQpe3Qub2ZmKHRoaXMub3B0aW9ucy51cGRhdGVXaGVuSWRsZT9cIm1vdmVlbmRcIjpcIm1vdmVcIix0aGlzLl91cGRhdGUsdGhpcyl9LF9hZGRTY2FsZXM6ZnVuY3Rpb24odCxlLGkpe3QubWV0cmljJiYodGhpcy5fbVNjYWxlPW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixlLGkpKSx0LmltcGVyaWFsJiYodGhpcy5faVNjYWxlPW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixlLGkpKX0sX3VwZGF0ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX21hcCxlPXQuZ2V0U2l6ZSgpLnkvMixpPXQuZGlzdGFuY2UodC5jb250YWluZXJQb2ludFRvTGF0TG5nKFswLGVdKSx0LmNvbnRhaW5lclBvaW50VG9MYXRMbmcoW3RoaXMub3B0aW9ucy5tYXhXaWR0aCxlXSkpO3RoaXMuX3VwZGF0ZVNjYWxlcyhpKX0sX3VwZGF0ZVNjYWxlczpmdW5jdGlvbih0KXt0aGlzLm9wdGlvbnMubWV0cmljJiZ0JiZ0aGlzLl91cGRhdGVNZXRyaWModCksdGhpcy5vcHRpb25zLmltcGVyaWFsJiZ0JiZ0aGlzLl91cGRhdGVJbXBlcmlhbCh0KX0sX3VwZGF0ZU1ldHJpYzpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9nZXRSb3VuZE51bSh0KSxpPWU8MWUzP2UrXCIgbVwiOmUvMWUzK1wiIGttXCI7dGhpcy5fdXBkYXRlU2NhbGUodGhpcy5fbVNjYWxlLGksZS90KX0sX3VwZGF0ZUltcGVyaWFsOmZ1bmN0aW9uKHQpe3ZhciBlLGksbixvPTMuMjgwODM5OSp0O28+NTI4MD8oZT1vLzUyODAsaT10aGlzLl9nZXRSb3VuZE51bShlKSx0aGlzLl91cGRhdGVTY2FsZSh0aGlzLl9pU2NhbGUsaStcIiBtaVwiLGkvZSkpOihuPXRoaXMuX2dldFJvdW5kTnVtKG8pLHRoaXMuX3VwZGF0ZVNjYWxlKHRoaXMuX2lTY2FsZSxuK1wiIGZ0XCIsbi9vKSl9LF91cGRhdGVTY2FsZTpmdW5jdGlvbih0LGUsaSl7dC5zdHlsZS53aWR0aD1NYXRoLnJvdW5kKHRoaXMub3B0aW9ucy5tYXhXaWR0aCppKStcInB4XCIsdC5pbm5lckhUTUw9ZX0sX2dldFJvdW5kTnVtOmZ1bmN0aW9uKHQpe3ZhciBlPU1hdGgucG93KDEwLChNYXRoLmZsb29yKHQpK1wiXCIpLmxlbmd0aC0xKSxpPXQvZTtyZXR1cm4gaT1pPj0xMD8xMDppPj01PzU6aT49Mz8zOmk+PTI/MjoxLGUqaX19KSxvLmNvbnRyb2wuc2NhbGU9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBvLkNvbnRyb2wuU2NhbGUodCl9LG8uQ29udHJvbC5MYXllcnM9by5Db250cm9sLmV4dGVuZCh7b3B0aW9uczp7Y29sbGFwc2VkOiEwLHBvc2l0aW9uOlwidG9wcmlnaHRcIixhdXRvWkluZGV4OiEwLGhpZGVTaW5nbGVCYXNlOiExLHNvcnRMYXllcnM6ITEsc29ydEZ1bmN0aW9uOmZ1bmN0aW9uKHQsZSxpLG4pe3JldHVybiBpPG4/LTE6bjxpPzE6MH19LGluaXRpYWxpemU6ZnVuY3Rpb24odCxlLGkpe28uc2V0T3B0aW9ucyh0aGlzLGkpLHRoaXMuX2xheWVycz1bXSx0aGlzLl9sYXN0WkluZGV4PTAsdGhpcy5faGFuZGxpbmdDbGljaz0hMTtmb3IodmFyIG4gaW4gdCl0aGlzLl9hZGRMYXllcih0W25dLG4pO2ZvcihuIGluIGUpdGhpcy5fYWRkTGF5ZXIoZVtuXSxuLCEwKX0sb25BZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2luaXRMYXlvdXQoKSx0aGlzLl91cGRhdGUoKSx0aGlzLl9tYXA9dCx0Lm9uKFwiem9vbWVuZFwiLHRoaXMuX2NoZWNrRGlzYWJsZWRMYXllcnMsdGhpcyksdGhpcy5fY29udGFpbmVyfSxvblJlbW92ZTpmdW5jdGlvbigpe3RoaXMuX21hcC5vZmYoXCJ6b29tZW5kXCIsdGhpcy5fY2hlY2tEaXNhYmxlZExheWVycyx0aGlzKTtmb3IodmFyIHQ9MDt0PHRoaXMuX2xheWVycy5sZW5ndGg7dCsrKXRoaXMuX2xheWVyc1t0XS5sYXllci5vZmYoXCJhZGQgcmVtb3ZlXCIsdGhpcy5fb25MYXllckNoYW5nZSx0aGlzKX0sYWRkQmFzZUxheWVyOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuX2FkZExheWVyKHQsZSksdGhpcy5fbWFwP3RoaXMuX3VwZGF0ZSgpOnRoaXN9LGFkZE92ZXJsYXk6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5fYWRkTGF5ZXIodCxlLCEwKSx0aGlzLl9tYXA/dGhpcy5fdXBkYXRlKCk6dGhpc30scmVtb3ZlTGF5ZXI6ZnVuY3Rpb24odCl7dC5vZmYoXCJhZGQgcmVtb3ZlXCIsdGhpcy5fb25MYXllckNoYW5nZSx0aGlzKTt2YXIgZT10aGlzLl9nZXRMYXllcihvLnN0YW1wKHQpKTtyZXR1cm4gZSYmdGhpcy5fbGF5ZXJzLnNwbGljZSh0aGlzLl9sYXllcnMuaW5kZXhPZihlKSwxKSx0aGlzLl9tYXA/dGhpcy5fdXBkYXRlKCk6dGhpc30sZXhwYW5kOmZ1bmN0aW9uKCl7by5Eb21VdGlsLmFkZENsYXNzKHRoaXMuX2NvbnRhaW5lcixcImxlYWZsZXQtY29udHJvbC1sYXllcnMtZXhwYW5kZWRcIiksdGhpcy5fZm9ybS5zdHlsZS5oZWlnaHQ9bnVsbDt2YXIgdD10aGlzLl9tYXAuZ2V0U2l6ZSgpLnktKHRoaXMuX2NvbnRhaW5lci5vZmZzZXRUb3ArNTApO3JldHVybiB0PHRoaXMuX2Zvcm0uY2xpZW50SGVpZ2h0PyhvLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fZm9ybSxcImxlYWZsZXQtY29udHJvbC1sYXllcnMtc2Nyb2xsYmFyXCIpLHRoaXMuX2Zvcm0uc3R5bGUuaGVpZ2h0PXQrXCJweFwiKTpvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fZm9ybSxcImxlYWZsZXQtY29udHJvbC1sYXllcnMtc2Nyb2xsYmFyXCIpLHRoaXMuX2NoZWNrRGlzYWJsZWRMYXllcnMoKSx0aGlzfSxjb2xsYXBzZTpmdW5jdGlvbigpe3JldHVybiBvLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5fY29udGFpbmVyLFwibGVhZmxldC1jb250cm9sLWxheWVycy1leHBhbmRlZFwiKSx0aGlzfSxfaW5pdExheW91dDpmdW5jdGlvbigpe3ZhciB0PVwibGVhZmxldC1jb250cm9sLWxheWVyc1wiLGU9dGhpcy5fY29udGFpbmVyPW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIix0KSxpPXRoaXMub3B0aW9ucy5jb2xsYXBzZWQ7ZS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWhhc3BvcHVwXCIsITApLG8uRG9tRXZlbnQuZGlzYWJsZUNsaWNrUHJvcGFnYXRpb24oZSksby5Ccm93c2VyLnRvdWNofHxvLkRvbUV2ZW50LmRpc2FibGVTY3JvbGxQcm9wYWdhdGlvbihlKTt2YXIgbj10aGlzLl9mb3JtPW8uRG9tVXRpbC5jcmVhdGUoXCJmb3JtXCIsdCtcIi1saXN0XCIpO2kmJih0aGlzLl9tYXAub24oXCJjbGlja1wiLHRoaXMuY29sbGFwc2UsdGhpcyksby5Ccm93c2VyLmFuZHJvaWR8fG8uRG9tRXZlbnQub24oZSx7bW91c2VlbnRlcjp0aGlzLmV4cGFuZCxtb3VzZWxlYXZlOnRoaXMuY29sbGFwc2V9LHRoaXMpKTt2YXIgcz10aGlzLl9sYXllcnNMaW5rPW8uRG9tVXRpbC5jcmVhdGUoXCJhXCIsdCtcIi10b2dnbGVcIixlKTtzLmhyZWY9XCIjXCIscy50aXRsZT1cIkxheWVyc1wiLG8uQnJvd3Nlci50b3VjaD9vLkRvbUV2ZW50Lm9uKHMsXCJjbGlja1wiLG8uRG9tRXZlbnQuc3RvcCkub24ocyxcImNsaWNrXCIsdGhpcy5leHBhbmQsdGhpcyk6by5Eb21FdmVudC5vbihzLFwiZm9jdXNcIix0aGlzLmV4cGFuZCx0aGlzKSxvLkRvbUV2ZW50Lm9uKG4sXCJjbGlja1wiLGZ1bmN0aW9uKCl7c2V0VGltZW91dChvLmJpbmQodGhpcy5fb25JbnB1dENsaWNrLHRoaXMpLDApfSx0aGlzKSxpfHx0aGlzLmV4cGFuZCgpLHRoaXMuX2Jhc2VMYXllcnNMaXN0PW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIix0K1wiLWJhc2VcIixuKSx0aGlzLl9zZXBhcmF0b3I9by5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLHQrXCItc2VwYXJhdG9yXCIsbiksdGhpcy5fb3ZlcmxheXNMaXN0PW8uRG9tVXRpbC5jcmVhdGUoXCJkaXZcIix0K1wiLW92ZXJsYXlzXCIsbiksZS5hcHBlbmRDaGlsZChuKX0sX2dldExheWVyOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT0wO2U8dGhpcy5fbGF5ZXJzLmxlbmd0aDtlKyspaWYodGhpcy5fbGF5ZXJzW2VdJiZvLnN0YW1wKHRoaXMuX2xheWVyc1tlXS5sYXllcik9PT10KXJldHVybiB0aGlzLl9sYXllcnNbZV19LF9hZGRMYXllcjpmdW5jdGlvbih0LGUsaSl7dC5vbihcImFkZCByZW1vdmVcIix0aGlzLl9vbkxheWVyQ2hhbmdlLHRoaXMpLHRoaXMuX2xheWVycy5wdXNoKHtsYXllcjp0LG5hbWU6ZSxvdmVybGF5Oml9KSx0aGlzLm9wdGlvbnMuc29ydExheWVycyYmdGhpcy5fbGF5ZXJzLnNvcnQoby5iaW5kKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMub3B0aW9ucy5zb3J0RnVuY3Rpb24odC5sYXllcixlLmxheWVyLHQubmFtZSxlLm5hbWUpfSx0aGlzKSksdGhpcy5vcHRpb25zLmF1dG9aSW5kZXgmJnQuc2V0WkluZGV4JiYodGhpcy5fbGFzdFpJbmRleCsrLHQuc2V0WkluZGV4KHRoaXMuX2xhc3RaSW5kZXgpKX0sX3VwZGF0ZTpmdW5jdGlvbigpe2lmKCF0aGlzLl9jb250YWluZXIpcmV0dXJuIHRoaXM7by5Eb21VdGlsLmVtcHR5KHRoaXMuX2Jhc2VMYXllcnNMaXN0KSxvLkRvbVV0aWwuZW1wdHkodGhpcy5fb3ZlcmxheXNMaXN0KTt2YXIgdCxlLGksbixzPTA7Zm9yKGk9MDtpPHRoaXMuX2xheWVycy5sZW5ndGg7aSsrKW49dGhpcy5fbGF5ZXJzW2ldLHRoaXMuX2FkZEl0ZW0obiksZT1lfHxuLm92ZXJsYXksdD10fHwhbi5vdmVybGF5LHMrPW4ub3ZlcmxheT8wOjE7cmV0dXJuIHRoaXMub3B0aW9ucy5oaWRlU2luZ2xlQmFzZSYmKHQ9dCYmcz4xLHRoaXMuX2Jhc2VMYXllcnNMaXN0LnN0eWxlLmRpc3BsYXk9dD9cIlwiOlwibm9uZVwiKSx0aGlzLl9zZXBhcmF0b3Iuc3R5bGUuZGlzcGxheT1lJiZ0P1wiXCI6XCJub25lXCIsdGhpc30sX29uTGF5ZXJDaGFuZ2U6ZnVuY3Rpb24odCl7dGhpcy5faGFuZGxpbmdDbGlja3x8dGhpcy5fdXBkYXRlKCk7dmFyIGU9dGhpcy5fZ2V0TGF5ZXIoby5zdGFtcCh0LnRhcmdldCkpLGk9ZS5vdmVybGF5P1wiYWRkXCI9PT10LnR5cGU/XCJvdmVybGF5YWRkXCI6XCJvdmVybGF5cmVtb3ZlXCI6XCJhZGRcIj09PXQudHlwZT9cImJhc2VsYXllcmNoYW5nZVwiOm51bGw7aSYmdGhpcy5fbWFwLmZpcmUoaSxlKX0sX2NyZWF0ZVJhZGlvRWxlbWVudDpmdW5jdGlvbih0LGkpe3ZhciBuPSc8aW5wdXQgdHlwZT1cInJhZGlvXCIgY2xhc3M9XCJsZWFmbGV0LWNvbnRyb2wtbGF5ZXJzLXNlbGVjdG9yXCIgbmFtZT1cIicrdCsnXCInKyhpPycgY2hlY2tlZD1cImNoZWNrZWRcIic6XCJcIikrXCIvPlwiLG89ZS5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO3JldHVybiBvLmlubmVySFRNTD1uLG8uZmlyc3RDaGlsZH0sX2FkZEl0ZW06ZnVuY3Rpb24odCl7dmFyIGksbj1lLmNyZWF0ZUVsZW1lbnQoXCJsYWJlbFwiKSxzPXRoaXMuX21hcC5oYXNMYXllcih0LmxheWVyKTt0Lm92ZXJsYXk/KGk9ZS5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiksaS50eXBlPVwiY2hlY2tib3hcIixpLmNsYXNzTmFtZT1cImxlYWZsZXQtY29udHJvbC1sYXllcnMtc2VsZWN0b3JcIixpLmRlZmF1bHRDaGVja2VkPXMpOmk9dGhpcy5fY3JlYXRlUmFkaW9FbGVtZW50KFwibGVhZmxldC1iYXNlLWxheWVyc1wiLHMpLGkubGF5ZXJJZD1vLnN0YW1wKHQubGF5ZXIpLG8uRG9tRXZlbnQub24oaSxcImNsaWNrXCIsdGhpcy5fb25JbnB1dENsaWNrLHRoaXMpO3ZhciByPWUuY3JlYXRlRWxlbWVudChcInNwYW5cIik7ci5pbm5lckhUTUw9XCIgXCIrdC5uYW1lO3ZhciBhPWUuY3JlYXRlRWxlbWVudChcImRpdlwiKTtuLmFwcGVuZENoaWxkKGEpLGEuYXBwZW5kQ2hpbGQoaSksYS5hcHBlbmRDaGlsZChyKTt2YXIgaD10Lm92ZXJsYXk/dGhpcy5fb3ZlcmxheXNMaXN0OnRoaXMuX2Jhc2VMYXllcnNMaXN0O3JldHVybiBoLmFwcGVuZENoaWxkKG4pLHRoaXMuX2NoZWNrRGlzYWJsZWRMYXllcnMoKSxufSxfb25JbnB1dENsaWNrOmZ1bmN0aW9uKCl7dmFyIHQsZSxpLG49dGhpcy5fZm9ybS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImlucHV0XCIpLG89W10scz1bXTt0aGlzLl9oYW5kbGluZ0NsaWNrPSEwO2Zvcih2YXIgcj1uLmxlbmd0aC0xO3I+PTA7ci0tKXQ9bltyXSxlPXRoaXMuX2dldExheWVyKHQubGF5ZXJJZCkubGF5ZXIsaT10aGlzLl9tYXAuaGFzTGF5ZXIoZSksdC5jaGVja2VkJiYhaT9vLnB1c2goZSk6IXQuY2hlY2tlZCYmaSYmcy5wdXNoKGUpO2ZvcihyPTA7cjxzLmxlbmd0aDtyKyspdGhpcy5fbWFwLnJlbW92ZUxheWVyKHNbcl0pO2ZvcihyPTA7cjxvLmxlbmd0aDtyKyspdGhpcy5fbWFwLmFkZExheWVyKG9bcl0pO3RoaXMuX2hhbmRsaW5nQ2xpY2s9ITEsdGhpcy5fcmVmb2N1c09uTWFwKCl9LF9jaGVja0Rpc2FibGVkTGF5ZXJzOmZ1bmN0aW9uKCl7Zm9yKHZhciB0LGUsbj10aGlzLl9mb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIiksbz10aGlzLl9tYXAuZ2V0Wm9vbSgpLHM9bi5sZW5ndGgtMTtzPj0wO3MtLSl0PW5bc10sZT10aGlzLl9nZXRMYXllcih0LmxheWVySWQpLmxheWVyLHQuZGlzYWJsZWQ9ZS5vcHRpb25zLm1pblpvb20hPT1pJiZvPGUub3B0aW9ucy5taW5ab29tfHxlLm9wdGlvbnMubWF4Wm9vbSE9PWkmJm8+ZS5vcHRpb25zLm1heFpvb219LF9leHBhbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5leHBhbmQoKX0sX2NvbGxhcHNlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29sbGFwc2UoKX19KSxvLmNvbnRyb2wubGF5ZXJzPWZ1bmN0aW9uKHQsZSxpKXtyZXR1cm4gbmV3IG8uQ29udHJvbC5MYXllcnModCxlLGkpfX0od2luZG93LGRvY3VtZW50KTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgLy8gc2F2ZSB0aGVzZSBvcmlnaW5hbCBtZXRob2RzIGJlZm9yZSB0aGV5IGFyZSBvdmVyd3JpdHRlblxuICAgIHZhciBwcm90b19pbml0SWNvbiA9IEwuTWFya2VyLnByb3RvdHlwZS5faW5pdEljb247XG4gICAgdmFyIHByb3RvX3NldFBvcyA9IEwuTWFya2VyLnByb3RvdHlwZS5fc2V0UG9zO1xuICAgIHZhciBwcm90b19vbkRyYWcgPSBMLkhhbmRsZXIuTWFya2VyRHJhZy5wcm90b3R5cGUuX29uRHJhZztcblxuICAgIHZhciBvbGRJRSA9IChMLkRvbVV0aWwuVFJBTlNGT1JNID09PSAnbXNUcmFuc2Zvcm0nKTtcblxuICAgIEwuTWFya2VyLmFkZEluaXRIb29rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGljb25PcHRpb25zID0gdGhpcy5vcHRpb25zLmljb24gJiYgdGhpcy5vcHRpb25zLmljb24ub3B0aW9ucztcbiAgICAgICAgdmFyIGljb25BbmNob3IgPSBpY29uT3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMuaWNvbi5vcHRpb25zLmljb25BbmNob3I7XG4gICAgICAgIGlmIChpY29uQW5jaG9yKSB7XG4gICAgICAgICAgICBpY29uQW5jaG9yID0gKGljb25BbmNob3JbMF0gKyAncHggJyArIGljb25BbmNob3JbMV0gKyAncHgnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9wdGlvbnMucm90YXRpb25PcmlnaW4gPSB0aGlzLm9wdGlvbnMucm90YXRpb25PcmlnaW4gfHwgaWNvbkFuY2hvciB8fCAnY2VudGVyIGJvdHRvbScgO1xuICAgICAgICB0aGlzLm9wdGlvbnMucm90YXRpb25BbmdsZSA9IHRoaXMub3B0aW9ucy5yb3RhdGlvbkFuZ2xlIHx8IDA7XG4gICAgfSk7XG5cbiAgICBMLk1hcmtlci5pbmNsdWRlKHtcbiAgICAgICAgX2luaXRJY29uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHByb3RvX2luaXRJY29uLmNhbGwodGhpcyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX3NldFBvczogZnVuY3Rpb24gKHBvcykge1xuICAgICAgICAgICAgcHJvdG9fc2V0UG9zLmNhbGwodGhpcywgcG9zKTtcbiAgICAgICAgICAgIHRoaXMuX2FwcGx5Um90YXRpb24oKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfYXBwbHlSb3RhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnJvdGF0aW9uQW5nbGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pY29uLnN0eWxlW0wuRG9tVXRpbC5UUkFOU0ZPUk0rJ09yaWdpbiddID0gdGhpcy5vcHRpb25zLnJvdGF0aW9uT3JpZ2luO1xuXG4gICAgICAgICAgICAgICAgaWYob2xkSUUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIElFIDksIHVzZSB0aGUgMkQgcm90YXRpb25cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faWNvbi5zdHlsZVtMLkRvbVV0aWwuVFJBTlNGT1JNXSA9ICdyb3RhdGUoJyArIHRoaXMub3B0aW9ucy5yb3RhdGlvbkFuZ2xlICsgJ2RlZyknO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZvciBtb2Rlcm4gYnJvd3NlcnMsIHByZWZlciB0aGUgM0QgYWNjZWxlcmF0ZWQgdmVyc2lvblxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pY29uLnN0eWxlW0wuRG9tVXRpbC5UUkFOU0ZPUk1dICs9ICcgcm90YXRlWignICsgdGhpcy5vcHRpb25zLnJvdGF0aW9uQW5nbGUgKyAnZGVnKSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldFJvdGF0aW9uQW5nbGU6IGZ1bmN0aW9uKGFuZ2xlKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucm90YXRpb25BbmdsZSA9IGFuZ2xlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFJvdGF0aW9uT3JpZ2luOiBmdW5jdGlvbihvcmlnaW4pIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yb3RhdGlvbk9yaWdpbiA9IG9yaWdpbjtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgTC5IYW5kbGVyLk1hcmtlckRyYWcuaW5jbHVkZSh7XG4gICAgICAgIF9vbkRyYWc6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBwcm90b19vbkRyYWcuY2FsbCh0aGlzLCBlKTtcbiAgICAgICAgICAgIHRoaXMuX21hcmtlci5fYXBwbHlSb3RhdGlvbigpO1xuICAgICAgICB9XG4gICAgfSlcbn0pKCk7XG4iLCIvKiEgTGVhZmxldC5Db29yZGluYXRlcyAwMy0wNy0yMDEzICovXG5MLkNvbnRyb2wuQ29vcmRpbmF0ZXM9TC5Db250cm9sLmV4dGVuZCh7b3B0aW9uczp7cG9zaXRpb246XCJib3R0b21yaWdodFwiLGRlY2ltYWxzOjQsZGVjaW1hbFNlcGVyYXRvcjpcIi5cIixsYWJlbFRlbXBsYXRlTGF0OlwiTGF0OiB7eX1cIixsYWJlbFRlbXBsYXRlTG5nOlwiTG5nOiB7eH1cIixsYWJlbEZvcm1hdHRlckxhdDp2b2lkIDAsbGFiZWxGb3JtYXR0ZXJMbmc6dm9pZCAwLGVuYWJsZVVzZXJJbnB1dDohMCx1c2VETVM6ITEsdXNlTGF0TG5nT3JkZXI6ITF9LG9uQWRkOmZ1bmN0aW9uKGEpe3RoaXMuX21hcD1hO3ZhciBiPVwibGVhZmxldC1jb250cm9sLWNvb3JkaW5hdGVzXCIsYz10aGlzLl9jb250YWluZXI9TC5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLGIpLGQ9dGhpcy5vcHRpb25zO3RoaXMuX2xhYmVsY29udGFpbmVyPUwuRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixcInVpRWxlbWVudCBsYWJlbFwiLGMpLHRoaXMuX2xhYmVsPUwuRG9tVXRpbC5jcmVhdGUoXCJzcGFuXCIsXCJsYWJlbEZpcnN0XCIsdGhpcy5fbGFiZWxjb250YWluZXIpLHRoaXMuX2lucHV0Y29udGFpbmVyPUwuRG9tVXRpbC5jcmVhdGUoXCJkaXZcIixcInVpRWxlbWVudCBpbnB1dCB1aUhpZGRlblwiLGMpO3ZhciBlLGY7cmV0dXJuIGQudXNlTGF0TG5nT3JkZXI/KGY9TC5Eb21VdGlsLmNyZWF0ZShcInNwYW5cIixcIlwiLHRoaXMuX2lucHV0Y29udGFpbmVyKSx0aGlzLl9pbnB1dFk9dGhpcy5fY3JlYXRlSW5wdXQoXCJpbnB1dFlcIix0aGlzLl9pbnB1dGNvbnRhaW5lciksZT1MLkRvbVV0aWwuY3JlYXRlKFwic3BhblwiLFwiXCIsdGhpcy5faW5wdXRjb250YWluZXIpLHRoaXMuX2lucHV0WD10aGlzLl9jcmVhdGVJbnB1dChcImlucHV0WFwiLHRoaXMuX2lucHV0Y29udGFpbmVyKSk6KGU9TC5Eb21VdGlsLmNyZWF0ZShcInNwYW5cIixcIlwiLHRoaXMuX2lucHV0Y29udGFpbmVyKSx0aGlzLl9pbnB1dFg9dGhpcy5fY3JlYXRlSW5wdXQoXCJpbnB1dFhcIix0aGlzLl9pbnB1dGNvbnRhaW5lciksZj1MLkRvbVV0aWwuY3JlYXRlKFwic3BhblwiLFwiXCIsdGhpcy5faW5wdXRjb250YWluZXIpLHRoaXMuX2lucHV0WT10aGlzLl9jcmVhdGVJbnB1dChcImlucHV0WVwiLHRoaXMuX2lucHV0Y29udGFpbmVyKSksZS5pbm5lckhUTUw9ZC5sYWJlbFRlbXBsYXRlTG5nLnJlcGxhY2UoXCJ7eH1cIixcIlwiKSxmLmlubmVySFRNTD1kLmxhYmVsVGVtcGxhdGVMYXQucmVwbGFjZShcInt5fVwiLFwiXCIpLEwuRG9tRXZlbnQub24odGhpcy5faW5wdXRYLFwia2V5dXBcIix0aGlzLl9oYW5kbGVLZXlwcmVzcyx0aGlzKSxMLkRvbUV2ZW50Lm9uKHRoaXMuX2lucHV0WSxcImtleXVwXCIsdGhpcy5faGFuZGxlS2V5cHJlc3MsdGhpcyksYS5vbihcIm1vdXNlbW92ZVwiLHRoaXMuX3VwZGF0ZSx0aGlzKSxhLm9uKFwiZHJhZ3N0YXJ0XCIsdGhpcy5jb2xsYXBzZSx0aGlzKSxhLndoZW5SZWFkeSh0aGlzLl91cGRhdGUsdGhpcyksdGhpcy5fc2hvd3NDb29yZGluYXRlcz0hMCxkLmVuYWJsZVVzZXJJbnB1dCYmTC5Eb21FdmVudC5hZGRMaXN0ZW5lcih0aGlzLl9jb250YWluZXIsXCJjbGlja1wiLHRoaXMuX3N3aXRjaFVJLHRoaXMpLGN9LF9jcmVhdGVJbnB1dDpmdW5jdGlvbihhLGIpe3ZhciBjPUwuRG9tVXRpbC5jcmVhdGUoXCJpbnB1dFwiLGEsYik7cmV0dXJuIGMudHlwZT1cInRleHRcIixMLkRvbUV2ZW50LmRpc2FibGVDbGlja1Byb3BhZ2F0aW9uKGMpLGN9LF9jbGVhck1hcmtlcjpmdW5jdGlvbigpe3RoaXMuX21hcC5yZW1vdmVMYXllcih0aGlzLl9tYXJrZXIpfSxfaGFuZGxlS2V5cHJlc3M6ZnVuY3Rpb24oYSl7c3dpdGNoKGEua2V5Q29kZSl7Y2FzZSAyNzp0aGlzLmNvbGxhcHNlKCk7YnJlYWs7Y2FzZSAxMzp0aGlzLl9oYW5kbGVTdWJtaXQoKSx0aGlzLmNvbGxhcHNlKCk7YnJlYWs7ZGVmYXVsdDp0aGlzLl9oYW5kbGVTdWJtaXQoKX19LF9oYW5kbGVTdWJtaXQ6ZnVuY3Rpb24oKXt2YXIgYT1MLk51bWJlckZvcm1hdHRlci5jcmVhdGVWYWxpZE51bWJlcih0aGlzLl9pbnB1dFgudmFsdWUsdGhpcy5vcHRpb25zLmRlY2ltYWxTZXBlcmF0b3IpLGI9TC5OdW1iZXJGb3JtYXR0ZXIuY3JlYXRlVmFsaWROdW1iZXIodGhpcy5faW5wdXRZLnZhbHVlLHRoaXMub3B0aW9ucy5kZWNpbWFsU2VwZXJhdG9yKTtpZih2b2lkIDAhPT1hJiZ2b2lkIDAhPT1iKXt2YXIgYz10aGlzLl9tYXJrZXI7Y3x8KGM9dGhpcy5fbWFya2VyPUwubWFya2VyKCksYy5vbihcImNsaWNrXCIsdGhpcy5fY2xlYXJNYXJrZXIsdGhpcykpLGMuc2V0TGF0TG5nKG5ldyBMLkxhdExuZyhiLGEpKSxjLmFkZFRvKHRoaXMuX21hcCl9fSxleHBhbmQ6ZnVuY3Rpb24oKXt0aGlzLl9zaG93c0Nvb3JkaW5hdGVzPSExLHRoaXMuX21hcC5vZmYoXCJtb3VzZW1vdmVcIix0aGlzLl91cGRhdGUsdGhpcyksTC5Eb21FdmVudC5hZGRMaXN0ZW5lcih0aGlzLl9jb250YWluZXIsXCJtb3VzZW1vdmVcIixMLkRvbUV2ZW50LnN0b3ApLEwuRG9tRXZlbnQucmVtb3ZlTGlzdGVuZXIodGhpcy5fY29udGFpbmVyLFwiY2xpY2tcIix0aGlzLl9zd2l0Y2hVSSx0aGlzKSxMLkRvbVV0aWwuYWRkQ2xhc3ModGhpcy5fbGFiZWxjb250YWluZXIsXCJ1aUhpZGRlblwiKSxMLkRvbVV0aWwucmVtb3ZlQ2xhc3ModGhpcy5faW5wdXRjb250YWluZXIsXCJ1aUhpZGRlblwiKX0sX2NyZWF0ZUNvb3JkaW5hdGVMYWJlbDpmdW5jdGlvbihhKXt2YXIgYixjLGQ9dGhpcy5vcHRpb25zO3JldHVybiBiPWQubGFiZWxGb3JtYXR0ZXJMbmc/ZC5sYWJlbEZvcm1hdHRlckxuZyhhLmxuZyk6TC5VdGlsLnRlbXBsYXRlKGQubGFiZWxUZW1wbGF0ZUxuZyx7eDp0aGlzLl9nZXROdW1iZXIoYS5sbmcsZCl9KSxjPWQubGFiZWxGb3JtYXR0ZXJMYXQ/ZC5sYWJlbEZvcm1hdHRlckxhdChhLmxhdCk6TC5VdGlsLnRlbXBsYXRlKGQubGFiZWxUZW1wbGF0ZUxhdCx7eTp0aGlzLl9nZXROdW1iZXIoYS5sYXQsZCl9KSxkLnVzZUxhdExuZ09yZGVyP2MrXCIgXCIrYjpiK1wiIFwiK2N9LF9nZXROdW1iZXI6ZnVuY3Rpb24oYSxiKXt2YXIgYztyZXR1cm4gYz1iLnVzZURNUz9MLk51bWJlckZvcm1hdHRlci50b0RNUyhhKTpMLk51bWJlckZvcm1hdHRlci5yb3VuZChhLGIuZGVjaW1hbHMsYi5kZWNpbWFsU2VwZXJhdG9yKX0sY29sbGFwc2U6ZnVuY3Rpb24oKXtpZighdGhpcy5fc2hvd3NDb29yZGluYXRlcyYmKHRoaXMuX21hcC5vbihcIm1vdXNlbW92ZVwiLHRoaXMuX3VwZGF0ZSx0aGlzKSx0aGlzLl9zaG93c0Nvb3JkaW5hdGVzPSEwLHRoaXMub3B0aW9ucyxMLkRvbUV2ZW50LmFkZExpc3RlbmVyKHRoaXMuX2NvbnRhaW5lcixcImNsaWNrXCIsdGhpcy5fc3dpdGNoVUksdGhpcyksTC5Eb21FdmVudC5yZW1vdmVMaXN0ZW5lcih0aGlzLl9jb250YWluZXIsXCJtb3VzZW1vdmVcIixMLkRvbUV2ZW50LnN0b3ApLEwuRG9tVXRpbC5hZGRDbGFzcyh0aGlzLl9pbnB1dGNvbnRhaW5lcixcInVpSGlkZGVuXCIpLEwuRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9sYWJlbGNvbnRhaW5lcixcInVpSGlkZGVuXCIpLHRoaXMuX21hcmtlcikpe3ZhciBhPUwubWFya2VyKCksYj10aGlzLl9tYXJrZXIuZ2V0TGF0TG5nKCk7YS5zZXRMYXRMbmcoYik7dmFyIGM9TC5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLFwiXCIpLGQ9TC5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLFwiXCIsYyk7ZC5pbm5lckhUTUw9dGhpcy5fY3JlYXRlQ29vcmRpbmF0ZUxhYmVsKGIpO3ZhciBlPUwuRG9tVXRpbC5jcmVhdGUoXCJhXCIsXCJcIixjKTtlLmlubmVySFRNTD1cIlJlbW92ZVwiLGUuaHJlZj1cIiNcIjt2YXIgZj1MLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbjtMLkRvbUV2ZW50Lm9uKGUsXCJjbGlja1wiLGYpLm9uKGUsXCJtb3VzZWRvd25cIixmKS5vbihlLFwiZGJsY2xpY2tcIixmKS5vbihlLFwiY2xpY2tcIixMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KS5vbihlLFwiY2xpY2tcIixmdW5jdGlvbigpe3RoaXMuX21hcC5yZW1vdmVMYXllcihhKX0sdGhpcyksYS5iaW5kUG9wdXAoYyksYS5hZGRUbyh0aGlzLl9tYXApLHRoaXMuX21hcC5yZW1vdmVMYXllcih0aGlzLl9tYXJrZXIpLHRoaXMuX21hcmtlcj1udWxsfX0sX3N3aXRjaFVJOmZ1bmN0aW9uKGEpe0wuRG9tRXZlbnQuc3RvcChhKSxMLkRvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbihhKSxMLkRvbUV2ZW50LnByZXZlbnREZWZhdWx0KGEpLHRoaXMuX3Nob3dzQ29vcmRpbmF0ZXM/dGhpcy5leHBhbmQoKTp0aGlzLmNvbGxhcHNlKCl9LG9uUmVtb3ZlOmZ1bmN0aW9uKGEpe2Eub2ZmKFwibW91c2Vtb3ZlXCIsdGhpcy5fdXBkYXRlLHRoaXMpfSxfdXBkYXRlOmZ1bmN0aW9uKGEpe3ZhciBiPWEubGF0bG5nLGM9dGhpcy5vcHRpb25zO2ImJihiPWIud3JhcCgpLHRoaXMuX2N1cnJlbnRQb3M9Yix0aGlzLl9pbnB1dFkudmFsdWU9TC5OdW1iZXJGb3JtYXR0ZXIucm91bmQoYi5sYXQsYy5kZWNpbWFscyxjLmRlY2ltYWxTZXBlcmF0b3IpLHRoaXMuX2lucHV0WC52YWx1ZT1MLk51bWJlckZvcm1hdHRlci5yb3VuZChiLmxuZyxjLmRlY2ltYWxzLGMuZGVjaW1hbFNlcGVyYXRvciksdGhpcy5fbGFiZWwuaW5uZXJIVE1MPXRoaXMuX2NyZWF0ZUNvb3JkaW5hdGVMYWJlbChiKSl9fSksTC5jb250cm9sLmNvb3JkaW5hdGVzPWZ1bmN0aW9uKGEpe3JldHVybiBuZXcgTC5Db250cm9sLkNvb3JkaW5hdGVzKGEpfSxMLk1hcC5tZXJnZU9wdGlvbnMoe2Nvb3JkaW5hdGVDb250cm9sOiExfSksTC5NYXAuYWRkSW5pdEhvb2soZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMuY29vcmRpbmF0ZUNvbnRyb2wmJih0aGlzLmNvb3JkaW5hdGVDb250cm9sPW5ldyBMLkNvbnRyb2wuQ29vcmRpbmF0ZXMsdGhpcy5hZGRDb250cm9sKHRoaXMuY29vcmRpbmF0ZUNvbnRyb2wpKX0pLEwuTnVtYmVyRm9ybWF0dGVyPXtyb3VuZDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9TC5VdGlsLmZvcm1hdE51bShhLGIpK1wiXCIsZT1kLnNwbGl0KFwiLlwiKTtpZihlWzFdKXtmb3IodmFyIGY9Yi1lWzFdLmxlbmd0aDtmPjA7Zi0tKWVbMV0rPVwiMFwiO2Q9ZS5qb2luKGN8fFwiLlwiKX1yZXR1cm4gZH0sdG9ETVM6ZnVuY3Rpb24oYSl7dmFyIGI9TWF0aC5mbG9vcihhKSxjPTYwKihhLWIpLGQ9TWF0aC5mbG9vcihjKSxlPTYwKihjLWQpLGY9TWF0aC5yb3VuZChlKTtyZXR1cm4gNjA9PWYmJihkKyssZj1cIjAwXCIpLDYwPT1kJiYoYisrLGQ9XCIwMFwiKSwxMD5mJiYoZj1cIjBcIitmKSwxMD5kJiYoZD1cIjBcIitkKSxcIlwiK2IrXCImZGVnOyBcIitkK1wiJyBcIitmK1wiJydcIn0sY3JlYXRlVmFsaWROdW1iZXI6ZnVuY3Rpb24oYSxiKXtpZihhJiZhLmxlbmd0aD4wKXt2YXIgYz1hLnNwbGl0KGJ8fFwiLlwiKTt0cnl7dmFyIGQ9TnVtYmVyKGMuam9pbihcIi5cIikpO3JldHVybiBpc05hTihkKT92b2lkIDA6ZH1jYXRjaChlKXtyZXR1cm4gdm9pZCAwfX1yZXR1cm4gdm9pZCAwfX07IiwiLypcblx0TGVhZmxldC5jb250ZXh0bWVudSwgYSBjb250ZXh0IG1lbnUgZm9yIExlYWZsZXQuXG5cdChjKSAyMDE1LCBBZGFtIFJhdGNsaWZmZSwgR2VvU21hcnQgTWFwcyBMaW1pdGVkXG5cblx0QHByZXNlcnZlXG4qL1xuKGZ1bmN0aW9uKHQpe3ZhciBlO2lmKHR5cGVvZiBkZWZpbmU9PT1cImZ1bmN0aW9uXCImJmRlZmluZS5hbWQpe2RlZmluZShbXCJsZWFmbGV0XCJdLHQpfWVsc2UgaWYodHlwZW9mIG1vZHVsZT09PVwib2JqZWN0XCImJnR5cGVvZiBtb2R1bGUuZXhwb3J0cz09PVwib2JqZWN0XCIpe2U9cmVxdWlyZShcImxlYWZsZXRcIik7bW9kdWxlLmV4cG9ydHM9dChlKX1lbHNle2lmKHR5cGVvZiB3aW5kb3cuTD09PVwidW5kZWZpbmVkXCIpe3Rocm93IG5ldyBFcnJvcihcIkxlYWZsZXQgbXVzdCBiZSBsb2FkZWQgZmlyc3RcIil9dCh3aW5kb3cuTCl9fSkoZnVuY3Rpb24odCl7dC5NYXAubWVyZ2VPcHRpb25zKHtjb250ZXh0bWVudUl0ZW1zOltdfSk7dC5NYXAuQ29udGV4dE1lbnU9dC5IYW5kbGVyLmV4dGVuZCh7X3RvdWNoc3RhcnQ6dC5Ccm93c2VyLm1zUG9pbnRlcj9cIk1TUG9pbnRlckRvd25cIjp0LkJyb3dzZXIucG9pbnRlcj9cInBvaW50ZXJkb3duXCI6XCJ0b3VjaHN0YXJ0XCIsc3RhdGljczp7QkFTRV9DTFM6XCJsZWFmbGV0LWNvbnRleHRtZW51XCJ9LGluaXRpYWxpemU6ZnVuY3Rpb24oZSl7dC5IYW5kbGVyLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcyxlKTt0aGlzLl9pdGVtcz1bXTt0aGlzLl92aXNpYmxlPWZhbHNlO3ZhciBuPXRoaXMuX2NvbnRhaW5lcj10LkRvbVV0aWwuY3JlYXRlKFwiZGl2XCIsdC5NYXAuQ29udGV4dE1lbnUuQkFTRV9DTFMsZS5fY29udGFpbmVyKTtuLnN0eWxlLnpJbmRleD0xZTQ7bi5zdHlsZS5wb3NpdGlvbj1cImFic29sdXRlXCI7aWYoZS5vcHRpb25zLmNvbnRleHRtZW51V2lkdGgpe24uc3R5bGUud2lkdGg9ZS5vcHRpb25zLmNvbnRleHRtZW51V2lkdGgrXCJweFwifXRoaXMuX2NyZWF0ZUl0ZW1zKCk7dC5Eb21FdmVudC5vbihuLFwiY2xpY2tcIix0LkRvbUV2ZW50LnN0b3ApLm9uKG4sXCJtb3VzZWRvd25cIix0LkRvbUV2ZW50LnN0b3ApLm9uKG4sXCJkYmxjbGlja1wiLHQuRG9tRXZlbnQuc3RvcCkub24obixcImNvbnRleHRtZW51XCIsdC5Eb21FdmVudC5zdG9wKX0sYWRkSG9va3M6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9tYXAuZ2V0Q29udGFpbmVyKCk7dC5Eb21FdmVudC5vbihlLFwibW91c2VsZWF2ZVwiLHRoaXMuX2hpZGUsdGhpcykub24oZG9jdW1lbnQsXCJrZXlkb3duXCIsdGhpcy5fb25LZXlEb3duLHRoaXMpO2lmKHQuQnJvd3Nlci50b3VjaCl7dC5Eb21FdmVudC5vbihkb2N1bWVudCx0aGlzLl90b3VjaHN0YXJ0LHRoaXMuX2hpZGUsdGhpcyl9dGhpcy5fbWFwLm9uKHtjb250ZXh0bWVudTp0aGlzLl9zaG93LG1vdXNlZG93bjp0aGlzLl9oaWRlLG1vdmVzdGFydDp0aGlzLl9oaWRlLHpvb21zdGFydDp0aGlzLl9oaWRlfSx0aGlzKX0scmVtb3ZlSG9va3M6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9tYXAuZ2V0Q29udGFpbmVyKCk7dC5Eb21FdmVudC5vZmYoZSxcIm1vdXNlbGVhdmVcIix0aGlzLl9oaWRlLHRoaXMpLm9mZihkb2N1bWVudCxcImtleWRvd25cIix0aGlzLl9vbktleURvd24sdGhpcyk7aWYodC5Ccm93c2VyLnRvdWNoKXt0LkRvbUV2ZW50Lm9mZihkb2N1bWVudCx0aGlzLl90b3VjaHN0YXJ0LHRoaXMuX2hpZGUsdGhpcyl9dGhpcy5fbWFwLm9mZih7Y29udGV4dG1lbnU6dGhpcy5fc2hvdyxtb3VzZWRvd246dGhpcy5faGlkZSxtb3Zlc3RhcnQ6dGhpcy5faGlkZSx6b29tc3RhcnQ6dGhpcy5faGlkZX0sdGhpcyl9LHNob3dBdDpmdW5jdGlvbihlLG4pe2lmKGUgaW5zdGFuY2VvZiB0LkxhdExuZyl7ZT10aGlzLl9tYXAubGF0TG5nVG9Db250YWluZXJQb2ludChlKX10aGlzLl9zaG93QXRQb2ludChlLG4pfSxoaWRlOmZ1bmN0aW9uKCl7dGhpcy5faGlkZSgpfSxhZGRJdGVtOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmluc2VydEl0ZW0odCl9LGluc2VydEl0ZW06ZnVuY3Rpb24odCxlKXtlPWUhPT11bmRlZmluZWQ/ZTp0aGlzLl9pdGVtcy5sZW5ndGg7dmFyIG49dGhpcy5fY3JlYXRlSXRlbSh0aGlzLl9jb250YWluZXIsdCxlKTt0aGlzLl9pdGVtcy5wdXNoKG4pO3RoaXMuX3NpemVDaGFuZ2VkPXRydWU7dGhpcy5fbWFwLmZpcmUoXCJjb250ZXh0bWVudS5hZGRpdGVtXCIse2NvbnRleHRtZW51OnRoaXMsZWw6bi5lbCxpbmRleDplfSk7cmV0dXJuIG4uZWx9LHJlbW92ZUl0ZW06ZnVuY3Rpb24oZSl7dmFyIG49dGhpcy5fY29udGFpbmVyO2lmKCFpc05hTihlKSl7ZT1uLmNoaWxkcmVuW2VdfWlmKGUpe3RoaXMuX3JlbW92ZUl0ZW0odC5VdGlsLnN0YW1wKGUpKTt0aGlzLl9zaXplQ2hhbmdlZD10cnVlO3RoaXMuX21hcC5maXJlKFwiY29udGV4dG1lbnUucmVtb3ZlaXRlbVwiLHtjb250ZXh0bWVudTp0aGlzLGVsOmV9KTtyZXR1cm4gZX1yZXR1cm4gbnVsbH0scmVtb3ZlQWxsSXRlbXM6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9jb250YWluZXIuY2hpbGRyZW4sbjt3aGlsZShlLmxlbmd0aCl7bj1lWzBdO3RoaXMuX3JlbW92ZUl0ZW0odC5VdGlsLnN0YW1wKG4pKX1yZXR1cm4gZX0saGlkZUFsbEl0ZW1zOmZ1bmN0aW9uKCl7dmFyIHQsZSxuO2ZvcihlPTAsbj10aGlzLl9pdGVtcy5sZW5ndGg7ZTxuO2UrKyl7dD10aGlzLl9pdGVtc1tlXTt0LmVsLnN0eWxlLmRpc3BsYXk9XCJub25lXCJ9fSxzaG93QWxsSXRlbXM6ZnVuY3Rpb24oKXt2YXIgdCxlLG47Zm9yKGU9MCxuPXRoaXMuX2l0ZW1zLmxlbmd0aDtlPG47ZSsrKXt0PXRoaXMuX2l0ZW1zW2VdO3QuZWwuc3R5bGUuZGlzcGxheT1cIlwifX0sc2V0RGlzYWJsZWQ6ZnVuY3Rpb24oZSxuKXt2YXIgaT10aGlzLl9jb250YWluZXIsbz10Lk1hcC5Db250ZXh0TWVudS5CQVNFX0NMUytcIi1pdGVtXCI7aWYoIWlzTmFOKGUpKXtlPWkuY2hpbGRyZW5bZV19aWYoZSYmdC5Eb21VdGlsLmhhc0NsYXNzKGUsbykpe2lmKG4pe3QuRG9tVXRpbC5hZGRDbGFzcyhlLG8rXCItZGlzYWJsZWRcIik7dGhpcy5fbWFwLmZpcmUoXCJjb250ZXh0bWVudS5kaXNhYmxlaXRlbVwiLHtjb250ZXh0bWVudTp0aGlzLGVsOmV9KX1lbHNle3QuRG9tVXRpbC5yZW1vdmVDbGFzcyhlLG8rXCItZGlzYWJsZWRcIik7dGhpcy5fbWFwLmZpcmUoXCJjb250ZXh0bWVudS5lbmFibGVpdGVtXCIse2NvbnRleHRtZW51OnRoaXMsZWw6ZX0pfX19LGlzVmlzaWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl92aXNpYmxlfSxfY3JlYXRlSXRlbXM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9tYXAub3B0aW9ucy5jb250ZXh0bWVudUl0ZW1zLGUsbixpO2ZvcihuPTAsaT10Lmxlbmd0aDtuPGk7bisrKXt0aGlzLl9pdGVtcy5wdXNoKHRoaXMuX2NyZWF0ZUl0ZW0odGhpcy5fY29udGFpbmVyLHRbbl0pKX19LF9jcmVhdGVJdGVtOmZ1bmN0aW9uKGUsbixpKXtpZihuLnNlcGFyYXRvcnx8bj09PVwiLVwiKXtyZXR1cm4gdGhpcy5fY3JlYXRlU2VwYXJhdG9yKGUsaSl9dmFyIG89dC5NYXAuQ29udGV4dE1lbnUuQkFTRV9DTFMrXCItaXRlbVwiLHM9bi5kaXNhYmxlZD9vK1wiIFwiK28rXCItZGlzYWJsZWRcIjpvLGg9dGhpcy5faW5zZXJ0RWxlbWVudEF0KFwiYVwiLHMsZSxpKSxyPXRoaXMuX2NyZWF0ZUV2ZW50SGFuZGxlcihoLG4uY2FsbGJhY2ssbi5jb250ZXh0LG4uaGlkZU9uU2VsZWN0KSxhPXRoaXMuX2dldEljb24obiksbT10aGlzLl9nZXRJY29uQ2xzKG4pLHU9XCJcIjtpZihhKXt1PSc8aW1nIGNsYXNzPVwiJyt0Lk1hcC5Db250ZXh0TWVudS5CQVNFX0NMUysnLWljb25cIiBzcmM9XCInK2ErJ1wiLz4nfWVsc2UgaWYobSl7dT0nPHNwYW4gY2xhc3M9XCInK3QuTWFwLkNvbnRleHRNZW51LkJBU0VfQ0xTK1wiLWljb24gXCIrbSsnXCI+PC9zcGFuPid9aC5pbm5lckhUTUw9dStuLnRleHQ7aC5ocmVmPVwiI1wiO3QuRG9tRXZlbnQub24oaCxcIm1vdXNlb3ZlclwiLHRoaXMuX29uSXRlbU1vdXNlT3Zlcix0aGlzKS5vbihoLFwibW91c2VvdXRcIix0aGlzLl9vbkl0ZW1Nb3VzZU91dCx0aGlzKS5vbihoLFwibW91c2Vkb3duXCIsdC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pLm9uKGgsXCJjbGlja1wiLHIpO2lmKHQuQnJvd3Nlci50b3VjaCl7dC5Eb21FdmVudC5vbihoLHRoaXMuX3RvdWNoc3RhcnQsdC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pfWlmKCF0LkJyb3dzZXIucG9pbnRlcil7dC5Eb21FdmVudC5vbihoLFwiY2xpY2tcIix0aGlzLl9vbkl0ZW1Nb3VzZU91dCx0aGlzKX1yZXR1cm57aWQ6dC5VdGlsLnN0YW1wKGgpLGVsOmgsY2FsbGJhY2s6cn19LF9yZW1vdmVJdGVtOmZ1bmN0aW9uKGUpe3ZhciBuLGksbyxzLGg7Zm9yKG89MCxzPXRoaXMuX2l0ZW1zLmxlbmd0aDtvPHM7bysrKXtuPXRoaXMuX2l0ZW1zW29dO2lmKG4uaWQ9PT1lKXtpPW4uZWw7aD1uLmNhbGxiYWNrO2lmKGgpe3QuRG9tRXZlbnQub2ZmKGksXCJtb3VzZW92ZXJcIix0aGlzLl9vbkl0ZW1Nb3VzZU92ZXIsdGhpcykub2ZmKGksXCJtb3VzZW92ZXJcIix0aGlzLl9vbkl0ZW1Nb3VzZU91dCx0aGlzKS5vZmYoaSxcIm1vdXNlZG93blwiLHQuRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKS5vZmYoaSxcImNsaWNrXCIsaCk7aWYodC5Ccm93c2VyLnRvdWNoKXt0LkRvbUV2ZW50Lm9mZihpLHRoaXMuX3RvdWNoc3RhcnQsdC5Eb21FdmVudC5zdG9wUHJvcGFnYXRpb24pfWlmKCF0LkJyb3dzZXIucG9pbnRlcil7dC5Eb21FdmVudC5vbihpLFwiY2xpY2tcIix0aGlzLl9vbkl0ZW1Nb3VzZU91dCx0aGlzKX19dGhpcy5fY29udGFpbmVyLnJlbW92ZUNoaWxkKGkpO3RoaXMuX2l0ZW1zLnNwbGljZShvLDEpO3JldHVybiBufX1yZXR1cm4gbnVsbH0sX2NyZWF0ZVNlcGFyYXRvcjpmdW5jdGlvbihlLG4pe3ZhciBpPXRoaXMuX2luc2VydEVsZW1lbnRBdChcImRpdlwiLHQuTWFwLkNvbnRleHRNZW51LkJBU0VfQ0xTK1wiLXNlcGFyYXRvclwiLGUsbik7cmV0dXJue2lkOnQuVXRpbC5zdGFtcChpKSxlbDppfX0sX2NyZWF0ZUV2ZW50SGFuZGxlcjpmdW5jdGlvbihlLG4saSxvKXt2YXIgcz10aGlzLGg9dGhpcy5fbWFwLHI9dC5NYXAuQ29udGV4dE1lbnUuQkFTRV9DTFMrXCItaXRlbS1kaXNhYmxlZFwiLG89byE9PXVuZGVmaW5lZD9vOnRydWU7cmV0dXJuIGZ1bmN0aW9uKGEpe2lmKHQuRG9tVXRpbC5oYXNDbGFzcyhlLHIpKXtyZXR1cm59aWYobyl7cy5faGlkZSgpfWlmKG4pe24uY2FsbChpfHxoLHMuX3Nob3dMb2NhdGlvbil9cy5fbWFwLmZpcmUoXCJjb250ZXh0bWVudS5zZWxlY3RcIix7Y29udGV4dG1lbnU6cyxlbDplfSl9fSxfaW5zZXJ0RWxlbWVudEF0OmZ1bmN0aW9uKHQsZSxuLGkpe3ZhciBvLHM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0KTtzLmNsYXNzTmFtZT1lO2lmKGkhPT11bmRlZmluZWQpe289bi5jaGlsZHJlbltpXX1pZihvKXtuLmluc2VydEJlZm9yZShzLG8pfWVsc2V7bi5hcHBlbmRDaGlsZChzKX1yZXR1cm4gc30sX3Nob3c6ZnVuY3Rpb24odCl7dGhpcy5fc2hvd0F0UG9pbnQodC5jb250YWluZXJQb2ludCx0KX0sX3Nob3dBdFBvaW50OmZ1bmN0aW9uKGUsbil7aWYodGhpcy5faXRlbXMubGVuZ3RoKXt2YXIgaT10aGlzLl9tYXAsbz1pLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KGUpLHM9aS5sYXllclBvaW50VG9MYXRMbmcobyksaD10LmV4dGVuZChufHx7fSx7Y29udGV4dG1lbnU6dGhpc30pO3RoaXMuX3Nob3dMb2NhdGlvbj17bGF0bG5nOnMsbGF5ZXJQb2ludDpvLGNvbnRhaW5lclBvaW50OmV9O2lmKG4mJm4ucmVsYXRlZFRhcmdldCl7dGhpcy5fc2hvd0xvY2F0aW9uLnJlbGF0ZWRUYXJnZXQ9bi5yZWxhdGVkVGFyZ2V0fXRoaXMuX3NldFBvc2l0aW9uKGUpO2lmKCF0aGlzLl92aXNpYmxlKXt0aGlzLl9jb250YWluZXIuc3R5bGUuZGlzcGxheT1cImJsb2NrXCI7dGhpcy5fdmlzaWJsZT10cnVlfXRoaXMuX21hcC5maXJlKFwiY29udGV4dG1lbnUuc2hvd1wiLGgpfX0sX2hpZGU6ZnVuY3Rpb24oKXtpZih0aGlzLl92aXNpYmxlKXt0aGlzLl92aXNpYmxlPWZhbHNlO3RoaXMuX2NvbnRhaW5lci5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO3RoaXMuX21hcC5maXJlKFwiY29udGV4dG1lbnUuaGlkZVwiLHtjb250ZXh0bWVudTp0aGlzfSl9fSxfZ2V0SWNvbjpmdW5jdGlvbihlKXtyZXR1cm4gdC5Ccm93c2VyLnJldGluYSYmZS5yZXRpbmFJY29ufHxlLmljb259LF9nZXRJY29uQ2xzOmZ1bmN0aW9uKGUpe3JldHVybiB0LkJyb3dzZXIucmV0aW5hJiZlLnJldGluYUljb25DbHN8fGUuaWNvbkNsc30sX3NldFBvc2l0aW9uOmZ1bmN0aW9uKGUpe3ZhciBuPXRoaXMuX21hcC5nZXRTaXplKCksaT10aGlzLl9jb250YWluZXIsbz10aGlzLl9nZXRFbGVtZW50U2l6ZShpKSxzO2lmKHRoaXMuX21hcC5vcHRpb25zLmNvbnRleHRtZW51QW5jaG9yKXtzPXQucG9pbnQodGhpcy5fbWFwLm9wdGlvbnMuY29udGV4dG1lbnVBbmNob3IpO2U9ZS5hZGQocyl9aS5fbGVhZmxldF9wb3M9ZTtpZihlLngrby54Pm4ueCl7aS5zdHlsZS5sZWZ0PVwiYXV0b1wiO2kuc3R5bGUucmlnaHQ9TWF0aC5taW4oTWF0aC5tYXgobi54LWUueCwwKSxuLngtby54LTEpK1wicHhcIn1lbHNle2kuc3R5bGUubGVmdD1NYXRoLm1heChlLngsMCkrXCJweFwiO2kuc3R5bGUucmlnaHQ9XCJhdXRvXCJ9aWYoZS55K28ueT5uLnkpe2kuc3R5bGUudG9wPVwiYXV0b1wiO2kuc3R5bGUuYm90dG9tPU1hdGgubWluKE1hdGgubWF4KG4ueS1lLnksMCksbi55LW8ueS0xKStcInB4XCJ9ZWxzZXtpLnN0eWxlLnRvcD1NYXRoLm1heChlLnksMCkrXCJweFwiO2kuc3R5bGUuYm90dG9tPVwiYXV0b1wifX0sX2dldEVsZW1lbnRTaXplOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX3NpemUsbj10LnN0eWxlLmRpc3BsYXk7aWYoIWV8fHRoaXMuX3NpemVDaGFuZ2VkKXtlPXt9O3Quc3R5bGUubGVmdD1cIi05OTk5OTlweFwiO3Quc3R5bGUucmlnaHQ9XCJhdXRvXCI7dC5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIjtlLng9dC5vZmZzZXRXaWR0aDtlLnk9dC5vZmZzZXRIZWlnaHQ7dC5zdHlsZS5sZWZ0PVwiYXV0b1wiO3Quc3R5bGUuZGlzcGxheT1uO3RoaXMuX3NpemVDaGFuZ2VkPWZhbHNlfXJldHVybiBlfSxfb25LZXlEb3duOmZ1bmN0aW9uKHQpe3ZhciBlPXQua2V5Q29kZTtpZihlPT09Mjcpe3RoaXMuX2hpZGUoKX19LF9vbkl0ZW1Nb3VzZU92ZXI6ZnVuY3Rpb24oZSl7dC5Eb21VdGlsLmFkZENsYXNzKGUudGFyZ2V0fHxlLnNyY0VsZW1lbnQsXCJvdmVyXCIpfSxfb25JdGVtTW91c2VPdXQ6ZnVuY3Rpb24oZSl7dC5Eb21VdGlsLnJlbW92ZUNsYXNzKGUudGFyZ2V0fHxlLnNyY0VsZW1lbnQsXCJvdmVyXCIpfX0pO3QuTWFwLmFkZEluaXRIb29rKFwiYWRkSGFuZGxlclwiLFwiY29udGV4dG1lbnVcIix0Lk1hcC5Db250ZXh0TWVudSk7dC5NaXhpbi5Db250ZXh0TWVudT17YmluZENvbnRleHRNZW51OmZ1bmN0aW9uKGUpe3Quc2V0T3B0aW9ucyh0aGlzLGUpO3RoaXMuX2luaXRDb250ZXh0TWVudSgpO3JldHVybiB0aGlzfSx1bmJpbmRDb250ZXh0TWVudTpmdW5jdGlvbigpe3RoaXMub2ZmKFwiY29udGV4dG1lbnVcIix0aGlzLl9zaG93Q29udGV4dE1lbnUsdGhpcyk7cmV0dXJuIHRoaXN9LGFkZENvbnRleHRNZW51SXRlbTpmdW5jdGlvbih0KXt0aGlzLm9wdGlvbnMuY29udGV4dG1lbnVJdGVtcy5wdXNoKHQpfSxyZW1vdmVDb250ZXh0TWVudUl0ZW1XaXRoSW5kZXg6ZnVuY3Rpb24odCl7dmFyIGU9W107Zm9yKHZhciBuPTA7bjx0aGlzLm9wdGlvbnMuY29udGV4dG1lbnVJdGVtcy5sZW5ndGg7bisrKXtpZih0aGlzLm9wdGlvbnMuY29udGV4dG1lbnVJdGVtc1tuXS5pbmRleD09dCl7ZS5wdXNoKG4pfX12YXIgaT1lLnBvcCgpO3doaWxlKGkhPT11bmRlZmluZWQpe3RoaXMub3B0aW9ucy5jb250ZXh0bWVudUl0ZW1zLnNwbGljZShpLDEpO2k9ZS5wb3AoKX19LHJlcGxhY2VDb250ZXh0TWVudUl0ZW06ZnVuY3Rpb24odCl7dGhpcy5yZW1vdmVDb250ZXh0TWVudUl0ZW1XaXRoSW5kZXgodC5pbmRleCk7dGhpcy5hZGRDb250ZXh0TWVudUl0ZW0odCl9LF9pbml0Q29udGV4dE1lbnU6ZnVuY3Rpb24oKXt0aGlzLl9pdGVtcz1bXTt0aGlzLm9uKFwiY29udGV4dG1lbnVcIix0aGlzLl9zaG93Q29udGV4dE1lbnUsdGhpcyl9LF9zaG93Q29udGV4dE1lbnU6ZnVuY3Rpb24oZSl7dmFyIG4saSxvLHMsaDtpZih0aGlzLl9tYXAuY29udGV4dG1lbnUpe2k9dC5leHRlbmQoe3JlbGF0ZWRUYXJnZXQ6dGhpc30sZSk7bz10aGlzLl9tYXAubW91c2VFdmVudFRvQ29udGFpbmVyUG9pbnQoZS5vcmlnaW5hbEV2ZW50KTtpZighdGhpcy5vcHRpb25zLmNvbnRleHRtZW51SW5oZXJpdEl0ZW1zKXt0aGlzLl9tYXAuY29udGV4dG1lbnUuaGlkZUFsbEl0ZW1zKCl9Zm9yKHM9MCxoPXRoaXMub3B0aW9ucy5jb250ZXh0bWVudUl0ZW1zLmxlbmd0aDtzPGg7cysrKXtuPXRoaXMub3B0aW9ucy5jb250ZXh0bWVudUl0ZW1zW3NdO3RoaXMuX2l0ZW1zLnB1c2godGhpcy5fbWFwLmNvbnRleHRtZW51Lmluc2VydEl0ZW0obixuLmluZGV4KSl9dGhpcy5fbWFwLm9uY2UoXCJjb250ZXh0bWVudS5oaWRlXCIsdGhpcy5faGlkZUNvbnRleHRNZW51LHRoaXMpO3RoaXMuX21hcC5jb250ZXh0bWVudS5zaG93QXQobyxpKX19LF9oaWRlQ29udGV4dE1lbnU6ZnVuY3Rpb24oKXt2YXIgdCxlO2Zvcih0PTAsZT10aGlzLl9pdGVtcy5sZW5ndGg7dDxlO3QrKyl7dGhpcy5fbWFwLmNvbnRleHRtZW51LnJlbW92ZUl0ZW0odGhpcy5faXRlbXNbdF0pfXRoaXMuX2l0ZW1zLmxlbmd0aD0wO2lmKCF0aGlzLm9wdGlvbnMuY29udGV4dG1lbnVJbmhlcml0SXRlbXMpe3RoaXMuX21hcC5jb250ZXh0bWVudS5zaG93QWxsSXRlbXMoKX19fTt2YXIgZT1bdC5NYXJrZXIsdC5QYXRoXSxuPXtjb250ZXh0bWVudTpmYWxzZSxjb250ZXh0bWVudUl0ZW1zOltdLGNvbnRleHRtZW51SW5oZXJpdEl0ZW1zOnRydWV9LGksbyxzO2ZvcihvPTAscz1lLmxlbmd0aDtvPHM7bysrKXtpPWVbb107aWYoIWkucHJvdG90eXBlLm9wdGlvbnMpe2kucHJvdG90eXBlLm9wdGlvbnM9bn1lbHNle2kubWVyZ2VPcHRpb25zKG4pfWkuYWRkSW5pdEhvb2soZnVuY3Rpb24oKXtpZih0aGlzLm9wdGlvbnMuY29udGV4dG1lbnUpe3RoaXMuX2luaXRDb250ZXh0TWVudSgpfX0pO2kuaW5jbHVkZSh0Lk1peGluLkNvbnRleHRNZW51KX1yZXR1cm4gdC5NYXAuQ29udGV4dE1lbnV9KTsiLCIvKipcbiAqIFNlbWljaXJjbGUgZXh0ZW5zaW9uIGZvciBMLkNpcmNsZS5cbiAqIEphbiBQaWV0ZXIgV2FhZ21lZXN0ZXIgPGppZXRlckBqaWV0ZXIubmw+XG4gKlxuICogVGhpcyB2ZXJzaW9uIGlzIHRlc3RlZCB3aXRoIGxlYWZsZXQgMS4wLjJcbiAqL1xuKGZ1bmN0aW9uIChmYWN0b3J5KSB7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICAvLyBBTURcbiAgICAgICAgZGVmaW5lKFsnbGVhZmxldCddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiByZXF1aXJlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAvLyBOb2RlL0NvbW1vbkpTXG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCdsZWFmbGV0JykpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEJyb3dzZXIgZ2xvYmFsc1xuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5MID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhyb3cgJ0xlYWZsZXQgbXVzdCBiZSBsb2FkZWQgZmlyc3QnO1xuICAgICAgICB9XG4gICAgICAgIGZhY3Rvcnkod2luZG93LkwpO1xuICAgIH1cbn0pKGZ1bmN0aW9uIChMKSB7XG4gICAgdmFyIERFR19UT19SQUQgPSBNYXRoLlBJIC8gMTgwO1xuXG4gICAgLy8gbWFrZSBzdXJlIDAgZGVncmVlcyBpcyB1cCAoTm9ydGgpIGFuZCBjb252ZXJ0IHRvIHJhZGlhbnMuXG4gICAgZnVuY3Rpb24gZml4QW5nbGUgKGFuZ2xlKSB7XG4gICAgICAgIHJldHVybiAoYW5nbGUgLSA5MCkgKiBERUdfVE9fUkFEO1xuICAgIH1cblxuICAgIC8vIHJvdGF0ZSBwb2ludCBbeCArIHIsIHkrcl0gYXJvdW5kIFt4LCB5XSBieSBgYW5nbGVgIHJhZGlhbnMuXG4gICAgZnVuY3Rpb24gcm90YXRlZCAocCwgYW5nbGUsIHIpIHtcbiAgICAgICAgcmV0dXJuIHAuYWRkKFxuICAgICAgICAgICAgTC5wb2ludChNYXRoLmNvcyhhbmdsZSksIE1hdGguc2luKGFuZ2xlKSkubXVsdGlwbHlCeShyKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIEwuUG9pbnQucHJvdG90eXBlLnJvdGF0ZWQgPSBmdW5jdGlvbiAoYW5nbGUsIHIpIHtcbiAgICAgICAgcmV0dXJuIHJvdGF0ZWQodGhpcywgYW5nbGUsIHIpO1xuICAgIH07XG5cbiAgICB2YXIgc2VtaWNpcmNsZSA9IHtcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgc3RhcnRBbmdsZTogMCxcbiAgICAgICAgICAgIHN0b3BBbmdsZTogMzU5Ljk5OTlcbiAgICAgICAgfSxcblxuICAgICAgICBzdGFydEFuZ2xlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnN0YXJ0QW5nbGUgPCB0aGlzLm9wdGlvbnMuc3RvcEFuZ2xlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpeEFuZ2xlKHRoaXMub3B0aW9ucy5zdGFydEFuZ2xlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpeEFuZ2xlKHRoaXMub3B0aW9ucy5zdG9wQW5nbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzdG9wQW5nbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3RhcnRBbmdsZSA8IHRoaXMub3B0aW9ucy5zdG9wQW5nbGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZml4QW5nbGUodGhpcy5vcHRpb25zLnN0b3BBbmdsZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaXhBbmdsZSh0aGlzLm9wdGlvbnMuc3RhcnRBbmdsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0U3RhcnRBbmdsZTogZnVuY3Rpb24gKGFuZ2xlKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuc3RhcnRBbmdsZSA9IGFuZ2xlO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVkcmF3KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0U3RvcEFuZ2xlOiBmdW5jdGlvbiAoYW5nbGUpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zdG9wQW5nbGUgPSBhbmdsZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlZHJhdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldERpcmVjdGlvbjogZnVuY3Rpb24gKGRpcmVjdGlvbiwgZGVncmVlcykge1xuICAgICAgICAgICAgaWYgKGRlZ3JlZXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGRlZ3JlZXMgPSAxMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zdGFydEFuZ2xlID0gZGlyZWN0aW9uIC0gKGRlZ3JlZXMgLyAyKTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zdG9wQW5nbGUgPSBkaXJlY3Rpb24gKyAoZGVncmVlcyAvIDIpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZWRyYXcoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0RGlyZWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdG9wQW5nbGUoKSAtICh0aGlzLnN0b3BBbmdsZSgpIC0gdGhpcy5zdGFydEFuZ2xlKCkpIC8gMjtcbiAgICAgICAgfSxcblxuICAgICAgICBpc1NlbWljaXJjbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzdGFydEFuZ2xlID0gdGhpcy5vcHRpb25zLnN0YXJ0QW5nbGUsXG4gICAgICAgICAgICAgICAgc3RvcEFuZ2xlID0gdGhpcy5vcHRpb25zLnN0b3BBbmdsZTtcblxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAhKHN0YXJ0QW5nbGUgPT09IDAgJiYgc3RvcEFuZ2xlID4gMzU5KSAmJlxuICAgICAgICAgICAgICAgICEoc3RhcnRBbmdsZSA9PSBzdG9wQW5nbGUpXG4gICAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBfY29udGFpbnNQb2ludDogZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZSAoYW5nbGUpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoYW5nbGUgPD0gLU1hdGguUEkpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5nbGUgKz0gMi4wICogTWF0aC5QSTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd2hpbGUgKGFuZ2xlID4gTWF0aC5QSSkge1xuICAgICAgICAgICAgICAgICAgICBhbmdsZSAtPSAyLjAgKiBNYXRoLlBJO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYW5nbGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLmF0YW4yKHAueSAtIHRoaXMuX3BvaW50LnksIHAueCAtIHRoaXMuX3BvaW50LngpO1xuICAgICAgICAgICAgdmFyIG5TdGFydCA9IG5vcm1hbGl6ZSh0aGlzLnN0YXJ0QW5nbGUoKSk7XG4gICAgICAgICAgICB2YXIgblN0b3AgPSBub3JtYWxpemUodGhpcy5zdG9wQW5nbGUoKSk7XG4gICAgICAgICAgICBpZiAoblN0b3AgPD0gblN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgblN0b3AgKz0gMi4wICogTWF0aC5QSTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhbmdsZSA8PSBuU3RhcnQpIHtcbiAgICAgICAgICAgICAgICBhbmdsZSArPSAyLjAgKiBNYXRoLlBJO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICBuU3RhcnQgPCBhbmdsZSAmJiBhbmdsZSA8PSBuU3RvcCAmJlxuICAgICAgICAgICAgICAgIHAuZGlzdGFuY2VUbyh0aGlzLl9wb2ludCkgPD0gdGhpcy5fcmFkaXVzICsgdGhpcy5fY2xpY2tUb2xlcmFuY2UoKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBMLlNlbWlDaXJjbGUgPSBMLkNpcmNsZS5leHRlbmQoc2VtaWNpcmNsZSk7XG4gICAgTC5TZW1pQ2lyY2xlTWFya2VyID0gTC5DaXJjbGVNYXJrZXIuZXh0ZW5kKHNlbWljaXJjbGUpO1xuXG4gICAgTC5zZW1pQ2lyY2xlID0gZnVuY3Rpb24gKGxhdGxuZywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IEwuU2VtaUNpcmNsZShsYXRsbmcsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgTC5zZW1pQ2lyY2xlTWFya2VyID0gZnVuY3Rpb24gKGxhdGxuZywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IEwuU2VtaUNpcmNsZU1hcmtlcihsYXRsbmcsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICB2YXIgX3VwZGF0ZUNpcmNsZVNWRyA9IEwuU1ZHLnByb3RvdHlwZS5fdXBkYXRlQ2lyY2xlO1xuICAgIHZhciBfdXBkYXRlQ2lyY2xlQ2FudmFzID0gTC5DYW52YXMucHJvdG90eXBlLl91cGRhdGVDaXJjbGU7XG5cbiAgICBMLlNWRy5pbmNsdWRlKHtcbiAgICAgICAgX3VwZGF0ZUNpcmNsZTogZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgICAgICAvLyBJZiB3ZSB3YW50IGEgY2lyY2xlLCB3ZSB1c2UgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uXG4gICAgICAgICAgICBpZiAoIShsYXllciBpbnN0YW5jZW9mIEwuU2VtaUNpcmNsZSB8fCBsYXllciBpbnN0YW5jZW9mIEwuU2VtaUNpcmNsZU1hcmtlcikgfHxcbiAgICAgICAgICAgICAgICAhbGF5ZXIuaXNTZW1pY2lyY2xlKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3VwZGF0ZUNpcmNsZVNWRy5jYWxsKHRoaXMsIGxheWVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsYXllci5fZW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZXRQYXRoKGxheWVyLCAnTTAgMCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcCA9IGxheWVyLl9tYXAubGF0TG5nVG9MYXllclBvaW50KGxheWVyLl9sYXRsbmcpLFxuICAgICAgICAgICAgICAgIHIgPSBsYXllci5fcmFkaXVzLFxuICAgICAgICAgICAgICAgIHIyID0gTWF0aC5yb3VuZChsYXllci5fcmFkaXVzWSB8fCByKSxcbiAgICAgICAgICAgICAgICBzdGFydCA9IHAucm90YXRlZChsYXllci5zdGFydEFuZ2xlKCksIHIpLFxuICAgICAgICAgICAgICAgIGVuZCA9IHAucm90YXRlZChsYXllci5zdG9wQW5nbGUoKSwgcik7XG5cbiAgICAgICAgICAgIHZhciBsYXJnZUFyYyA9IChsYXllci5vcHRpb25zLnN0b3BBbmdsZSAtIGxheWVyLm9wdGlvbnMuc3RhcnRBbmdsZSA+PSAxODApID8gJzEnIDogJzAnO1xuXG4gICAgICAgICAgICB2YXIgZCA9ICdNJyArIHAueCArICcsJyArIHAueSArXG4gICAgICAgICAgICAgICAgLy8gbGluZSB0byBmaXJzdCBzdGFydCBwb2ludFxuICAgICAgICAgICAgICAgICdMJyArIHN0YXJ0LnggKyAnLCcgKyBzdGFydC55ICtcbiAgICAgICAgICAgICAgICAnQSAnICsgciArICcsJyArIHIyICsgJywwLCcgKyBsYXJnZUFyYyArICcsMSwnICsgZW5kLnggKyAnLCcgKyBlbmQueSArXG4gICAgICAgICAgICAgICAgJyB6JztcblxuICAgICAgICAgICAgdGhpcy5fc2V0UGF0aChsYXllciwgZCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIEwuQ2FudmFzLmluY2x1ZGUoe1xuICAgICAgICBfdXBkYXRlQ2lyY2xlOiBmdW5jdGlvbiAobGF5ZXIpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIHdhbnQgYSBjaXJjbGUsIHdlIHVzZSB0aGUgb3JpZ2luYWwgZnVuY3Rpb25cbiAgICAgICAgICAgIGlmICghKGxheWVyIGluc3RhbmNlb2YgTC5TZW1pQ2lyY2xlIHx8IGxheWVyIGluc3RhbmNlb2YgTC5TZW1pQ2lyY2xlTWFya2VyKSB8fFxuICAgICAgICAgICAgICAgICFsYXllci5pc1NlbWljaXJjbGUoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfdXBkYXRlQ2lyY2xlQ2FudmFzLmNhbGwodGhpcywgbGF5ZXIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcCA9IGxheWVyLl9wb2ludCxcbiAgICAgICAgICAgICAgICBjdHggPSB0aGlzLl9jdHgsXG4gICAgICAgICAgICAgICAgciA9IGxheWVyLl9yYWRpdXMsXG4gICAgICAgICAgICAgICAgcyA9IChsYXllci5fcmFkaXVzWSB8fCByKSAvIHIsXG4gICAgICAgICAgICAgICAgc3RhcnQgPSBwLnJvdGF0ZWQobGF5ZXIuc3RhcnRBbmdsZSgpLCByKTtcblxuICAgICAgICAgICAgdGhpcy5fZHJhd25MYXllcnNbbGF5ZXIuX2xlYWZsZXRfaWRdID0gbGF5ZXI7XG5cbiAgICAgICAgICAgIGlmIChzICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgICAgICBjdHguc2NhbGUoMSwgcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5tb3ZlVG8ocC54LCBwLnkpO1xuICAgICAgICAgICAgY3R4LmxpbmVUbyhzdGFydC54LCBzdGFydC55KTtcbiAgICAgICAgICAgIGN0eC5hcmMocC54LCBwLnksIHIsIGxheWVyLnN0YXJ0QW5nbGUoKSwgbGF5ZXIuc3RvcEFuZ2xlKCkpO1xuICAgICAgICAgICAgY3R4LmxpbmVUbyhwLngsIHAueSk7XG5cbiAgICAgICAgICAgIGlmIChzICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fZmlsbFN0cm9rZShjdHgsIGxheWVyKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG4iLCIkJC5tb2R1bGUucmVnaXN0ZXJNb2R1bGUoJ2JyYWluanMubWFwLmljb24uYWlzJywgZnVuY3Rpb24oKSB7XG5cblx0cmV0dXJuIGZ1bmN0aW9uKGRhdGEpIHtcblxuXHRcdHZhciBjb2xvciA9IGRhdGEuY29sb3IgfHwgJ2dyZWVuJ1xuXG5cdFx0dmFyIHRlbXBsYXRlID0gIGBcblx0XHRcdDxzdmcgd2lkdGg9XCI0MFwiIGhlaWdodD1cIjQwXCIgc3R5bGU9XCJib3JkZXI6IDFweCBzb2xpZCBiYWNrO1wiPlxuXHRcdFx0XHQ8ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoMjAsIDIwKVwiIHN0cm9rZT1cIiR7Y29sb3J9XCIgZmlsbD1cIiR7Y29sb3J9XCI+XG5cdFx0XHRcdFx0PGNpcmNsZSByPVwiM1wiPjwvY2lyY2xlPlxuXHRcdFx0XHRcdDxyZWN0IHg9XCItN1wiIHk9XCItN1wiIHdpZHRoPVwiMTVcIiBoZWlnaHQ9XCIxNVwiIGZpbGw9JHtjb2xvcn0gZmlsbC1vcGFjaXR5PVwiMC4zXCI+PC9yZWN0PlxuXHRcdFx0XHRcdDxsaW5lIHkyPVwiLTMwXCI+PC9saW5lPlxuXHRcdFx0XHQ8L2c+XG5cdFx0XHQ8L3N2Zz5cblx0XHRgXG5cblx0XHRyZXR1cm4gTC5kaXZJY29uKHtcblx0XHRcdGNsYXNzTmFtZTogJ2Fpc01hcmtlcicsXG5cdFx0XHRpY29uU2l6ZTogWzQwLCA0MF0sXG5cdFx0XHRpY29uQW5jaG9yOiBbMjAsIDIwXSxcblx0XHRcdGh0bWw6IHRlbXBsYXRlXG5cdFx0fSlcdFx0XG5cdH1cbn0pO1xuIiwiJCQubW9kdWxlLnJlZ2lzdGVyTW9kdWxlKCdicmFpbmpzLm1hcC5pY29uLmZvbnQnLCBmdW5jdGlvbigpIHtcblxuXHRyZXR1cm4gZnVuY3Rpb24oZGF0YSkge1xuXHRcdGRhdGEgPSAkLmV4dGVuZCh7XG5cdFx0XHRjbGFzc05hbWU6ICdmYSBmYS1ob21lJyxcblx0XHRcdGZvbnRTaXplOiAxMCxcblx0XHRcdGNvbG9yOiAnZ3JlZW4nXG5cdFx0fSwgZGF0YSlcblxuXHRcdGNvbnN0IGZvbnRTaXplID0gZGF0YS5mb250U2l6ZVxuXG5cdFx0dmFyIHRlbXBsYXRlID0gYFxuXHRcdFx0PGkgY2xhc3M9XCIke2RhdGEuY2xhc3NOYW1lfVwiIHN0eWxlPVwiY29sb3I6ICR7ZGF0YS5jb2xvcn07IGZvbnQtc2l6ZTogJHtmb250U2l6ZX1weFwiPjwvaT5cblx0XHRgXG5cdFx0cmV0dXJuIEwuZGl2SWNvbih7XG5cdFx0XHRjbGFzc05hbWU6ICdmb250TWFya2VyJyxcblx0XHRcdGljb25TaXplOiBbZm9udFNpemUsIGZvbnRTaXplXSxcblx0XHRcdGljb25BbmNob3I6IFtmb250U2l6ZS8yLCBmb250U2l6ZS8yXSxcblx0XHRcdGh0bWw6IHRlbXBsYXRlXG5cdFx0fSlcdFxuXHR9XHRcbn0pIiwiJCQubW9kdWxlLnJlZ2lzdGVyTW9kdWxlKCdicmFpbmpzLm1hcC5zaGFwZS5jaXJjbGUnLCBmdW5jdGlvbigpIHtcblxuXHRyZXR1cm4ge1xuXHRcdFxuXHRcdGNyZWF0ZTogZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0cmV0dXJuIEwuY2lyY2xlKGRhdGEubGF0bG5nLCBkYXRhLnJhZGl1cywgZGF0YS5zdHlsZSlcblx0XHR9LFxuXHRcdHVwZGF0ZTogZnVuY3Rpb24obGF5ZXIsIGRhdGEpIHtcblx0XHRcblx0XHRcdGlmIChkYXRhLmxhdGxuZykge1xuXHRcdFx0XHRsYXllci5zZXRMYXRMbmcoZGF0YS5sYXRsbmcpXG5cdFx0XHR9XHRcblx0XHRcdFxuXHRcdFx0aWYgKGRhdGEucmFkaXVzKSB7XG5cdFx0XHRcdGxheWVyLnNldFJhZGl1cyhkYXRhLnJhZGl1cylcblx0XHRcdH1cblx0XHRcdGlmIChkYXRhLnN0eWxlKSB7XG5cdFx0XHRcdGxheWVyLnNldFN0eWxlKGRhdGEuc3R5bGUpXG5cdFx0XHR9XG5cdFx0XHRcblx0XHR9LFxuXHRcdGdldERhdGE6IGZ1bmN0aW9uKGxheWVyLCBkYXRhKSB7XG5cdFx0XHRkYXRhLnJhZGl1cyA9IGxheWVyLmdldFJhZGl1cygpXG5cdFx0XHRkYXRhLmxhdGxuZyA9IGxheWVyLmdldExhdExuZygpXHRcblx0XHR9XHRcdFxuXG5cdH1cbn0pO1xuXG4iLCIkJC5tb2R1bGUucmVnaXN0ZXJNb2R1bGUoJ2JyYWluanMubWFwLnNoYXBlLmNpcmNsZU1hcmtlcicsIGZ1bmN0aW9uKCkge1xuXG5cdHJldHVybiB7XG5cblx0XHRjcmVhdGU6IGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdFxuXHRcdFx0cmV0dXJuIEwuY2lyY2xlTWFya2VyKGRhdGEubGF0bG5nLCBkYXRhLm9wdGlvbnMpXG5cdFx0fSxcblx0XHR1cGRhdGU6IGZ1bmN0aW9uKGxheWVyLCBkYXRhKSB7XG5cdFx0XG5cdFx0XHRpZiAoZGF0YS5sYXRsbmcpIHtcblx0XHRcdFx0bGF5ZXIuc2V0TGF0TG5nKGRhdGEubGF0bG5nKVxuXHRcdFx0fVx0XG5cdFx0XHRcblx0XHRcdGlmIChkYXRhLm9wdGlvbnMpIHtcblx0XHRcdFx0bGF5ZXIuc2V0U3R5bGUoZGF0YS5vcHRpb25zKVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0fVx0XHRcdFx0XG5cdH1cbn0pO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG5cblxuZnVuY3Rpb24gZ2V0SWNvbk1hcmtlcihkYXRhKSB7XG5cdGlmICh0eXBlb2YgZGF0YS50eXBlICE9ICdzdHJpbmcnKSB7XG5cdFx0Y29uc29sZS5lcnJvcignW2JyYWluanMubWFwXSBnZXRJY29uTWFya2VyLCBtaXNzaW5nIHR5cGUgZmllbGQnKVxuXHRcdHJldHVyblxuXHR9XG5cdGNvbnN0IGZ1bmMgPSAkJC5tb2R1bGUuZ2V0TW9kdWxlKCdicmFpbmpzLm1hcC5pY29uLicgKyBkYXRhLnR5cGUpXG5cblx0aWYgKHR5cGVvZiBmdW5jID09ICdmdW5jdGlvbicpIHtcblx0XHRyZXR1cm4gZnVuYyhkYXRhKVxuXHR9XG59XG5cbiQkLm1vZHVsZS5yZWdpc3Rlck1vZHVsZSgnYnJhaW5qcy5tYXAuc2hhcGUubWFya2VyJywgZnVuY3Rpb24oKSB7XG5cblx0cmV0dXJuIHtcblx0XHRcblx0XHRjcmVhdGU6IGZ1bmN0aW9uKGRhdGEpIHtcblxuXHRcdFx0Y29uc3Qgb3B0aW9ucyA9IGRhdGEub3B0aW9ucyB8fCB7fVxuXHRcdFx0aWYgKGRhdGEuaWNvbikge1xuXHRcdFx0XHRvcHRpb25zLmljb24gPSBnZXRJY29uTWFya2VyKGRhdGEuaWNvbilcblx0XHRcdH1cblx0XHRcdGlmIChkYXRhLnJvdGF0aW9uQW5nbGUpIHtcblx0XHRcdFx0b3B0aW9ucy5yb3RhdGlvbkFuZ2xlID0gZGF0YS5yb3RhdGlvbkFuZ2xlXG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IG1hcmtlciA9IEwubWFya2VyKGRhdGEubGF0bG5nLCBvcHRpb25zKVx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcblx0XHRcdGlmIChkYXRhLnBvcHVwKSB7XG5cdFx0XHRcdGNvbnN0IGNvbnRlbnQgPSBkYXRhLnBvcHVwLmNvbnRlbnRcblx0XHRcdFx0aWYgKHR5cGVvZiBjb250ZW50ID09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0ZGVsZXRlIGRhdGEucG9wdXAuY29udGVudFxuXHRcdFx0XHRcdGNvbnN0IG9wdGlvbnMgPSAkLmV4dGVuZCh7YXV0b0Nsb3NlOiBmYWxzZSwgY2xvc2VCdXR0b246IHRydWUsIGF1dG9QYW46IGZhbHNlfSwgZGF0YS5wb3B1cClcblx0XHRcdFx0XHRsZXQgcG9wdXAgPSBMLnBvcHVwKG9wdGlvbnMpXG5cdFx0XHRcdFx0cG9wdXAuc2V0Q29udGVudChjb250ZW50KVxuXHRcdFx0XHRcdG1hcmtlci5iaW5kUG9wdXAocG9wdXApXG5cdFxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblxuXG5cblx0XHRcdGlmICh0eXBlb2YgZGF0YS50b29sdGlwID09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdG1hcmtlci5iaW5kVG9vbHRpcChkYXRhLnRvb2x0aXApLm9wZW5Ub29sdGlwKClcblx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XG5cdFx0XHRyZXR1cm4gbWFya2VyXG5cdFx0fSxcblxuXHRcdHVwZGF0ZTogZnVuY3Rpb24obGF5ZXIsIGRhdGEpIHtcblx0XHRcblxuXHRcdFx0aWYgKGRhdGEubGF0bG5nKSB7XG5cdFx0XHRcdGxheWVyLnNldExhdExuZyhkYXRhLmxhdGxuZylcblx0XHRcdH1cblx0XHRcdGlmIChkYXRhLmljb24pIHtcblx0XHRcdFx0bGF5ZXIuc2V0SWNvbihnZXRJY29uTWFya2VyKGRhdGEuaWNvbikpXG5cdFx0XHR9XG5cdFx0XHRpZiAoZGF0YS5yb3RhdGlvbkFuZ2xlKSB7XG5cdFx0XHRcdGxheWVyLnNldFJvdGF0aW9uQW5nbGUoZGF0YS5yb3RhdGlvbkFuZ2xlKVxuXHRcdFx0fVx0XG5cblx0XHRcdGlmIChkYXRhLnBvcHVwQ29udGVudCkge1xuXHRcdFx0XHRsYXllci5zZXRQb3B1cENvbnRlbnQoZGF0YS5wb3B1cENvbnRlbnQpXG5cdFx0XHR9XHRcblxuXHRcdH0sXG5cdFx0Z2V0RGF0YTogZnVuY3Rpb24obGF5ZXIsIGRhdGEpIHtcblx0XHRcdGRhdGEubGF0bG5nID0gbGF5ZXIuZ2V0TGF0TG5nKClcblx0XHR9XG5cdH1cbn0pXG5cbn0pKCk7IiwiJCQubW9kdWxlLnJlZ2lzdGVyTW9kdWxlKCdicmFpbmpzLm1hcC5zaGFwZS5wb2x5Z29uJywgZnVuY3Rpb24oKSB7XG5cblx0cmV0dXJuIHtcblx0XHRcblx0XHRjcmVhdGU6IGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdHJldHVybiBMLnBvbHlnb24oZGF0YS5sYXRsbmdzLCBkYXRhLnN0eWxlKVxuXHRcdH0sXG5cdFx0dXBkYXRlOiBmdW5jdGlvbihsYXllciwgZGF0YSkge1xuXHRcdFxuXHRcdFx0aWYgKGRhdGEubGF0bG5ncykge1xuXHRcdFx0XHRsYXllci5zZXRMYXRMbmdzKGRhdGEubGF0bG5ncylcblx0XHRcdH1cblx0XHRcdGlmIChkYXRhLnN0eWxlKSB7XG5cdFx0XHRcdGxheWVyLnNldFN0eWxlKGRhdGEuc3R5bGUpXG5cdFx0XHR9XG5cdFx0XHRcblx0XHR9LFxuXHRcdGdldERhdGE6IGZ1bmN0aW9uKGxheWVyLCBkYXRhKSB7XG5cdFx0XHRkYXRhLmxhdGxuZ3MgPSBsYXllci5nZXRMYXRMbmdzKClbMF1cblx0XHR9XHRcdFxuXG5cdH1cbn0pO1xuXG4iLCIkJC5tb2R1bGUucmVnaXN0ZXJNb2R1bGUoJ2JyYWluanMubWFwLnNoYXBlLnBvbHlsaW5lJywgZnVuY3Rpb24oKSB7XG5cblx0cmV0dXJuIHtcblx0XHRcblx0XHRjcmVhdGU6IGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdHJldHVybiBMLnBvbHlsaW5lKGRhdGEubGF0bG5ncywgZGF0YS5zdHlsZSlcblx0XHR9LFxuXHRcdHVwZGF0ZTogZnVuY3Rpb24obGF5ZXIsIGRhdGEpIHtcblx0XHRcblx0XHRcdGlmIChkYXRhLmxhdGxuZ3MpIHtcblx0XHRcdFx0bGF5ZXIuc2V0TGF0TG5ncyhkYXRhLmxhdGxuZ3MpXG5cdFx0XHR9XG5cdFx0XHRpZiAoZGF0YS5zdHlsZSkge1xuXHRcdFx0XHRsYXllci5zZXRTdHlsZShkYXRhLnN0eWxlKVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0fSxcblx0XHRnZXREYXRhOiBmdW5jdGlvbihsYXllciwgZGF0YSkge1xuXHRcdFx0ZGF0YS5sYXRsbmdzID0gbGF5ZXIuZ2V0TGF0TG5ncygpXG5cdFx0fVx0XG5cdH1cbn0pO1xuXG4iLCIkJC5tb2R1bGUucmVnaXN0ZXJNb2R1bGUoJ2JyYWluanMubWFwLnNoYXBlLnJlY3RhbmdsZScsIGZ1bmN0aW9uKCkge1xuXG5cdHJldHVybiB7XG5cdFx0XG5cdFx0Y3JlYXRlOiBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XG5cdFx0XHRjb25zdCBib3VuZHMgPSBMLmxhdExuZ0JvdW5kcyhkYXRhLm5vcnRoV2VzdCwgZGF0YS5zb3V0aEVhc3QpXG5cdFx0XHRyZXR1cm4gTC5yZWN0YW5nbGUoYm91bmRzLCBkYXRhLnN0eWxlKVxuXHRcdH0sXG5cblx0XHR1cGRhdGU6IGZ1bmN0aW9uKGxheWVyLCBkYXRhKSB7XG5cdFx0XHRcblx0XHRcdGlmIChkYXRhLm5vcnRoV2VzdCAmJiBkYXRhLnNvdXRoRWFzdCkge1xuXHRcdFx0XHRjb25zdCBib3VuZHMgPSBMLmxhdExuZ0JvdW5kcyhkYXRhLm5vcnRoV2VzdCwgZGF0YS5zb3V0aEVhc3QpXG5cdFx0XHRcdGxheWVyLnNldEJvdW5kcyhib3VuZHMpXG5cdFx0XHR9XG5cdFx0XHRpZiAoZGF0YS5zdHlsZSkge1xuXHRcdFx0XHRsYXllci5zZXRTdHlsZShkYXRhLnN0eWxlKVxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0Z2V0RGF0YTogZnVuY3Rpb24obGF5ZXIsIGRhdGEpIHtcblx0XHRcdGNvbnN0IGJvdW5kcyA9IGxheWVyLmdldEJvdW5kcygpXG5cdFx0XHRkYXRhLm5vcnRoV2VzdCA9ICBib3VuZHMuZ2V0Tm9ydGhXZXN0KClcblx0XHRcdGRhdGEuc291dGhFYXN0ID0gIGJvdW5kcy5nZXRTb3V0aEVhc3QoKVxuXHRcdH1cblx0fVxufSk7XG5cbiIsIiQkLm1vZHVsZS5yZWdpc3Rlck1vZHVsZSgnYnJhaW5qcy5tYXAuc2hhcGUuc2VjdG9yJywgZnVuY3Rpb24oKSB7XG5cblx0cmV0dXJuIHtcblxuXHRcdGNyZWF0ZTogZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0dmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7cmFkaXVzOiBkYXRhLnJhZGl1c30sIGRhdGEub3B0aW9ucylcblx0XHRcdHZhciBzZWN0b3IgPSBMLnNlbWlDaXJjbGUoZGF0YS5sYXRsbmcsIG9wdGlvbnMpXG5cdFx0XHRzZWN0b3Iuc2V0RGlyZWN0aW9uKGRhdGEuZGlyZWN0aW9uLCBkYXRhLnNpemUpXG5cdFx0XHRyZXR1cm4gc2VjdG9yXG5cdFx0fSxcblx0XHR1cGRhdGU6IGZ1bmN0aW9uKGxheWVyLCBkYXRhKSB7XG5cdFx0XHRpZiAoZGF0YS5sYXRsbmcpIHtcblx0XHRcdFx0bGF5ZXIuc2V0TGF0TG5nKGRhdGEubGF0bG5nKVxuXHRcdFx0fVxuXHRcdFx0aWYgKGRhdGEucmFkaXVzKSB7XG5cdFx0XHRcdGxheWVyLnNldFJhZGl1cyhkYXRhLnJhZGl1cylcblx0XHRcdH1cblx0XHRcdGlmIChkYXRhLmRpcmVjdGlvbiAmJiBkYXRhLnNpemUpIHtcblx0XHRcdFx0bGF5ZXIuc2V0RGlyZWN0aW9uKGRhdGEuZGlyZWN0aW9uLCBkYXRhLnNpemUpXG5cdFx0XHR9XG5cdFx0XHRpZiAoZGF0YS5vcHRpb25zKSB7XG5cdFx0XHRcdGxheWVyLnNldFN0eWxlKGRhdGEub3B0aW9ucylcblx0XHRcdH1cblx0XHR9XHRcdFxuXHR9XG59KTtcblxuIiwiJChmdW5jdGlvbiAoKSB7XG5cdGNvbnNvbGUubG9nKCdbYnJhaW5qcy5tYXBdIExlYWZsZXQgdmVyc2lvbicsIEwudmVyc2lvbilcblx0Ly8kJC51dGlsLmxvYWRTdHlsZSgnbWFwL2JyYWluanMtbWFwLmNzcycpXG59KVxuXG5cblxuJCQuY29udHJvbC5yZWdpc3RlckNvbnRyb2woJ2JyYWluanMubWFwJywge1xuXHRwcm9wczoge1xuXHRcdHRpbGVVcmw6ICdodHRwczovL3tzfS50aWxlLm9wZW5zdHJlZXRtYXAub3JnL3t6fS97eH0ve3l9LnBuZycsXG5cdFx0Y2VudGVyOiB7IGxhdDogNTEuNTA1LCBsbmc6IC0wLjA5IH0sIC8vIGxvbmRvbiBjaXR5XG5cdFx0em9vbTogMTMsXG5cdFx0bGF5ZXJzOiB7fSxcblx0XHRzY2FsZTogZmFsc2UsXG5cdFx0Y29vcmRpbmF0ZXM6IGZhbHNlLFxuXHRcdHBsdWdpbnM6IHt9LFxuXHRcdGNvbnRleHRNZW51OiB7fSxcblx0XHRzaGFwZXM6IHt9XG5cdH0sXG5cdGluaXQ6IGZ1bmN0aW9uIChlbHQpIHtcblxuXHRcdGNvbnN0IGRpdiA9ICQoJzxkaXY+JykuY3NzKCdoZWlnaHQnLCAnMTAwJScpLmFwcGVuZFRvKGVsdCkuZ2V0KDApXG5cblx0XHRjb25zdCB7IGNlbnRlciwgem9vbSwgdGlsZVVybCwgY29udGV4dE1lbnUgfSA9IHRoaXMucHJvcHNcblxuXHRcdGNvbnN0IG1hcE9wdGlvbnMgPSB7XG5cdFx0XHRjZW50ZXIsXG5cdFx0XHR6b29tLFxuXHRcdFx0Y2xvc2VQb3B1cE9uQ2xpY2s6IGZhbHNlLFxuXHRcdFx0Y29udGV4dG1lbnU6IHRydWUsXG5cdFx0XHQvL2NvbnRleHRtZW51V2lkdGg6IDIwMCxcblx0XHRcdGF0dHJpYnV0aW9uQ29udHJvbDogZmFsc2Vcblx0XHR9XG5cblx0XHRtYXBPcHRpb25zLmNvbnRleHRtZW51SXRlbXMgPSBPYmplY3Qua2V5cyhjb250ZXh0TWVudSkubWFwKGZ1bmN0aW9uIChjbWQpIHtcblx0XHRcdGNvbnN0IHRleHQgPSBjb250ZXh0TWVudVtjbWRdLm5hbWVcblx0XHRcdGlmICh0ZXh0ID09PSAnLS0nKSB7XG5cdFx0XHRcdHJldHVybiB7IHNlcGFyYXRvcjogdHJ1ZSB9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR0ZXh0LFxuXHRcdFx0XHRjYWxsYmFjazogZnVuY3Rpb24gKGV2KSB7XG5cdFx0XHRcdFx0ZWx0LnRyaWdnZXIoJ21hcGNvbnRleHRtZW51JywgeyBjbWQsIGxhdGxuZzogZXYubGF0bG5nIH0pXG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdH0pXG5cblx0XHRjb25zdCBtYXAgPSBMLm1hcChkaXYsIG1hcE9wdGlvbnMpXG5cdFx0Y29uc3Qgc2hhcGVzID0ge31cblx0XHRjb25zdCBsYXllcnMgPSB7fVxuXG5cdFx0Y29uc3QgY29uZkxheWVyID0ge31cblxuXHRcdGZvciAobGV0IGxheWVyTmFtZSBpbiB0aGlzLnByb3BzLmxheWVycykge1xuXHRcdFx0Y29uc3QgeyBsYWJlbCwgdmlzaWJsZSB9ID0gdGhpcy5wcm9wcy5sYXllcnNbbGF5ZXJOYW1lXVxuXHRcdFx0Y29uc3QgbGF5ZXIgPSBuZXcgTC5GZWF0dXJlR3JvdXAoKVxuXHRcdFx0bGF5ZXJzW2xheWVyTmFtZV0gPSBsYXllclxuXHRcdFx0aWYgKHR5cGVvZiBsYWJlbCA9PSAnc3RyaW5nJykge1xuXHRcdFx0XHRjb25mTGF5ZXJbbGFiZWxdID0gbGF5ZXJcblx0XHRcdH1cblxuXHRcdFx0aWYgKHZpc2libGUgPT09IHRydWUpIHtcblx0XHRcdFx0bWFwLmFkZExheWVyKGxheWVyKVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChPYmplY3Qua2V5cyhjb25mTGF5ZXIpLmxlbmd0aCAhPSAwKSB7XG5cdFx0XHRMLmNvbnRyb2wubGF5ZXJzKHt9LCBjb25mTGF5ZXIpLmFkZFRvKG1hcClcblx0XHR9XG5cblx0XHRpZiAodGhpcy5wcm9wcy5zY2FsZSkge1xuXHRcdFx0TC5jb250cm9sLnNjYWxlKHsgaW1wZXJpYWw6IGZhbHNlLCBwb3NpdGlvbjogJ2JvdHRvbXJpZ2h0JyB9KS5hZGRUbyhtYXApXG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMucHJvcHMuY29vcmRpbmF0ZXMpIHtcblx0XHRcdEwuY29udHJvbC5jb29yZGluYXRlcyh7XG5cdFx0XHRcdHBvc2l0aW9uOiAnYm90dG9tbGVmdCcsXG5cdFx0XHRcdHVzZUxhdExuZ09yZGVyOiB0cnVlLFxuXHRcdFx0XHRlbmFibGVVc2VySW5wdXQ6IGZhbHNlLFxuXHRcdFx0XHRkZWNpbWFsczogNVxuXHRcdFx0fSkuYWRkVG8obWFwKVxuXHRcdH1cblxuXHRcdGNvbnN0IGRhdGEgPSB7IGVsdCwgbWFwLCBsYXllcnMsIHNoYXBlcyB9XG5cblx0XHRmb3IgKGxldCBwbHVnaW5OYW1lIGluIHRoaXMucHJvcHMucGx1Z2lucykge1xuXHRcdFx0Y29uc3QgZnVuYyA9ICQkLm1vZHVsZS5nZXRNb2R1bGUoJ2JyYWluanMubWFwLnBsdWdpbi4nICsgcGx1Z2luTmFtZSlcblx0XHRcdGNvbnN0IGNvbmZpZyA9IHRoaXMucHJvcHMucGx1Z2luc1twbHVnaW5OYW1lXVxuXHRcdFx0aWYgKHR5cGVvZiBmdW5jID09ICdmdW5jdGlvbicpIHtcblx0XHRcdFx0Y29uc29sZS5sb2coYFticmFpbmpzLm1hcF0gaW5zdGFuY2UgcGx1Z2luICcke3BsdWdpbk5hbWV9JyB3aXRoIGNvbmZpZ2AsIGNvbmZpZylcblx0XHRcdFx0ZnVuYyhkYXRhLCBjb25maWcpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0TC50aWxlTGF5ZXIodGlsZVVybCkuYWRkVG8obWFwKVxuXG5cdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRtYXAuaW52YWxpZGF0ZVNpemUoKVxuXHRcdH0sIDEwMClcblxuXHRcdG1hcC5vbignY2xpY2snLCBmdW5jdGlvbiAoZXYpIHtcblx0XHRcdC8vY29uc29sZS5sb2coJ1ttYXBdIG9uY2xpY2snLCBldilcblx0XHRcdGVsdC50cmlnZ2VyKCdtYXBjbGljaycsIHsgbGF0bG5nOiBldi5sYXRsbmcgfSlcblx0XHR9KVxuXG5cdFx0dGhpcy5nZXRTaGFwZXMgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmtleXMoc2hhcGVzKVxuXHRcdH1cblxuXHRcdHRoaXMudXBkYXRlU2hhcGUgPSBmdW5jdGlvbiAoaWQsIG9wdGlvbnMpIHtcblx0XHRcdGNvbnN0IHNoYXBlID0gc2hhcGVzW2lkXVxuXHRcdFx0aWYgKHNoYXBlKSB7XG5cdFx0XHRcdGNvbnN0IHNoYXBlRGVzYyA9ICQkLm1vZHVsZS5nZXRNb2R1bGUoJ2JyYWluanMubWFwLnNoYXBlLicgKyBzaGFwZS50eXBlKVxuXHRcdFx0XHRpZiAoc2hhcGVEZXNjICYmIHR5cGVvZiBzaGFwZURlc2MudXBkYXRlID09ICdmdW5jdGlvbicpIHtcblxuXHRcdFx0XHRcdC8vY29uc29sZS5sb2coJ1ticmFpbmpzLm1hcF0gdXBkYXRlU2hhcGUgd2l0aCBpZCcsIGlkKVxuXHRcdFx0XHRcdHNoYXBlRGVzYy51cGRhdGUoc2hhcGUsIG9wdGlvbnMpXG5cdFx0XHRcdFx0JC5leHRlbmQoc2hhcGUuaW5mbywgb3B0aW9ucylcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHRocm93IGBbYnJhaW5qcy5tYXBdIHVwZGF0ZVNoYXBlIGlkICcke2lkfScgZG9lc24ndCBleGlzdGBcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLmFkZFNoYXBlID0gZnVuY3Rpb24gKGlkLCBkYXRhKSB7XG5cdFx0XHRpZiAoc2hhcGVzW2lkXSkge1xuXHRcdFx0XHR0aHJvdyBgW2JyYWluanMubWFwXSBhZGRTaGFwZSBpZCAnJHtpZH0nIGFscmVhZHkgZXhpc3RgXG5cdFx0XHR9XG5cdFx0XHRkYXRhID0gZGF0YSB8fCB7fVxuXG5cdFx0XHRpZiAodHlwZW9mIGRhdGEudHlwZSAhPSAnc3RyaW5nJykge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKCdbYnJhaW5qcy5tYXBdIGFkZFNoYXBlLCBtaXNzaW5nIHR5cGUgZmllbGQnKVxuXHRcdFx0XHRyZXR1cm5cblx0XHRcdH1cblxuXHRcdFx0Y29uc3Qgc2hhcGVEZXNjID0gJCQubW9kdWxlLmdldE1vZHVsZSgnYnJhaW5qcy5tYXAuc2hhcGUuJyArIGRhdGEudHlwZSlcblxuXHRcdFx0bGV0IGxheWVyID0gbWFwXG5cdFx0XHRpZiAodHlwZW9mIGRhdGEubGF5ZXIgPT0gJ3N0cmluZycpIHtcblx0XHRcdFx0bGF5ZXIgPSBsYXllcnNbZGF0YS5sYXllcl1cblx0XHRcdFx0aWYgKGxheWVyID09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdHRocm93IGBsYXllciAnJHtkYXRhLmxheWVyfScgZG9lc24ndCBleGlzdGBcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoc2hhcGVEZXNjICYmIHR5cGVvZiBzaGFwZURlc2MuY3JlYXRlID09ICdmdW5jdGlvbicpIHtcblxuXHRcdFx0XHRjb25zb2xlLmxvZygnW2JyYWluanMubWFwXSBhZGRTaGFwZSB3aXRoIGlkJywgaWQpXG5cdFx0XHRcdGlmIChkYXRhLmNvbnRleHRNZW51KSB7XG5cdFx0XHRcdFx0ZGF0YS5vcHRpb25zID0ge1xuXHRcdFx0XHRcdFx0Y29udGV4dG1lbnU6IHRydWUsXG5cdFx0XHRcdFx0XHRjb250ZXh0bWVudUluaGVyaXRJdGVtczogZmFsc2UsXG5cdFx0XHRcdFx0XHRjb250ZXh0bWVudUl0ZW1zOiBPYmplY3QuZW50cmllcyhkYXRhLmNvbnRleHRNZW51KS5tYXAoKGl0ZW0pID0+IHtcblx0XHRcdFx0XHRcdFx0Y29uc3QgW2NtZCwgaW5mb10gPSBpdGVtXG5cdFx0XHRcdFx0XHRcdGNvbnN0IHRleHQgPSBpbmZvLm5hbWVcblx0XHRcdFx0XHRcdFx0aWYgKHRleHQgPT09ICctLScpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4geyBzZXBhcmF0b3I6IHRydWUgfVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0XHRcdFx0dGV4dCxcblx0XHRcdFx0XHRcdFx0XHRpY29uQ2xzOiBpbmZvLmljb25DbHMsXG5cdFx0XHRcdFx0XHRcdFx0Y2FsbGJhY2s6IGZ1bmN0aW9uIChldikge1xuXHRcdFx0XHRcdFx0XHRcdFx0ZWx0LnRyaWdnZXIoJ21hcHNoYXBlY29udGV4dG1lbnUnLCB7IGlkLCBjbWQsIGxhdGxuZzogZXYubGF0bG5nIH0pXG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFxuXHRcdFx0XHRcdFx0fSlcblx0XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2hhcGUgPSBzaGFwZURlc2MuY3JlYXRlKGRhdGEpXG5cdFx0XHRcdHNoYXBlLnR5cGUgPSBkYXRhLnR5cGVcblx0XHRcdFx0c2hhcGUub3dubGF5ZXIgPSBsYXllclxuXHRcdFx0XHRzaGFwZS5pbmZvID0gZGF0YVxuXHRcdFx0XHRzaGFwZS5pZCA9IGlkXG5cdFx0XHRcdHNoYXBlc1tpZF0gPSBzaGFwZVxuXHRcdFx0XHRpZiAoZGF0YS5jb250ZXh0TWVudSA9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRzaGFwZS5vbignY29udGV4dG1lbnUnLCBmdW5jdGlvbiAoZXYpIHtcblx0XHRcdFx0XHRcdGNvbnN0IGRhdGEgPSB7IGlkLCBsYXRsbmc6IGV2LmxhdGxuZyB9XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIGV2LnRhcmdldC5nZXRMYXRMbmcgPT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0XHRcdFx0XHRkYXRhLnBvcyA9IG1hcC5sYXRMbmdUb0NvbnRhaW5lclBvaW50KGV2LnRhcmdldC5nZXRMYXRMbmcoKSlcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGVsdC50cmlnZ2VyKCdtYXBzaGFwZWNvbnRleHRtZW51JywgZGF0YSlcblx0XHRcdFx0XHR9KVxuXG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0ZGVsZXRlIGRhdGEuY29udGV4dE1lbnVcblx0XHRcdFx0fVxuXHRcdFx0XHRzaGFwZS5hZGRUbyhsYXllcilcblx0XHRcdFx0aWYgKGRhdGEucG9wdXApIHtcblx0XHRcdFx0XHRzaGFwZS5vcGVuUG9wdXAoKVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5yZW1vdmVTaGFwZSA9IGZ1bmN0aW9uIChpZCkge1xuXG5cdFx0XHRjb25zdCBzaGFwZSA9IHNoYXBlc1tpZF1cblx0XHRcdGlmIChzaGFwZSkge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnW2JyYWluanMubWFwXSByZW1vdmVTaGFwZSB3aXRoIGlkJywgaWQpXG5cdFx0XHRcdHNoYXBlLnJlbW92ZUZyb20oc2hhcGUub3dubGF5ZXIpXG5cdFx0XHRcdGRlbGV0ZSBzaGFwZXNbaWRdXG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKGBbYnJhaW5qcy5tYXBdIHJlbW92ZVNoYXBlIGlkICcke2lkfScgZG9lc24ndCBleGlzdGApXG5cdFx0XHR9XG5cdFx0fVxuXG5cblx0XHR0aGlzLmdldFNoYXBlSW5mbyA9IGZ1bmN0aW9uIChpZCkge1xuXG5cdFx0XHRjb25zdCBzaGFwZSA9IHNoYXBlc1tpZF1cblx0XHRcdGlmIChzaGFwZSkge1xuXHRcdFx0XHRyZXR1cm4gc2hhcGUuaW5mb1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihgW2JyYWluanMubWFwXSByZW1vdmVTaGFwZSBpZCAnJHtpZH0nIGRvZXNuJ3QgZXhpc3RgKVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuZW5hYmxlSGFuZGxlcnMgPSBmdW5jdGlvbiAoZW5hYmxlZCkge1xuXHRcdFx0bWFwLl9oYW5kbGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoYW5kbGVyKSB7XG5cdFx0XHRcdGlmIChlbmFibGVkKVxuXHRcdFx0XHRcdGhhbmRsZXIuZW5hYmxlKClcblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdGhhbmRsZXIuZGlzYWJsZSgpXG5cdFx0XHR9KVxuXHRcdH1cblxuXHRcdHRoaXMuZ2V0Wm9vbSA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBtYXAuZ2V0Wm9vbSgpXG5cdFx0fVxuXG5cdFx0dGhpcy5nZXRDZW50ZXIgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gbWFwLmdldENlbnRlcigpXG5cdFx0fVxuXG5cdFx0dGhpcy5wYW5UbyA9IGZ1bmN0aW9uIChsYXRsbmcpIHtcblx0XHRcdHJldHVybiBtYXAucGFuVG8obGF0bG5nLCB7IGFuaW1hdGU6IHRydWUgfSlcblx0XHR9XG5cblx0XHR0aGlzLmZseVRvID0gZnVuY3Rpb24gKGxhdGxuZywgem9vbSkge1xuXHRcdFx0cmV0dXJuIG1hcC5mbHlUbyhsYXRsbmcsIHpvb20sIHsgYW5pbWF0ZTogdHJ1ZSB9KVxuXHRcdH1cblxuXHRcdGZvciAobGV0IHNoYXBlSWQgaW4gdGhpcy5wcm9wcy5zaGFwZXMpIHtcblx0XHRcdHRoaXMuYWRkU2hhcGUoc2hhcGVJZCwgdGhpcy5wcm9wcy5zaGFwZXNbc2hhcGVJZF0pXG5cdFx0fVxuXG5cdH0sXG5cblx0JGlmYWNlOiBgXG5cdFx0Z2V0U2hhcGVzKCk6W3NoYXBlSWRdO1xuXHRcdHVwZGF0ZVNoYXBlKHNoYXBlSWQsIG9wdGlvbnMpO1xuXHRcdGFkZFNoYXBlKHNoYXBlSWQsIG9wdGlvbnMpO1xuXHRcdHJlbW92ZVNoYXBlKHNoYXBlSWQpO1xuXHRcdGdldFNoYXBlSW5mbyhzaGFwZUlkKTogU2hhcGVJbmZvO1xuXHRcdGVuYWJsZUhhbmRsZXJzKGVuYWJsZWQpO1xuXHRcdGdldFpvb20oKTpab29tTGV2ZWw7XG5cdFx0Z2V0Q2VudGVyKCk6IExhdExuZztcblx0XHRwYW5UbyhsYXRsbmcpO1xuXHRcdGZseVRvKGxhdGxuZywgem9vbSlcblx0XHRgLFxuXG5cdCRldmVudHM6IGBtYXBjb250ZXh0bWVudTttYXBjbGljazttYXBzaGFwZWNvbnRleHRtZW51YFxuXG59KTtcbiIsIiQkLmNvbnRyb2wucmVnaXN0ZXJDb250cm9sKCdicmFpbmpzLmltYWdlJywge1xuXG5cdHByb3BzOiB7XG5cdFx0c3JjOiAnJ1xuXHR9LFxuXG5cdHRlbXBsYXRlOiBcIjxkaXYgY2xhc3M9XFxcInRvb2xiYXJcXFwiPlxcblx0PGRpdiBibi1zaG93PVxcXCIhcmVhZHlcXFwiPlxcblx0XHQ8aSBjbGFzcz1cXFwiZmEgZmEtc3Bpbm5lciBmYS1wdWxzZVxcXCI+PC9pPlxcblx0XHQmbmJzcDtMb2FkaW5nLi4uXFxuXHQ8L2Rpdj5cXG5cdFxcbjwvZGl2PlxcblxcbjxkaXYgYm4tYmluZD1cXFwibWFwXFxcIiBjbGFzcz1cXFwibWFwXFxcIj48L2Rpdj5cIixcblxuXHRpbml0OiBmdW5jdGlvbihlbHQpIHtcblxuXHRcdGNvbnN0IHtzcmN9ID0gdGhpcy5wcm9wc1xuXG5cdFx0bGV0IHJvdGF0aW9uQW5nbGUgPSAwXG5cblx0XHRjb25zdCBjdHJsID0gJCQudmlld0NvbnRyb2xsZXIoZWx0LCB7XG5cdFx0XHRkYXRhOiB7XG5cdFx0XHRcdHJlYWR5OiBmYWxzZVxuXHRcdFx0fSxcblx0XHRcdGV2ZW50czoge1xuXHRcdFx0fVxuXHRcdH0pXG5cblx0XHRjb25zdCBtYXBPcHRpb25zID0ge1xuXHRcdFx0Y3JzOiBMLkNSUy5TaW1wbGUsXG5cdFx0XHRhdHRyaWJ1dGlvbkNvbnRyb2w6IGZhbHNlLFxuXHRcdFx0em9vbUNvbnRyb2w6IGZhbHNlLFxuXHRcdFx0bWluWm9vbTogLTQsXG5cdFx0XHR6b29tU25hcDogMC4wNSxcblx0XHRcdGNvbnRleHRtZW51OiB0cnVlLFxuXHRcdFx0Y29udGV4dG1lbnVJdGVtczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dGV4dDogJ0ZpdCBJbWFnZSBTaXplJyxcblx0XHRcdFx0XHRpY29uQ2xzOiAnZmFzIGZhLWV4cGFuZCB3My10ZXh0LWJsdWUnLFxuXHRcdFx0XHRcdGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGZpdEltYWdlKClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtzZXBhcmF0b3I6IHRydWV9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dGV4dDogJ1JvdGF0ZSBSaWdodCcsXG5cdFx0XHRcdFx0aWNvbkNsczogJ2ZhcyBmYS1yZWRvLWFsdCB3My10ZXh0LWJsdWUnLFxuXHRcdFx0XHRcdGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHJvdGF0ZSg5MClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0ZXh0OiAnUm90YXRlIExlZnQnLCBcblx0XHRcdFx0XHRpY29uQ2xzOiAnZmFzIGZhLXVuZG8tYWx0IHczLXRleHQtYmx1ZScsXG5cdFx0XHRcdFx0Y2FsbGJhY2s6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0cm90YXRlKC05MClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdF1cdFx0XHRcblx0XHR9XG5cblx0XHRjb25zdCBtYXAgPSBMLm1hcChjdHJsLnNjb3BlLm1hcC5nZXQoMCksIG1hcE9wdGlvbnMpXG5cblx0XHRsZXQgYm91bmRzXG5cdFx0bGV0IGltYWdlT3ZlcmxheSA9IG51bGxcblx0XHRsZXQgaW1hZ2UgPSBudWxsXG5cblx0XHRmdW5jdGlvbiBsb2FkKHVybCkge1xuXHRcdFx0Y3RybC5zZXREYXRhKHtyZWFkeTogZmFsc2V9KVxuXG5cdFx0XHRpbWFnZSA9IG5ldyBJbWFnZSgpXG5cdFx0XHRpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0Y3RybC5zZXREYXRhKHtyZWFkeTogdHJ1ZX0pXG5cblx0XHRcdFx0Y29uc3Qgd2lkdGggPSBpbWFnZS53aWR0aFxuXHRcdFx0XHRjb25zdCBoZWlnaHQgPSBpbWFnZS5oZWlnaHRcblx0XHRcdFx0Ly9jb25zb2xlLmxvZygnd2lkdGg6ICcsIHdpZHRoLCAnIGhlaWdodDonLCBoZWlnaHQpXG5cdFx0XHRcdGJvdW5kcyA9IFtbMCwgMF0sIFtoZWlnaHQsIHdpZHRoXV1cblxuXHRcdFx0aWYgKGltYWdlT3ZlcmxheSA9PSBudWxsKSB7XG5cdFx0XHRcdFx0aW1hZ2VPdmVybGF5ID0gTC5yb3RhdGVJbWFnZUxheWVyKHVybCwgYm91bmRzKS5hZGRUbyhtYXApXHRcdFx0XHRcdFxuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdGltYWdlT3ZlcmxheS5zZXRCb3VuZHMoYm91bmRzKVxuXHRcdFx0XHRcdHJvdGF0aW9uQW5nbGUgPSAwXG5cdFx0XHRcdFx0aW1hZ2VPdmVybGF5LnNldFJvdGF0aW9uKHJvdGF0aW9uQW5nbGUpXG5cdFx0XHRcdFx0aW1hZ2VPdmVybGF5LnNldFVybCh1cmwpXG5cdFx0XHRcdH1cblx0XHRcdFx0bWFwLmZpdEJvdW5kcyhib3VuZHMpXG5cblx0XHRcdH1cblx0XHRcdGltYWdlLnNyYyA9IHVybFx0XHRcdFxuXHRcdH1cblxuXHRcdGlmIChzcmMgIT0gJycpIHtcblx0XHRcdGxvYWQoc3JjKVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGZpdEltYWdlKCkge1xuXHRcdFx0aWYgKGJvdW5kcyAhPSB1bmRlZmluZWQpIHtcblx0XHRcdFx0bWFwLmZpdEJvdW5kcyhib3VuZHMpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcm90YXRlKGFuZ2xlRGVnKSB7XG5cdFx0XHRyb3RhdGlvbkFuZ2xlICs9IGFuZ2xlRGVnXG5cdFx0XHRyb3RhdGlvbkFuZ2xlID0gKHJvdGF0aW9uQW5nbGUgKyAzNjApICUgMzYwXG5cblx0XHRcdGNvbnN0IHdpZHRoID0gaW1hZ2Uud2lkdGhcblx0XHRcdGNvbnN0IGhlaWdodCA9IGltYWdlLmhlaWdodFxuXG5cdFx0XHRpZiAocm90YXRpb25BbmdsZSA9PSAwKSB7XG5cdFx0XHRcdGJvdW5kcyA9IFtbMCwgMF0sIFtoZWlnaHQsIHdpZHRoXV1cblx0XHRcdH1cblx0XHRcdGlmIChyb3RhdGlvbkFuZ2xlID09IDI3MCkge1xuXHRcdFx0XHRib3VuZHMgPSBbW2hlaWdodCwgMF0sIFt3aWR0aCtoZWlnaHQsIHdpZHRoXV1cblx0XHRcdH1cblx0XHRcdGlmIChyb3RhdGlvbkFuZ2xlID09IDkwKSB7XG5cdFx0XHRcdGJvdW5kcyA9IFtbaGVpZ2h0LCAtaGVpZ2h0XSwgW2hlaWdodC13aWR0aCwgMF1dXG5cdFx0XHR9XG5cdFx0XHRpZiAocm90YXRpb25BbmdsZSA9PSAxODApIHtcblx0XHRcdFx0Ym91bmRzID0gW1toZWlnaHQsIDBdLCBbMipoZWlnaHQsIC13aWR0aF1dXG5cdFx0XHR9XG5cdFx0XHQvL2NvbnNvbGUubG9nKCdyb3RhdGlvbkFuZ2xlJywgcm90YXRpb25BbmdsZSlcblx0XHRcdC8vY29uc29sZS5sb2coJ2JvdW5kcycsIGJvdW5kcylcblx0XHRcdGltYWdlT3ZlcmxheS5zZXRSb3RhdGlvbihyb3RhdGlvbkFuZ2xlKVxuXHRcdFx0Zml0SW1hZ2UoKVxuXHRcdH1cblxuXHRcdHRoaXMuZml0SW1hZ2UgPSBmaXRJbWFnZVxuXHRcdHRoaXMucm90YXRlID0gcm90YXRlXG5cblx0XHR0aGlzLmVuYWJsZUhhbmRsZXJzID0gZnVuY3Rpb24oaXNFbmFibGVkKSB7XG5cdFx0XHRtYXAuX2hhbmRsZXJzLmZvckVhY2goKGhhbmRsZXIpID0+IHtcblx0XHRcdFx0aWYgKGlzRW5hYmxlZCkge1xuXHRcdFx0XHRcdGhhbmRsZXIuZW5hYmxlKClcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRoYW5kbGVyLmRpc2FibGUoKVxuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdH1cblxuXHRcdHRoaXMuZW5hYmxlQ29udGV4dE1lbnUgPSBmdW5jdGlvbihpc0VuYWJsZWQpIHtcblxuXHRcdFx0aWYgKGlzRW5hYmxlZCkge1xuXHRcdFx0XHRtYXAuY29udGV4dG1lbnUuZW5hYmxlKClcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRtYXAuY29udGV4dG1lbnUuZGlzYWJsZSgpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5pbnZhbGlkYXRlU2l6ZSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0bWFwLmludmFsaWRhdGVTaXplKClcblx0XHRcdGZpdEltYWdlKClcblx0XHR9XG5cblx0XHR0aGlzLnNldERhdGEgPSBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHQvL2NvbnNvbGUubG9nKCdbaW1hZ2VdIHNldERhdGEnLCBkYXRhKVxuXHRcdFx0aWYgKGRhdGEuc3JjKSB7XG5cdFx0XHRcdGxvYWQoZGF0YS5zcmMpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdH0sXG5cdCRpZmFjZTogYFxuXHRcdHNldERhdGEoe3NyY30pO1xuXHRcdGludmFsaWRhdGVTaXplKCk7XG5cdFx0ZW5hYmxlSGFuZGxlcnMoaXNFbmFibGVkKTtcblx0XHRlbmFibGVDb250ZXh0TWVudShpc0VuYWJsZWQpO1xuXHRcdGZpdEltYWdlKCk7XG5cdFx0cm90YXRlKGFuZ2xlRGVnKVxuXG5cdGBcblxufSkiLCJMLnJvdGF0ZUltYWdlTGF5ZXIgPSBmdW5jdGlvbih1cmwsIGJvdW5kcywgb3B0aW9ucykge1xuICAgIHJldHVybiBuZXcgTC5Sb3RhdGVJbWFnZUxheWVyKHVybCwgYm91bmRzLCBvcHRpb25zKTtcbn07XG4vLyBBIHF1aWNrIGV4dGVuc2lvbiB0byBhbGxvdyBpbWFnZSBsYXllciByb3RhdGlvbi5cbkwuUm90YXRlSW1hZ2VMYXllciA9IEwuSW1hZ2VPdmVybGF5LmV4dGVuZCh7XG4gICAgb3B0aW9uczoge3JvdGF0aW9uOiAwfSxcblxuICAgIF9hbmltYXRlWm9vbTogZnVuY3Rpb24oZSl7XG4gICAgICAgIEwuSW1hZ2VPdmVybGF5LnByb3RvdHlwZS5fYW5pbWF0ZVpvb20uY2FsbCh0aGlzLCBlKTtcbiAgICAgICAgdmFyIGltZyA9IHRoaXMuX2ltYWdlO1xuICAgICAgICBpbWcuc3R5bGVbTC5Eb21VdGlsLlRSQU5TRk9STV0gKz0gJyByb3RhdGUoJyArIHRoaXMub3B0aW9ucy5yb3RhdGlvbiArICdkZWcpJztcbiAgICB9LFxuXG4gICAgX3Jlc2V0OiBmdW5jdGlvbigpe1xuICAgICAgICBMLkltYWdlT3ZlcmxheS5wcm90b3R5cGUuX3Jlc2V0LmNhbGwodGhpcyk7XG4gICAgICAgIHZhciBpbWcgPSB0aGlzLl9pbWFnZTtcbiAgICAgICAgaW1nLnN0eWxlW0wuRG9tVXRpbC5UUkFOU0ZPUk1dICs9ICcgcm90YXRlKCcgKyB0aGlzLm9wdGlvbnMucm90YXRpb24gKyAnZGVnKSc7XG4gICAgfSxcblxuICAgIHNldFJvdGF0aW9uOmZ1bmN0aW9uKHJvdGF0aW9uKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5yb3RhdGlvbiA9IHJvdGF0aW9uXG4gICAgICAgIGlmICh0aGlzLl9tYXApIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc2V0KClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0sXG5cbiAgICBzZXRCb3VuZHM6ZnVuY3Rpb24oYm91bmRzKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coJ3NldEJvdW5kcycsIGJvdW5kcylcbiAgICAgICAgY29uc3QgY29ybmVyMSA9IEwubGF0TG5nKGJvdW5kc1swXVswXSwgYm91bmRzWzBdWzFdKVxuICAgICAgICBjb25zdCBjb3JuZXIyID0gTC5sYXRMbmcoYm91bmRzWzFdWzBdLCBib3VuZHNbMV1bMV0pXG4gICAgICAgIGJvdW5kcyA9IEwubGF0TG5nQm91bmRzKGNvcm5lcjEsIGNvcm5lcjIpOyAgICAgICAgXG4gICAgICAgIEwuSW1hZ2VPdmVybGF5LnByb3RvdHlwZS5zZXRCb3VuZHMuY2FsbCh0aGlzLCBib3VuZHMpO1xuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH0gICAgXG59KTtcbiJdfQ==
